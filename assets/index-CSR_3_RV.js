(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function a(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=a(i);fetch(i.href,s)}})();var j_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pg(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Wp={exports:{}},ko={},Qp={exports:{}},De={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var es=Symbol.for("react.element"),mg=Symbol.for("react.portal"),fg=Symbol.for("react.fragment"),hg=Symbol.for("react.strict_mode"),gg=Symbol.for("react.profiler"),xg=Symbol.for("react.provider"),_g=Symbol.for("react.context"),vg=Symbol.for("react.forward_ref"),bg=Symbol.for("react.suspense"),yg=Symbol.for("react.memo"),Sg=Symbol.for("react.lazy"),ju=Symbol.iterator;function wg(e){return e===null||typeof e!="object"?null:(e=ju&&e[ju]||e["@@iterator"],typeof e=="function"?e:null)}var Gp={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Kp=Object.assign,Jp={};function ti(e,t,a){this.props=e,this.context=t,this.refs=Jp,this.updater=a||Gp}ti.prototype.isReactComponent={};ti.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ti.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Yp(){}Yp.prototype=ti.prototype;function qc(e,t,a){this.props=e,this.context=t,this.refs=Jp,this.updater=a||Gp}var Vc=qc.prototype=new Yp;Vc.constructor=qc;Kp(Vc,ti.prototype);Vc.isPureReactComponent=!0;var Nu=Array.isArray,Zp=Object.prototype.hasOwnProperty,Hc={current:null},Xp={key:!0,ref:!0,__self:!0,__source:!0};function em(e,t,a){var n,i={},s=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Zp.call(t,n)&&!Xp.hasOwnProperty(n)&&(i[n]=t[n]);var u=arguments.length-2;if(u===1)i.children=a;else if(1<u){for(var p=Array(u),v=0;v<u;v++)p[v]=arguments[v+2];i.children=p}if(e&&e.defaultProps)for(n in u=e.defaultProps,u)i[n]===void 0&&(i[n]=u[n]);return{$$typeof:es,type:e,key:s,ref:o,props:i,_owner:Hc.current}}function jg(e,t){return{$$typeof:es,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Wc(e){return typeof e=="object"&&e!==null&&e.$$typeof===es}function Ng(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(a){return t[a]})}var Cu=/\/+/g;function Sl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ng(""+e.key):t.toString(36)}function qs(e,t,a,n,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case es:case mg:o=!0}}if(o)return o=e,i=i(o),e=n===""?"."+Sl(o,0):n,Nu(i)?(a="",e!=null&&(a=e.replace(Cu,"$&/")+"/"),qs(i,t,a,"",function(v){return v})):i!=null&&(Wc(i)&&(i=jg(i,a+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Cu,"$&/")+"/")+e)),t.push(i)),1;if(o=0,n=n===""?".":n+":",Nu(e))for(var u=0;u<e.length;u++){s=e[u];var p=n+Sl(s,u);o+=qs(s,t,a,p,i)}else if(p=wg(e),typeof p=="function")for(e=p.call(e),u=0;!(s=e.next()).done;)s=s.value,p=n+Sl(s,u++),o+=qs(s,t,a,p,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function ws(e,t,a){if(e==null)return e;var n=[],i=0;return qs(e,n,"","",function(s){return t.call(a,s,i++)}),n}function Cg(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(a){(e._status===0||e._status===-1)&&(e._status=1,e._result=a)},function(a){(e._status===0||e._status===-1)&&(e._status=2,e._result=a)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ta={current:null},Vs={transition:null},Ag={ReactCurrentDispatcher:ta,ReactCurrentBatchConfig:Vs,ReactCurrentOwner:Hc};function tm(){throw Error("act(...) is not supported in production builds of React.")}De.Children={map:ws,forEach:function(e,t,a){ws(e,function(){t.apply(this,arguments)},a)},count:function(e){var t=0;return ws(e,function(){t++}),t},toArray:function(e){return ws(e,function(t){return t})||[]},only:function(e){if(!Wc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};De.Component=ti;De.Fragment=fg;De.Profiler=gg;De.PureComponent=qc;De.StrictMode=hg;De.Suspense=bg;De.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ag;De.act=tm;De.cloneElement=function(e,t,a){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Kp({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=Hc.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(p in t)Zp.call(t,p)&&!Xp.hasOwnProperty(p)&&(n[p]=t[p]===void 0&&u!==void 0?u[p]:t[p])}var p=arguments.length-2;if(p===1)n.children=a;else if(1<p){u=Array(p);for(var v=0;v<p;v++)u[v]=arguments[v+2];n.children=u}return{$$typeof:es,type:e.type,key:i,ref:s,props:n,_owner:o}};De.createContext=function(e){return e={$$typeof:_g,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:xg,_context:e},e.Consumer=e};De.createElement=em;De.createFactory=function(e){var t=em.bind(null,e);return t.type=e,t};De.createRef=function(){return{current:null}};De.forwardRef=function(e){return{$$typeof:vg,render:e}};De.isValidElement=Wc;De.lazy=function(e){return{$$typeof:Sg,_payload:{_status:-1,_result:e},_init:Cg}};De.memo=function(e,t){return{$$typeof:yg,type:e,compare:t===void 0?null:t}};De.startTransition=function(e){var t=Vs.transition;Vs.transition={};try{e()}finally{Vs.transition=t}};De.unstable_act=tm;De.useCallback=function(e,t){return ta.current.useCallback(e,t)};De.useContext=function(e){return ta.current.useContext(e)};De.useDebugValue=function(){};De.useDeferredValue=function(e){return ta.current.useDeferredValue(e)};De.useEffect=function(e,t){return ta.current.useEffect(e,t)};De.useId=function(){return ta.current.useId()};De.useImperativeHandle=function(e,t,a){return ta.current.useImperativeHandle(e,t,a)};De.useInsertionEffect=function(e,t){return ta.current.useInsertionEffect(e,t)};De.useLayoutEffect=function(e,t){return ta.current.useLayoutEffect(e,t)};De.useMemo=function(e,t){return ta.current.useMemo(e,t)};De.useReducer=function(e,t,a){return ta.current.useReducer(e,t,a)};De.useRef=function(e){return ta.current.useRef(e)};De.useState=function(e){return ta.current.useState(e)};De.useSyncExternalStore=function(e,t,a){return ta.current.useSyncExternalStore(e,t,a)};De.useTransition=function(){return ta.current.useTransition()};De.version="18.3.1";Qp.exports=De;var q=Qp.exports;const V=pg(q);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kg=q,Ig=Symbol.for("react.element"),Eg=Symbol.for("react.fragment"),Pg=Object.prototype.hasOwnProperty,Mg=kg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Tg={key:!0,ref:!0,__self:!0,__source:!0};function am(e,t,a){var n,i={},s=null,o=null;a!==void 0&&(s=""+a),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)Pg.call(t,n)&&!Tg.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)i[n]===void 0&&(i[n]=t[n]);return{$$typeof:Ig,type:e,key:s,ref:o,props:i,_owner:Mg.current}}ko.Fragment=Eg;ko.jsx=am;ko.jsxs=am;Wp.exports=ko;var r=Wp.exports,Kl={},nm={exports:{}},xa={},rm={exports:{}},im={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ee,ge){var fe=ee.length;ee.push(ge);e:for(;0<fe;){var Fe=fe-1>>>1,te=ee[Fe];if(0<i(te,ge))ee[Fe]=ge,ee[fe]=te,fe=Fe;else break e}}function a(ee){return ee.length===0?null:ee[0]}function n(ee){if(ee.length===0)return null;var ge=ee[0],fe=ee.pop();if(fe!==ge){ee[0]=fe;e:for(var Fe=0,te=ee.length,_t=te>>>1;Fe<_t;){var wt=2*(Fe+1)-1,lt=ee[wt],gt=wt+1,jt=ee[gt];if(0>i(lt,fe))gt<te&&0>i(jt,lt)?(ee[Fe]=jt,ee[gt]=fe,Fe=gt):(ee[Fe]=lt,ee[wt]=fe,Fe=wt);else if(gt<te&&0>i(jt,fe))ee[Fe]=jt,ee[gt]=fe,Fe=gt;else break e}}return ge}function i(ee,ge){var fe=ee.sortIndex-ge.sortIndex;return fe!==0?fe:ee.id-ge.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,u=o.now();e.unstable_now=function(){return o.now()-u}}var p=[],v=[],_=1,b=null,j=3,E=!1,F=!1,D=!1,me=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(ee){for(var ge=a(v);ge!==null;){if(ge.callback===null)n(v);else if(ge.startTime<=ee)n(v),ge.sortIndex=ge.expirationTime,t(p,ge);else break;ge=a(v)}}function L(ee){if(D=!1,O(ee),!F)if(a(p)!==null)F=!0,T(ie);else{var ge=a(v);ge!==null&&de(L,ge.startTime-ee)}}function ie(ee,ge){F=!1,D&&(D=!1,N(M),M=-1),E=!0;var fe=j;try{for(O(ge),b=a(p);b!==null&&(!(b.expirationTime>ge)||ee&&!U());){var Fe=b.callback;if(typeof Fe=="function"){b.callback=null,j=b.priorityLevel;var te=Fe(b.expirationTime<=ge);ge=e.unstable_now(),typeof te=="function"?b.callback=te:b===a(p)&&n(p),O(ge)}else n(p);b=a(p)}if(b!==null)var _t=!0;else{var wt=a(v);wt!==null&&de(L,wt.startTime-ge),_t=!1}return _t}finally{b=null,j=fe,E=!1}}var Y=!1,Z=null,M=-1,K=5,C=-1;function U(){return!(e.unstable_now()-C<K)}function R(){if(Z!==null){var ee=e.unstable_now();C=ee;var ge=!0;try{ge=Z(!0,ee)}finally{ge?H():(Y=!1,Z=null)}}else Y=!1}var H;if(typeof y=="function")H=function(){y(R)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ne=X.port2;X.port1.onmessage=R,H=function(){ne.postMessage(null)}}else H=function(){me(R,0)};function T(ee){Z=ee,Y||(Y=!0,H())}function de(ee,ge){M=me(function(){ee(e.unstable_now())},ge)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ee){ee.callback=null},e.unstable_continueExecution=function(){F||E||(F=!0,T(ie))},e.unstable_forceFrameRate=function(ee){0>ee||125<ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<ee?Math.floor(1e3/ee):5},e.unstable_getCurrentPriorityLevel=function(){return j},e.unstable_getFirstCallbackNode=function(){return a(p)},e.unstable_next=function(ee){switch(j){case 1:case 2:case 3:var ge=3;break;default:ge=j}var fe=j;j=ge;try{return ee()}finally{j=fe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ee,ge){switch(ee){case 1:case 2:case 3:case 4:case 5:break;default:ee=3}var fe=j;j=ee;try{return ge()}finally{j=fe}},e.unstable_scheduleCallback=function(ee,ge,fe){var Fe=e.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?Fe+fe:Fe):fe=Fe,ee){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=fe+te,ee={id:_++,callback:ge,priorityLevel:ee,startTime:fe,expirationTime:te,sortIndex:-1},fe>Fe?(ee.sortIndex=fe,t(v,ee),a(p)===null&&ee===a(v)&&(D?(N(M),M=-1):D=!0,de(L,fe-Fe))):(ee.sortIndex=te,t(p,ee),F||E||(F=!0,T(ie))),ee},e.unstable_shouldYield=U,e.unstable_wrapCallback=function(ee){var ge=j;return function(){var fe=j;j=ge;try{return ee.apply(this,arguments)}finally{j=fe}}}})(im);rm.exports=im;var Og=rm.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rg=q,ga=Og;function re(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sm=new Set,Li={};function ur(e,t){Qr(e,t),Qr(e+"Capture",t)}function Qr(e,t){for(Li[e]=t,e=0;e<t.length;e++)sm.add(t[e])}var on=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jl=Object.prototype.hasOwnProperty,Lg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Au={},ku={};function zg(e){return Jl.call(ku,e)?!0:Jl.call(Au,e)?!1:Lg.test(e)?ku[e]=!0:(Au[e]=!0,!1)}function Fg(e,t,a,n){if(a!==null&&a.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:a!==null?!a.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Ug(e,t,a,n){if(t===null||typeof t>"u"||Fg(e,t,a,n))return!0;if(n)return!1;if(a!==null)switch(a.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function aa(e,t,a,n,i,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=a,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var Bt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Bt[e]=new aa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Bt[t]=new aa(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Bt[e]=new aa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Bt[e]=new aa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Bt[e]=new aa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Bt[e]=new aa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Bt[e]=new aa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Bt[e]=new aa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Bt[e]=new aa(e,5,!1,e.toLowerCase(),null,!1,!1)});var Qc=/[\-:]([a-z])/g;function Gc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Qc,Gc);Bt[t]=new aa(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Qc,Gc);Bt[t]=new aa(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Qc,Gc);Bt[t]=new aa(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Bt[e]=new aa(e,1,!1,e.toLowerCase(),null,!1,!1)});Bt.xlinkHref=new aa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Bt[e]=new aa(e,1,!1,e.toLowerCase(),null,!0,!0)});function Kc(e,t,a,n){var i=Bt.hasOwnProperty(t)?Bt[t]:null;(i!==null?i.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Ug(t,a,i,n)&&(a=null),n||i===null?zg(t)&&(a===null?e.removeAttribute(t):e.setAttribute(t,""+a)):i.mustUseProperty?e[i.propertyName]=a===null?i.type===3?!1:"":a:(t=i.attributeName,n=i.attributeNamespace,a===null?e.removeAttribute(t):(i=i.type,a=i===3||i===4&&a===!0?"":""+a,n?e.setAttributeNS(n,t,a):e.setAttribute(t,a))))}var un=Rg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,js=Symbol.for("react.element"),Ir=Symbol.for("react.portal"),Er=Symbol.for("react.fragment"),Jc=Symbol.for("react.strict_mode"),Yl=Symbol.for("react.profiler"),om=Symbol.for("react.provider"),lm=Symbol.for("react.context"),Yc=Symbol.for("react.forward_ref"),Zl=Symbol.for("react.suspense"),Xl=Symbol.for("react.suspense_list"),Zc=Symbol.for("react.memo"),vn=Symbol.for("react.lazy"),cm=Symbol.for("react.offscreen"),Iu=Symbol.iterator;function fi(e){return e===null||typeof e!="object"?null:(e=Iu&&e[Iu]||e["@@iterator"],typeof e=="function"?e:null)}var ht=Object.assign,wl;function Si(e){if(wl===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);wl=t&&t[1]||""}return`
`+wl+e}var jl=!1;function Nl(e,t){if(!e||jl)return"";jl=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(v){var n=v}Reflect.construct(e,[],t)}else{try{t.call()}catch(v){n=v}e.call(t.prototype)}else{try{throw Error()}catch(v){n=v}e()}}catch(v){if(v&&n&&typeof v.stack=="string"){for(var i=v.stack.split(`
`),s=n.stack.split(`
`),o=i.length-1,u=s.length-1;1<=o&&0<=u&&i[o]!==s[u];)u--;for(;1<=o&&0<=u;o--,u--)if(i[o]!==s[u]){if(o!==1||u!==1)do if(o--,u--,0>u||i[o]!==s[u]){var p=`
`+i[o].replace(" at new "," at ");return e.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",e.displayName)),p}while(1<=o&&0<=u);break}}}finally{jl=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?Si(e):""}function Dg(e){switch(e.tag){case 5:return Si(e.type);case 16:return Si("Lazy");case 13:return Si("Suspense");case 19:return Si("SuspenseList");case 0:case 2:case 15:return e=Nl(e.type,!1),e;case 11:return e=Nl(e.type.render,!1),e;case 1:return e=Nl(e.type,!0),e;default:return""}}function ec(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Er:return"Fragment";case Ir:return"Portal";case Yl:return"Profiler";case Jc:return"StrictMode";case Zl:return"Suspense";case Xl:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case lm:return(e.displayName||"Context")+".Consumer";case om:return(e._context.displayName||"Context")+".Provider";case Yc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Zc:return t=e.displayName||null,t!==null?t:ec(e.type)||"Memo";case vn:t=e._payload,e=e._init;try{return ec(e(t))}catch{}}return null}function $g(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ec(t);case 8:return t===Jc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function On(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function dm(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Bg(e){var t=dm(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var i=a.get,s=a.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:a.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ns(e){e._valueTracker||(e._valueTracker=Bg(e))}function um(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=dm(e)?e.checked?"true":"false":e.value),e=n,e!==a?(t.setValue(e),!0):!1}function ao(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function tc(e,t){var a=t.checked;return ht({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??e._wrapperState.initialChecked})}function Eu(e,t){var a=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;a=On(t.value!=null?t.value:a),e._wrapperState={initialChecked:n,initialValue:a,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pm(e,t){t=t.checked,t!=null&&Kc(e,"checked",t,!1)}function ac(e,t){pm(e,t);var a=On(t.value),n=t.type;if(a!=null)n==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?nc(e,t.type,a):t.hasOwnProperty("defaultValue")&&nc(e,t.type,On(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Pu(e,t,a){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,a||t===e.value||(e.value=t),e.defaultValue=t}a=e.name,a!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,a!==""&&(e.name=a)}function nc(e,t,a){(t!=="number"||ao(e.ownerDocument)!==e)&&(a==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var wi=Array.isArray;function $r(e,t,a,n){if(e=e.options,t){t={};for(var i=0;i<a.length;i++)t["$"+a[i]]=!0;for(a=0;a<e.length;a++)i=t.hasOwnProperty("$"+e[a].value),e[a].selected!==i&&(e[a].selected=i),i&&n&&(e[a].defaultSelected=!0)}else{for(a=""+On(a),t=null,i=0;i<e.length;i++){if(e[i].value===a){e[i].selected=!0,n&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function rc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(re(91));return ht({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Mu(e,t){var a=t.value;if(a==null){if(a=t.children,t=t.defaultValue,a!=null){if(t!=null)throw Error(re(92));if(wi(a)){if(1<a.length)throw Error(re(93));a=a[0]}t=a}t==null&&(t=""),a=t}e._wrapperState={initialValue:On(a)}}function mm(e,t){var a=On(t.value),n=On(t.defaultValue);a!=null&&(a=""+a,a!==e.value&&(e.value=a),t.defaultValue==null&&e.defaultValue!==a&&(e.defaultValue=a)),n!=null&&(e.defaultValue=""+n)}function Tu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function fm(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ic(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?fm(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Cs,hm=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,a,n,i){MSApp.execUnsafeLocalFunction(function(){return e(t,a,n,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Cs=Cs||document.createElement("div"),Cs.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Cs.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function zi(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var Ci={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qg=["Webkit","ms","Moz","O"];Object.keys(Ci).forEach(function(e){qg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ci[t]=Ci[e]})});function gm(e,t,a){return t==null||typeof t=="boolean"||t===""?"":a||typeof t!="number"||t===0||Ci.hasOwnProperty(e)&&Ci[e]?(""+t).trim():t+"px"}function xm(e,t){e=e.style;for(var a in t)if(t.hasOwnProperty(a)){var n=a.indexOf("--")===0,i=gm(a,t[a],n);a==="float"&&(a="cssFloat"),n?e.setProperty(a,i):e[a]=i}}var Vg=ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sc(e,t){if(t){if(Vg[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(re(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(re(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(re(61))}if(t.style!=null&&typeof t.style!="object")throw Error(re(62))}}function oc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lc=null;function Xc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var cc=null,Br=null,qr=null;function Ou(e){if(e=ns(e)){if(typeof cc!="function")throw Error(re(280));var t=e.stateNode;t&&(t=To(t),cc(e.stateNode,e.type,t))}}function _m(e){Br?qr?qr.push(e):qr=[e]:Br=e}function vm(){if(Br){var e=Br,t=qr;if(qr=Br=null,Ou(e),t)for(e=0;e<t.length;e++)Ou(t[e])}}function bm(e,t){return e(t)}function ym(){}var Cl=!1;function Sm(e,t,a){if(Cl)return e(t,a);Cl=!0;try{return bm(e,t,a)}finally{Cl=!1,(Br!==null||qr!==null)&&(ym(),vm())}}function Fi(e,t){var a=e.stateNode;if(a===null)return null;var n=To(a);if(n===null)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(re(231,t,typeof a));return a}var dc=!1;if(on)try{var hi={};Object.defineProperty(hi,"passive",{get:function(){dc=!0}}),window.addEventListener("test",hi,hi),window.removeEventListener("test",hi,hi)}catch{dc=!1}function Hg(e,t,a,n,i,s,o,u,p){var v=Array.prototype.slice.call(arguments,3);try{t.apply(a,v)}catch(_){this.onError(_)}}var Ai=!1,no=null,ro=!1,uc=null,Wg={onError:function(e){Ai=!0,no=e}};function Qg(e,t,a,n,i,s,o,u,p){Ai=!1,no=null,Hg.apply(Wg,arguments)}function Gg(e,t,a,n,i,s,o,u,p){if(Qg.apply(this,arguments),Ai){if(Ai){var v=no;Ai=!1,no=null}else throw Error(re(198));ro||(ro=!0,uc=v)}}function pr(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function wm(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Ru(e){if(pr(e)!==e)throw Error(re(188))}function Kg(e){var t=e.alternate;if(!t){if(t=pr(e),t===null)throw Error(re(188));return t!==e?null:e}for(var a=e,n=t;;){var i=a.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){a=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===a)return Ru(i),e;if(s===n)return Ru(i),t;s=s.sibling}throw Error(re(188))}if(a.return!==n.return)a=i,n=s;else{for(var o=!1,u=i.child;u;){if(u===a){o=!0,a=i,n=s;break}if(u===n){o=!0,n=i,a=s;break}u=u.sibling}if(!o){for(u=s.child;u;){if(u===a){o=!0,a=s,n=i;break}if(u===n){o=!0,n=s,a=i;break}u=u.sibling}if(!o)throw Error(re(189))}}if(a.alternate!==n)throw Error(re(190))}if(a.tag!==3)throw Error(re(188));return a.stateNode.current===a?e:t}function jm(e){return e=Kg(e),e!==null?Nm(e):null}function Nm(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Nm(e);if(t!==null)return t;e=e.sibling}return null}var Cm=ga.unstable_scheduleCallback,Lu=ga.unstable_cancelCallback,Jg=ga.unstable_shouldYield,Yg=ga.unstable_requestPaint,St=ga.unstable_now,Zg=ga.unstable_getCurrentPriorityLevel,ed=ga.unstable_ImmediatePriority,Am=ga.unstable_UserBlockingPriority,io=ga.unstable_NormalPriority,Xg=ga.unstable_LowPriority,km=ga.unstable_IdlePriority,Io=null,Ka=null;function ex(e){if(Ka&&typeof Ka.onCommitFiberRoot=="function")try{Ka.onCommitFiberRoot(Io,e,void 0,(e.current.flags&128)===128)}catch{}}var za=Math.clz32?Math.clz32:nx,tx=Math.log,ax=Math.LN2;function nx(e){return e>>>=0,e===0?32:31-(tx(e)/ax|0)|0}var As=64,ks=4194304;function ji(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function so(e,t){var a=e.pendingLanes;if(a===0)return 0;var n=0,i=e.suspendedLanes,s=e.pingedLanes,o=a&268435455;if(o!==0){var u=o&~i;u!==0?n=ji(u):(s&=o,s!==0&&(n=ji(s)))}else o=a&~i,o!==0?n=ji(o):s!==0&&(n=ji(s));if(n===0)return 0;if(t!==0&&t!==n&&!(t&i)&&(i=n&-n,s=t&-t,i>=s||i===16&&(s&4194240)!==0))return t;if(n&4&&(n|=a&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)a=31-za(t),i=1<<a,n|=e[a],t&=~i;return n}function rx(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ix(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-za(s),u=1<<o,p=i[o];p===-1?(!(u&a)||u&n)&&(i[o]=rx(u,t)):p<=t&&(e.expiredLanes|=u),s&=~u}}function pc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Im(){var e=As;return As<<=1,!(As&4194240)&&(As=64),e}function Al(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function ts(e,t,a){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-za(t),e[t]=a}function sx(e,t){var a=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<a;){var i=31-za(a),s=1<<i;t[i]=0,n[i]=-1,e[i]=-1,a&=~s}}function td(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-za(a),i=1<<n;i&t|e[n]&t&&(e[n]|=t),a&=~i}}var Ye=0;function Em(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Pm,ad,Mm,Tm,Om,mc=!1,Is=[],Cn=null,An=null,kn=null,Ui=new Map,Di=new Map,Sn=[],ox="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zu(e,t){switch(e){case"focusin":case"focusout":Cn=null;break;case"dragenter":case"dragleave":An=null;break;case"mouseover":case"mouseout":kn=null;break;case"pointerover":case"pointerout":Ui.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Di.delete(t.pointerId)}}function gi(e,t,a,n,i,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},t!==null&&(t=ns(t),t!==null&&ad(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function lx(e,t,a,n,i){switch(t){case"focusin":return Cn=gi(Cn,e,t,a,n,i),!0;case"dragenter":return An=gi(An,e,t,a,n,i),!0;case"mouseover":return kn=gi(kn,e,t,a,n,i),!0;case"pointerover":var s=i.pointerId;return Ui.set(s,gi(Ui.get(s)||null,e,t,a,n,i)),!0;case"gotpointercapture":return s=i.pointerId,Di.set(s,gi(Di.get(s)||null,e,t,a,n,i)),!0}return!1}function Rm(e){var t=Yn(e.target);if(t!==null){var a=pr(t);if(a!==null){if(t=a.tag,t===13){if(t=wm(a),t!==null){e.blockedOn=t,Om(e.priority,function(){Mm(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Hs(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=fc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(a===null){a=e.nativeEvent;var n=new a.constructor(a.type,a);lc=n,a.target.dispatchEvent(n),lc=null}else return t=ns(a),t!==null&&ad(t),e.blockedOn=a,!1;t.shift()}return!0}function Fu(e,t,a){Hs(e)&&a.delete(t)}function cx(){mc=!1,Cn!==null&&Hs(Cn)&&(Cn=null),An!==null&&Hs(An)&&(An=null),kn!==null&&Hs(kn)&&(kn=null),Ui.forEach(Fu),Di.forEach(Fu)}function xi(e,t){e.blockedOn===t&&(e.blockedOn=null,mc||(mc=!0,ga.unstable_scheduleCallback(ga.unstable_NormalPriority,cx)))}function $i(e){function t(i){return xi(i,e)}if(0<Is.length){xi(Is[0],e);for(var a=1;a<Is.length;a++){var n=Is[a];n.blockedOn===e&&(n.blockedOn=null)}}for(Cn!==null&&xi(Cn,e),An!==null&&xi(An,e),kn!==null&&xi(kn,e),Ui.forEach(t),Di.forEach(t),a=0;a<Sn.length;a++)n=Sn[a],n.blockedOn===e&&(n.blockedOn=null);for(;0<Sn.length&&(a=Sn[0],a.blockedOn===null);)Rm(a),a.blockedOn===null&&Sn.shift()}var Vr=un.ReactCurrentBatchConfig,oo=!0;function dx(e,t,a,n){var i=Ye,s=Vr.transition;Vr.transition=null;try{Ye=1,nd(e,t,a,n)}finally{Ye=i,Vr.transition=s}}function ux(e,t,a,n){var i=Ye,s=Vr.transition;Vr.transition=null;try{Ye=4,nd(e,t,a,n)}finally{Ye=i,Vr.transition=s}}function nd(e,t,a,n){if(oo){var i=fc(e,t,a,n);if(i===null)zl(e,t,n,lo,a),zu(e,n);else if(lx(i,e,t,a,n))n.stopPropagation();else if(zu(e,n),t&4&&-1<ox.indexOf(e)){for(;i!==null;){var s=ns(i);if(s!==null&&Pm(s),s=fc(e,t,a,n),s===null&&zl(e,t,n,lo,a),s===i)break;i=s}i!==null&&n.stopPropagation()}else zl(e,t,n,null,a)}}var lo=null;function fc(e,t,a,n){if(lo=null,e=Xc(n),e=Yn(e),e!==null)if(t=pr(e),t===null)e=null;else if(a=t.tag,a===13){if(e=wm(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return lo=e,null}function Lm(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zg()){case ed:return 1;case Am:return 4;case io:case Xg:return 16;case km:return 536870912;default:return 16}default:return 16}}var jn=null,rd=null,Ws=null;function zm(){if(Ws)return Ws;var e,t=rd,a=t.length,n,i="value"in jn?jn.value:jn.textContent,s=i.length;for(e=0;e<a&&t[e]===i[e];e++);var o=a-e;for(n=1;n<=o&&t[a-n]===i[s-n];n++);return Ws=i.slice(e,1<n?1-n:void 0)}function Qs(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Es(){return!0}function Uu(){return!1}function _a(e){function t(a,n,i,s,o){this._reactName=a,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var u in e)e.hasOwnProperty(u)&&(a=e[u],this[u]=a?a(s):s[u]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Es:Uu,this.isPropagationStopped=Uu,this}return ht(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Es)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Es)},persist:function(){},isPersistent:Es}),t}var ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},id=_a(ai),as=ht({},ai,{view:0,detail:0}),px=_a(as),kl,Il,_i,Eo=ht({},as,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==_i&&(_i&&e.type==="mousemove"?(kl=e.screenX-_i.screenX,Il=e.screenY-_i.screenY):Il=kl=0,_i=e),kl)},movementY:function(e){return"movementY"in e?e.movementY:Il}}),Du=_a(Eo),mx=ht({},Eo,{dataTransfer:0}),fx=_a(mx),hx=ht({},as,{relatedTarget:0}),El=_a(hx),gx=ht({},ai,{animationName:0,elapsedTime:0,pseudoElement:0}),xx=_a(gx),_x=ht({},ai,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vx=_a(_x),bx=ht({},ai,{data:0}),$u=_a(bx),yx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jx(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=wx[e])?!!t[e]:!1}function sd(){return jx}var Nx=ht({},as,{key:function(e){if(e.key){var t=yx[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Qs(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Sx[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sd,charCode:function(e){return e.type==="keypress"?Qs(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Qs(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Cx=_a(Nx),Ax=ht({},Eo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bu=_a(Ax),kx=ht({},as,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sd}),Ix=_a(kx),Ex=ht({},ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),Px=_a(Ex),Mx=ht({},Eo,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Tx=_a(Mx),Ox=[9,13,27,32],od=on&&"CompositionEvent"in window,ki=null;on&&"documentMode"in document&&(ki=document.documentMode);var Rx=on&&"TextEvent"in window&&!ki,Fm=on&&(!od||ki&&8<ki&&11>=ki),qu=" ",Vu=!1;function Um(e,t){switch(e){case"keyup":return Ox.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dm(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Pr=!1;function Lx(e,t){switch(e){case"compositionend":return Dm(t);case"keypress":return t.which!==32?null:(Vu=!0,qu);case"textInput":return e=t.data,e===qu&&Vu?null:e;default:return null}}function zx(e,t){if(Pr)return e==="compositionend"||!od&&Um(e,t)?(e=zm(),Ws=rd=jn=null,Pr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fm&&t.locale!=="ko"?null:t.data;default:return null}}var Fx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Fx[e.type]:t==="textarea"}function $m(e,t,a,n){_m(n),t=co(t,"onChange"),0<t.length&&(a=new id("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var Ii=null,Bi=null;function Ux(e){Zm(e,0)}function Po(e){var t=Or(e);if(um(t))return e}function Dx(e,t){if(e==="change")return t}var Bm=!1;if(on){var Pl;if(on){var Ml="oninput"in document;if(!Ml){var Wu=document.createElement("div");Wu.setAttribute("oninput","return;"),Ml=typeof Wu.oninput=="function"}Pl=Ml}else Pl=!1;Bm=Pl&&(!document.documentMode||9<document.documentMode)}function Qu(){Ii&&(Ii.detachEvent("onpropertychange",qm),Bi=Ii=null)}function qm(e){if(e.propertyName==="value"&&Po(Bi)){var t=[];$m(t,Bi,e,Xc(e)),Sm(Ux,t)}}function $x(e,t,a){e==="focusin"?(Qu(),Ii=t,Bi=a,Ii.attachEvent("onpropertychange",qm)):e==="focusout"&&Qu()}function Bx(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Po(Bi)}function qx(e,t){if(e==="click")return Po(t)}function Vx(e,t){if(e==="input"||e==="change")return Po(t)}function Hx(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Ua=typeof Object.is=="function"?Object.is:Hx;function qi(e,t){if(Ua(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var i=a[n];if(!Jl.call(t,i)||!Ua(e[i],t[i]))return!1}return!0}function Gu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ku(e,t){var a=Gu(e);e=0;for(var n;a;){if(a.nodeType===3){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Gu(a)}}function Vm(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Vm(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Hm(){for(var e=window,t=ao();t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=ao(e.document)}return t}function ld(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Wx(e){var t=Hm(),a=e.focusedElem,n=e.selectionRange;if(t!==a&&a&&a.ownerDocument&&Vm(a.ownerDocument.documentElement,a)){if(n!==null&&ld(a)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in a)a.selectionStart=t,a.selectionEnd=Math.min(e,a.value.length);else if(e=(t=a.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=a.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!e.extend&&s>n&&(i=n,n=s,s=i),i=Ku(a,s);var o=Ku(a,n);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),s>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=a;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<t.length;a++)e=t[a],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Qx=on&&"documentMode"in document&&11>=document.documentMode,Mr=null,hc=null,Ei=null,gc=!1;function Ju(e,t,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;gc||Mr==null||Mr!==ao(n)||(n=Mr,"selectionStart"in n&&ld(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Ei&&qi(Ei,n)||(Ei=n,n=co(hc,"onSelect"),0<n.length&&(t=new id("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=Mr)))}function Ps(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Tr={animationend:Ps("Animation","AnimationEnd"),animationiteration:Ps("Animation","AnimationIteration"),animationstart:Ps("Animation","AnimationStart"),transitionend:Ps("Transition","TransitionEnd")},Tl={},Wm={};on&&(Wm=document.createElement("div").style,"AnimationEvent"in window||(delete Tr.animationend.animation,delete Tr.animationiteration.animation,delete Tr.animationstart.animation),"TransitionEvent"in window||delete Tr.transitionend.transition);function Mo(e){if(Tl[e])return Tl[e];if(!Tr[e])return e;var t=Tr[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Wm)return Tl[e]=t[a];return e}var Qm=Mo("animationend"),Gm=Mo("animationiteration"),Km=Mo("animationstart"),Jm=Mo("transitionend"),Ym=new Map,Yu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ln(e,t){Ym.set(e,t),ur(t,[e])}for(var Ol=0;Ol<Yu.length;Ol++){var Rl=Yu[Ol],Gx=Rl.toLowerCase(),Kx=Rl[0].toUpperCase()+Rl.slice(1);Ln(Gx,"on"+Kx)}Ln(Qm,"onAnimationEnd");Ln(Gm,"onAnimationIteration");Ln(Km,"onAnimationStart");Ln("dblclick","onDoubleClick");Ln("focusin","onFocus");Ln("focusout","onBlur");Ln(Jm,"onTransitionEnd");Qr("onMouseEnter",["mouseout","mouseover"]);Qr("onMouseLeave",["mouseout","mouseover"]);Qr("onPointerEnter",["pointerout","pointerover"]);Qr("onPointerLeave",["pointerout","pointerover"]);ur("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ur("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ur("onBeforeInput",["compositionend","keypress","textInput","paste"]);ur("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ur("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ur("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ni="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ni));function Zu(e,t,a){var n=e.type||"unknown-event";e.currentTarget=a,Gg(n,t,void 0,e),e.currentTarget=null}function Zm(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var n=e[a],i=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var o=n.length-1;0<=o;o--){var u=n[o],p=u.instance,v=u.currentTarget;if(u=u.listener,p!==s&&i.isPropagationStopped())break e;Zu(i,u,v),s=p}else for(o=0;o<n.length;o++){if(u=n[o],p=u.instance,v=u.currentTarget,u=u.listener,p!==s&&i.isPropagationStopped())break e;Zu(i,u,v),s=p}}}if(ro)throw e=uc,ro=!1,uc=null,e}function nt(e,t){var a=t[yc];a===void 0&&(a=t[yc]=new Set);var n=e+"__bubble";a.has(n)||(Xm(t,e,2,!1),a.add(n))}function Ll(e,t,a){var n=0;t&&(n|=4),Xm(a,e,n,t)}var Ms="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){if(!e[Ms]){e[Ms]=!0,sm.forEach(function(a){a!=="selectionchange"&&(Jx.has(a)||Ll(a,!1,e),Ll(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ms]||(t[Ms]=!0,Ll("selectionchange",!1,t))}}function Xm(e,t,a,n){switch(Lm(t)){case 1:var i=dx;break;case 4:i=ux;break;default:i=nd}a=i.bind(null,t,a,e),i=void 0,!dc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),n?i!==void 0?e.addEventListener(t,a,{capture:!0,passive:i}):e.addEventListener(t,a,!0):i!==void 0?e.addEventListener(t,a,{passive:i}):e.addEventListener(t,a,!1)}function zl(e,t,a,n,i){var s=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var u=n.stateNode.containerInfo;if(u===i||u.nodeType===8&&u.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var p=o.tag;if((p===3||p===4)&&(p=o.stateNode.containerInfo,p===i||p.nodeType===8&&p.parentNode===i))return;o=o.return}for(;u!==null;){if(o=Yn(u),o===null)return;if(p=o.tag,p===5||p===6){n=s=o;continue e}u=u.parentNode}}n=n.return}Sm(function(){var v=s,_=Xc(a),b=[];e:{var j=Ym.get(e);if(j!==void 0){var E=id,F=e;switch(e){case"keypress":if(Qs(a)===0)break e;case"keydown":case"keyup":E=Cx;break;case"focusin":F="focus",E=El;break;case"focusout":F="blur",E=El;break;case"beforeblur":case"afterblur":E=El;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":E=Du;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":E=fx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":E=Ix;break;case Qm:case Gm:case Km:E=xx;break;case Jm:E=Px;break;case"scroll":E=px;break;case"wheel":E=Tx;break;case"copy":case"cut":case"paste":E=vx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":E=Bu}var D=(t&4)!==0,me=!D&&e==="scroll",N=D?j!==null?j+"Capture":null:j;D=[];for(var y=v,O;y!==null;){O=y;var L=O.stateNode;if(O.tag===5&&L!==null&&(O=L,N!==null&&(L=Fi(y,N),L!=null&&D.push(Hi(y,L,O)))),me)break;y=y.return}0<D.length&&(j=new E(j,F,null,a,_),b.push({event:j,listeners:D}))}}if(!(t&7)){e:{if(j=e==="mouseover"||e==="pointerover",E=e==="mouseout"||e==="pointerout",j&&a!==lc&&(F=a.relatedTarget||a.fromElement)&&(Yn(F)||F[ln]))break e;if((E||j)&&(j=_.window===_?_:(j=_.ownerDocument)?j.defaultView||j.parentWindow:window,E?(F=a.relatedTarget||a.toElement,E=v,F=F?Yn(F):null,F!==null&&(me=pr(F),F!==me||F.tag!==5&&F.tag!==6)&&(F=null)):(E=null,F=v),E!==F)){if(D=Du,L="onMouseLeave",N="onMouseEnter",y="mouse",(e==="pointerout"||e==="pointerover")&&(D=Bu,L="onPointerLeave",N="onPointerEnter",y="pointer"),me=E==null?j:Or(E),O=F==null?j:Or(F),j=new D(L,y+"leave",E,a,_),j.target=me,j.relatedTarget=O,L=null,Yn(_)===v&&(D=new D(N,y+"enter",F,a,_),D.target=O,D.relatedTarget=me,L=D),me=L,E&&F)t:{for(D=E,N=F,y=0,O=D;O;O=kr(O))y++;for(O=0,L=N;L;L=kr(L))O++;for(;0<y-O;)D=kr(D),y--;for(;0<O-y;)N=kr(N),O--;for(;y--;){if(D===N||N!==null&&D===N.alternate)break t;D=kr(D),N=kr(N)}D=null}else D=null;E!==null&&Xu(b,j,E,D,!1),F!==null&&me!==null&&Xu(b,me,F,D,!0)}}e:{if(j=v?Or(v):window,E=j.nodeName&&j.nodeName.toLowerCase(),E==="select"||E==="input"&&j.type==="file")var ie=Dx;else if(Hu(j))if(Bm)ie=Vx;else{ie=Bx;var Y=$x}else(E=j.nodeName)&&E.toLowerCase()==="input"&&(j.type==="checkbox"||j.type==="radio")&&(ie=qx);if(ie&&(ie=ie(e,v))){$m(b,ie,a,_);break e}Y&&Y(e,j,v),e==="focusout"&&(Y=j._wrapperState)&&Y.controlled&&j.type==="number"&&nc(j,"number",j.value)}switch(Y=v?Or(v):window,e){case"focusin":(Hu(Y)||Y.contentEditable==="true")&&(Mr=Y,hc=v,Ei=null);break;case"focusout":Ei=hc=Mr=null;break;case"mousedown":gc=!0;break;case"contextmenu":case"mouseup":case"dragend":gc=!1,Ju(b,a,_);break;case"selectionchange":if(Qx)break;case"keydown":case"keyup":Ju(b,a,_)}var Z;if(od)e:{switch(e){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Pr?Um(e,a)&&(M="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(M="onCompositionStart");M&&(Fm&&a.locale!=="ko"&&(Pr||M!=="onCompositionStart"?M==="onCompositionEnd"&&Pr&&(Z=zm()):(jn=_,rd="value"in jn?jn.value:jn.textContent,Pr=!0)),Y=co(v,M),0<Y.length&&(M=new $u(M,e,null,a,_),b.push({event:M,listeners:Y}),Z?M.data=Z:(Z=Dm(a),Z!==null&&(M.data=Z)))),(Z=Rx?Lx(e,a):zx(e,a))&&(v=co(v,"onBeforeInput"),0<v.length&&(_=new $u("onBeforeInput","beforeinput",null,a,_),b.push({event:_,listeners:v}),_.data=Z))}Zm(b,t)})}function Hi(e,t,a){return{instance:e,listener:t,currentTarget:a}}function co(e,t){for(var a=t+"Capture",n=[];e!==null;){var i=e,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Fi(e,a),s!=null&&n.unshift(Hi(e,s,i)),s=Fi(e,t),s!=null&&n.push(Hi(e,s,i))),e=e.return}return n}function kr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Xu(e,t,a,n,i){for(var s=t._reactName,o=[];a!==null&&a!==n;){var u=a,p=u.alternate,v=u.stateNode;if(p!==null&&p===n)break;u.tag===5&&v!==null&&(u=v,i?(p=Fi(a,s),p!=null&&o.unshift(Hi(a,p,u))):i||(p=Fi(a,s),p!=null&&o.push(Hi(a,p,u)))),a=a.return}o.length!==0&&e.push({event:t,listeners:o})}var Yx=/\r\n?/g,Zx=/\u0000|\uFFFD/g;function ep(e){return(typeof e=="string"?e:""+e).replace(Yx,`
`).replace(Zx,"")}function Ts(e,t,a){if(t=ep(t),ep(e)!==t&&a)throw Error(re(425))}function uo(){}var xc=null,_c=null;function vc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var bc=typeof setTimeout=="function"?setTimeout:void 0,Xx=typeof clearTimeout=="function"?clearTimeout:void 0,tp=typeof Promise=="function"?Promise:void 0,e1=typeof queueMicrotask=="function"?queueMicrotask:typeof tp<"u"?function(e){return tp.resolve(null).then(e).catch(t1)}:bc;function t1(e){setTimeout(function(){throw e})}function Fl(e,t){var a=t,n=0;do{var i=a.nextSibling;if(e.removeChild(a),i&&i.nodeType===8)if(a=i.data,a==="/$"){if(n===0){e.removeChild(i),$i(t);return}n--}else a!=="$"&&a!=="$?"&&a!=="$!"||n++;a=i}while(a);$i(t)}function In(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function ap(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return e;t--}else a==="/$"&&t++}e=e.previousSibling}return null}var ni=Math.random().toString(36).slice(2),Ga="__reactFiber$"+ni,Wi="__reactProps$"+ni,ln="__reactContainer$"+ni,yc="__reactEvents$"+ni,a1="__reactListeners$"+ni,n1="__reactHandles$"+ni;function Yn(e){var t=e[Ga];if(t)return t;for(var a=e.parentNode;a;){if(t=a[ln]||a[Ga]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=ap(e);e!==null;){if(a=e[Ga])return a;e=ap(e)}return t}e=a,a=e.parentNode}return null}function ns(e){return e=e[Ga]||e[ln],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Or(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(re(33))}function To(e){return e[Wi]||null}var Sc=[],Rr=-1;function zn(e){return{current:e}}function rt(e){0>Rr||(e.current=Sc[Rr],Sc[Rr]=null,Rr--)}function et(e,t){Rr++,Sc[Rr]=e.current,e.current=t}var Rn={},Qt=zn(Rn),sa=zn(!1),ir=Rn;function Gr(e,t){var a=e.type.contextTypes;if(!a)return Rn;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in a)i[s]=t[s];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function oa(e){return e=e.childContextTypes,e!=null}function po(){rt(sa),rt(Qt)}function np(e,t,a){if(Qt.current!==Rn)throw Error(re(168));et(Qt,t),et(sa,a)}function ef(e,t,a){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return a;n=n.getChildContext();for(var i in n)if(!(i in t))throw Error(re(108,$g(e)||"Unknown",i));return ht({},a,n)}function mo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Rn,ir=Qt.current,et(Qt,e),et(sa,sa.current),!0}function rp(e,t,a){var n=e.stateNode;if(!n)throw Error(re(169));a?(e=ef(e,t,ir),n.__reactInternalMemoizedMergedChildContext=e,rt(sa),rt(Qt),et(Qt,e)):rt(sa),et(sa,a)}var an=null,Oo=!1,Ul=!1;function tf(e){an===null?an=[e]:an.push(e)}function r1(e){Oo=!0,tf(e)}function Fn(){if(!Ul&&an!==null){Ul=!0;var e=0,t=Ye;try{var a=an;for(Ye=1;e<a.length;e++){var n=a[e];do n=n(!0);while(n!==null)}an=null,Oo=!1}catch(i){throw an!==null&&(an=an.slice(e+1)),Cm(ed,Fn),i}finally{Ye=t,Ul=!1}}return null}var Lr=[],zr=0,fo=null,ho=0,ja=[],Na=0,sr=null,nn=1,rn="";function Kn(e,t){Lr[zr++]=ho,Lr[zr++]=fo,fo=e,ho=t}function af(e,t,a){ja[Na++]=nn,ja[Na++]=rn,ja[Na++]=sr,sr=e;var n=nn;e=rn;var i=32-za(n)-1;n&=~(1<<i),a+=1;var s=32-za(t)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,nn=1<<32-za(t)+i|a<<i|n,rn=s+e}else nn=1<<s|a<<i|n,rn=e}function cd(e){e.return!==null&&(Kn(e,1),af(e,1,0))}function dd(e){for(;e===fo;)fo=Lr[--zr],Lr[zr]=null,ho=Lr[--zr],Lr[zr]=null;for(;e===sr;)sr=ja[--Na],ja[Na]=null,rn=ja[--Na],ja[Na]=null,nn=ja[--Na],ja[Na]=null}var ha=null,fa=null,ot=!1,La=null;function nf(e,t){var a=Ca(5,null,null,0);a.elementType="DELETED",a.stateNode=t,a.return=e,t=e.deletions,t===null?(e.deletions=[a],e.flags|=16):t.push(a)}function ip(e,t){switch(e.tag){case 5:var a=e.type;return t=t.nodeType!==1||a.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,ha=e,fa=In(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,ha=e,fa=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(a=sr!==null?{id:nn,overflow:rn}:null,e.memoizedState={dehydrated:t,treeContext:a,retryLane:1073741824},a=Ca(18,null,null,0),a.stateNode=t,a.return=e,e.child=a,ha=e,fa=null,!0):!1;default:return!1}}function wc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jc(e){if(ot){var t=fa;if(t){var a=t;if(!ip(e,t)){if(wc(e))throw Error(re(418));t=In(a.nextSibling);var n=ha;t&&ip(e,t)?nf(n,a):(e.flags=e.flags&-4097|2,ot=!1,ha=e)}}else{if(wc(e))throw Error(re(418));e.flags=e.flags&-4097|2,ot=!1,ha=e}}}function sp(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;ha=e}function Os(e){if(e!==ha)return!1;if(!ot)return sp(e),ot=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!vc(e.type,e.memoizedProps)),t&&(t=fa)){if(wc(e))throw rf(),Error(re(418));for(;t;)nf(e,t),t=In(t.nextSibling)}if(sp(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(re(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"){if(t===0){fa=In(e.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++}e=e.nextSibling}fa=null}}else fa=ha?In(e.stateNode.nextSibling):null;return!0}function rf(){for(var e=fa;e;)e=In(e.nextSibling)}function Kr(){fa=ha=null,ot=!1}function ud(e){La===null?La=[e]:La.push(e)}var i1=un.ReactCurrentBatchConfig;function vi(e,t,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(re(309));var n=a.stateNode}if(!n)throw Error(re(147,e));var i=n,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var u=i.refs;o===null?delete u[s]:u[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(re(284));if(!a._owner)throw Error(re(290,e))}return e}function Rs(e,t){throw e=Object.prototype.toString.call(t),Error(re(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function op(e){var t=e._init;return t(e._payload)}function sf(e){function t(N,y){if(e){var O=N.deletions;O===null?(N.deletions=[y],N.flags|=16):O.push(y)}}function a(N,y){if(!e)return null;for(;y!==null;)t(N,y),y=y.sibling;return null}function n(N,y){for(N=new Map;y!==null;)y.key!==null?N.set(y.key,y):N.set(y.index,y),y=y.sibling;return N}function i(N,y){return N=Tn(N,y),N.index=0,N.sibling=null,N}function s(N,y,O){return N.index=O,e?(O=N.alternate,O!==null?(O=O.index,O<y?(N.flags|=2,y):O):(N.flags|=2,y)):(N.flags|=1048576,y)}function o(N){return e&&N.alternate===null&&(N.flags|=2),N}function u(N,y,O,L){return y===null||y.tag!==6?(y=Wl(O,N.mode,L),y.return=N,y):(y=i(y,O),y.return=N,y)}function p(N,y,O,L){var ie=O.type;return ie===Er?_(N,y,O.props.children,L,O.key):y!==null&&(y.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===vn&&op(ie)===y.type)?(L=i(y,O.props),L.ref=vi(N,y,O),L.return=N,L):(L=eo(O.type,O.key,O.props,null,N.mode,L),L.ref=vi(N,y,O),L.return=N,L)}function v(N,y,O,L){return y===null||y.tag!==4||y.stateNode.containerInfo!==O.containerInfo||y.stateNode.implementation!==O.implementation?(y=Ql(O,N.mode,L),y.return=N,y):(y=i(y,O.children||[]),y.return=N,y)}function _(N,y,O,L,ie){return y===null||y.tag!==7?(y=nr(O,N.mode,L,ie),y.return=N,y):(y=i(y,O),y.return=N,y)}function b(N,y,O){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Wl(""+y,N.mode,O),y.return=N,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case js:return O=eo(y.type,y.key,y.props,null,N.mode,O),O.ref=vi(N,null,y),O.return=N,O;case Ir:return y=Ql(y,N.mode,O),y.return=N,y;case vn:var L=y._init;return b(N,L(y._payload),O)}if(wi(y)||fi(y))return y=nr(y,N.mode,O,null),y.return=N,y;Rs(N,y)}return null}function j(N,y,O,L){var ie=y!==null?y.key:null;if(typeof O=="string"&&O!==""||typeof O=="number")return ie!==null?null:u(N,y,""+O,L);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case js:return O.key===ie?p(N,y,O,L):null;case Ir:return O.key===ie?v(N,y,O,L):null;case vn:return ie=O._init,j(N,y,ie(O._payload),L)}if(wi(O)||fi(O))return ie!==null?null:_(N,y,O,L,null);Rs(N,O)}return null}function E(N,y,O,L,ie){if(typeof L=="string"&&L!==""||typeof L=="number")return N=N.get(O)||null,u(y,N,""+L,ie);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case js:return N=N.get(L.key===null?O:L.key)||null,p(y,N,L,ie);case Ir:return N=N.get(L.key===null?O:L.key)||null,v(y,N,L,ie);case vn:var Y=L._init;return E(N,y,O,Y(L._payload),ie)}if(wi(L)||fi(L))return N=N.get(O)||null,_(y,N,L,ie,null);Rs(y,L)}return null}function F(N,y,O,L){for(var ie=null,Y=null,Z=y,M=y=0,K=null;Z!==null&&M<O.length;M++){Z.index>M?(K=Z,Z=null):K=Z.sibling;var C=j(N,Z,O[M],L);if(C===null){Z===null&&(Z=K);break}e&&Z&&C.alternate===null&&t(N,Z),y=s(C,y,M),Y===null?ie=C:Y.sibling=C,Y=C,Z=K}if(M===O.length)return a(N,Z),ot&&Kn(N,M),ie;if(Z===null){for(;M<O.length;M++)Z=b(N,O[M],L),Z!==null&&(y=s(Z,y,M),Y===null?ie=Z:Y.sibling=Z,Y=Z);return ot&&Kn(N,M),ie}for(Z=n(N,Z);M<O.length;M++)K=E(Z,N,M,O[M],L),K!==null&&(e&&K.alternate!==null&&Z.delete(K.key===null?M:K.key),y=s(K,y,M),Y===null?ie=K:Y.sibling=K,Y=K);return e&&Z.forEach(function(U){return t(N,U)}),ot&&Kn(N,M),ie}function D(N,y,O,L){var ie=fi(O);if(typeof ie!="function")throw Error(re(150));if(O=ie.call(O),O==null)throw Error(re(151));for(var Y=ie=null,Z=y,M=y=0,K=null,C=O.next();Z!==null&&!C.done;M++,C=O.next()){Z.index>M?(K=Z,Z=null):K=Z.sibling;var U=j(N,Z,C.value,L);if(U===null){Z===null&&(Z=K);break}e&&Z&&U.alternate===null&&t(N,Z),y=s(U,y,M),Y===null?ie=U:Y.sibling=U,Y=U,Z=K}if(C.done)return a(N,Z),ot&&Kn(N,M),ie;if(Z===null){for(;!C.done;M++,C=O.next())C=b(N,C.value,L),C!==null&&(y=s(C,y,M),Y===null?ie=C:Y.sibling=C,Y=C);return ot&&Kn(N,M),ie}for(Z=n(N,Z);!C.done;M++,C=O.next())C=E(Z,N,M,C.value,L),C!==null&&(e&&C.alternate!==null&&Z.delete(C.key===null?M:C.key),y=s(C,y,M),Y===null?ie=C:Y.sibling=C,Y=C);return e&&Z.forEach(function(R){return t(N,R)}),ot&&Kn(N,M),ie}function me(N,y,O,L){if(typeof O=="object"&&O!==null&&O.type===Er&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case js:e:{for(var ie=O.key,Y=y;Y!==null;){if(Y.key===ie){if(ie=O.type,ie===Er){if(Y.tag===7){a(N,Y.sibling),y=i(Y,O.props.children),y.return=N,N=y;break e}}else if(Y.elementType===ie||typeof ie=="object"&&ie!==null&&ie.$$typeof===vn&&op(ie)===Y.type){a(N,Y.sibling),y=i(Y,O.props),y.ref=vi(N,Y,O),y.return=N,N=y;break e}a(N,Y);break}else t(N,Y);Y=Y.sibling}O.type===Er?(y=nr(O.props.children,N.mode,L,O.key),y.return=N,N=y):(L=eo(O.type,O.key,O.props,null,N.mode,L),L.ref=vi(N,y,O),L.return=N,N=L)}return o(N);case Ir:e:{for(Y=O.key;y!==null;){if(y.key===Y)if(y.tag===4&&y.stateNode.containerInfo===O.containerInfo&&y.stateNode.implementation===O.implementation){a(N,y.sibling),y=i(y,O.children||[]),y.return=N,N=y;break e}else{a(N,y);break}else t(N,y);y=y.sibling}y=Ql(O,N.mode,L),y.return=N,N=y}return o(N);case vn:return Y=O._init,me(N,y,Y(O._payload),L)}if(wi(O))return F(N,y,O,L);if(fi(O))return D(N,y,O,L);Rs(N,O)}return typeof O=="string"&&O!==""||typeof O=="number"?(O=""+O,y!==null&&y.tag===6?(a(N,y.sibling),y=i(y,O),y.return=N,N=y):(a(N,y),y=Wl(O,N.mode,L),y.return=N,N=y),o(N)):a(N,y)}return me}var Jr=sf(!0),of=sf(!1),go=zn(null),xo=null,Fr=null,pd=null;function md(){pd=Fr=xo=null}function fd(e){var t=go.current;rt(go),e._currentValue=t}function Nc(e,t,a){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function Hr(e,t){xo=e,pd=Fr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(ia=!0),e.firstContext=null)}function ka(e){var t=e._currentValue;if(pd!==e)if(e={context:e,memoizedValue:t,next:null},Fr===null){if(xo===null)throw Error(re(308));Fr=e,xo.dependencies={lanes:0,firstContext:e}}else Fr=Fr.next=e;return t}var Zn=null;function hd(e){Zn===null?Zn=[e]:Zn.push(e)}function lf(e,t,a,n){var i=t.interleaved;return i===null?(a.next=a,hd(t)):(a.next=i.next,i.next=a),t.interleaved=a,cn(e,n)}function cn(e,t){e.lanes|=t;var a=e.alternate;for(a!==null&&(a.lanes|=t),a=e,e=e.return;e!==null;)e.childLanes|=t,a=e.alternate,a!==null&&(a.childLanes|=t),a=e,e=e.return;return a.tag===3?a.stateNode:null}var bn=!1;function gd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cf(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function sn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function En(e,t,a){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,He&2){var i=n.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),n.pending=t,cn(e,a)}return i=n.interleaved,i===null?(t.next=t,hd(n)):(t.next=i.next,i.next=t),n.interleaved=t,cn(e,a)}function Gs(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,td(e,a)}}function lp(e,t){var a=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var i=null,s=null;if(a=a.firstBaseUpdate,a!==null){do{var o={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};s===null?i=s=o:s=s.next=o,a=a.next}while(a!==null);s===null?i=s=t:s=s.next=t}else i=s=t;a={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}function _o(e,t,a,n){var i=e.updateQueue;bn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,u=i.shared.pending;if(u!==null){i.shared.pending=null;var p=u,v=p.next;p.next=null,o===null?s=v:o.next=v,o=p;var _=e.alternate;_!==null&&(_=_.updateQueue,u=_.lastBaseUpdate,u!==o&&(u===null?_.firstBaseUpdate=v:u.next=v,_.lastBaseUpdate=p))}if(s!==null){var b=i.baseState;o=0,_=v=p=null,u=s;do{var j=u.lane,E=u.eventTime;if((n&j)===j){_!==null&&(_=_.next={eventTime:E,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var F=e,D=u;switch(j=t,E=a,D.tag){case 1:if(F=D.payload,typeof F=="function"){b=F.call(E,b,j);break e}b=F;break e;case 3:F.flags=F.flags&-65537|128;case 0:if(F=D.payload,j=typeof F=="function"?F.call(E,b,j):F,j==null)break e;b=ht({},b,j);break e;case 2:bn=!0}}u.callback!==null&&u.lane!==0&&(e.flags|=64,j=i.effects,j===null?i.effects=[u]:j.push(u))}else E={eventTime:E,lane:j,tag:u.tag,payload:u.payload,callback:u.callback,next:null},_===null?(v=_=E,p=b):_=_.next=E,o|=j;if(u=u.next,u===null){if(u=i.shared.pending,u===null)break;j=u,u=j.next,j.next=null,i.lastBaseUpdate=j,i.shared.pending=null}}while(!0);if(_===null&&(p=b),i.baseState=p,i.firstBaseUpdate=v,i.lastBaseUpdate=_,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else s===null&&(i.shared.lanes=0);lr|=o,e.lanes=o,e.memoizedState=b}}function cp(e,t,a){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(i!==null){if(n.callback=null,n=a,typeof i!="function")throw Error(re(191,i));i.call(n)}}}var rs={},Ja=zn(rs),Qi=zn(rs),Gi=zn(rs);function Xn(e){if(e===rs)throw Error(re(174));return e}function xd(e,t){switch(et(Gi,t),et(Qi,e),et(Ja,rs),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ic(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ic(t,e)}rt(Ja),et(Ja,t)}function Yr(){rt(Ja),rt(Qi),rt(Gi)}function df(e){Xn(Gi.current);var t=Xn(Ja.current),a=ic(t,e.type);t!==a&&(et(Qi,e),et(Ja,a))}function _d(e){Qi.current===e&&(rt(Ja),rt(Qi))}var mt=zn(0);function vo(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Dl=[];function vd(){for(var e=0;e<Dl.length;e++)Dl[e]._workInProgressVersionPrimary=null;Dl.length=0}var Ks=un.ReactCurrentDispatcher,$l=un.ReactCurrentBatchConfig,or=0,ft=null,At=null,Tt=null,bo=!1,Pi=!1,Ki=0,s1=0;function Vt(){throw Error(re(321))}function bd(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Ua(e[a],t[a]))return!1;return!0}function yd(e,t,a,n,i,s){if(or=s,ft=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Ks.current=e===null||e.memoizedState===null?d1:u1,e=a(n,i),Pi){s=0;do{if(Pi=!1,Ki=0,25<=s)throw Error(re(301));s+=1,Tt=At=null,t.updateQueue=null,Ks.current=p1,e=a(n,i)}while(Pi)}if(Ks.current=yo,t=At!==null&&At.next!==null,or=0,Tt=At=ft=null,bo=!1,t)throw Error(re(300));return e}function Sd(){var e=Ki!==0;return Ki=0,e}function Qa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?ft.memoizedState=Tt=e:Tt=Tt.next=e,Tt}function Ia(){if(At===null){var e=ft.alternate;e=e!==null?e.memoizedState:null}else e=At.next;var t=Tt===null?ft.memoizedState:Tt.next;if(t!==null)Tt=t,At=e;else{if(e===null)throw Error(re(310));At=e,e={memoizedState:At.memoizedState,baseState:At.baseState,baseQueue:At.baseQueue,queue:At.queue,next:null},Tt===null?ft.memoizedState=Tt=e:Tt=Tt.next=e}return Tt}function Ji(e,t){return typeof t=="function"?t(e):t}function Bl(e){var t=Ia(),a=t.queue;if(a===null)throw Error(re(311));a.lastRenderedReducer=e;var n=At,i=n.baseQueue,s=a.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}n.baseQueue=i=s,a.pending=null}if(i!==null){s=i.next,n=n.baseState;var u=o=null,p=null,v=s;do{var _=v.lane;if((or&_)===_)p!==null&&(p=p.next={lane:0,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),n=v.hasEagerState?v.eagerState:e(n,v.action);else{var b={lane:_,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null};p===null?(u=p=b,o=n):p=p.next=b,ft.lanes|=_,lr|=_}v=v.next}while(v!==null&&v!==s);p===null?o=n:p.next=u,Ua(n,t.memoizedState)||(ia=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=p,a.lastRenderedState=n}if(e=a.interleaved,e!==null){i=e;do s=i.lane,ft.lanes|=s,lr|=s,i=i.next;while(i!==e)}else i===null&&(a.lanes=0);return[t.memoizedState,a.dispatch]}function ql(e){var t=Ia(),a=t.queue;if(a===null)throw Error(re(311));a.lastRenderedReducer=e;var n=a.dispatch,i=a.pending,s=t.memoizedState;if(i!==null){a.pending=null;var o=i=i.next;do s=e(s,o.action),o=o.next;while(o!==i);Ua(s,t.memoizedState)||(ia=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),a.lastRenderedState=s}return[s,n]}function uf(){}function pf(e,t){var a=ft,n=Ia(),i=t(),s=!Ua(n.memoizedState,i);if(s&&(n.memoizedState=i,ia=!0),n=n.queue,wd(hf.bind(null,a,n,e),[e]),n.getSnapshot!==t||s||Tt!==null&&Tt.memoizedState.tag&1){if(a.flags|=2048,Yi(9,ff.bind(null,a,n,i,t),void 0,null),Ot===null)throw Error(re(349));or&30||mf(a,t,i)}return i}function mf(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=ft.updateQueue,t===null?(t={lastEffect:null,stores:null},ft.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function ff(e,t,a,n){t.value=a,t.getSnapshot=n,gf(t)&&xf(e)}function hf(e,t,a){return a(function(){gf(t)&&xf(e)})}function gf(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Ua(e,a)}catch{return!0}}function xf(e){var t=cn(e,1);t!==null&&Fa(t,e,1,-1)}function dp(e){var t=Qa();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:e},t.queue=e,e=e.dispatch=c1.bind(null,ft,e),[t.memoizedState,e]}function Yi(e,t,a,n){return e={tag:e,create:t,destroy:a,deps:n,next:null},t=ft.updateQueue,t===null?(t={lastEffect:null,stores:null},ft.updateQueue=t,t.lastEffect=e.next=e):(a=t.lastEffect,a===null?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e)),e}function _f(){return Ia().memoizedState}function Js(e,t,a,n){var i=Qa();ft.flags|=e,i.memoizedState=Yi(1|t,a,void 0,n===void 0?null:n)}function Ro(e,t,a,n){var i=Ia();n=n===void 0?null:n;var s=void 0;if(At!==null){var o=At.memoizedState;if(s=o.destroy,n!==null&&bd(n,o.deps)){i.memoizedState=Yi(t,a,s,n);return}}ft.flags|=e,i.memoizedState=Yi(1|t,a,s,n)}function up(e,t){return Js(8390656,8,e,t)}function wd(e,t){return Ro(2048,8,e,t)}function vf(e,t){return Ro(4,2,e,t)}function bf(e,t){return Ro(4,4,e,t)}function yf(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Sf(e,t,a){return a=a!=null?a.concat([e]):null,Ro(4,4,yf.bind(null,t,e),a)}function jd(){}function wf(e,t){var a=Ia();t=t===void 0?null:t;var n=a.memoizedState;return n!==null&&t!==null&&bd(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function jf(e,t){var a=Ia();t=t===void 0?null:t;var n=a.memoizedState;return n!==null&&t!==null&&bd(t,n[1])?n[0]:(e=e(),a.memoizedState=[e,t],e)}function Nf(e,t,a){return or&21?(Ua(a,t)||(a=Im(),ft.lanes|=a,lr|=a,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ia=!0),e.memoizedState=a)}function o1(e,t){var a=Ye;Ye=a!==0&&4>a?a:4,e(!0);var n=$l.transition;$l.transition={};try{e(!1),t()}finally{Ye=a,$l.transition=n}}function Cf(){return Ia().memoizedState}function l1(e,t,a){var n=Mn(e);if(a={lane:n,action:a,hasEagerState:!1,eagerState:null,next:null},Af(e))kf(t,a);else if(a=lf(e,t,a,n),a!==null){var i=ea();Fa(a,e,n,i),If(a,t,n)}}function c1(e,t,a){var n=Mn(e),i={lane:n,action:a,hasEagerState:!1,eagerState:null,next:null};if(Af(e))kf(t,i);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,u=s(o,a);if(i.hasEagerState=!0,i.eagerState=u,Ua(u,o)){var p=t.interleaved;p===null?(i.next=i,hd(t)):(i.next=p.next,p.next=i),t.interleaved=i;return}}catch{}finally{}a=lf(e,t,i,n),a!==null&&(i=ea(),Fa(a,e,n,i),If(a,t,n))}}function Af(e){var t=e.alternate;return e===ft||t!==null&&t===ft}function kf(e,t){Pi=bo=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function If(e,t,a){if(a&4194240){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,td(e,a)}}var yo={readContext:ka,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useInsertionEffect:Vt,useLayoutEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useMutableSource:Vt,useSyncExternalStore:Vt,useId:Vt,unstable_isNewReconciler:!1},d1={readContext:ka,useCallback:function(e,t){return Qa().memoizedState=[e,t===void 0?null:t],e},useContext:ka,useEffect:up,useImperativeHandle:function(e,t,a){return a=a!=null?a.concat([e]):null,Js(4194308,4,yf.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Js(4194308,4,e,t)},useInsertionEffect:function(e,t){return Js(4,2,e,t)},useMemo:function(e,t){var a=Qa();return t=t===void 0?null:t,e=e(),a.memoizedState=[e,t],e},useReducer:function(e,t,a){var n=Qa();return t=a!==void 0?a(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=l1.bind(null,ft,e),[n.memoizedState,e]},useRef:function(e){var t=Qa();return e={current:e},t.memoizedState=e},useState:dp,useDebugValue:jd,useDeferredValue:function(e){return Qa().memoizedState=e},useTransition:function(){var e=dp(!1),t=e[0];return e=o1.bind(null,e[1]),Qa().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,a){var n=ft,i=Qa();if(ot){if(a===void 0)throw Error(re(407));a=a()}else{if(a=t(),Ot===null)throw Error(re(349));or&30||mf(n,t,a)}i.memoizedState=a;var s={value:a,getSnapshot:t};return i.queue=s,up(hf.bind(null,n,s,e),[e]),n.flags|=2048,Yi(9,ff.bind(null,n,s,a,t),void 0,null),a},useId:function(){var e=Qa(),t=Ot.identifierPrefix;if(ot){var a=rn,n=nn;a=(n&~(1<<32-za(n)-1)).toString(32)+a,t=":"+t+"R"+a,a=Ki++,0<a&&(t+="H"+a.toString(32)),t+=":"}else a=s1++,t=":"+t+"r"+a.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},u1={readContext:ka,useCallback:wf,useContext:ka,useEffect:wd,useImperativeHandle:Sf,useInsertionEffect:vf,useLayoutEffect:bf,useMemo:jf,useReducer:Bl,useRef:_f,useState:function(){return Bl(Ji)},useDebugValue:jd,useDeferredValue:function(e){var t=Ia();return Nf(t,At.memoizedState,e)},useTransition:function(){var e=Bl(Ji)[0],t=Ia().memoizedState;return[e,t]},useMutableSource:uf,useSyncExternalStore:pf,useId:Cf,unstable_isNewReconciler:!1},p1={readContext:ka,useCallback:wf,useContext:ka,useEffect:wd,useImperativeHandle:Sf,useInsertionEffect:vf,useLayoutEffect:bf,useMemo:jf,useReducer:ql,useRef:_f,useState:function(){return ql(Ji)},useDebugValue:jd,useDeferredValue:function(e){var t=Ia();return At===null?t.memoizedState=e:Nf(t,At.memoizedState,e)},useTransition:function(){var e=ql(Ji)[0],t=Ia().memoizedState;return[e,t]},useMutableSource:uf,useSyncExternalStore:pf,useId:Cf,unstable_isNewReconciler:!1};function Oa(e,t){if(e&&e.defaultProps){t=ht({},t),e=e.defaultProps;for(var a in e)t[a]===void 0&&(t[a]=e[a]);return t}return t}function Cc(e,t,a,n){t=e.memoizedState,a=a(n,t),a=a==null?t:ht({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Lo={isMounted:function(e){return(e=e._reactInternals)?pr(e)===e:!1},enqueueSetState:function(e,t,a){e=e._reactInternals;var n=ea(),i=Mn(e),s=sn(n,i);s.payload=t,a!=null&&(s.callback=a),t=En(e,s,i),t!==null&&(Fa(t,e,i,n),Gs(t,e,i))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=ea(),i=Mn(e),s=sn(n,i);s.tag=1,s.payload=t,a!=null&&(s.callback=a),t=En(e,s,i),t!==null&&(Fa(t,e,i,n),Gs(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=ea(),n=Mn(e),i=sn(a,n);i.tag=2,t!=null&&(i.callback=t),t=En(e,i,n),t!==null&&(Fa(t,e,n,a),Gs(t,e,n))}};function pp(e,t,a,n,i,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,s,o):t.prototype&&t.prototype.isPureReactComponent?!qi(a,n)||!qi(i,s):!0}function Ef(e,t,a){var n=!1,i=Rn,s=t.contextType;return typeof s=="object"&&s!==null?s=ka(s):(i=oa(t)?ir:Qt.current,n=t.contextTypes,s=(n=n!=null)?Gr(e,i):Rn),t=new t(a,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Lo,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function mp(e,t,a,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&Lo.enqueueReplaceState(t,t.state,null)}function Ac(e,t,a,n){var i=e.stateNode;i.props=a,i.state=e.memoizedState,i.refs={},gd(e);var s=t.contextType;typeof s=="object"&&s!==null?i.context=ka(s):(s=oa(t)?ir:Qt.current,i.context=Gr(e,s)),i.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Cc(e,t,s,a),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&Lo.enqueueReplaceState(i,i.state,null),_o(e,a,i,n),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function Zr(e,t){try{var a="",n=t;do a+=Dg(n),n=n.return;while(n);var i=a}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:i,digest:null}}function Vl(e,t,a){return{value:e,source:null,stack:a??null,digest:t??null}}function kc(e,t){try{console.error(t.value)}catch(a){setTimeout(function(){throw a})}}var m1=typeof WeakMap=="function"?WeakMap:Map;function Pf(e,t,a){a=sn(-1,a),a.tag=3,a.payload={element:null};var n=t.value;return a.callback=function(){wo||(wo=!0,Fc=n),kc(e,t)},a}function Mf(e,t,a){a=sn(-1,a),a.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var i=t.value;a.payload=function(){return n(i)},a.callback=function(){kc(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(a.callback=function(){kc(e,t),typeof n!="function"&&(Pn===null?Pn=new Set([this]):Pn.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),a}function fp(e,t,a){var n=e.pingCache;if(n===null){n=e.pingCache=new m1;var i=new Set;n.set(t,i)}else i=n.get(t),i===void 0&&(i=new Set,n.set(t,i));i.has(a)||(i.add(a),e=A1.bind(null,e,t,a),t.then(e,e))}function hp(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function gp(e,t,a,n,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(t=sn(-1,1),t.tag=2,En(a,t,1))),a.lanes|=1),e)}var f1=un.ReactCurrentOwner,ia=!1;function Xt(e,t,a,n){t.child=e===null?of(t,null,a,n):Jr(t,e.child,a,n)}function xp(e,t,a,n,i){a=a.render;var s=t.ref;return Hr(t,i),n=yd(e,t,a,n,s,i),a=Sd(),e!==null&&!ia?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,dn(e,t,i)):(ot&&a&&cd(t),t.flags|=1,Xt(e,t,n,i),t.child)}function _p(e,t,a,n,i){if(e===null){var s=a.type;return typeof s=="function"&&!Md(s)&&s.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(t.tag=15,t.type=s,Tf(e,t,s,n,i)):(e=eo(a.type,null,n,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&i)){var o=s.memoizedProps;if(a=a.compare,a=a!==null?a:qi,a(o,n)&&e.ref===t.ref)return dn(e,t,i)}return t.flags|=1,e=Tn(s,n),e.ref=t.ref,e.return=t,t.child=e}function Tf(e,t,a,n,i){if(e!==null){var s=e.memoizedProps;if(qi(s,n)&&e.ref===t.ref)if(ia=!1,t.pendingProps=n=s,(e.lanes&i)!==0)e.flags&131072&&(ia=!0);else return t.lanes=e.lanes,dn(e,t,i)}return Ic(e,t,a,n,i)}function Of(e,t,a){var n=t.pendingProps,i=n.children,s=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Dr,pa),pa|=a;else{if(!(a&1073741824))return e=s!==null?s.baseLanes|a:a,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,et(Dr,pa),pa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:a,et(Dr,pa),pa|=n}else s!==null?(n=s.baseLanes|a,t.memoizedState=null):n=a,et(Dr,pa),pa|=n;return Xt(e,t,i,a),t.child}function Rf(e,t){var a=t.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(t.flags|=512,t.flags|=2097152)}function Ic(e,t,a,n,i){var s=oa(a)?ir:Qt.current;return s=Gr(t,s),Hr(t,i),a=yd(e,t,a,n,s,i),n=Sd(),e!==null&&!ia?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,dn(e,t,i)):(ot&&n&&cd(t),t.flags|=1,Xt(e,t,a,i),t.child)}function vp(e,t,a,n,i){if(oa(a)){var s=!0;mo(t)}else s=!1;if(Hr(t,i),t.stateNode===null)Ys(e,t),Ef(t,a,n),Ac(t,a,n,i),n=!0;else if(e===null){var o=t.stateNode,u=t.memoizedProps;o.props=u;var p=o.context,v=a.contextType;typeof v=="object"&&v!==null?v=ka(v):(v=oa(a)?ir:Qt.current,v=Gr(t,v));var _=a.getDerivedStateFromProps,b=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function";b||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(u!==n||p!==v)&&mp(t,o,n,v),bn=!1;var j=t.memoizedState;o.state=j,_o(t,n,o,i),p=t.memoizedState,u!==n||j!==p||sa.current||bn?(typeof _=="function"&&(Cc(t,a,_,n),p=t.memoizedState),(u=bn||pp(t,a,u,n,j,p,v))?(b||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=p),o.props=n,o.state=p,o.context=v,n=u):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,cf(e,t),u=t.memoizedProps,v=t.type===t.elementType?u:Oa(t.type,u),o.props=v,b=t.pendingProps,j=o.context,p=a.contextType,typeof p=="object"&&p!==null?p=ka(p):(p=oa(a)?ir:Qt.current,p=Gr(t,p));var E=a.getDerivedStateFromProps;(_=typeof E=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(u!==b||j!==p)&&mp(t,o,n,p),bn=!1,j=t.memoizedState,o.state=j,_o(t,n,o,i);var F=t.memoizedState;u!==b||j!==F||sa.current||bn?(typeof E=="function"&&(Cc(t,a,E,n),F=t.memoizedState),(v=bn||pp(t,a,v,n,j,F,p)||!1)?(_||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,F,p),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,F,p)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||u===e.memoizedProps&&j===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||u===e.memoizedProps&&j===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=F),o.props=n,o.state=F,o.context=p,n=v):(typeof o.componentDidUpdate!="function"||u===e.memoizedProps&&j===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||u===e.memoizedProps&&j===e.memoizedState||(t.flags|=1024),n=!1)}return Ec(e,t,a,n,s,i)}function Ec(e,t,a,n,i,s){Rf(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return i&&rp(t,a,!1),dn(e,t,s);n=t.stateNode,f1.current=t;var u=o&&typeof a.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Jr(t,e.child,null,s),t.child=Jr(t,null,u,s)):Xt(e,t,u,s),t.memoizedState=n.state,i&&rp(t,a,!0),t.child}function Lf(e){var t=e.stateNode;t.pendingContext?np(e,t.pendingContext,t.pendingContext!==t.context):t.context&&np(e,t.context,!1),xd(e,t.containerInfo)}function bp(e,t,a,n,i){return Kr(),ud(i),t.flags|=256,Xt(e,t,a,n),t.child}var Pc={dehydrated:null,treeContext:null,retryLane:0};function Mc(e){return{baseLanes:e,cachePool:null,transitions:null}}function zf(e,t,a){var n=t.pendingProps,i=mt.current,s=!1,o=(t.flags&128)!==0,u;if((u=o)||(u=e!==null&&e.memoizedState===null?!1:(i&2)!==0),u?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),et(mt,i&1),e===null)return jc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,s?(n=t.mode,s=t.child,o={mode:"hidden",children:o},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Uo(o,n,0,null),e=nr(e,n,a,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Mc(a),t.memoizedState=Pc,e):Nd(t,o));if(i=e.memoizedState,i!==null&&(u=i.dehydrated,u!==null))return h1(e,t,o,n,u,i,a);if(s){s=n.fallback,o=t.mode,i=e.child,u=i.sibling;var p={mode:"hidden",children:n.children};return!(o&1)&&t.child!==i?(n=t.child,n.childLanes=0,n.pendingProps=p,t.deletions=null):(n=Tn(i,p),n.subtreeFlags=i.subtreeFlags&14680064),u!==null?s=Tn(u,s):(s=nr(s,o,a,null),s.flags|=2),s.return=t,n.return=t,n.sibling=s,t.child=n,n=s,s=t.child,o=e.child.memoizedState,o=o===null?Mc(a):{baseLanes:o.baseLanes|a,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~a,t.memoizedState=Pc,n}return s=e.child,e=s.sibling,n=Tn(s,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=a),n.return=t,n.sibling=null,e!==null&&(a=t.deletions,a===null?(t.deletions=[e],t.flags|=16):a.push(e)),t.child=n,t.memoizedState=null,n}function Nd(e,t){return t=Uo({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ls(e,t,a,n){return n!==null&&ud(n),Jr(t,e.child,null,a),e=Nd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function h1(e,t,a,n,i,s,o){if(a)return t.flags&256?(t.flags&=-257,n=Vl(Error(re(422))),Ls(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=n.fallback,i=t.mode,n=Uo({mode:"visible",children:n.children},i,0,null),s=nr(s,i,o,null),s.flags|=2,n.return=t,s.return=t,n.sibling=s,t.child=n,t.mode&1&&Jr(t,e.child,null,o),t.child.memoizedState=Mc(o),t.memoizedState=Pc,s);if(!(t.mode&1))return Ls(e,t,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var u=n.dgst;return n=u,s=Error(re(419)),n=Vl(s,n,void 0),Ls(e,t,o,n)}if(u=(o&e.childLanes)!==0,ia||u){if(n=Ot,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,cn(e,i),Fa(n,e,i,-1))}return Pd(),n=Vl(Error(re(421))),Ls(e,t,o,n)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=k1.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,fa=In(i.nextSibling),ha=t,ot=!0,La=null,e!==null&&(ja[Na++]=nn,ja[Na++]=rn,ja[Na++]=sr,nn=e.id,rn=e.overflow,sr=t),t=Nd(t,n.children),t.flags|=4096,t)}function yp(e,t,a){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Nc(e.return,t,a)}function Hl(e,t,a,n,i){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=a,s.tailMode=i)}function Ff(e,t,a){var n=t.pendingProps,i=n.revealOrder,s=n.tail;if(Xt(e,t,n.children,a),n=mt.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&yp(e,a,t);else if(e.tag===19)yp(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(et(mt,n),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(a=t.child,i=null;a!==null;)e=a.alternate,e!==null&&vo(e)===null&&(i=a),a=a.sibling;a=i,a===null?(i=t.child,t.child=null):(i=a.sibling,a.sibling=null),Hl(t,!1,i,a,s);break;case"backwards":for(a=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&vo(e)===null){t.child=i;break}e=i.sibling,i.sibling=a,a=i,i=e}Hl(t,!0,a,null,s);break;case"together":Hl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ys(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function dn(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),lr|=t.lanes,!(a&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(re(153));if(t.child!==null){for(e=t.child,a=Tn(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Tn(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function g1(e,t,a){switch(t.tag){case 3:Lf(t),Kr();break;case 5:df(t);break;case 1:oa(t.type)&&mo(t);break;case 4:xd(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;et(go,n._currentValue),n._currentValue=i;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(et(mt,mt.current&1),t.flags|=128,null):a&t.child.childLanes?zf(e,t,a):(et(mt,mt.current&1),e=dn(e,t,a),e!==null?e.sibling:null);et(mt,mt.current&1);break;case 19:if(n=(a&t.childLanes)!==0,e.flags&128){if(n)return Ff(e,t,a);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),et(mt,mt.current),n)break;return null;case 22:case 23:return t.lanes=0,Of(e,t,a)}return dn(e,t,a)}var Uf,Tc,Df,$f;Uf=function(e,t){for(var a=t.child;a!==null;){if(a.tag===5||a.tag===6)e.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Tc=function(){};Df=function(e,t,a,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,Xn(Ja.current);var s=null;switch(a){case"input":i=tc(e,i),n=tc(e,n),s=[];break;case"select":i=ht({},i,{value:void 0}),n=ht({},n,{value:void 0}),s=[];break;case"textarea":i=rc(e,i),n=rc(e,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=uo)}sc(a,n);var o;a=null;for(v in i)if(!n.hasOwnProperty(v)&&i.hasOwnProperty(v)&&i[v]!=null)if(v==="style"){var u=i[v];for(o in u)u.hasOwnProperty(o)&&(a||(a={}),a[o]="")}else v!=="dangerouslySetInnerHTML"&&v!=="children"&&v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Li.hasOwnProperty(v)?s||(s=[]):(s=s||[]).push(v,null));for(v in n){var p=n[v];if(u=i!=null?i[v]:void 0,n.hasOwnProperty(v)&&p!==u&&(p!=null||u!=null))if(v==="style")if(u){for(o in u)!u.hasOwnProperty(o)||p&&p.hasOwnProperty(o)||(a||(a={}),a[o]="");for(o in p)p.hasOwnProperty(o)&&u[o]!==p[o]&&(a||(a={}),a[o]=p[o])}else a||(s||(s=[]),s.push(v,a)),a=p;else v==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,u=u?u.__html:void 0,p!=null&&u!==p&&(s=s||[]).push(v,p)):v==="children"?typeof p!="string"&&typeof p!="number"||(s=s||[]).push(v,""+p):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&(Li.hasOwnProperty(v)?(p!=null&&v==="onScroll"&&nt("scroll",e),s||u===p||(s=[])):(s=s||[]).push(v,p))}a&&(s=s||[]).push("style",a);var v=s;(t.updateQueue=v)&&(t.flags|=4)}};$f=function(e,t,a,n){a!==n&&(t.flags|=4)};function bi(e,t){if(!ot)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Ht(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,n=0;if(t)for(var i=e.child;i!==null;)a|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)a|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function x1(e,t,a){var n=t.pendingProps;switch(dd(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ht(t),null;case 1:return oa(t.type)&&po(),Ht(t),null;case 3:return n=t.stateNode,Yr(),rt(sa),rt(Qt),vd(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(Os(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,La!==null&&($c(La),La=null))),Tc(e,t),Ht(t),null;case 5:_d(t);var i=Xn(Gi.current);if(a=t.type,e!==null&&t.stateNode!=null)Df(e,t,a,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(re(166));return Ht(t),null}if(e=Xn(Ja.current),Os(t)){n=t.stateNode,a=t.type;var s=t.memoizedProps;switch(n[Ga]=t,n[Wi]=s,e=(t.mode&1)!==0,a){case"dialog":nt("cancel",n),nt("close",n);break;case"iframe":case"object":case"embed":nt("load",n);break;case"video":case"audio":for(i=0;i<Ni.length;i++)nt(Ni[i],n);break;case"source":nt("error",n);break;case"img":case"image":case"link":nt("error",n),nt("load",n);break;case"details":nt("toggle",n);break;case"input":Eu(n,s),nt("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},nt("invalid",n);break;case"textarea":Mu(n,s),nt("invalid",n)}sc(a,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var u=s[o];o==="children"?typeof u=="string"?n.textContent!==u&&(s.suppressHydrationWarning!==!0&&Ts(n.textContent,u,e),i=["children",u]):typeof u=="number"&&n.textContent!==""+u&&(s.suppressHydrationWarning!==!0&&Ts(n.textContent,u,e),i=["children",""+u]):Li.hasOwnProperty(o)&&u!=null&&o==="onScroll"&&nt("scroll",n)}switch(a){case"input":Ns(n),Pu(n,s,!0);break;case"textarea":Ns(n),Tu(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=uo)}n=i,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=fm(a)),e==="http://www.w3.org/1999/xhtml"?a==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(a,{is:n.is}):(e=o.createElement(a),a==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,a),e[Ga]=t,e[Wi]=n,Uf(e,t,!1,!1),t.stateNode=e;e:{switch(o=oc(a,n),a){case"dialog":nt("cancel",e),nt("close",e),i=n;break;case"iframe":case"object":case"embed":nt("load",e),i=n;break;case"video":case"audio":for(i=0;i<Ni.length;i++)nt(Ni[i],e);i=n;break;case"source":nt("error",e),i=n;break;case"img":case"image":case"link":nt("error",e),nt("load",e),i=n;break;case"details":nt("toggle",e),i=n;break;case"input":Eu(e,n),i=tc(e,n),nt("invalid",e);break;case"option":i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=ht({},n,{value:void 0}),nt("invalid",e);break;case"textarea":Mu(e,n),i=rc(e,n),nt("invalid",e);break;default:i=n}sc(a,i),u=i;for(s in u)if(u.hasOwnProperty(s)){var p=u[s];s==="style"?xm(e,p):s==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&hm(e,p)):s==="children"?typeof p=="string"?(a!=="textarea"||p!=="")&&zi(e,p):typeof p=="number"&&zi(e,""+p):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Li.hasOwnProperty(s)?p!=null&&s==="onScroll"&&nt("scroll",e):p!=null&&Kc(e,s,p,o))}switch(a){case"input":Ns(e),Pu(e,n,!1);break;case"textarea":Ns(e),Tu(e);break;case"option":n.value!=null&&e.setAttribute("value",""+On(n.value));break;case"select":e.multiple=!!n.multiple,s=n.value,s!=null?$r(e,!!n.multiple,s,!1):n.defaultValue!=null&&$r(e,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=uo)}switch(a){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ht(t),null;case 6:if(e&&t.stateNode!=null)$f(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(re(166));if(a=Xn(Gi.current),Xn(Ja.current),Os(t)){if(n=t.stateNode,a=t.memoizedProps,n[Ga]=t,(s=n.nodeValue!==a)&&(e=ha,e!==null))switch(e.tag){case 3:Ts(n.nodeValue,a,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ts(n.nodeValue,a,(e.mode&1)!==0)}s&&(t.flags|=4)}else n=(a.nodeType===9?a:a.ownerDocument).createTextNode(n),n[Ga]=t,t.stateNode=n}return Ht(t),null;case 13:if(rt(mt),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ot&&fa!==null&&t.mode&1&&!(t.flags&128))rf(),Kr(),t.flags|=98560,s=!1;else if(s=Os(t),n!==null&&n.dehydrated!==null){if(e===null){if(!s)throw Error(re(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(re(317));s[Ga]=t}else Kr(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ht(t),s=!1}else La!==null&&($c(La),La=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=a,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||mt.current&1?kt===0&&(kt=3):Pd())),t.updateQueue!==null&&(t.flags|=4),Ht(t),null);case 4:return Yr(),Tc(e,t),e===null&&Vi(t.stateNode.containerInfo),Ht(t),null;case 10:return fd(t.type._context),Ht(t),null;case 17:return oa(t.type)&&po(),Ht(t),null;case 19:if(rt(mt),s=t.memoizedState,s===null)return Ht(t),null;if(n=(t.flags&128)!==0,o=s.rendering,o===null)if(n)bi(s,!1);else{if(kt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=vo(e),o!==null){for(t.flags|=128,bi(s,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=a,a=t.child;a!==null;)s=a,e=n,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return et(mt,mt.current&1|2),t.child}e=e.sibling}s.tail!==null&&St()>Xr&&(t.flags|=128,n=!0,bi(s,!1),t.lanes=4194304)}else{if(!n)if(e=vo(o),e!==null){if(t.flags|=128,n=!0,a=e.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),bi(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ot)return Ht(t),null}else 2*St()-s.renderingStartTime>Xr&&a!==1073741824&&(t.flags|=128,n=!0,bi(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(a=s.last,a!==null?a.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=St(),t.sibling=null,a=mt.current,et(mt,n?a&1|2:a&1),t):(Ht(t),null);case 22:case 23:return Ed(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?pa&1073741824&&(Ht(t),t.subtreeFlags&6&&(t.flags|=8192)):Ht(t),null;case 24:return null;case 25:return null}throw Error(re(156,t.tag))}function _1(e,t){switch(dd(t),t.tag){case 1:return oa(t.type)&&po(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Yr(),rt(sa),rt(Qt),vd(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return _d(t),null;case 13:if(rt(mt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(re(340));Kr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return rt(mt),null;case 4:return Yr(),null;case 10:return fd(t.type._context),null;case 22:case 23:return Ed(),null;case 24:return null;default:return null}}var zs=!1,Wt=!1,v1=typeof WeakSet=="function"?WeakSet:Set,_e=null;function Ur(e,t){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(n){xt(e,t,n)}else a.current=null}function Oc(e,t,a){try{a()}catch(n){xt(e,t,n)}}var Sp=!1;function b1(e,t){if(xc=oo,e=Hm(),ld(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{a.nodeType,s.nodeType}catch{a=null;break e}var o=0,u=-1,p=-1,v=0,_=0,b=e,j=null;t:for(;;){for(var E;b!==a||i!==0&&b.nodeType!==3||(u=o+i),b!==s||n!==0&&b.nodeType!==3||(p=o+n),b.nodeType===3&&(o+=b.nodeValue.length),(E=b.firstChild)!==null;)j=b,b=E;for(;;){if(b===e)break t;if(j===a&&++v===i&&(u=o),j===s&&++_===n&&(p=o),(E=b.nextSibling)!==null)break;b=j,j=b.parentNode}b=E}a=u===-1||p===-1?null:{start:u,end:p}}else a=null}a=a||{start:0,end:0}}else a=null;for(_c={focusedElem:e,selectionRange:a},oo=!1,_e=t;_e!==null;)if(t=_e,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,_e=e;else for(;_e!==null;){t=_e;try{var F=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(F!==null){var D=F.memoizedProps,me=F.memoizedState,N=t.stateNode,y=N.getSnapshotBeforeUpdate(t.elementType===t.type?D:Oa(t.type,D),me);N.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var O=t.stateNode.containerInfo;O.nodeType===1?O.textContent="":O.nodeType===9&&O.documentElement&&O.removeChild(O.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(L){xt(t,t.return,L)}if(e=t.sibling,e!==null){e.return=t.return,_e=e;break}_e=t.return}return F=Sp,Sp=!1,F}function Mi(e,t,a){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,s!==void 0&&Oc(t,a,s)}i=i.next}while(i!==n)}}function zo(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var a=t=t.next;do{if((a.tag&e)===e){var n=a.create;a.destroy=n()}a=a.next}while(a!==t)}}function Rc(e){var t=e.ref;if(t!==null){var a=e.stateNode;switch(e.tag){case 5:e=a;break;default:e=a}typeof t=="function"?t(e):t.current=e}}function Bf(e){var t=e.alternate;t!==null&&(e.alternate=null,Bf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Ga],delete t[Wi],delete t[yc],delete t[a1],delete t[n1])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function qf(e){return e.tag===5||e.tag===3||e.tag===4}function wp(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||qf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Lc(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.nodeType===8?a.parentNode.insertBefore(e,t):a.insertBefore(e,t):(a.nodeType===8?(t=a.parentNode,t.insertBefore(e,a)):(t=a,t.appendChild(e)),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=uo));else if(n!==4&&(e=e.child,e!==null))for(Lc(e,t,a),e=e.sibling;e!==null;)Lc(e,t,a),e=e.sibling}function zc(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(zc(e,t,a),e=e.sibling;e!==null;)zc(e,t,a),e=e.sibling}var Dt=null,Ra=!1;function _n(e,t,a){for(a=a.child;a!==null;)Vf(e,t,a),a=a.sibling}function Vf(e,t,a){if(Ka&&typeof Ka.onCommitFiberUnmount=="function")try{Ka.onCommitFiberUnmount(Io,a)}catch{}switch(a.tag){case 5:Wt||Ur(a,t);case 6:var n=Dt,i=Ra;Dt=null,_n(e,t,a),Dt=n,Ra=i,Dt!==null&&(Ra?(e=Dt,a=a.stateNode,e.nodeType===8?e.parentNode.removeChild(a):e.removeChild(a)):Dt.removeChild(a.stateNode));break;case 18:Dt!==null&&(Ra?(e=Dt,a=a.stateNode,e.nodeType===8?Fl(e.parentNode,a):e.nodeType===1&&Fl(e,a),$i(e)):Fl(Dt,a.stateNode));break;case 4:n=Dt,i=Ra,Dt=a.stateNode.containerInfo,Ra=!0,_n(e,t,a),Dt=n,Ra=i;break;case 0:case 11:case 14:case 15:if(!Wt&&(n=a.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Oc(a,t,o),i=i.next}while(i!==n)}_n(e,t,a);break;case 1:if(!Wt&&(Ur(a,t),n=a.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=a.memoizedProps,n.state=a.memoizedState,n.componentWillUnmount()}catch(u){xt(a,t,u)}_n(e,t,a);break;case 21:_n(e,t,a);break;case 22:a.mode&1?(Wt=(n=Wt)||a.memoizedState!==null,_n(e,t,a),Wt=n):_n(e,t,a);break;default:_n(e,t,a)}}function jp(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new v1),t.forEach(function(n){var i=I1.bind(null,e,n);a.has(n)||(a.add(n),n.then(i,i))})}}function Ta(e,t){var a=t.deletions;if(a!==null)for(var n=0;n<a.length;n++){var i=a[n];try{var s=e,o=t,u=o;e:for(;u!==null;){switch(u.tag){case 5:Dt=u.stateNode,Ra=!1;break e;case 3:Dt=u.stateNode.containerInfo,Ra=!0;break e;case 4:Dt=u.stateNode.containerInfo,Ra=!0;break e}u=u.return}if(Dt===null)throw Error(re(160));Vf(s,o,i),Dt=null,Ra=!1;var p=i.alternate;p!==null&&(p.return=null),i.return=null}catch(v){xt(i,t,v)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Hf(t,e),t=t.sibling}function Hf(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ta(t,e),Wa(e),n&4){try{Mi(3,e,e.return),zo(3,e)}catch(D){xt(e,e.return,D)}try{Mi(5,e,e.return)}catch(D){xt(e,e.return,D)}}break;case 1:Ta(t,e),Wa(e),n&512&&a!==null&&Ur(a,a.return);break;case 5:if(Ta(t,e),Wa(e),n&512&&a!==null&&Ur(a,a.return),e.flags&32){var i=e.stateNode;try{zi(i,"")}catch(D){xt(e,e.return,D)}}if(n&4&&(i=e.stateNode,i!=null)){var s=e.memoizedProps,o=a!==null?a.memoizedProps:s,u=e.type,p=e.updateQueue;if(e.updateQueue=null,p!==null)try{u==="input"&&s.type==="radio"&&s.name!=null&&pm(i,s),oc(u,o);var v=oc(u,s);for(o=0;o<p.length;o+=2){var _=p[o],b=p[o+1];_==="style"?xm(i,b):_==="dangerouslySetInnerHTML"?hm(i,b):_==="children"?zi(i,b):Kc(i,_,b,v)}switch(u){case"input":ac(i,s);break;case"textarea":mm(i,s);break;case"select":var j=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var E=s.value;E!=null?$r(i,!!s.multiple,E,!1):j!==!!s.multiple&&(s.defaultValue!=null?$r(i,!!s.multiple,s.defaultValue,!0):$r(i,!!s.multiple,s.multiple?[]:"",!1))}i[Wi]=s}catch(D){xt(e,e.return,D)}}break;case 6:if(Ta(t,e),Wa(e),n&4){if(e.stateNode===null)throw Error(re(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(D){xt(e,e.return,D)}}break;case 3:if(Ta(t,e),Wa(e),n&4&&a!==null&&a.memoizedState.isDehydrated)try{$i(t.containerInfo)}catch(D){xt(e,e.return,D)}break;case 4:Ta(t,e),Wa(e);break;case 13:Ta(t,e),Wa(e),i=e.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(kd=St())),n&4&&jp(e);break;case 22:if(_=a!==null&&a.memoizedState!==null,e.mode&1?(Wt=(v=Wt)||_,Ta(t,e),Wt=v):Ta(t,e),Wa(e),n&8192){if(v=e.memoizedState!==null,(e.stateNode.isHidden=v)&&!_&&e.mode&1)for(_e=e,_=e.child;_!==null;){for(b=_e=_;_e!==null;){switch(j=_e,E=j.child,j.tag){case 0:case 11:case 14:case 15:Mi(4,j,j.return);break;case 1:Ur(j,j.return);var F=j.stateNode;if(typeof F.componentWillUnmount=="function"){n=j,a=j.return;try{t=n,F.props=t.memoizedProps,F.state=t.memoizedState,F.componentWillUnmount()}catch(D){xt(n,a,D)}}break;case 5:Ur(j,j.return);break;case 22:if(j.memoizedState!==null){Cp(b);continue}}E!==null?(E.return=j,_e=E):Cp(b)}_=_.sibling}e:for(_=null,b=e;;){if(b.tag===5){if(_===null){_=b;try{i=b.stateNode,v?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(u=b.stateNode,p=b.memoizedProps.style,o=p!=null&&p.hasOwnProperty("display")?p.display:null,u.style.display=gm("display",o))}catch(D){xt(e,e.return,D)}}}else if(b.tag===6){if(_===null)try{b.stateNode.nodeValue=v?"":b.memoizedProps}catch(D){xt(e,e.return,D)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===e)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===e)break e;for(;b.sibling===null;){if(b.return===null||b.return===e)break e;_===b&&(_=null),b=b.return}_===b&&(_=null),b.sibling.return=b.return,b=b.sibling}}break;case 19:Ta(t,e),Wa(e),n&4&&jp(e);break;case 21:break;default:Ta(t,e),Wa(e)}}function Wa(e){var t=e.flags;if(t&2){try{e:{for(var a=e.return;a!==null;){if(qf(a)){var n=a;break e}a=a.return}throw Error(re(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(zi(i,""),n.flags&=-33);var s=wp(e);zc(e,s,i);break;case 3:case 4:var o=n.stateNode.containerInfo,u=wp(e);Lc(e,u,o);break;default:throw Error(re(161))}}catch(p){xt(e,e.return,p)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function y1(e,t,a){_e=e,Wf(e)}function Wf(e,t,a){for(var n=(e.mode&1)!==0;_e!==null;){var i=_e,s=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||zs;if(!o){var u=i.alternate,p=u!==null&&u.memoizedState!==null||Wt;u=zs;var v=Wt;if(zs=o,(Wt=p)&&!v)for(_e=i;_e!==null;)o=_e,p=o.child,o.tag===22&&o.memoizedState!==null?Ap(i):p!==null?(p.return=o,_e=p):Ap(i);for(;s!==null;)_e=s,Wf(s),s=s.sibling;_e=i,zs=u,Wt=v}Np(e)}else i.subtreeFlags&8772&&s!==null?(s.return=i,_e=s):Np(e)}}function Np(e){for(;_e!==null;){var t=_e;if(t.flags&8772){var a=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Wt||zo(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Wt)if(a===null)n.componentDidMount();else{var i=t.elementType===t.type?a.memoizedProps:Oa(t.type,a.memoizedProps);n.componentDidUpdate(i,a.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&cp(t,s,n);break;case 3:var o=t.updateQueue;if(o!==null){if(a=null,t.child!==null)switch(t.child.tag){case 5:a=t.child.stateNode;break;case 1:a=t.child.stateNode}cp(t,o,a)}break;case 5:var u=t.stateNode;if(a===null&&t.flags&4){a=u;var p=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&a.focus();break;case"img":p.src&&(a.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var v=t.alternate;if(v!==null){var _=v.memoizedState;if(_!==null){var b=_.dehydrated;b!==null&&$i(b)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}Wt||t.flags&512&&Rc(t)}catch(j){xt(t,t.return,j)}}if(t===e){_e=null;break}if(a=t.sibling,a!==null){a.return=t.return,_e=a;break}_e=t.return}}function Cp(e){for(;_e!==null;){var t=_e;if(t===e){_e=null;break}var a=t.sibling;if(a!==null){a.return=t.return,_e=a;break}_e=t.return}}function Ap(e){for(;_e!==null;){var t=_e;try{switch(t.tag){case 0:case 11:case 15:var a=t.return;try{zo(4,t)}catch(p){xt(t,a,p)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var i=t.return;try{n.componentDidMount()}catch(p){xt(t,i,p)}}var s=t.return;try{Rc(t)}catch(p){xt(t,s,p)}break;case 5:var o=t.return;try{Rc(t)}catch(p){xt(t,o,p)}}}catch(p){xt(t,t.return,p)}if(t===e){_e=null;break}var u=t.sibling;if(u!==null){u.return=t.return,_e=u;break}_e=t.return}}var S1=Math.ceil,So=un.ReactCurrentDispatcher,Cd=un.ReactCurrentOwner,Aa=un.ReactCurrentBatchConfig,He=0,Ot=null,Nt=null,$t=0,pa=0,Dr=zn(0),kt=0,Zi=null,lr=0,Fo=0,Ad=0,Ti=null,ra=null,kd=0,Xr=1/0,en=null,wo=!1,Fc=null,Pn=null,Fs=!1,Nn=null,jo=0,Oi=0,Uc=null,Zs=-1,Xs=0;function ea(){return He&6?St():Zs!==-1?Zs:Zs=St()}function Mn(e){return e.mode&1?He&2&&$t!==0?$t&-$t:i1.transition!==null?(Xs===0&&(Xs=Im()),Xs):(e=Ye,e!==0||(e=window.event,e=e===void 0?16:Lm(e.type)),e):1}function Fa(e,t,a,n){if(50<Oi)throw Oi=0,Uc=null,Error(re(185));ts(e,a,n),(!(He&2)||e!==Ot)&&(e===Ot&&(!(He&2)&&(Fo|=a),kt===4&&wn(e,$t)),la(e,n),a===1&&He===0&&!(t.mode&1)&&(Xr=St()+500,Oo&&Fn()))}function la(e,t){var a=e.callbackNode;ix(e,t);var n=so(e,e===Ot?$t:0);if(n===0)a!==null&&Lu(a),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(a!=null&&Lu(a),t===1)e.tag===0?r1(kp.bind(null,e)):tf(kp.bind(null,e)),e1(function(){!(He&6)&&Fn()}),a=null;else{switch(Em(n)){case 1:a=ed;break;case 4:a=Am;break;case 16:a=io;break;case 536870912:a=km;break;default:a=io}a=e0(a,Qf.bind(null,e))}e.callbackPriority=t,e.callbackNode=a}}function Qf(e,t){if(Zs=-1,Xs=0,He&6)throw Error(re(327));var a=e.callbackNode;if(Wr()&&e.callbackNode!==a)return null;var n=so(e,e===Ot?$t:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=No(e,n);else{t=n;var i=He;He|=2;var s=Kf();(Ot!==e||$t!==t)&&(en=null,Xr=St()+500,ar(e,t));do try{N1();break}catch(u){Gf(e,u)}while(!0);md(),So.current=s,He=i,Nt!==null?t=0:(Ot=null,$t=0,t=kt)}if(t!==0){if(t===2&&(i=pc(e),i!==0&&(n=i,t=Dc(e,i))),t===1)throw a=Zi,ar(e,0),wn(e,n),la(e,St()),a;if(t===6)wn(e,n);else{if(i=e.current.alternate,!(n&30)&&!w1(i)&&(t=No(e,n),t===2&&(s=pc(e),s!==0&&(n=s,t=Dc(e,s))),t===1))throw a=Zi,ar(e,0),wn(e,n),la(e,St()),a;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(re(345));case 2:Jn(e,ra,en);break;case 3:if(wn(e,n),(n&130023424)===n&&(t=kd+500-St(),10<t)){if(so(e,0)!==0)break;if(i=e.suspendedLanes,(i&n)!==n){ea(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=bc(Jn.bind(null,e,ra,en),t);break}Jn(e,ra,en);break;case 4:if(wn(e,n),(n&4194240)===n)break;for(t=e.eventTimes,i=-1;0<n;){var o=31-za(n);s=1<<o,o=t[o],o>i&&(i=o),n&=~s}if(n=i,n=St()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*S1(n/1960))-n,10<n){e.timeoutHandle=bc(Jn.bind(null,e,ra,en),n);break}Jn(e,ra,en);break;case 5:Jn(e,ra,en);break;default:throw Error(re(329))}}}return la(e,St()),e.callbackNode===a?Qf.bind(null,e):null}function Dc(e,t){var a=Ti;return e.current.memoizedState.isDehydrated&&(ar(e,t).flags|=256),e=No(e,t),e!==2&&(t=ra,ra=a,t!==null&&$c(t)),e}function $c(e){ra===null?ra=e:ra.push.apply(ra,e)}function w1(e){for(var t=e;;){if(t.flags&16384){var a=t.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var n=0;n<a.length;n++){var i=a[n],s=i.getSnapshot;i=i.value;try{if(!Ua(s(),i))return!1}catch{return!1}}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function wn(e,t){for(t&=~Ad,t&=~Fo,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var a=31-za(t),n=1<<a;e[a]=-1,t&=~n}}function kp(e){if(He&6)throw Error(re(327));Wr();var t=so(e,0);if(!(t&1))return la(e,St()),null;var a=No(e,t);if(e.tag!==0&&a===2){var n=pc(e);n!==0&&(t=n,a=Dc(e,n))}if(a===1)throw a=Zi,ar(e,0),wn(e,t),la(e,St()),a;if(a===6)throw Error(re(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Jn(e,ra,en),la(e,St()),null}function Id(e,t){var a=He;He|=1;try{return e(t)}finally{He=a,He===0&&(Xr=St()+500,Oo&&Fn())}}function cr(e){Nn!==null&&Nn.tag===0&&!(He&6)&&Wr();var t=He;He|=1;var a=Aa.transition,n=Ye;try{if(Aa.transition=null,Ye=1,e)return e()}finally{Ye=n,Aa.transition=a,He=t,!(He&6)&&Fn()}}function Ed(){pa=Dr.current,rt(Dr)}function ar(e,t){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==-1&&(e.timeoutHandle=-1,Xx(a)),Nt!==null)for(a=Nt.return;a!==null;){var n=a;switch(dd(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&po();break;case 3:Yr(),rt(sa),rt(Qt),vd();break;case 5:_d(n);break;case 4:Yr();break;case 13:rt(mt);break;case 19:rt(mt);break;case 10:fd(n.type._context);break;case 22:case 23:Ed()}a=a.return}if(Ot=e,Nt=e=Tn(e.current,null),$t=pa=t,kt=0,Zi=null,Ad=Fo=lr=0,ra=Ti=null,Zn!==null){for(t=0;t<Zn.length;t++)if(a=Zn[t],n=a.interleaved,n!==null){a.interleaved=null;var i=n.next,s=a.pending;if(s!==null){var o=s.next;s.next=i,n.next=o}a.pending=n}Zn=null}return e}function Gf(e,t){do{var a=Nt;try{if(md(),Ks.current=yo,bo){for(var n=ft.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}bo=!1}if(or=0,Tt=At=ft=null,Pi=!1,Ki=0,Cd.current=null,a===null||a.return===null){kt=1,Zi=t,Nt=null;break}e:{var s=e,o=a.return,u=a,p=t;if(t=$t,u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var v=p,_=u,b=_.tag;if(!(_.mode&1)&&(b===0||b===11||b===15)){var j=_.alternate;j?(_.updateQueue=j.updateQueue,_.memoizedState=j.memoizedState,_.lanes=j.lanes):(_.updateQueue=null,_.memoizedState=null)}var E=hp(o);if(E!==null){E.flags&=-257,gp(E,o,u,s,t),E.mode&1&&fp(s,v,t),t=E,p=v;var F=t.updateQueue;if(F===null){var D=new Set;D.add(p),t.updateQueue=D}else F.add(p);break e}else{if(!(t&1)){fp(s,v,t),Pd();break e}p=Error(re(426))}}else if(ot&&u.mode&1){var me=hp(o);if(me!==null){!(me.flags&65536)&&(me.flags|=256),gp(me,o,u,s,t),ud(Zr(p,u));break e}}s=p=Zr(p,u),kt!==4&&(kt=2),Ti===null?Ti=[s]:Ti.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var N=Pf(s,p,t);lp(s,N);break e;case 1:u=p;var y=s.type,O=s.stateNode;if(!(s.flags&128)&&(typeof y.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(Pn===null||!Pn.has(O)))){s.flags|=65536,t&=-t,s.lanes|=t;var L=Mf(s,u,t);lp(s,L);break e}}s=s.return}while(s!==null)}Yf(a)}catch(ie){t=ie,Nt===a&&a!==null&&(Nt=a=a.return);continue}break}while(!0)}function Kf(){var e=So.current;return So.current=yo,e===null?yo:e}function Pd(){(kt===0||kt===3||kt===2)&&(kt=4),Ot===null||!(lr&268435455)&&!(Fo&268435455)||wn(Ot,$t)}function No(e,t){var a=He;He|=2;var n=Kf();(Ot!==e||$t!==t)&&(en=null,ar(e,t));do try{j1();break}catch(i){Gf(e,i)}while(!0);if(md(),He=a,So.current=n,Nt!==null)throw Error(re(261));return Ot=null,$t=0,kt}function j1(){for(;Nt!==null;)Jf(Nt)}function N1(){for(;Nt!==null&&!Jg();)Jf(Nt)}function Jf(e){var t=Xf(e.alternate,e,pa);e.memoizedProps=e.pendingProps,t===null?Yf(e):Nt=t,Cd.current=null}function Yf(e){var t=e;do{var a=t.alternate;if(e=t.return,t.flags&32768){if(a=_1(a,t),a!==null){a.flags&=32767,Nt=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{kt=6,Nt=null;return}}else if(a=x1(a,t,pa),a!==null){Nt=a;return}if(t=t.sibling,t!==null){Nt=t;return}Nt=t=e}while(t!==null);kt===0&&(kt=5)}function Jn(e,t,a){var n=Ye,i=Aa.transition;try{Aa.transition=null,Ye=1,C1(e,t,a,n)}finally{Aa.transition=i,Ye=n}return null}function C1(e,t,a,n){do Wr();while(Nn!==null);if(He&6)throw Error(re(327));a=e.finishedWork;var i=e.finishedLanes;if(a===null)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(re(177));e.callbackNode=null,e.callbackPriority=0;var s=a.lanes|a.childLanes;if(sx(e,s),e===Ot&&(Nt=Ot=null,$t=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Fs||(Fs=!0,e0(io,function(){return Wr(),null})),s=(a.flags&15990)!==0,a.subtreeFlags&15990||s){s=Aa.transition,Aa.transition=null;var o=Ye;Ye=1;var u=He;He|=4,Cd.current=null,b1(e,a),Hf(a,e),Wx(_c),oo=!!xc,_c=xc=null,e.current=a,y1(a),Yg(),He=u,Ye=o,Aa.transition=s}else e.current=a;if(Fs&&(Fs=!1,Nn=e,jo=i),s=e.pendingLanes,s===0&&(Pn=null),ex(a.stateNode),la(e,St()),t!==null)for(n=e.onRecoverableError,a=0;a<t.length;a++)i=t[a],n(i.value,{componentStack:i.stack,digest:i.digest});if(wo)throw wo=!1,e=Fc,Fc=null,e;return jo&1&&e.tag!==0&&Wr(),s=e.pendingLanes,s&1?e===Uc?Oi++:(Oi=0,Uc=e):Oi=0,Fn(),null}function Wr(){if(Nn!==null){var e=Em(jo),t=Aa.transition,a=Ye;try{if(Aa.transition=null,Ye=16>e?16:e,Nn===null)var n=!1;else{if(e=Nn,Nn=null,jo=0,He&6)throw Error(re(331));var i=He;for(He|=4,_e=e.current;_e!==null;){var s=_e,o=s.child;if(_e.flags&16){var u=s.deletions;if(u!==null){for(var p=0;p<u.length;p++){var v=u[p];for(_e=v;_e!==null;){var _=_e;switch(_.tag){case 0:case 11:case 15:Mi(8,_,s)}var b=_.child;if(b!==null)b.return=_,_e=b;else for(;_e!==null;){_=_e;var j=_.sibling,E=_.return;if(Bf(_),_===v){_e=null;break}if(j!==null){j.return=E,_e=j;break}_e=E}}}var F=s.alternate;if(F!==null){var D=F.child;if(D!==null){F.child=null;do{var me=D.sibling;D.sibling=null,D=me}while(D!==null)}}_e=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,_e=o;else e:for(;_e!==null;){if(s=_e,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Mi(9,s,s.return)}var N=s.sibling;if(N!==null){N.return=s.return,_e=N;break e}_e=s.return}}var y=e.current;for(_e=y;_e!==null;){o=_e;var O=o.child;if(o.subtreeFlags&2064&&O!==null)O.return=o,_e=O;else e:for(o=y;_e!==null;){if(u=_e,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:zo(9,u)}}catch(ie){xt(u,u.return,ie)}if(u===o){_e=null;break e}var L=u.sibling;if(L!==null){L.return=u.return,_e=L;break e}_e=u.return}}if(He=i,Fn(),Ka&&typeof Ka.onPostCommitFiberRoot=="function")try{Ka.onPostCommitFiberRoot(Io,e)}catch{}n=!0}return n}finally{Ye=a,Aa.transition=t}}return!1}function Ip(e,t,a){t=Zr(a,t),t=Pf(e,t,1),e=En(e,t,1),t=ea(),e!==null&&(ts(e,1,t),la(e,t))}function xt(e,t,a){if(e.tag===3)Ip(e,e,a);else for(;t!==null;){if(t.tag===3){Ip(t,e,a);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Pn===null||!Pn.has(n))){e=Zr(a,e),e=Mf(t,e,1),t=En(t,e,1),e=ea(),t!==null&&(ts(t,1,e),la(t,e));break}}t=t.return}}function A1(e,t,a){var n=e.pingCache;n!==null&&n.delete(t),t=ea(),e.pingedLanes|=e.suspendedLanes&a,Ot===e&&($t&a)===a&&(kt===4||kt===3&&($t&130023424)===$t&&500>St()-kd?ar(e,0):Ad|=a),la(e,t)}function Zf(e,t){t===0&&(e.mode&1?(t=ks,ks<<=1,!(ks&130023424)&&(ks=4194304)):t=1);var a=ea();e=cn(e,t),e!==null&&(ts(e,t,a),la(e,a))}function k1(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),Zf(e,a)}function I1(e,t){var a=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;i!==null&&(a=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(re(314))}n!==null&&n.delete(t),Zf(e,a)}var Xf;Xf=function(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps||sa.current)ia=!0;else{if(!(e.lanes&a)&&!(t.flags&128))return ia=!1,g1(e,t,a);ia=!!(e.flags&131072)}else ia=!1,ot&&t.flags&1048576&&af(t,ho,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Ys(e,t),e=t.pendingProps;var i=Gr(t,Qt.current);Hr(t,a),i=yd(null,t,n,e,i,a);var s=Sd();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,oa(n)?(s=!0,mo(t)):s=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,gd(t),i.updater=Lo,t.stateNode=i,i._reactInternals=t,Ac(t,n,e,a),t=Ec(null,t,n,!0,s,a)):(t.tag=0,ot&&s&&cd(t),Xt(null,t,i,a),t=t.child),t;case 16:n=t.elementType;e:{switch(Ys(e,t),e=t.pendingProps,i=n._init,n=i(n._payload),t.type=n,i=t.tag=P1(n),e=Oa(n,e),i){case 0:t=Ic(null,t,n,e,a);break e;case 1:t=vp(null,t,n,e,a);break e;case 11:t=xp(null,t,n,e,a);break e;case 14:t=_p(null,t,n,Oa(n.type,e),a);break e}throw Error(re(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Oa(n,i),Ic(e,t,n,i,a);case 1:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Oa(n,i),vp(e,t,n,i,a);case 3:e:{if(Lf(t),e===null)throw Error(re(387));n=t.pendingProps,s=t.memoizedState,i=s.element,cf(e,t),_o(t,n,null,a);var o=t.memoizedState;if(n=o.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){i=Zr(Error(re(423)),t),t=bp(e,t,n,a,i);break e}else if(n!==i){i=Zr(Error(re(424)),t),t=bp(e,t,n,a,i);break e}else for(fa=In(t.stateNode.containerInfo.firstChild),ha=t,ot=!0,La=null,a=of(t,null,n,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Kr(),n===i){t=dn(e,t,a);break e}Xt(e,t,n,a)}t=t.child}return t;case 5:return df(t),e===null&&jc(t),n=t.type,i=t.pendingProps,s=e!==null?e.memoizedProps:null,o=i.children,vc(n,i)?o=null:s!==null&&vc(n,s)&&(t.flags|=32),Rf(e,t),Xt(e,t,o,a),t.child;case 6:return e===null&&jc(t),null;case 13:return zf(e,t,a);case 4:return xd(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Jr(t,null,n,a):Xt(e,t,n,a),t.child;case 11:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Oa(n,i),xp(e,t,n,i,a);case 7:return Xt(e,t,t.pendingProps,a),t.child;case 8:return Xt(e,t,t.pendingProps.children,a),t.child;case 12:return Xt(e,t,t.pendingProps.children,a),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,et(go,n._currentValue),n._currentValue=o,s!==null)if(Ua(s.value,o)){if(s.children===i.children&&!sa.current){t=dn(e,t,a);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var u=s.dependencies;if(u!==null){o=s.child;for(var p=u.firstContext;p!==null;){if(p.context===n){if(s.tag===1){p=sn(-1,a&-a),p.tag=2;var v=s.updateQueue;if(v!==null){v=v.shared;var _=v.pending;_===null?p.next=p:(p.next=_.next,_.next=p),v.pending=p}}s.lanes|=a,p=s.alternate,p!==null&&(p.lanes|=a),Nc(s.return,a,t),u.lanes|=a;break}p=p.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(re(341));o.lanes|=a,u=o.alternate,u!==null&&(u.lanes|=a),Nc(o,a,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Xt(e,t,i.children,a),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,Hr(t,a),i=ka(i),n=n(i),t.flags|=1,Xt(e,t,n,a),t.child;case 14:return n=t.type,i=Oa(n,t.pendingProps),i=Oa(n.type,i),_p(e,t,n,i,a);case 15:return Tf(e,t,t.type,t.pendingProps,a);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:Oa(n,i),Ys(e,t),t.tag=1,oa(n)?(e=!0,mo(t)):e=!1,Hr(t,a),Ef(t,n,i),Ac(t,n,i,a),Ec(null,t,n,!0,e,a);case 19:return Ff(e,t,a);case 22:return Of(e,t,a)}throw Error(re(156,t.tag))};function e0(e,t){return Cm(e,t)}function E1(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ca(e,t,a,n){return new E1(e,t,a,n)}function Md(e){return e=e.prototype,!(!e||!e.isReactComponent)}function P1(e){if(typeof e=="function")return Md(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Yc)return 11;if(e===Zc)return 14}return 2}function Tn(e,t){var a=e.alternate;return a===null?(a=Ca(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function eo(e,t,a,n,i,s){var o=2;if(n=e,typeof e=="function")Md(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case Er:return nr(a.children,i,s,t);case Jc:o=8,i|=8;break;case Yl:return e=Ca(12,a,t,i|2),e.elementType=Yl,e.lanes=s,e;case Zl:return e=Ca(13,a,t,i),e.elementType=Zl,e.lanes=s,e;case Xl:return e=Ca(19,a,t,i),e.elementType=Xl,e.lanes=s,e;case cm:return Uo(a,i,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case om:o=10;break e;case lm:o=9;break e;case Yc:o=11;break e;case Zc:o=14;break e;case vn:o=16,n=null;break e}throw Error(re(130,e==null?e:typeof e,""))}return t=Ca(o,a,t,i),t.elementType=e,t.type=n,t.lanes=s,t}function nr(e,t,a,n){return e=Ca(7,e,n,t),e.lanes=a,e}function Uo(e,t,a,n){return e=Ca(22,e,n,t),e.elementType=cm,e.lanes=a,e.stateNode={isHidden:!1},e}function Wl(e,t,a){return e=Ca(6,e,null,t),e.lanes=a,e}function Ql(e,t,a){return t=Ca(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function M1(e,t,a,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Al(0),this.expirationTimes=Al(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Al(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Td(e,t,a,n,i,s,o,u,p){return e=new M1(e,t,a,u,p),t===1?(t=1,s===!0&&(t|=8)):t=0,s=Ca(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:n,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},gd(s),e}function T1(e,t,a){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ir,key:n==null?null:""+n,children:e,containerInfo:t,implementation:a}}function t0(e){if(!e)return Rn;e=e._reactInternals;e:{if(pr(e)!==e||e.tag!==1)throw Error(re(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(oa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(re(171))}if(e.tag===1){var a=e.type;if(oa(a))return ef(e,a,t)}return t}function a0(e,t,a,n,i,s,o,u,p){return e=Td(a,n,!0,e,i,s,o,u,p),e.context=t0(null),a=e.current,n=ea(),i=Mn(a),s=sn(n,i),s.callback=t??null,En(a,s,i),e.current.lanes=i,ts(e,i,n),la(e,n),e}function Do(e,t,a,n){var i=t.current,s=ea(),o=Mn(i);return a=t0(a),t.context===null?t.context=a:t.pendingContext=a,t=sn(s,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=En(i,t,o),e!==null&&(Fa(e,i,o,s),Gs(e,i,o)),o}function Co(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ep(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function Od(e,t){Ep(e,t),(e=e.alternate)&&Ep(e,t)}function O1(){return null}var n0=typeof reportError=="function"?reportError:function(e){console.error(e)};function Rd(e){this._internalRoot=e}$o.prototype.render=Rd.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(re(409));Do(e,t,null,null)};$o.prototype.unmount=Rd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;cr(function(){Do(null,e,null,null)}),t[ln]=null}};function $o(e){this._internalRoot=e}$o.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tm();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Sn.length&&t!==0&&t<Sn[a].priority;a++);Sn.splice(a,0,e),a===0&&Rm(e)}};function Ld(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Bo(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Pp(){}function R1(e,t,a,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var v=Co(o);s.call(v)}}var o=a0(t,n,e,0,null,!1,!1,"",Pp);return e._reactRootContainer=o,e[ln]=o.current,Vi(e.nodeType===8?e.parentNode:e),cr(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof n=="function"){var u=n;n=function(){var v=Co(p);u.call(v)}}var p=Td(e,0,!1,null,null,!1,!1,"",Pp);return e._reactRootContainer=p,e[ln]=p.current,Vi(e.nodeType===8?e.parentNode:e),cr(function(){Do(t,p,a,n)}),p}function qo(e,t,a,n,i){var s=a._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var u=i;i=function(){var p=Co(o);u.call(p)}}Do(t,o,e,i)}else o=R1(a,t,e,i,n);return Co(o)}Pm=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var a=ji(t.pendingLanes);a!==0&&(td(t,a|1),la(t,St()),!(He&6)&&(Xr=St()+500,Fn()))}break;case 13:cr(function(){var n=cn(e,1);if(n!==null){var i=ea();Fa(n,e,1,i)}}),Od(e,1)}};ad=function(e){if(e.tag===13){var t=cn(e,134217728);if(t!==null){var a=ea();Fa(t,e,134217728,a)}Od(e,134217728)}};Mm=function(e){if(e.tag===13){var t=Mn(e),a=cn(e,t);if(a!==null){var n=ea();Fa(a,e,t,n)}Od(e,t)}};Tm=function(){return Ye};Om=function(e,t){var a=Ye;try{return Ye=e,t()}finally{Ye=a}};cc=function(e,t,a){switch(t){case"input":if(ac(e,a),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var i=To(n);if(!i)throw Error(re(90));um(n),ac(n,i)}}}break;case"textarea":mm(e,a);break;case"select":t=a.value,t!=null&&$r(e,!!a.multiple,t,!1)}};bm=Id;ym=cr;var L1={usingClientEntryPoint:!1,Events:[ns,Or,To,_m,vm,Id]},yi={findFiberByHostInstance:Yn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},z1={bundleType:yi.bundleType,version:yi.version,rendererPackageName:yi.rendererPackageName,rendererConfig:yi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:un.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=jm(e),e===null?null:e.stateNode},findFiberByHostInstance:yi.findFiberByHostInstance||O1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Us=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Us.isDisabled&&Us.supportsFiber)try{Io=Us.inject(z1),Ka=Us}catch{}}xa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L1;xa.createPortal=function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ld(t))throw Error(re(200));return T1(e,t,null,a)};xa.createRoot=function(e,t){if(!Ld(e))throw Error(re(299));var a=!1,n="",i=n0;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=Td(e,1,!1,null,null,a,!1,n,i),e[ln]=t.current,Vi(e.nodeType===8?e.parentNode:e),new Rd(t)};xa.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(re(188)):(e=Object.keys(e).join(","),Error(re(268,e)));return e=jm(t),e=e===null?null:e.stateNode,e};xa.flushSync=function(e){return cr(e)};xa.hydrate=function(e,t,a){if(!Bo(t))throw Error(re(200));return qo(null,e,t,!0,a)};xa.hydrateRoot=function(e,t,a){if(!Ld(e))throw Error(re(405));var n=a!=null&&a.hydratedSources||null,i=!1,s="",o=n0;if(a!=null&&(a.unstable_strictMode===!0&&(i=!0),a.identifierPrefix!==void 0&&(s=a.identifierPrefix),a.onRecoverableError!==void 0&&(o=a.onRecoverableError)),t=a0(t,null,e,1,a??null,i,!1,s,o),e[ln]=t.current,Vi(e),n)for(e=0;e<n.length;e++)a=n[e],i=a._getVersion,i=i(a._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[a,i]:t.mutableSourceEagerHydrationData.push(a,i);return new $o(t)};xa.render=function(e,t,a){if(!Bo(t))throw Error(re(200));return qo(null,e,t,!1,a)};xa.unmountComponentAtNode=function(e){if(!Bo(e))throw Error(re(40));return e._reactRootContainer?(cr(function(){qo(null,null,e,!1,function(){e._reactRootContainer=null,e[ln]=null})}),!0):!1};xa.unstable_batchedUpdates=Id;xa.unstable_renderSubtreeIntoContainer=function(e,t,a,n){if(!Bo(a))throw Error(re(200));if(e==null||e._reactInternals===void 0)throw Error(re(38));return qo(e,t,a,!1,n)};xa.version="18.3.1-next-f1338f8080-20240426";function r0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r0)}catch(e){console.error(e)}}r0(),nm.exports=xa;var F1=nm.exports,Mp=F1;Kl.createRoot=Mp.createRoot,Kl.hydrateRoot=Mp.hydrateRoot;const U1="modulepreload",D1=function(e){return"/pres/"+e},Tp={},Gl=function(t,a,n){let i=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),u=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(a.map(p=>{if(p=D1(p),p in Tp)return;Tp[p]=!0;const v=p.endsWith(".css"),_=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${_}`))return;const b=document.createElement("link");if(b.rel=v?"stylesheet":U1,v||(b.as="script"),b.crossOrigin="",b.href=p,u&&b.setAttribute("nonce",u),document.head.appendChild(b),v)return new Promise((j,E)=>{b.addEventListener("load",j),b.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${p}`)))})}))}function s(o){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o}return i.then(o=>{for(const u of o||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})},dr=e=>(e||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().replace(/\s+/g," ").trim(),Op=e=>dr(e).split(/[^a-z0-9]+/).filter(Boolean),Rp=e=>{const t=`  ${dr(e)}  `,a=[];for(let n=0;n<t.length-2;n++)a.push(t.slice(n,n+3));return a},$1=(e,t)=>{const a=new Set(Rp(e)),n=new Set(Rp(t));if(a.size===0||n.size===0)return 0;let i=0;for(const o of a)n.has(o)&&i++;const s=a.size+n.size-i;return s>0?i/s:0},i0=(e,t)=>{const a=new Set(Op(e)),n=new Set(Op(t));if(!a.size||!n.size)return 0;let i=0;for(const s of a)n.has(s)&&i++;return i/(a.size+n.size-i||1)},zd=(e,t)=>{const a=$1(e,t),n=i0(e,t),i=dr(e),s=dr(t),o=s.includes(i)||i.includes(s)?.1:0,u=i&&s.startsWith(i)||s&&i.startsWith(s)?.05:0;return .6*a+.4*n+o+u},tn=e=>{const t=dr(e);return t==="m2"||t.startsWith("m2")?"m2":t==="m3"||t.startsWith("m3")?"m3":t==="ml"||t==="m"||t==="metro lineal"?"ml":t==="kg"?"kg":["u","un","und","unidad","unid","un."].includes(t)?"u":["gl","lote","kit","set"].includes(t)?"gl":t||""},rr=e=>{const t=e.secciones||{},a=[t.materiales,t.manoObra,t.equipos,t.varios].flat().filter(Boolean),n=a.some(i=>Number((i==null?void 0:i.pu)||0)>0);return Array.isArray(e.items)&&e.items.length>0?!1:!a.length||!n};function to(e,t){const a=(t==null?void 0:t.threshold)??.42,n=(t==null?void 0:t.sameUnit)??!0,i=[],s=new Set;for(let o=0;o<e.length;o++){const u=e[o];if(!u||s.has(u.id))continue;const p=tn(String(u.unidadSalida||"")),v=[u.id],_=[u.descripcion];for(let b=o+1;b<e.length;b++){const j=e[b];if(!j||s.has(j.id))continue;const E=tn(String(j.unidadSalida||""));if(n&&p&&E&&p!==E)continue;zd(u.descripcion,j.descripcion)>=a&&(v.push(j.id),_.push(j.descripcion),s.add(j.id))}v.length>1&&(i.push({key:u.id,unit:p,ids:v,labels:_}),v.forEach(b=>s.add(b)))}return i}const yn=()=>{try{return JSON.parse(localStorage.getItem("apu-aliases")||"{}")||{}}catch{return{}}},Ds=e=>{try{localStorage.setItem("apu-aliases",JSON.stringify(e||{}))}catch{}};function s0({open:e,onClose:t,onPick:a,apus:n,onCreateNew:i}){const[s,o]=V.useState(""),[u,p]=V.useState(!1);if(!e)return null;const v=(n||[]).filter(_=>!s||String(_.descripcion||"").toLowerCase().includes(s.toLowerCase())).filter(_=>u?!(rr(_)||!String((_==null?void 0:_.unidadSalida)||"").trim()):!0);return r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:t}),r.jsxs("div",{className:"relative bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-3xl mx-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Seleccionar APU"}),r.jsx("button",{onClick:t,className:"text-slate-300 hover:text-white",children:"×"})]}),r.jsxs("div",{className:"p-4 grid gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-slate-300",children:"Buscar:"}),r.jsx("input",{value:s,onChange:_=>o(_.target.value),className:"bg-slate-800 border border-slate-700 rounded-xl px-3 py-2 text-sm w-full",placeholder:"Descripción del APU"}),r.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-300 whitespace-nowrap",children:[r.jsx("input",{type:"checkbox",checked:u,onChange:_=>p(_.currentTarget.checked)}),"Ocultar incompletos"]})]}),v.length===0?r.jsx("div",{className:"text-sm text-slate-300",children:"No hay APUs creados para seleccionar. Puedes crear uno nuevo."}):r.jsx("div",{className:"max-h-[50vh] overflow-y-auto rounded-xl border border-slate-700",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-slate-300",children:[r.jsx("th",{className:"py-2 px-3",children:"Descripción"}),r.jsx("th",{className:"py-2 px-3 w-28",children:"Cat."}),r.jsx("th",{className:"py-2 px-3 w-24",children:"Unidad"}),r.jsx("th",{className:"py-2 px-3 w-20"})]})}),r.jsx("tbody",{children:v.map(_=>{const b=rr(_)||!String((_==null?void 0:_.unidadSalida)||"").trim();return r.jsxs("tr",{className:"border-t border-slate-800 hover:bg-slate-800/60",children:[r.jsx("td",{className:"py-2 px-3",children:r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx("span",{children:_.descripcion}),b&&r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-amber-900/30 border border-amber-700/50 text-amber-300 text-[10px]",title:"Este APU no tiene costo calculable o le falta unidad/secciones","aria-label":"APU incompleto",children:"incompleto"})]})}),r.jsx("td",{className:"py-2 px-3",children:_.categoria||""}),r.jsx("td",{className:"py-2 px-3",children:_.unidadSalida}),r.jsx("td",{className:"py-2 px-3 text-right",children:r.jsx("button",{onClick:()=>a(_.id),className:"px-2 py-1 rounded border border-slate-600 hover:bg-slate-700/30 text-xs",children:"Seleccionar"})})]},_.id)})})]})}),r.jsxs("div",{className:"flex justify-end gap-2",children:[i&&r.jsx("button",{onClick:i,className:"px-3 py-2 rounded-xl border border-slate-600 hover:bg-slate-700/40 text-sm",children:"+ Crear nuevo APU"}),r.jsx("button",{onClick:t,className:"px-3 py-2 rounded-xl border border-slate-600 text-sm",children:"Cerrar"})]})]})]})]})}const pt=e=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(e||0),Vo=e=>{let t=String(e||"").trim();try{t=t.normalize("NFKC")}catch{}return t=t.replace(/²/g,"2").replace(/³/g,"3"),t=t.replace(/\u33A1/g,"m2").replace(/\u33A5/g,"m3"),t=t.replace(/m\s*\^\s*2/gi,"m2").replace(/m\s*\^\s*3/gi,"m3"),t=t.replace(/\s+/g,"").toLowerCase(),t},Ie=()=>Math.random().toString(36).slice(2),o0=e=>{try{return String(e||"").normalize("NFC")}catch{return String(e||"")}},B1=e=>{const t={"Ã¡":"á","Ã©":"é","Ã­":"í","Ã³":"ó",Ãº:"ú","Ã±":"ñ","Ã‘":"Ñ","Ã¼":"ü",Ãœ:"Ü","Â¿":"¿","Â¡":"¡",Âº:"º",Âª:"ª","Ã€":"À","Ã‰":"É","Ãˆ":"È","Ã‚":"Â","â€“":"–","â€”":"—","â€˜":"‘","â€™":"’","â€œ":"“","â€":"”","â€¢":"•","â€¦":"…","mÂ²":"m²","mÂ³":"m³"};let a=String(e||"");for(const[n,i]of Object.entries(t))a=a.replace(new RegExp(n,"g"),i);return o0(a)},q1={jornal_maestro:{id:"jornal_maestro",tipo:"mano_obra",nombre:"Maestro jornal",unidad:"jornal",precio:49500},jornal_ayudante:{id:"jornal_ayudante",tipo:"mano_obra",nombre:"Ayudante jornal",unidad:"jornal",precio:29915},retro_4x4_hora:{id:"retro_4x4_hora",tipo:"equipo",nombre:"Retroexcavadora 4x4 hora",unidad:"hora",precio:42e3},bomba_hora:{id:"bomba_hora",tipo:"equipo",nombre:"Bomba de hormigón hora",unidad:"hora",precio:31303},h25_m3:{id:"h25_m3",tipo:"material",nombre:"Hormigón H-25 (m³)",unidad:"m3",precio:188836},encofrado_m2:{id:"encofrado_m2",tipo:"material",nombre:"Madera encofrado (m²)",unidad:"m2",precio:28442},acero_kg:{id:"acero_kg",tipo:"material",nombre:"Acero A63-42H (kg)",unidad:"kg",precio:3133},topo_dia:{id:"topo_dia",tipo:"servicio",nombre:"Topografía con estación total (día)",unidad:"día",precio:51e4},plancha_zinc_m2:{id:"plancha_zinc_m2",tipo:"material",nombre:"Plancha Zinc Acanalada (m²)",unidad:"m2",precio:8990},ceramica_piso_m2:{id:"ceramica_piso_m2",tipo:"material",nombre:"Cerámica piso (m²)",unidad:"m2",precio:5990},ceramica_muro_m2:{id:"ceramica_muro_m2",tipo:"material",nombre:"Cerámica muro (m²)",unidad:"m2",precio:6990},yeso_carton_m2:{id:"yeso_carton_m2",tipo:"material",nombre:"Yeso-cartón para cielos (m²)",unidad:"m2",precio:12e3},pintura_latex_20l:{id:"pintura_latex_20l",tipo:"material",nombre:"Pintura Látex interior (20L)",unidad:"20L",precio:29990},pintura_fachada_20l:{id:"pintura_fachada_20l",tipo:"material",nombre:"Pintura Fachada (20L)",unidad:"20L",precio:34990},fijaciones_zinc_lote:{id:"fijaciones_zinc_lote",tipo:"material",nombre:"Fijaciones Techo (lote)",unidad:"gl",precio:8e4},mortero_lechada_lote:{id:"mortero_lechada_lote",tipo:"material",nombre:"Mortero y lechada (lote)",unidad:"gl",precio:12e4},cable_electrico_lote:{id:"cable_electrico_lote",tipo:"material",nombre:"Cableado eléctrico (lote)",unidad:"gl",precio:25e4},tablero_electrico_un:{id:"tablero_electrico_un",tipo:"material",nombre:"Tablero eléctrico (unidad)",unidad:"un",precio:8e4},cajas_electricas_un:{id:"cajas_electricas_un",tipo:"material",nombre:"Cajas y dispositivos (unidad)",unidad:"un",precio:2990},canaletas_lote:{id:"canaletas_lote",tipo:"material",nombre:"Tubería/Canaletas (lote)",unidad:"gl",precio:7e4},artefactos_bano_kit:{id:"artefactos_bano_kit",tipo:"material",nombre:"Artefactos de baño (kit)",unidad:"gl",precio:299990},artefactos_cocina_kit:{id:"artefactos_cocina_kit",tipo:"material",nombre:"Artefactos cocina (kit)",unidad:"gl",precio:149990},ppr_agua_lote:{id:"ppr_agua_lote",tipo:"material",nombre:"Tuberías PPR agua (lote)",unidad:"gl",precio:22e4},pvc_desague_lote:{id:"pvc_desague_lote",tipo:"material",nombre:"Tuberías PVC desagüe (lote)",unidad:"gl",precio:18e4},regulador_gas_lote:{id:"regulador_gas_lote",tipo:"material",nombre:"Cañería gas y regulador (lote)",unidad:"gl",precio:12e4}},Xi=e=>o0(B1(String(e||""))).trim(),V1=e=>({...e,nombre:Xi(e.nombre),unidad:Vo(Xi(e.unidad))}),Ao=Object.fromEntries(Object.entries(q1).map(([e,t])=>[e,V1(t)])),H1=[{id:"apu_topografia_inicial",descripcion:"Levantamiento topográfico y PRs",unidadSalida:"gl",items:[{resourceId:"topo_dia",tipo:"coef",coef:1,merma:0}]},{id:"apu_trazado_niveles",descripcion:"Trazado de ejes y niveles en obra",unidadSalida:"m²",items:[{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:75},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:150}]},{id:"apu_excavacion_manual",descripcion:"Excavación a mano en zanja",unidadSalida:"m³",items:[{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:8},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:16}]},{id:"apu_h25_fundaciones",descripcion:"Hormigón fundaciones H-25",unidadSalida:"m³",items:[{resourceId:"h25_m3",tipo:"coef",coef:1,merma:.03},{resourceId:"bomba_hora",tipo:"coef",coef:1.5},{resourceId:"jornal_maestro",tipo:"coef",coef:.3},{resourceId:"jornal_ayudante",tipo:"coef",coef:.3}]},{id:"apu_h25_muros",descripcion:"Hormigón muros H-25",unidadSalida:"m³",items:[{resourceId:"h25_m3",tipo:"coef",coef:1,merma:.03},{resourceId:"bomba_hora",tipo:"coef",coef:2},{resourceId:"jornal_maestro",tipo:"coef",coef:.35},{resourceId:"jornal_ayudante",tipo:"coef",coef:.45},{resourceId:"encofrado_m2",tipo:"rendimiento",rendimiento:9},{resourceId:"acero_kg",tipo:"rendimiento",rendimiento:220}]},{id:"apu_moldajes_fundaciones",descripcion:"Moldajes hormigón fundaciones",unidadSalida:"m²",items:[{resourceId:"encofrado_m2",tipo:"coef",coef:1},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:12},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:18}]},{id:"apu_enfierradura",descripcion:"Enfierraduras",unidadSalida:"kg",items:[{resourceId:"acero_kg",tipo:"coef",coef:1,merma:.06},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:400},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:600}]},{id:"apu_radier_10cm",descripcion:"Radier 10 cm H-25 con malla",unidadSalida:"m²",items:[{resourceId:"h25_m3",tipo:"coef",coef:.1,merma:.03},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:30},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:45}]},{id:"apu_pintura_interior_m2",descripcion:"Pintura interior (látex) 2 manos",unidadSalida:"m2",items:[{resourceId:"pintura_latex_20l",tipo:"rendimiento",rendimiento:60},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:120},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:180}]},{id:"apu_pintura_fachada_m2",descripcion:"Pintura fachada 2 manos",unidadSalida:"m2",items:[{resourceId:"pintura_fachada_20l",tipo:"rendimiento",rendimiento:60},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:100},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:150}]},{id:"apu_cubierta_zinc_m2",descripcion:"Cubierta de zinc acanalado",unidadSalida:"m2",items:[{resourceId:"plancha_zinc_m2",tipo:"coef",coef:1},{resourceId:"fijaciones_zinc_lote",tipo:"rendimiento",rendimiento:70},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:30},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:45}]},{id:"apu_ceramica_piso_m2",descripcion:"Instalación cerámica en piso",unidadSalida:"m2",items:[{resourceId:"ceramica_piso_m2",tipo:"coef",coef:1},{resourceId:"mortero_lechada_lote",tipo:"rendimiento",rendimiento:60},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:18},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:28}]},{id:"apu_ceramica_muro_m2",descripcion:"Instalación cerámica en muro",unidadSalida:"m2",items:[{resourceId:"ceramica_muro_m2",tipo:"coef",coef:1},{resourceId:"mortero_lechada_lote",tipo:"rendimiento",rendimiento:45},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:14},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:20}]},{id:"apu_cielo_yeso_m2",descripcion:"Cielo de yeso-cartón",unidadSalida:"m2",items:[{resourceId:"yeso_carton_m2",tipo:"coef",coef:1},{resourceId:"jornal_maestro",tipo:"rendimiento",rendimiento:22},{resourceId:"jornal_ayudante",tipo:"rendimiento",rendimiento:35}]},{id:"apu_inst_electrica_gl",descripcion:"Instalaciones eléctricas completas",unidadSalida:"gl",items:[{resourceId:"cable_electrico_lote",tipo:"coef",coef:1},{resourceId:"tablero_electrico_un",tipo:"coef",coef:1},{resourceId:"cajas_electricas_un",tipo:"coef",coef:20},{resourceId:"canaletas_lote",tipo:"coef",coef:1},{resourceId:"jornal_maestro",tipo:"coef",coef:.5},{resourceId:"jornal_ayudante",tipo:"coef",coef:.5}]},{id:"apu_inst_sanitaria_gl",descripcion:"Instalaciones sanitarias y gas",unidadSalida:"gl",items:[{resourceId:"ppr_agua_lote",tipo:"coef",coef:1},{resourceId:"pvc_desague_lote",tipo:"coef",coef:1},{resourceId:"artefactos_bano_kit",tipo:"coef",coef:1},{resourceId:"artefactos_cocina_kit",tipo:"coef",coef:1},{resourceId:"regulador_gas_lote",tipo:"coef",coef:1},{resourceId:"jornal_maestro",tipo:"coef",coef:.5},{resourceId:"jornal_ayudante",tipo:"coef",coef:.5}]}],W1=e=>({...e,descripcion:Xi(e.descripcion),unidadSalida:Vo(Xi(e.unidadSalida))}),$s=H1.map(W1),Q1={vivienda_basica:{name:"Vivienda Básica (60m²)",items:[{apuId:"apu_topografia_inicial",metrados:1},{apuId:"apu_trazado_niveles",metrados:60},{apuId:"apu_excavacion_manual",metrados:8},{apuId:"apu_h25_fundaciones",metrados:8},{apuId:"apu_moldajes_fundaciones",metrados:24},{apuId:"apu_enfierradura",metrados:350},{apuId:"apu_radier_10cm",metrados:60}]},ampliacion_casa:{name:"Ampliación Casa (30m²)",items:[{apuId:"apu_trazado_niveles",metrados:30},{apuId:"apu_excavacion_manual",metrados:4},{apuId:"apu_h25_fundaciones",metrados:4},{apuId:"apu_moldajes_fundaciones",metrados:12},{apuId:"apu_radier_10cm",metrados:30}]}};Object.fromEntries(Object.entries(Q1).map(([e,t])=>[e,{...t,name:Xi(t.name)}]));const G1=[["radier",["losa delgada","radiel","radier h-25","radier h25","radier 10 cm"]],["zinc acanalado",["cubierta zinc","plancha zinc","zinc 0,35","zinc ondulado"]],["yeso cartón",["yesocarton","yeso-carton","drywall","volcanita"]],["pvc desagüe",["pvc alcantarillado","pvc sanitario","pvc 110"]],["ppr agua",["ppr agua fría","ppr agua caliente","ppr"]],["puerta exterior",["puerta principal"]],["herrajes",["bisagras","picaportes","cerraduras"]],["aislación",["aislante","lana de vidrio","lana"]],["dren infiltración",["dren de infiltracion","drenaje infiltracion"]]];function er(e){let t=String(e||"");for(const[a,n]of G1)for(const i of n){const s=new RegExp(`\\b${i.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}\\b`,"gi");t=t.replace(s,a)}return t}function yt(e,t,a,n=new Map,i=new Set){if(e&&typeof e.id=="string"&&n.has(e.id))return n.get(e.id);if(e&&typeof e.id=="string"&&i.has(e.id))return{unit:0,desglose:[{nombre:`Ciclo en ${e.id}`,costo:0}]};e&&typeof e.id=="string"&&i.add(e.id);let s=0;const o=[],u=e;if((()=>{try{const _=(u==null?void 0:u.secciones)||{},b=["materiales","equipos","manoObra","varios"],j=b.some(D=>Array.isArray(_==null?void 0:_[D])&&_[D].length>0),E=Array.isArray(_==null?void 0:_.extras)&&_.extras.some(D=>Array.isArray(D==null?void 0:D.rows)&&D.rows.length>0),F=Object.keys(_||{}).some(D=>{if(b.includes(D)||D==="extras"||D==="__meta"||D==="__titles")return!1;const me=_[D];return Array.isArray(me)?me.length>0:me&&Array.isArray(me.rows)?me.rows.length>0:!1});return!!(j||E||F)}catch{return!1}})()){const _=F=>Array.isArray(F)?F:[],b=u.secciones||{},j=["materiales","equipos","manoObra","varios"],E=[..._(b.materiales),..._(b.equipos),..._(b.manoObra),..._(b.varios)];if(Array.isArray(b.extras))for(const F of b.extras)E.push(..._(F==null?void 0:F.rows));for(const F of Object.keys(b||{})){if(j.includes(F)||F==="extras"||F==="__meta"||F==="__titles")continue;const D=b[F];Array.isArray(D)?E.push(..._(D)):D&&Array.isArray(D.rows)&&E.push(..._(D.rows))}for(const F of E){const D=Number((F==null?void 0:F.cantidad)||0),me=Number((F==null?void 0:F.pu)||0),N=D*me;N>0&&(o.push({nombre:String((F==null?void 0:F.descripcion)||"Item"),costo:N}),s+=N)}}else if(Array.isArray(u==null?void 0:u.items))for(const _ of u.items){if(_.tipo==="coef"||_.tipo==="rendimiento"){const b=t[_.resourceId];if(!b)continue;let j=0;if(_.tipo==="coef"){const E=1+(_.merma??0);j=(_.coef??0)*b.precio*E}else j=b.precio/(_.rendimiento||1);o.push({nombre:b.nombre,costo:j}),s+=j;continue}if(_.tipo==="subapu"){const b=_.apuRefId,j=a==null?void 0:a[b];if(!j)continue;const E=yt(j,t,a,n,i),D=(_.coef??(_.rendimiento?1/_.rendimiento:1))*E.unit;o.push({nombre:`SubAPU ${b}`,costo:D}),s+=D;continue}}const v={unit:s,desglose:o};return e&&typeof e.id=="string"&&(n.set(e.id,v),i.delete(e.id)),v}function Bs(e,t,a,n=new Map,i=new Set){const s={materiales:0,manoObra:0,equipos:0,varios:0};if(!e)return{...s};const o=e.id;if(typeof o=="string"&&n.has(o))return n.get(o);if(typeof o=="string"&&i.has(o))return{...s};typeof o=="string"&&i.add(o);const u={materiales:0,manoObra:0,equipos:0,varios:0},p=e;if((()=>{try{const _=(p==null?void 0:p.secciones)||{},b=["materiales","equipos","manoObra","varios"],j=b.some(D=>Array.isArray(_==null?void 0:_[D])&&_[D].length>0),E=Array.isArray(_==null?void 0:_.extras)&&_.extras.some(D=>Array.isArray(D==null?void 0:D.rows)&&D.rows.length>0),F=Object.keys(_||{}).some(D=>{if(b.includes(D)||D==="extras"||D==="__meta"||D==="__titles")return!1;const me=_[D];return Array.isArray(me)?me.length>0:me&&Array.isArray(me.rows)?me.rows.length>0:!1});return!!(j||E||F)}catch{return!1}})()){const _=E=>Array.isArray(E)?E:[],b=p.secciones||{};for(const E of _(b.materiales))u.materiales+=Number((E==null?void 0:E.cantidad)||0)*Number((E==null?void 0:E.pu)||0);for(const E of _(b.manoObra))u.manoObra+=Number((E==null?void 0:E.cantidad)||0)*Number((E==null?void 0:E.pu)||0);for(const E of _(b.equipos))u.equipos+=Number((E==null?void 0:E.cantidad)||0)*Number((E==null?void 0:E.pu)||0);for(const E of _(b.varios))u.varios+=Number((E==null?void 0:E.cantidad)||0)*Number((E==null?void 0:E.pu)||0);if(Array.isArray(b.extras))for(const E of b.extras)for(const F of _(E==null?void 0:E.rows))u.varios+=Number((F==null?void 0:F.cantidad)||0)*Number((F==null?void 0:F.pu)||0);const j=["materiales","equipos","manoObra","varios"];for(const E of Object.keys(b||{})){if(j.includes(E)||E==="extras"||E==="__meta"||E==="__titles")continue;const F=b[E];if(Array.isArray(F))for(const D of F)u.varios+=Number((D==null?void 0:D.cantidad)||0)*Number((D==null?void 0:D.pu)||0);else if(F&&Array.isArray(F.rows))for(const D of F.rows)u.varios+=Number((D==null?void 0:D.cantidad)||0)*Number((D==null?void 0:D.pu)||0)}}else if(Array.isArray(p==null?void 0:p.items))for(const _ of p.items){if(_.tipo==="coef"||_.tipo==="rendimiento"){const b=t[_.resourceId];if(!b)continue;let j=0;if(_.tipo==="coef"){const F=1+(_.merma??0);j=(_.coef??0)*b.precio*F}else j=b.precio/(_.rendimiento||1);const E=b.tipo;E==="material"?u.materiales+=j:E==="mano_obra"?u.manoObra+=j:E==="equipo"?u.equipos+=j:u.varios+=j;continue}if(_.tipo==="subapu"){_.apuRefId;continue}}return typeof o=="string"&&(n.set(o,u),i.delete(o)),u}function K1({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const l0=q.forwardRef(K1);function J1({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"}))}const Bc=q.forwardRef(J1);function Y1({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))}const Z1=q.forwardRef(Y1);function X1({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88"}))}const e_=q.forwardRef(X1);function t_({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}const a_=q.forwardRef(t_);function n_({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"}))}const Ri=q.forwardRef(n_);function r_({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}const Lp=q.forwardRef(r_);function i_({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0 1 10.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0 .229 2.523a1.125 1.125 0 0 1-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0 0 21 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 0 0-1.913-.247M6.34 18H5.25A2.25 2.25 0 0 1 3 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 0 1 1.913-.247m10.5 0a48.536 48.536 0 0 0-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5Zm-3 0h.008v.008H15V10.5Z"}))}const s_=q.forwardRef(i_);function o_({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}const ma=q.forwardRef(o_);function l_({title:e,titleId:t,...a},n){return q.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},a),e?q.createElement("title",{id:t},e):null,q.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z"}))}const c_=q.forwardRef(l_),zp=new Intl.NumberFormat("es-CL",{maximumFractionDigits:0});function ei({value:e,onChange:t,placeholder:a,className:n="",ariaLabel:i}){const[s,o]=V.useState("");V.useEffect(()=>{typeof e=="number"&&Number.isFinite(e)?o(zp.format(e)):o("")},[e]);const u=v=>{const b=v.target.value.replace(/\D+/g,"");if(!b){o(""),t(void 0);return}const j=Number(b);o(zp.format(j)),t(j)},p=v=>{["Backspace","Delete","ArrowLeft","ArrowRight","Home","End","Tab"].includes(v.key)||/\d/.test(v.key)||v.preventDefault()};return r.jsxs("div",{className:`relative ${n}`,children:[r.jsx("span",{className:"pointer-events-none absolute left-2 top-1/2 -translate-y-1/2 text-slate-400",children:"$"}),r.jsx("input",{"aria-label":i||"Precio (CLP)",inputMode:"numeric",className:"w-full text-right bg-slate-900 border border-slate-700 rounded px-2 pl-6 py-1 tabular-nums",value:s,onChange:u,onKeyDown:p,placeholder:a})]})}function d_({index:e,row:t,chapters:a,onPickApu:n,onAddSubRow:i,onUpdateSubRow:s,onRemoveSubRow:o,onMoveChapter:u,onDelete:p,onDuplicate:v,getApuById:_,unitCost:b,resources:j,fmt:E,onUpdateRow:F,onShowApuDetail:D}){var Y;const[me,N]=V.useState(!1),[y,O]=V.useState({}),L=Array.isArray(t.subRows)?t.subRows.length===0:!0,ie=V.useCallback((Z,M)=>{try{const K=H=>{if(!H)return"";const X=String(H).trim();return/^01[\-\s]/.test(X)?X.replace(/^01[\-\s]*/,""):X},U=(yn()||{})[String(Z)]||String(Z),R=localStorage.getItem("apu-library");if(R){const H=JSON.parse(R);if(Array.isArray(H)){const X=H.findIndex(de=>String((de==null?void 0:de.id)||"")===String(U));if(X>=0){const de=H[X],ee=X+1,ge=de&&de.codigo?K(String(de.codigo)):null;return{pos:ee,code:ge}}const ne=H.find(de=>String((de==null?void 0:de.id)||"")===String((M==null?void 0:M.id)||""));return{pos:null,code:ne&&ne.codigo?K(String(ne.codigo)):M!=null&&M.codigo?K(String(M.codigo)):null}}}if(M&&M.codigo)return{pos:null,code:K(String(M.codigo))}}catch{}return{pos:null,code:null}},[]);return r.jsxs(r.Fragment,{children:[r.jsxs("tr",{className:`hover:bg-slate-800/60 text-xs whitespace-nowrap group ${L?"bg-amber-900/10 ring-1 ring-amber-700/50":""}`,children:[r.jsx("td",{className:"h-10 px-3 text-center w-10 tabular-nums align-middle",children:e+1}),r.jsx("td",{className:"h-10 px-3 align-middle",children:r.jsxs("button",{"aria-label":"Agregar subpartida",onClick:()=>i&&i(t.id),className:`w-full h-9 rounded-md bg-transparent border-0 px-3 text-left text-xs min-w-0 truncate focus:outline-none focus:ring-1 ${L?"focus:ring-amber-500":"focus:ring-cyan-500"}`,title:L?"Partida vacía: agrega una subpartida":"Agregar subpartida",children:[((Y=t.descripcion)==null?void 0:Y.trim())||"Sin nombre"," ",L&&r.jsx("span",{className:"ml-2 text-amber-300",children:"(vacía)"})]})}),r.jsx("td",{className:"h-10 px-3 text-center w-20 align-middle"}),r.jsx("td",{className:"h-10 px-3 text-right w-24 align-middle tabular-nums"}),r.jsx("td",{className:"h-10 px-3 text-right w-36 align-middle tabular-nums"}),r.jsx("td",{className:"h-10 px-3 text-right w-40 align-middle tabular-nums font-semibold"}),r.jsx("td",{className:"h-10 px-2 align-middle",children:r.jsxs("div",{className:"flex items-center justify-end gap-1",children:[r.jsx("button",{"aria-label":me?"Mostrar subpartidas y APUs":"Ocultar subpartidas y APUs",title:me?"Mostrar subpartidas y APUs":"Ocultar subpartidas y APUs",onClick:()=>N(Z=>!Z),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:me?r.jsx(a_,{className:"h-4 w-4"}):r.jsx(e_,{className:"h-4 w-4"})}),r.jsx("button",{"aria-label":"Renombrar partida",title:"Renombrar partida",onClick:()=>{const Z=prompt("Nuevo nombre de la partida:",(t.descripcion||"").trim());if(Z!==null){const M=Z.trim();M!==(t.descripcion||"")&&F(t.id,{descripcion:M})}},className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:r.jsx(Ri,{className:"h-4 w-4"})}),v&&r.jsx("button",{"aria-label":"Duplicar partida",onClick:()=>v(t.id),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:r.jsx(Z1,{className:"h-4 w-4"})}),r.jsx("button",{"aria-label":"Eliminar partida",onClick:()=>{confirm("¿Eliminar esta partida completa?")&&p(t.id)},className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:r.jsx(ma,{className:"h-4 w-4"})}),r.jsx("select",{"aria-label":"Mover a capítulo",value:t.chapterId,onChange:Z=>u(t.id,Z.target.value),className:"ml-1 h-7 px-2 rounded-md bg-slate-800 border border-slate-700 text-xs",children:a.map(Z=>r.jsx("option",{value:Z.id,children:Z.letter},Z.id))})]})})]}),!me&&(Array.isArray(t.subRows)?t.subRows:[]).map((Z,M)=>{var ne,T;const K=Z.id,C=Number(Z.metrados||0),U=Z.apuIds||[],R=U.reduce((de,ee)=>{try{return de+b(_(ee),j).unit}catch{return de}},0),H=typeof Z.overrideUnitPrice=="number"&&Number.isFinite(Z.overrideUnitPrice)?Z.overrideUnitPrice:R,X=typeof Z.overrideTotal=="number"&&Number.isFinite(Z.overrideTotal)?Z.overrideTotal:H*C;return r.jsxs(V.Fragment,{children:[r.jsxs("tr",{className:"hover:bg-slate-800/60 text-xs whitespace-nowrap group",children:[r.jsxs("td",{className:"h-10 px-3 text-center w-10 tabular-nums align-middle",children:[e+1,".",M+1]}),r.jsx("td",{className:"h-10 px-3 align-middle",children:r.jsxs("button",{"aria-label":"Seleccionar APU para subpartida",onClick:()=>n(K),className:"w-full h-9 rounded-md bg-transparent border-0 px-3 text-left text-xs min-w-0 truncate focus:outline-none focus:ring-1 focus:ring-cyan-500",title:`${((ne=Z.descripcion)==null?void 0:ne.trim())||"Subpartida"}${U.length===0?" — sin APU":""}`,children:[r.jsx("span",{className:"pl-8",children:((T=Z.descripcion)==null?void 0:T.trim())||"Subpartida"}),Z._migrated&&r.jsx("span",{className:"ml-2 inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-indigo-900/30 border border-indigo-700/50 text-indigo-200 text-[10px] align-middle",children:"migrado"}),U.length===0&&r.jsx("span",{className:"ml-2 inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-amber-900/30 border border-amber-700/50 text-amber-300 text-[10px] align-middle",children:"sin APU"})]})}),r.jsx("td",{className:"h-10 px-3 text-center w-20 align-middle",children:r.jsxs("select",{"aria-label":"Unidad",className:"h-9 w-full rounded-md bg-slate-800 border border-slate-700 px-2 text-[11px] text-center focus:outline-none focus:ring-1 focus:ring-cyan-500",value:Z.unidadSalida||"",onChange:de=>s&&s(t.id,K,{unidadSalida:de.target.value}),children:[r.jsx("option",{value:"",children:"UN..."}),["u","ml","m","m2","m3","kg","jornal","día","hora","gl"].map(de=>r.jsx("option",{value:de,children:de},de))]})}),r.jsx("td",{className:"h-10 px-3 text-right w-24 align-middle tabular-nums",children:r.jsx("input",{"aria-label":"Cantidad",type:"number",step:.1,className:"h-9 w-full text-right rounded-md bg-slate-800 border border-slate-700 px-2 text-[11px] focus:outline-none focus:ring-1 focus:ring-cyan-500 tabular-nums",value:Number.isFinite(C)?C:0,onChange:de=>s&&s(t.id,K,{metrados:Math.max(0,Number(de.target.value)||0)})})}),r.jsx("td",{className:"h-10 px-3 text-right w-36 align-middle tabular-nums",children:r.jsx(ei,{ariaLabel:"Precio unitario (CLP)",value:typeof Z.overrideUnitPrice=="number"&&Number.isFinite(Z.overrideUnitPrice)?Z.overrideUnitPrice:void 0,onChange:de=>{if(de===void 0){s&&s(t.id,K,{overrideUnitPrice:void 0});return}s&&s(t.id,K,{overrideUnitPrice:Number(de)})},placeholder:H?`${E(H)}`:"0"})}),r.jsx("td",{className:"h-10 px-3 text-right w-40 align-middle tabular-nums font-semibold",children:r.jsx(ei,{ariaLabel:"Total (CLP)",value:typeof Z.overrideTotal=="number"&&Number.isFinite(Z.overrideTotal)?Z.overrideTotal:void 0,onChange:de=>{if(de===void 0){s&&s(t.id,K,{overrideTotal:void 0});return}s&&s(t.id,K,{overrideTotal:Number(de)})},placeholder:X?`${E(X)}`:"0"})}),r.jsx("td",{className:"h-10 px-2 align-middle",children:r.jsxs("div",{className:"flex items-center justify-end gap-1",children:[r.jsx("button",{"aria-label":y[K]?"Mostrar APUs":"Ocultar APUs",title:y[K]?"Mostrar APUs":"Ocultar APUs",onClick:()=>O(de=>({...de,[K]:!de[K]})),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:y[K]?r.jsx(Bc,{className:"h-4 w-4"}):r.jsx(l0,{className:"h-4 w-4"})}),s&&r.jsx("button",{"aria-label":"Renombrar subpartida",title:"Renombrar subpartida",onClick:()=>{const de=prompt("Nuevo nombre de la subpartida:",(Z.descripcion||"Subpartida").trim());if(de!==null){const ee=de.trim();ee&&s(t.id,K,{descripcion:ee})}},className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:r.jsx(Ri,{className:"h-4 w-4"})}),o&&r.jsx("button",{"aria-label":"Eliminar subpartida",title:"Eliminar subpartida",onClick:()=>{confirm("¿Eliminar esta subpartida?")&&o(t.id,K)},className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",children:r.jsx(ma,{className:"h-4 w-4"})})]})})]}),U.length>0&&!y[K]&&r.jsxs("tr",{className:"bg-slate-900/40",children:[r.jsx("td",{className:"px-3 w-10"}),r.jsx("td",{className:"px-3 py-2 align-top",colSpan:5,children:r.jsx("div",{className:"grid gap-1 pl-8",children:U.map(de=>{try{const ee=_(de);return r.jsxs("div",{className:"flex items-center gap-2 text-[11px] group",children:[r.jsx("span",{className:"text-slate-500",children:"•"}),ee&&r.jsxs(r.Fragment,{children:[(()=>{const ge=ie(de,ee),fe=ge.pos!=null?`${ge.pos}`:"";return fe?r.jsx("button",{onClick:()=>D&&D(de),className:"inline-flex items-center px-1.5 py-0.5 rounded-md bg-slate-800/70 border border-slate-700 text-[10px] text-slate-200 font-mono hover:bg-slate-700/70",title:`${ee.descripcion||""}`,"aria-label":"Número de biblioteca",children:fe}):null})(),r.jsx("button",{onClick:()=>D&&D(de),className:"text-slate-200 hover:underline text-left truncate max-w-[44ch]",title:ee.descripcion,children:ee.descripcion})]}),r.jsx("button",{onClick:()=>{if(!confirm("¿Quitar este APU de la subpartida?"))return;const ge=U.filter(fe=>fe!==de);s&&s(t.id,K,{apuIds:ge})},className:"ml-1 p-1 rounded-md text-slate-400 hover:text-red-200 hover:bg-red-900/30",title:"Quitar APU de la subpartida","aria-label":"Quitar APU de la subpartida",children:r.jsx(ma,{className:"h-3.5 w-3.5"})})]},de)}catch{return null}})})}),r.jsx("td",{className:"px-2 w-32"})]})]},K)})]})}function c0({chapters:e,rows:t,getApuById:a,unitCost:n,resources:i,fmt:s,onPickApu:o,onAddSubRow:u,onUpdateSubRow:p,onRemoveSubRow:v,onMoveChapter:_,onDelete:b,onDuplicate:j,onUpdateRow:E,onShowApuDetail:F,onAddSubChapter:D}){const[me,N]=V.useState({}),y=L=>N(ie=>({...ie,[L]:!ie[L]})),O=L=>{var C;if(Array.isArray(L.subRows)&&L.subRows.length>0)return L.subRows.reduce((U,R)=>{const H=Number(R.metrados||0),ne=(Array.isArray(R.apuIds)?R.apuIds:[]).reduce((ee,ge)=>{try{return ee+n(a(ge),i).unit}catch{return ee}},0),T=typeof R.overrideUnitPrice=="number"&&Number.isFinite(R.overrideUnitPrice)?R.overrideUnitPrice:ne,de=typeof R.overrideTotal=="number"&&Number.isFinite(R.overrideTotal)?R.overrideTotal:T*H;return U+(Number.isFinite(de)?de:0)},0);const ie=Number(L.metrados||0),Z=((C=L.apuIds)!=null&&C.length?L.apuIds:L.apuId?[L.apuId]:[]).reduce((U,R)=>{try{return U+n(a(R),i).unit}catch{return U}},0),M=typeof L.overrideUnitPrice=="number"&&Number.isFinite(L.overrideUnitPrice)?L.overrideUnitPrice:Z,K=typeof L.overrideTotal=="number"&&Number.isFinite(L.overrideTotal)?L.overrideTotal:M*ie;return Number.isFinite(K)?K:0};return r.jsx("div",{className:"space-y-6",children:e.map(L=>{const ie=t.filter(M=>M.chapterId===L.id),Y=ie.reduce((M,K)=>M+O(K),0);if(!ie.length)return r.jsx("div",{className:"rounded-2xl border border-slate-700/60 px-3 py-2",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>y(L.id),className:"p-1 rounded hover:bg-slate-700/60","aria-label":"Expandir/colapsar capítulo",children:r.jsx(Bc,{className:"h-5 w-5"})}),r.jsxs("button",{onClick:()=>D&&D(L.id),className:"inline-flex items-center gap-2 rounded-xl bg-slate-800 px-3 py-1 text-sm font-semibold hover:bg-slate-700",children:[r.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded bg-slate-700",children:L.letter}),r.jsx("span",{children:L.title})]}),r.jsxs("div",{className:"ml-auto text-sm text-slate-300",children:["Subtotal: ",r.jsx("b",{children:s(0)})]})]})},L.id);const Z=!!me[L.id];return r.jsxs("div",{className:"rounded-2xl border border-slate-700/60",children:[r.jsx("div",{className:"px-4 pt-3",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>y(L.id),className:"p-1 rounded hover:bg-slate-700/60","aria-label":"Expandir/colapsar capítulo",children:Z?r.jsx(Bc,{className:"h-5 w-5"}):r.jsx(l0,{className:"h-5 w-5"})}),r.jsxs("button",{onClick:()=>D&&D(L.id),className:"inline-flex items-center gap-2 rounded-xl bg-slate-800 px-3 py-1 text-sm font-semibold hover:bg-slate-700",children:[r.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded bg-slate-700",children:L.letter}),r.jsx("span",{children:L.title})]}),r.jsxs("div",{className:"ml-auto text-sm text-slate-300",children:["Subtotal: ",r.jsx("b",{children:s(Y)})]})]})}),!Z&&r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{className:"text-slate-300 text-sm font-semibold",children:r.jsxs("tr",{className:"h-10",children:[r.jsx("th",{className:"w-10 text-center px-3",children:"#"}),r.jsx("th",{className:"text-left px-3",children:"Descripción"}),r.jsx("th",{className:"w-20 text-center px-3",children:"UN"}),r.jsx("th",{className:"w-24 text-right px-3",children:"CANT."}),r.jsx("th",{className:"w-36 text-right px-3",children:"P. UNIT."}),r.jsx("th",{className:"w-40 text-right px-3",children:"TOTAL"}),r.jsx("th",{className:"w-32 px-2"})]})}),r.jsx("tbody",{className:"divide-y divide-slate-700 text-slate-200",children:ie.map((M,K)=>r.jsx(d_,{index:K,row:M,chapters:e,getApuById:a,unitCost:n,resources:i,fmt:s,onPickApu:o,onAddSubRow:u,onUpdateSubRow:p,onRemoveSubRow:v,onMoveChapter:_,onDelete:b,onDuplicate:j,onUpdateRow:E,onShowApuDetail:F},M.id))})]})})]},L.id)})})}const Fp=[{id:"movimiento_tierras",nombre:"Movimiento de Tierras y Excavación",tipo:"fija",base:275e3,items:[{descripcion:"Movimiento de tierra (nivelación y excavación)",cantidad:1,unidad:"lote",precioUnitario:15e4},{descripcion:"Material de relleno y compactación (arena, grava)",cantidad:5,unidad:"m³",precioUnitario:25e3}]},{id:"fundaciones",nombre:"Fundaciones y Estructura",tipo:"variable",base:3789e3,factor:63150,items:[{descripcion:"Hormigón H20 para fundaciones y losa",cantidad:15,unidad:"m³",precioUnitario:85e3},{descripcion:"Acero de Refuerzo (fierro de construcción)",cantidad:600,unidad:"kg",precioUnitario:1190},{descripcion:"Madera para encofrado (pino cepillado)",cantidad:200,unidad:"m²",precioUnitario:8500},{descripcion:"Clavos, alambre de amarre, etc.",cantidad:1,unidad:"lote",precioUnitario:1e5}]},{id:"albanileria",nombre:"Albañilería (Muros)",tipo:"variable",base:947e3,factor:15783,items:[{descripcion:"Ladrillo Fiscal (12x24x6 cm)",cantidad:3e3,unidad:"un",precioUnitario:199},{descripcion:"Mortero (Arena, Cemento)",cantidad:1,unidad:"lote",precioUnitario:35e4}]},{id:"techumbre",nombre:"Techumbre",tipo:"variable",base:1556730,factor:37065,items:[{descripcion:"Cerchas de Pino para Techo",cantidad:70,unidad:"m²",precioUnitario:15e3},{descripcion:"Plancha Zinc Acanalada",cantidad:70,unidad:"m²",precioUnitario:8990},{descripcion:"Clavos para tejas, fijaciones",cantidad:1,unidad:"lote",precioUnitario:8e4},{descripcion:"Aislante térmico (Lana de vidrio)",cantidad:6,unidad:"rollo",precioUnitario:7990}]},{id:"terminaciones",nombre:"Terminaciones Interiores",tipo:"variable",base:1439130,factor:23986,items:[{descripcion:"Pintura Látex para interior",cantidad:1,unidad:"20L",precioUnitario:29990},{descripcion:"Pintura Fachada",cantidad:1,unidad:"20L",precioUnitario:34990},{descripcion:"Cerámica para piso (económica 33x33 cm)",cantidad:60,unidad:"m²",precioUnitario:5990},{descripcion:"Cerámica para baño/cocina (pared)",cantidad:25,unidad:"m²",precioUnitario:6990},{descripcion:"Mortero de pega y lechada",cantidad:1,unidad:"lote",precioUnitario:12e4},{descripcion:"Yeso-cartón para cielos",cantidad:60,unidad:"m²",precioUnitario:12e3}]},{id:"carpinteria",nombre:"Carpintería y Ventanas",tipo:"fija",base:914960,items:[{descripcion:"Puerta principal de madera maciza",cantidad:1,unidad:"un",precioUnitario:149990},{descripcion:"Puertas interiores de honeycomb",cantidad:3,unidad:"un",precioUnitario:44990},{descripcion:"Ventanas de PVC línea económica",cantidad:6,unidad:"un",precioUnitario:8e4},{descripcion:"Herrajes (bisagras, picaportes, cerraduras)",cantidad:1,unidad:"lote",precioUnitario:15e4}]},{id:"instalaciones",nombre:"Instalaciones Sanitarias y Gas",tipo:"fija",base:969980,items:[{descripcion:"Tuberías de PVC para desagüe",cantidad:1,unidad:"lote",precioUnitario:18e4},{descripcion:"Tuberías de PPR para agua caliente/fría",cantidad:1,unidad:"lote",precioUnitario:22e4},{descripcion:"Artefactos de Baño (inodoro, lavatorio, ducha)",cantidad:1,unidad:"kit",precioUnitario:299990},{descripcion:"Artefactos de Cocina (llave, lavaplatos)",cantidad:1,unidad:"kit",precioUnitario:149990},{descripcion:"Cañería para gas y regulador",cantidad:1,unidad:"lote",precioUnitario:12e4}]},{id:"electricas",nombre:"Instalaciones Eléctricas",tipo:"fija",base:459800,items:[{descripcion:"Cable THWN 2,5 mm², 1,5 mm², etc.",cantidad:1,unidad:"lote",precioUnitario:25e4},{descripcion:"Tablero eléctrico, breakers, etc.",cantidad:1,unidad:"un",precioUnitario:8e4},{descripcion:"Cajas, tomacorrientes, interruptores",cantidad:20,unidad:"un",precioUnitario:2990},{descripcion:"Túbes o Canaletas",cantidad:1,unidad:"lote",precioUnitario:7e4}]}],u_=60,Wn=e=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(Math.round(e||0)),p_=({gg:e,util:t,iva:a,apus:n=[],resources:i={},onShowApuDetail:s,onCreateApuByName:o,onChangeGG:u,onChangeUtil:p,onChangeIVA:v})=>{const[_,b]=V.useState(60),[j]=V.useState(1),[E]=V.useState(.7),[F]=V.useState(1),[D,me]=V.useState(null),[N,y]=V.useState(null),[O,L]=V.useState(!1),[ie,Y]=V.useState(null),Z=V.useRef(!1),[M,K]=V.useState(!1),[C,U]=V.useState([]),[R,H]=V.useState(0),X=V.useRef(null),[ne,T]=V.useState({}),[de]=V.useState({}),[ee]=V.useState({}),[ge]=V.useState({}),[fe,Fe]=V.useState({}),[te,_t]=V.useState({}),[wt,lt]=V.useState({}),[gt,jt]=V.useState({}),[ca,Se]=V.useState({open:!1,subId:null}),we=V.useMemo(()=>{const k={};for(const P of Array.isArray(n)?n:[])P&&typeof P.id=="string"&&(k[P.id]=P);try{const P=yn();for(const[w,I]of Object.entries(P||{}))!k[w]&&k[I]&&(k[w]=k[I])}catch{}return k},[n]);V.useEffect(()=>{},[we]);const Un=V.useCallback(k=>{const P=String((k==null?void 0:k.unidadSalida)||"").toLowerCase();return P==="m2"||P==="m²"?_:P==="m3"||P==="m³"?Math.max(1,Math.round(_*.1)):1},[_]),va=V.useMemo(()=>Fp.map(P=>{const w=de[P.id];let I=0,$=[];if(w&&we[w])try{const W=we[w],ce=yt(W,i,we).unit,je=ee[P.id]&&ee[P.id]>0?ee[P.id]:Un(W);I=ce*je,P.id==="techumbre"&&(I*=E),P.id==="terminaciones"&&(I*=F)}catch{I=0}else $=P.items.map((W,ce)=>{var Me;const je=((Me=ge[P.id])==null?void 0:Me[ce])||{},le=Number.isFinite(je.cantidad)?je.cantidad:W.cantidad,Qe=Number.isFinite(je.precio)?je.precio:W.precioUnitario;let ye=le;P.tipo==="variable"&&(ye=le*(_/u_));let Oe=Qe;P.id==="terminaciones"&&W.descripcion.toLowerCase().includes("cerámica para piso")&&(Oe=Qe*F);const Pe=ye*Oe;return{...W,cantidadCalc:ye,precioCalc:Oe,totalItem:Pe}}),I=$.reduce((W,ce)=>W+ce.totalItem,0),P.id==="techumbre"&&(I*=E);return I*=j,{...P,costo:Math.round(I),itemsCalculados:$}}),[_,j,E,F,de,we,Un,i,ee,ge]),[Da,Dn]=V.useState(!0),mr=V.useMemo(()=>ie==="fosa"?[{id:"calc",letter:"S",title:"Fosa séptica y drenaje"}]:[{id:"calc",letter:"A",title:"Presupuesto (Calculadora)"}],[ie]),da=k=>(k||"").toLowerCase().replace("²","2").replace("³","3").trim(),pn=V.useCallback(k=>{const P=Vo(String(k||""));return P?P==="m2"||P==="m3"||P==="m"||P==="ml"||P==="kg"||P==="jornal"||P==="día"||P==="hora"||P==="gl"||P==="u"?P:P.startsWith("m2")?"m2":P.startsWith("m3")?"m3":P==="un"||P==="und"||P==="unidad"||P==="unid"||P==="un."?"u":P==="lote"||P==="kit"||P==="set"?"gl":"u":""},[]),is=V.useCallback((k,P)=>{const w=da(er(k)),I=da(P);if((w.includes("acero")||w.includes("fierro"))&&(w.includes("refuerzo")||w.includes("enfier"))&&I==="kg")return[];if(w.includes("madera")&&(w.includes("encofrad")||w.includes("moldaj"))&&(I==="m2"||I==="m²"))return[];if(w.includes("zinc")&&(w.includes("acanal")||w.includes("plancha"))&&(I==="m2"||I==="m²"))return[];const $=[];(w.includes("movimiento")&&w.includes("tierra")||w.includes("excav"))&&we.apu_mov_tierras_excavacion_lote&&$.push("apu_mov_tierras_excavacion_lote"),(w.includes("relleno")||w.includes("compact"))&&we.apu_relleno_compact_manual&&$.push("apu_relleno_compact_manual"),w.includes("clavos")&&(w.includes("alambre")||w.includes("amarre"))&&we.apu_clavos_alambre_lote&&$.push("apu_clavos_alambre_lote"),w.includes("ladrillo")&&w.includes("fiscal")&&we.apu_material_ladrillo_fiscal_u&&$.push("apu_material_ladrillo_fiscal_u"),(w.includes("mortero")||w.includes("arena")&&w.includes("cemento"))&&we.apu_mortero_pega_lote&&$.push("apu_mortero_pega_lote"),(w.includes("cercha")||w.includes("estructura"))&&(w.includes("pino")||w.includes("techo"))&&we.apu_estructura_techumbre_madera&&$.push("apu_estructura_techumbre_madera"),(w.includes("clavos")||w.includes("fijac"))&&(w.includes("teja")||w.includes("techo"))&&we.apu_fijaciones_techo_lote&&$.push("apu_fijaciones_techo_lote"),(w.includes("herrajes")||w.includes("bisagra")||w.includes("picaporte")||w.includes("cerradura"))&&(we.apu_herrajes_bisagras_picaportes_cerraduras_lote?$.push("apu_herrajes_bisagras_picaportes_cerraduras_lote"):we.apu_herrajes_carpinteria_lote&&$.push("apu_herrajes_carpinteria_lote")),w.includes("ventana")&&w.includes("pvc")&&we.apu_ventana_pvc_100x100_instalada&&$.push("apu_ventana_pvc_100x100_instalada"),w.includes("puerta")&&(w.includes("principal")||w.includes("exterior"))&&((w.includes("madera")||w.includes("maciza"))&&we.apu_puerta_exterior_madera_90x200_instalada?$.push("apu_puerta_exterior_madera_90x200_instalada"):we.apu_puerta_exterior_acero_90x200_instalada&&$.push("apu_puerta_exterior_acero_90x200_instalada")),w.includes("puertas")&&w.includes("interiores")&&we.apu_puerta_interior_mdf_70x200_instalada&&$.push("apu_puerta_interior_mdf_70x200_instalada"),(w.includes("aislante")||w.includes("lana"))&&(we.apu_acond_termico_cielo_lana100?$.push("apu_acond_termico_cielo_lana100"):we.apu_acond_termico_muros_lana100_bv&&$.push("apu_acond_termico_muros_lana100_bv")),(w.includes("excav")||w.includes("zanja"))&&(I==="m3"||I==="m³")&&we.apu_excavacion_manual&&$.push("apu_excavacion_manual"),w.includes("hormig")&&(w.includes("fundac")||w.includes("losa"))&&(I==="m3"||I==="m³")&&we.apu_h25_fundaciones&&$.push("apu_h25_fundaciones"),(w.includes("moldaje")||w.includes("encofrad"))&&(I==="m2"||I==="m²")&&we.apu_moldajes_fundaciones&&$.push("apu_moldajes_fundaciones"),(w.includes("acero")||w.includes("enfier"))&&I==="kg"&&we.apu_enfierradura&&$.push("apu_enfierradura"),w.includes("radier")&&(I==="m2"||I==="m²")&&we.apu_radier_10cm&&$.push("apu_radier_10cm"),(w.includes("zinc")||w.includes("zinc acan"))&&(I==="m2"||I==="m²")&&we.apu_cubierta_zinc_m2&&$.push("apu_cubierta_zinc_m2"),w.includes("cerámica")&&w.includes("piso")&&(I==="m2"||I==="m²")&&we.apu_ceramica_piso_m2&&$.push("apu_ceramica_piso_m2"),w.includes("cerámica")&&(w.includes("pared")||w.includes("muro"))&&(I==="m2"||I==="m²")&&we.apu_ceramica_muro_m2&&$.push("apu_ceramica_muro_m2"),(w.includes("yeso")||w.includes("cielo"))&&(I==="m2"||I==="m²")&&we.apu_cielo_yeso_m2&&$.push("apu_cielo_yeso_m2"),(w.includes("eléctr")||w.includes("cable")||w.includes("tablero")||w.includes("canaleta")||w.includes("tomacorriente"))&&(I==="gl"||I==="kit"||I==="lote"||I==="un")&&we.apu_inst_electrica_gl&&$.push("apu_inst_electrica_gl"),(I==="gl"||I==="kit"||I==="lote")&&(w.includes("pvc")&&(w.includes("desag")||w.includes("alcantar")||w.includes("sanit"))&&we.apu_tuberias_pvc_desague_lote&&$.push("apu_tuberias_pvc_desague_lote"),(w.includes("ppr")||w.includes("agua")&&(w.includes("caliente")||w.includes("fría")||w.includes("fria")))&&we.apu_tuberias_ppr_agua_lote&&$.push("apu_tuberias_ppr_agua_lote"),(w.includes("artefact")||w.includes("kit"))&&(w.includes("baño")||w.includes("bano"))&&we.apu_kit_bano_economico_set&&$.push("apu_kit_bano_economico_set"),(w.includes("artefact")||w.includes("kit"))&&w.includes("cocina")&&we.apu_kit_cocina_economico_set&&$.push("apu_kit_cocina_economico_set"),(w.includes("gas")||w.includes("regulador"))&&we.apu_caneria_gas_lote&&$.push("apu_caneria_gas_lote"),$.length===0&&(w.includes("sanit")||w.includes("ppr")||w.includes("pvc")||w.includes("gas")||w.includes("artefact"))&&we.apu_inst_sanitaria_gl&&$.push("apu_inst_sanitaria_gl"));const W=pn(I);return $.length>1&&W&&$.sort((ce,je)=>{var Pe,Me;const le=String(((Pe=we[ce])==null?void 0:Pe.unidadSalida)||""),Qe=String(((Me=we[je])==null?void 0:Me.unidadSalida)||"");return(le===W?0:1)-(Qe===W?0:1)}),$},[we,pn]),ua=V.useCallback((k,P)=>{const w=da(er(k)),I=tn(String(P||""));if((w.includes("acero")||w.includes("fierro"))&&(w.includes("refuerzo")||w.includes("enfier"))&&I==="kg"||w.includes("madera")&&(w.includes("encofrad")||w.includes("moldaj"))&&I==="m2"||w.includes("zinc")&&(w.includes("acanal")||w.includes("plancha"))&&I==="m2")return null;const $=tn(String(P||"")),W=dr(String(er(k)||""));let ce=null,je=0;for(const le of Object.values(we)){if(!le||typeof le.id!="string")continue;const Qe=tn(String(le.unidadSalida||"")),ye=dr(String(le.descripcion||"")),Oe=i0(W,ye);let Pe=zd(W,ye);const Me=$&&Qe===$?.12:$&&Qe&&Qe[0]===$[0]?.04:0,tt=Math.max(Oe+Me,Pe+Me);tt>je&&(je=tt,ce=le.id)}return je>=.5?ce:null},[we]),It=V.useMemo(()=>{const P=4*Math.sqrt(Math.max(_,1)),w=Math.max(0,_),I=Math.max(0,Math.round(_*2.8)),$=Math.max(0,Math.round(P*2.4));if(ie==="fosa"){const le={fosa:"apu_fosa_septica_3000l_u",camaraInsp:"apu_camara_inspeccion_elevador_u",camaraDist:"apu_camara_distribuidora_100l_u",camaraDesg:"apu_camara_desgrasadora_100l_u",pvc110:"apu_tuberia_pvc_110_m",dren:"apu_dren_infiltracion_m"},Qe=Pe=>!!we[Pe],ye=(Pe,Me,tt,Lt)=>({id:`user_fosa_${Pe}_${Me}`.toLowerCase().replace(/[^a-z0-9_]+/g,"_"),descripcion:Pe,unidadSalida:Me,metrados:tt,apuIds:Lt.filter(Qe)});return[{id:"fosa_partida_1",chapterId:"calc",descripcion:"Fosa séptica 3.000 L instalada",apuIds:[],metrados:1,subRows:[ye("Fosa séptica 3.000 L instalada","u",1,[le.fosa])]},{id:"fosa_partida_2",chapterId:"calc",descripcion:"Cámaras sanitarias",apuIds:[],metrados:1,subRows:[ye("Cámara de inspección con elevador","u",2,[le.camaraInsp]),ye("Cámara distribuidora 100 L","u",1,[le.camaraDist]),ye("Cámara desgrasadora 100 L","u",1,[le.camaraDesg])]},{id:"fosa_partida_3",chapterId:"calc",descripcion:"Redes y drenaje sanitario",apuIds:[],metrados:1,subRows:[ye("Tubería PVC Ø110 sanitaria enterrada","m",15,[le.pvc110]),ye("Dren de infiltración 0,50×0,80 m","m",20,[le.dren])]}]}const W=va.map((le,Qe)=>{const ye=le.itemsCalculados||[],Oe=`calc_${le.id}`;if(le.id==="instalaciones"){const oe={id:`calc_${le.id}_s0`,descripcion:"Instalaciones sanitarias y gas",unidadSalida:"gl",metrados:1,apuIds:we.apu_inst_sanitaria_gl?["apu_inst_sanitaria_gl"]:[]};oe.apuIds.length===0&&(oe.overrideTotal=Math.round(le.costo||ye.reduce((vt,Ha)=>vt+(Ha.totalItem||0),0)));const Ve=te[oe.id]||{},Et=Object.prototype.hasOwnProperty.call(Ve,"apuIds")?Array.isArray(Ve.apuIds)?Ve.apuIds:[]:oe.apuIds,Je=Et&&Et.length?void 0:Ve.overrideTotal??oe.overrideTotal,zt=[{...oe,...Ve,apuIds:Et,overrideTotal:Je}].filter(vt=>!gt[vt.id]),Va=wt[Oe]||[],gn=[...zt,...Va];return{id:Oe,chapterId:"calc",descripcion:fe[`calc_${le.id}`]??le.nombre,apuIds:[],metrados:1,subRows:gn}}if(le.id==="electricas"){const oe={id:`calc_${le.id}_s0`,descripcion:"Instalaciones eléctricas",unidadSalida:"gl",metrados:1,apuIds:we.apu_inst_electrica_gl?["apu_inst_electrica_gl"]:[]};oe.apuIds.length===0&&(oe.overrideTotal=Math.round(le.costo||ye.reduce((vt,Ha)=>vt+(Ha.totalItem||0),0)));const Ve=te[oe.id]||{},Et=Object.prototype.hasOwnProperty.call(Ve,"apuIds")?Array.isArray(Ve.apuIds)?Ve.apuIds:[]:oe.apuIds,Je=Et&&Et.length?void 0:Ve.overrideTotal??oe.overrideTotal,zt=[{...oe,...Ve,apuIds:Et,overrideTotal:Je}].filter(vt=>!gt[vt.id]),Va=wt[Oe]||[],gn=[...zt,...Va];return{id:Oe,chapterId:"calc",descripcion:fe[`calc_${le.id}`]??le.nombre,apuIds:[],metrados:1,subRows:gn}}let Me=ye.map((oe,Ve)=>{const Xe=da(oe.descripcion);if(Xe.includes("pintura")&&Xe.includes("interior")){const Pt=we.apu_pintura_interior_m2?["apu_pintura_interior_m2"]:[],ct={id:`calc_${le.id}_s${Ve}`,descripcion:"Pintura interior (látex) 2 manos",unidadSalida:"m2",metrados:I,apuIds:Pt};if(Pt.length===0){const qt=ua("Pintura interior (látex) 2 manos","m2");qt&&(ct.apuIds=[qt])}const We=te[ct.id]||{},bt=Object.prototype.hasOwnProperty.call(We,"apuIds");let Kt=bt?Array.isArray(We.apuIds)?We.apuIds:[]:ct.apuIds;if(bt&&Array.isArray(We.apuIds)&&We.apuIds.length>0){const qt=new Set(["apu_inst_sanitaria_gl","apu_inst_electrica_gl"]),Pa=(ct.apuIds||[]).some(ba=>!qt.has(ba)),Hn=We.apuIds.every(ba=>qt.has(ba));Pa&&Hn&&(Kt=ct.apuIds)}const Ea=Kt&&Kt.length?void 0:We.overrideTotal??ct.overrideTotal;return{...ct,...We,apuIds:Kt,overrideTotal:Ea}}if(Xe.includes("pintura")&&(Xe.includes("fachada")||Xe.includes("exterior"))){const Pt=we.apu_pintura_fachada_m2?["apu_pintura_fachada_m2"]:[],ct={id:`calc_${le.id}_s${Ve}`,descripcion:"Pintura fachada 2 manos",unidadSalida:"m2",metrados:$,apuIds:Pt};if(Pt.length===0){const qt=ua("Pintura fachada 2 manos","m2");qt&&(ct.apuIds=[qt])}const We=te[ct.id]||{},bt=Object.prototype.hasOwnProperty.call(We,"apuIds");let Kt=bt?Array.isArray(We.apuIds)?We.apuIds:[]:ct.apuIds;if(bt&&Array.isArray(We.apuIds)&&We.apuIds.length>0){const qt=new Set(["apu_inst_sanitaria_gl","apu_inst_electrica_gl"]),Pa=(ct.apuIds||[]).some(ba=>!qt.has(ba)),Hn=We.apuIds.every(ba=>qt.has(ba));Pa&&Hn&&(Kt=ct.apuIds)}const Ea=Kt&&Kt.length?void 0:We.overrideTotal??ct.overrideTotal;return{...ct,...We,apuIds:Kt,overrideTotal:Ea}}if(Xe.includes("aislante")||Xe.includes("lana")){const Pt=le.id==="techumbre"||Xe.includes("techo")||Xe.includes("cielo"),ct=Pt?we.apu_acond_termico_cielo_lana100?["apu_acond_termico_cielo_lana100"]:[]:we.apu_acond_termico_muros_lana100_bv?["apu_acond_termico_muros_lana100_bv"]:[],We={id:`calc_${le.id}_s${Ve}`,descripcion:Pt?"Aislación térmica en cielo (lana 100 mm)":"Acondicionamiento térmico de muros (lana 100 mm + BV)",unidadSalida:"m2",metrados:Pt?w:I,apuIds:ct};if(ct.length===0){const Pa=ua(We.descripcion,"m2");Pa&&(We.apuIds=[Pa])}const bt=te[We.id]||{},Kt=Object.prototype.hasOwnProperty.call(bt,"apuIds");let Ea=Kt?Array.isArray(bt.apuIds)?bt.apuIds:[]:We.apuIds;if(Kt&&Array.isArray(bt.apuIds)&&bt.apuIds.length>0){const Pa=new Set(["apu_inst_sanitaria_gl","apu_inst_electrica_gl"]),Hn=(We.apuIds||[]).some(yr=>!Pa.has(yr)),ba=bt.apuIds.every(yr=>Pa.has(yr));Hn&&ba&&(Ea=We.apuIds)}const qt=Ea&&Ea.length?void 0:bt.overrideTotal??We.overrideTotal;return{...We,...bt,apuIds:Ea,overrideTotal:qt}}const Et=is(oe.descripcion,oe.unidad),Je={id:`calc_${le.id}_s${Ve}`,descripcion:oe.descripcion,unidadSalida:pn(oe.unidad),metrados:Number.isFinite(oe.cantidadCalc)?oe.cantidadCalc:oe.cantidad,apuIds:Et},zt=da(er(String(Je.descripcion||""))),Va=tn(String(Je.unidadSalida||"")),gn=(zt.includes("acero")||zt.includes("fierro"))&&(zt.includes("refuerzo")||zt.includes("enfier"))&&Va==="kg"||zt.includes("madera")&&(zt.includes("encofrad")||zt.includes("moldaj"))&&Va==="m2"||zt.includes("zinc")&&(zt.includes("acanal")||zt.includes("plancha"))&&Va==="m2";if(Et.length===0&&!gn){const Pt=ua(Je.descripcion,Je.unidadSalida);Pt&&(Je.apuIds=[Pt])}const vt=te[Je.id]||{},Ha=Object.prototype.hasOwnProperty.call(vt,"apuIds");let xn=Ha?Array.isArray(vt.apuIds)?vt.apuIds:[]:Je.apuIds;if(Ha&&Array.isArray(vt.apuIds)&&vt.apuIds.length>0){const Pt=new Set(["apu_inst_sanitaria_gl","apu_inst_electrica_gl"]),ct=(Je.apuIds||[]).some(bt=>!Pt.has(bt)),We=vt.apuIds.every(bt=>Pt.has(bt));ct&&We&&(xn=Je.apuIds)}const oi=gn,br=Ha&&Array.isArray(vt.apuIds)&&vt.apuIds.length>0;oi&&!br&&(xn=[],Je.overrideTotal=void 0);const cs=xn&&xn.length||oi&&!br?void 0:vt.overrideTotal??Je.overrideTotal;return{...Je,...vt,apuIds:xn,overrideTotal:cs}}).filter(oe=>!gt[oe.id]);le.id==="techumbre"&&(Me=Me.map(oe=>{if(Array.isArray(oe.apuIds)&&oe.apuIds.length>0){const Ve=Number(oe.metrados||0)*(E||1);return{...oe,metrados:Ve}}if(typeof oe.overrideTotal=="number"&&Number.isFinite(oe.overrideTotal)){const Ve=Math.round((oe.overrideTotal||0)*(E||1));return{...oe,overrideTotal:Ve}}return oe})),le.id==="terminaciones"&&(Me=Me.map(oe=>{const Ve=String(oe.descripcion||"").toLowerCase();if(!(Ve.includes("cerámica")&&Ve.includes("piso")))return oe;if(Array.isArray(oe.apuIds)&&oe.apuIds.length>0){const Et=Number(oe.metrados||0)*(F||1);return{...oe,metrados:Et}}if(typeof oe.overrideTotal=="number"&&Number.isFinite(oe.overrideTotal)){const Et=Math.round((oe.overrideTotal||0)*(F||1));return{...oe,overrideTotal:Et}}return oe}));const tt=wt[Oe]||[],Lt=[...Me,...tt];return{id:Oe,chapterId:"calc",descripcion:fe[`calc_${le.id}`]??le.nombre,apuIds:[],metrados:1,subRows:Lt}}),ce="calc_manual",je=wt[ce]||[];return je.length&&W.push({id:ce,chapterId:"calc",descripcion:"Ítems manuales",apuIds:[],metrados:1,subRows:je}),W},[va,fe,is,ua,_,we,te,pn,wt,gt,E,F,ie]),fr=V.useCallback(k=>{const P=String(k||"").replace(/^calc_/,"");return Fp.find(w=>w.id===P)},[]),$n=V.useCallback(k=>{var $;if(!k||k.length===0)return"gl";const P={};for(const W of k){const ce=pn(W.unidad);P[ce]=(P[ce]||0)+1}const I=(($=Object.entries(P).sort((W,ce)=>ce[1]-W[1])[0])==null?void 0:$[0])||"gl";return I==="u"&&(P.m2||P.m3)?(P.m2||0)>=(P.m3||0)?"m2":"m3":I||"gl"},[pn]),hr=V.useMemo(()=>{const k=[];for(const P of It){if(P.id==="calc_manual")continue;if((Array.isArray(P.subRows)?P.subRows:[]).length===0){const I=fr(P.id),$=(I==null?void 0:I.nombre)||"Partida",W=$n(I==null?void 0:I.items),ce=W==="m2"?_:W==="m3"?Math.max(1,Math.round(_*.1)):1,je=ua($,W);k.push({rowId:P.id,name:$,unit:W,metrados:ce,suggestedApuId:je})}}return k},[It,_,fr,$n,ua]),Ho=V.useCallback(k=>{try{const P=hr.find($=>$.rowId===k);if(!P)return;const w=`user_${k}_${Date.now()}`,I=`APU para ${P.name}`;lt($=>{const W=[...$[k]||[]],ce={id:w,descripcion:I,unidadSalida:P.unit,metrados:P.metrados};return P.suggestedApuId?ce.apuIds=[P.suggestedApuId]:ce.apuIds=[],W.push(ce),{...$,[k]:W}}),P.suggestedApuId||setTimeout(()=>Se({open:!0,subId:w}),0)}catch{}},[hr]),Wo=V.useCallback(k=>{try{const P=fr(k),w=(P==null?void 0:P.nombre)||"Partida",I=$n(P==null?void 0:P.items),$=I==="m2"?_:I==="m3"?Math.max(1,Math.round(_*.1)):1,W=`user_${k}_${Date.now()}`;lt(ce=>{const je=[...ce[k]||[]];return je.push({id:W,descripcion:`APU para ${w}`,unidadSalida:I,metrados:$,apuIds:[]}),{...ce,[k]:je}}),setTimeout(()=>Se({open:!0,subId:W}),0)}catch{}},[fr,$n,_]),Qo=V.useCallback((k,P)=>{try{const w=C.find(I=>I.parentId===k&&I.subId===P);if(!w||!w.suggestedApuId)return;String(P).startsWith("user_")?lt(I=>{const $=[...I[k]||[]],W=$.findIndex(ce=>ce.id===P);return W>=0&&($[W]={...$[W],apuIds:[w.suggestedApuId],overrideTotal:void 0,overrideUnitPrice:void 0}),{...I,[k]:$}}):_t(I=>({...I,[P]:{...I[P]||{},apuIds:[w.suggestedApuId],overrideTotal:void 0,overrideUnitPrice:void 0}})),U(I=>I.filter($=>!($.parentId===k&&$.subId===P)))}catch{}},[C]),ss=V.useCallback((k,P)=>{try{Se({open:!0,subId:P})}catch{}},[]),ri=V.useRef({});V.useEffect(()=>{if(o)try{const k=[];for(const I of It)for(const $ of I.subRows||[])k.push($);const P=k.filter(I=>{const $=Array.isArray(I.apuIds)&&I.apuIds.length>0,W=te[I.id],ce=Array.isArray(W==null?void 0:W.apuIds)&&W.apuIds.length>0,je=W?Object.prototype.hasOwnProperty.call(W,"apuIds"):!1,le=!!ri.current[I.id],Qe=String(I.id||"").startsWith("user_"),ye=da(String(I.descripcion||"")),Oe=tn(String(I.unidadSalida||"")),Pe=(ye.includes("acero")||ye.includes("fierro"))&&(ye.includes("refuerzo")||ye.includes("enfier"))&&Oe==="kg"||ye.includes("madera")&&(ye.includes("encofrad")||ye.includes("moldaj"))&&Oe==="m2"||ye.includes("zinc")&&(ye.includes("acanal")||ye.includes("plancha"))&&Oe==="m2";return!$&&!ce&&!je&&!le&&!Qe&&!Pe});if(!P.length)return;const w=P.map(I=>{const $=String(I.descripcion||"APU sin título"),W=String(I.unidadSalida||""),ce=o($,W);return ce&&typeof ce.then=="function"?ce.then(le=>({sid:I.id,id:le})).catch(()=>({sid:I.id,id:null})):Promise.resolve({sid:I.id,id:typeof ce=="string"?ce:null})});Promise.all(w).then(I=>{const $={};for(const W of I)W&&W.id&&(ri.current[W.sid]=!0,$[W.sid]={apuIds:[W.id],overrideTotal:void 0});Object.keys($).length&&_t(W=>{const ce={...W||{}};for(const je of Object.keys($))ce[je]={...ce[je]||{},...$[je]};return ce})})}catch{}},[It,te,o]);const $a=V.useCallback(k=>{const P=we[k];if(P)return P;try{const w=localStorage.getItem("apu-library");if(w){const I=JSON.parse(w);if(Array.isArray(I)){const $=I.find(W=>String((W==null?void 0:W.id)||"")===String(k));if($)return $}}}catch{}},[we]),gr=V.useCallback((k,P)=>{try{return yt(k,i,we)}catch{return{unit:0}}},[i,we]),xr=V.useCallback(k=>{if(k)try{const P=JSON.parse(k||"null");if(!P||!P.apuId)return;const w=$a(String(P.apuId)),I=`user_calc_${Date.now()}`,$=String(P.descripcion||(w==null?void 0:w.descripcion)||"APU agregado"),W=String(P.unidadSalida||(w==null?void 0:w.unidadSalida)||"u"),ce=Number(P.metrados||1);lt(je=>{const le=[...je.calc_manual||[]];return le.push({id:I,descripcion:$,unidadSalida:W,metrados:ce,apuIds:[String(P.apuId)]}),{...je,calc_manual:le}})}catch{}},[$a]);V.useEffect(()=>{const k=localStorage.getItem("calculator-inject");if(k){xr(k);try{localStorage.removeItem("calculator-inject")}catch{}}const P=w=>{if(w.key==="calculator-inject"&&w.newValue){xr(w.newValue);try{localStorage.removeItem("calculator-inject")}catch{}}};return window.addEventListener("storage",P),()=>window.removeEventListener("storage",P)},[xr]);const os=V.useCallback(k=>{var ce;if(Array.isArray(k.subRows)&&k.subRows.length>0)return k.subRows.reduce((je,le)=>{const Qe=Number(le.metrados||0),Oe=(Array.isArray(le.apuIds)?le.apuIds:[]).reduce((tt,Lt)=>{try{return tt+gr($a(Lt),i).unit}catch{return tt}},0),Pe=typeof le.overrideUnitPrice=="number"&&Number.isFinite(le.overrideUnitPrice)?le.overrideUnitPrice:Oe,Me=typeof le.overrideTotal=="number"&&Number.isFinite(le.overrideTotal)?le.overrideTotal:Pe*Qe;return je+(Number.isFinite(Me)?Me:0)},0);const P=Number(k.metrados||0),I=((ce=k.apuIds)!=null&&ce.length?k.apuIds:k.apuId?[k.apuId]:[]).reduce((je,le)=>{try{return je+gr($a(le),i).unit}catch{return je}},0),$=typeof k.overrideUnitPrice=="number"&&Number.isFinite(k.overrideUnitPrice)?k.overrideUnitPrice:I,W=typeof k.overrideTotal=="number"&&Number.isFinite(k.overrideTotal)?k.overrideTotal:$*P;return Number.isFinite(W)?W:0},[$a,gr,i]),Ba=V.useMemo(()=>{try{return(It||[]).reduce((k,P)=>k+os(P),0)}catch{return 0}},[It,os]),ii=V.useRef(!1);V.useEffect(()=>{if(!ii.current)try{const k=new Set(["apu_enfierradura","apu_moldajes_fundaciones","apu_cubierta_zinc_m2"]),P={};for(const w of It)for(const I of w.subRows||[]){const $=da(String(I.descripcion||"")),W=tn(String(I.unidadSalida||""));if(!(($.includes("acero")||$.includes("fierro"))&&($.includes("refuerzo")||$.includes("enfier"))&&W==="kg"||$.includes("madera")&&($.includes("encofrad")||$.includes("moldaj"))&&W==="m2"||$.includes("zinc")&&($.includes("acanal")||$.includes("plancha"))&&W==="m2"))continue;const je=Array.isArray(I.apuIds)?I.apuIds:[];je.length&&je.every(le=>k.has(String(le)))&&(P[I.id]={apuIds:[],overrideTotal:void 0,overrideUnitPrice:void 0})}Object.keys(P).length&&_t(w=>{const I={...w||{}};for(const $ of Object.keys(P))I[$]={...I[$]||{},...P[$]};return I}),ii.current=!0}catch{}},[It,_t]);const mn=V.useMemo(()=>Ba*(e||0),[Ba,e]),_r=V.useMemo(()=>(Ba+mn)*(t||0),[Ba,mn,t]),Bn=V.useMemo(()=>Ba+mn+_r,[Ba,mn,_r]),fn=V.useMemo(()=>Bn*(a||0),[Bn,a]),qn=V.useMemo(()=>Bn+fn,[Bn,fn]),ls=V.useMemo(()=>{const k=Da?qn:qn-fn;return _>0?Math.round(k/_):0},[qn,fn,Da,_]),Rt=V.useCallback(()=>{try{const k=localStorage.getItem("calculator-saves-index-v1"),P=k?JSON.parse(k):[];return Array.isArray(P)?P:[]}catch{return[]}},[]),Gt=V.useCallback(k=>{try{localStorage.setItem("calculator-saves-index-v1",JSON.stringify(k))}catch{}},[]),Ya=V.useCallback(()=>({v:1,savedAt:Date.now(),metros:_,calidad:j,techo:E,piso:F,includeIvaInM2:Da,rowDescOverrides:fe,subOverrides:te,userSubRows:wt,hiddenSubIds:gt,gg:e,util:t,iva:a}),[_,j,E,F,Da,fe,te,wt,gt,e,t,a]),vr=V.useCallback(()=>{try{const k="a",P=`calculator-save:${encodeURIComponent(k)}`,w=localStorage.getItem(P);if(w)try{const I=JSON.parse(w);if(I&&!I.immutable){I.immutable=!0,localStorage.setItem(P,JSON.stringify(I));const $=Rt().filter(W=>W&&W.name!==k);$.unshift({name:k,savedAt:I.savedAt||Date.now()}),Gt($.slice(0,30))}}catch{}else{const I={...Ya(),name:k,immutable:!0};localStorage.setItem(P,JSON.stringify(I));const $=Rt().filter(W=>W&&W.name!==k);$.unshift({name:k,savedAt:I.savedAt}),Gt($.slice(0,30))}}catch{}},[Ya,Rt,Gt]),Vn=V.useCallback(()=>{try{const k="fosa",P=`calculator-save:${encodeURIComponent(k)}`,w=localStorage.getItem(P),I=Math.max(3,Math.round((_||0)*.06)),$=3,W="calc_manual",ce=Date.now(),je=[{id:`user_${W}_${ce}_1`,descripcion:"Excavación para fosa séptica",unidadSalida:"m3",metrados:I},{id:`user_${W}_${ce}_2`,descripcion:"Fosa séptica prefabricada 3.000 L",unidadSalida:"u",metrados:1},{id:`user_${W}_${ce}_3`,descripcion:"Relleno y compactación alrededor de fosa",unidadSalida:"m3",metrados:I},{id:`user_${W}_${ce}_4`,descripcion:"Cámara de inspección",unidadSalida:"u",metrados:1},{id:`user_${W}_${ce}_5`,descripcion:"Losa de hormigón para tapa de fosa",unidadSalida:"m2",metrados:$},{id:`user_${W}_${ce}_6`,descripcion:"Conexiones y tuberías sanitarias hacia fosa",unidadSalida:"gl",metrados:1}],le=(ye,Oe)=>{const Pe=da(ye),Me=tn(String(Oe||"")),tt=[];Pe.includes("excav")&&Me==="m3"&&tt.push("apu_exc_zanja_manual","apu_excavacion_manual"),Pe.includes("fosa")&&Pe.includes("séptica")&&(Me==="u"||Me==="gl")&&tt.push("apu_fosa_septica_3000l_u"),(Pe.includes("relleno")||Pe.includes("compact"))&&Me==="m3"&&tt.push("apu_relleno_compact_manual"),(Pe.includes("cámara")||Pe.includes("camara"))&&tt.push("apu_camara_inspeccion_elevador_u"),(Pe.includes("losa")||Pe.includes("radier"))&&tt.push("apu_radier_h25_10cm_malla_polietileno","apu_radier_10cm"),(Pe.includes("tuber")||Pe.includes("pvc")||Pe.includes("sanit"))&&(Me==="gl"||Me==="u")&&tt.push("apu_inst_sanit_gas_lote","apu_inst_sanitaria_gl");for(const Lt of tt)if(we[Lt])return Lt;return null},Qe=je.map(ye=>{try{const Oe=le(ye.descripcion,ye.unidadSalida||"u");if(Oe)return{...ye,apuIds:[Oe]};const Pe=ua(ye.descripcion,ye.unidadSalida||"u");return Pe?{...ye,apuIds:[Pe]}:{...ye,apuIds:[]}}catch{return{...ye,apuIds:[]}}});if(w)try{const ye=JSON.parse(w||"null"),Oe=ye&&ye.userSubRows&&Array.isArray(ye.userSubRows[W])?ye.userSubRows[W]:[],Pe=oe=>String(oe||"").toLowerCase(),Me=[...Qe],tt=[{key:"excav",match:oe=>oe.includes("excav"),make:()=>Me[0],fixQty:oe=>({...oe,metrados:I})},{key:"fosa",match:oe=>oe.includes("fosa"),make:()=>Me[1]},{key:"relleno",match:oe=>oe.includes("relleno")||oe.includes("compact"),make:()=>Me[2],fixQty:oe=>({...oe,metrados:I})},{key:"camara",match:oe=>oe.includes("cámara")||oe.includes("camara"),make:()=>Me[3]},{key:"losa",match:oe=>oe.includes("losa")||oe.includes("radier"),make:()=>Me[4],fixQty:oe=>({...oe,metrados:$})},{key:"conex",match:oe=>oe.includes("conex")||oe.includes("sanit")||oe.includes("pvc"),make:()=>Me[5]}];let Lt=!1;const qa=Array.isArray(Oe)?[...Oe]:[];for(const oe of tt){const Ve=qa.findIndex(Je=>oe.match(Pe(Je.descripcion)));if(Ve===-1){qa.push(oe.make()),Lt=!0;continue}const Xe=qa[Ve]||{};if(!(Array.isArray(Xe.apuIds)?Xe.apuIds:[]).length){const Je=le(Xe.descripcion,Xe.unidadSalida||"u");Je&&(qa[Ve]={...Xe,apuIds:[Je]},Lt=!0)}if(oe.fixQty){const Je=oe.fixQty(Xe);Je&&Je.metrados!==Xe.metrados&&(qa[Ve]=Je,Lt=!0)}}if(!Oe||Oe.length===0||Lt){const oe={...ye,userSubRows:{...ye.userSubRows||{},[W]:qa},rowDescOverrides:{...ye.rowDescOverrides||{},[W]:"Fosa séptica"},savedAt:Date.now()};localStorage.setItem(P,JSON.stringify(oe));const Ve=Rt().filter(Xe=>Xe&&Xe.name!==k);Ve.unshift({name:k,savedAt:oe.savedAt}),Gt(Ve.slice(0,30))}}catch{}else{const ye=Ya(),Oe={...ye,name:k,userSubRows:{...ye.userSubRows||{},[W]:Qe},rowDescOverrides:{...ye.rowDescOverrides||{},[W]:"Fosa séptica"}};localStorage.setItem(P,JSON.stringify(Oe));const Pe=Rt().filter(Me=>Me&&Me.name!==k);Pe.unshift({name:k,savedAt:Oe.savedAt}),Gt(Pe.slice(0,30))}}catch{}},[Ya,_,ua,Rt,Gt,we]),si=V.useCallback(()=>{try{const P=(prompt("Nombre del guardado","")||"").trim();if(P){const w=P.slice(0,64),I=`calculator-save:${encodeURIComponent(w)}`;try{const ce=localStorage.getItem(I);if(ce){const je=JSON.parse(ce);if(je&&je.immutable){alert(`El guardado "${w}" está protegido y no puede ser sobrescrito.`);return}}}catch{}const $={...Ya(),name:w};localStorage.setItem(I,JSON.stringify($));const W=Rt().filter(ce=>ce&&typeof ce.name=="string"&&ce.name!==w);W.unshift({name:w,savedAt:$.savedAt}),Gt(W.slice(0,30))}me(Date.now()),window.setTimeout(()=>me(null),1800);try{const w=[];for(const I of It){const $=Array.isArray(I.subRows)?I.subRows:[];for(const W of $){const ce=Array.isArray(W.apuIds)&&W.apuIds.length>0,je=Number(W.metrados||0)>0;if(!ce){const le=String(W.unidadSalida||"u"),Qe=je?Number(W.metrados||0):1,ye=ua(String(W.descripcion||""),le);w.push({parentId:I.id,subId:W.id,descripcion:String(W.descripcion||"Subpartida"),unit:le,metrados:Qe,suggestedApuId:ye})}}}U(w),K(w.length>0),H(w.length),w.length>0&&setTimeout(()=>{var I;try{(I=X.current)==null||I.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},50)}catch{}}catch{}},[Ya,Rt,Gt,It,ua]),hn=V.useCallback(k=>{try{const P=`calculator-save:${encodeURIComponent(k)}`,w=localStorage.getItem(P);if(!w)return;const I=JSON.parse(w||"null");if(!I)return;typeof I.metros=="number"&&b(I.metros),typeof I.includeIvaInM2=="boolean"&&Dn(I.includeIvaInM2),I.rowDescOverrides&&typeof I.rowDescOverrides=="object"&&Fe(I.rowDescOverrides),I.subOverrides&&typeof I.subOverrides=="object"&&_t(I.subOverrides),I.userSubRows&&typeof I.userSubRows=="object"&&lt(I.userSubRows),I.hiddenSubIds&&typeof I.hiddenSubIds=="object"&&jt(I.hiddenSubIds),typeof I.gg=="number"&&u&&u(I.gg),typeof I.util=="number"&&p&&p(I.util),typeof I.iva=="number"&&v&&v(I.iva),Y(k||null),y(Date.now()),window.setTimeout(()=>y(null),1800)}catch{}},[u,p,v]),Go=V.useCallback(k=>{try{const P=`calculator-save:${encodeURIComponent(k)}`;try{const $=localStorage.getItem(P);if($){const W=JSON.parse($);if(W&&W.immutable){alert(`El guardado "${k}" está protegido y no puede ser eliminado.`);return}}}catch{}if(!window.confirm(`¿Eliminar "${k}"?`))return;localStorage.removeItem(P);const I=Rt().filter($=>$&&$.name!==k);Gt(I)}catch{}},[Rt,Gt]);return V.useEffect(()=>{try{if(Z.current)return;vr();const k=`calculator-save:${encodeURIComponent("base")}`;try{if(!!localStorage.getItem(k)){localStorage.removeItem(k);const $=Rt().filter(W=>W&&W.name!=="base");Gt($)}}catch{}const P=`calculator-save:${encodeURIComponent("fosa")}`;!!localStorage.getItem(P)||Vn(),Z.current=!0,hn("fosa")}catch{}},[Rt,Gt,hn,vr,Vn]),r.jsxs("div",{className:"container mx-auto p-4",children:[r.jsx("header",{className:"bg-gradient-to-br from-slate-800 to-slate-900 text-white rounded-2xl px-6 py-6 shadow",children:r.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[r.jsxs("div",{children:[r.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Calculadora de Presupuesto"}),r.jsx("p",{className:"opacity-80",children:"Casa Básica Económica - Región de Valparaíso"})]}),r.jsxs("div",{className:"relative flex items-center gap-3",children:[D&&r.jsx("span",{className:"text-emerald-300 text-sm",children:"Guardado"}),N&&r.jsx("span",{className:"text-sky-300 text-sm",children:"Cargado"}),R>0&&r.jsxs("button",{type:"button",onClick:()=>{K(!0),setTimeout(()=>{var k;try{(k=X.current)==null||k.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},0)},className:"px-2 py-1 rounded-lg text-xs font-semibold bg-amber-700/70 hover:bg-amber-600 text-white",title:"Subpartidas vacías detectadas",children:["Vacías: ",R]}),r.jsxs("button",{type:"button",onClick:si,className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 text-white text-sm font-semibold shadow focus:outline-none focus:ring-2 focus:ring-indigo-400/60",title:"Guardar con nombre",children:[r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"opacity-90",children:[r.jsx("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),r.jsx("path",{d:"M7 21V14a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v7",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),r.jsx("path",{d:"M7 3v6h9V3",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"})]}),"Guardar"]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{type:"button",onClick:()=>L(k=>!k),className:"inline-flex items-center gap-2 px-3 py-2 rounded-xl bg-slate-700 hover:bg-slate-600 active:bg-slate-800 text-white text-sm font-semibold shadow focus:outline-none focus:ring-2 focus:ring-slate-400/60",title:"Cargar guardado",children:[r.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"opacity-90",children:[r.jsx("path",{d:"M12 16V4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),r.jsx("path",{d:"M8 12l4 4 4-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M20 20H4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),"Cargar"]}),O&&r.jsx("div",{className:"absolute right-0 mt-2 w-64 rounded-xl border border-slate-700 bg-slate-900 shadow-xl z-20",children:r.jsxs("div",{className:"max-h-64 overflow-auto py-2",children:[r.jsxs("div",{className:"px-3 py-2 border-b border-slate-700/60",children:[r.jsx("div",{className:"text-[11px] uppercase text-slate-400 mb-1",children:"Acciones rápidas"}),r.jsxs("div",{className:"flex flex-col gap-1",children:[r.jsx("button",{onClick:()=>{try{Vn(),hn("fosa"),L(!1)}catch{}},className:"px-2 py-1 rounded-lg text-sm font-medium bg-emerald-700/70 hover:bg-emerald-600 text-white",children:"Cargar preset Fosa"}),r.jsx("button",{onClick:()=>{try{hn("a"),L(!1)}catch{}},className:"px-2 py-1 rounded-lg text-sm font-medium bg-indigo-700/70 hover:bg-indigo-600 text-white",children:"Cargar A (protegido)"})]})]}),Rt().length===0&&r.jsx("div",{className:"px-3 py-2 text-slate-400 text-sm",children:"No hay guardados"}),Rt().map((k,P)=>r.jsxs("div",{className:"flex items-start gap-2 px-3 py-2 hover:bg-slate-800",children:[r.jsxs("button",{onClick:()=>{L(!1),hn(k.name)},className:"flex-1 text-left text-slate-100 text-sm",children:[r.jsxs("div",{className:"font-medium truncate",children:[k.name,k.name==="a"&&r.jsx("span",{className:"ml-2 inline-block text-[10px] px-1.5 py-0.5 rounded bg-indigo-800/60 text-indigo-200 align-middle",children:"protegido"}),k.name==="fosa"&&r.jsx("span",{className:"ml-2 inline-block text-[10px] px-1.5 py-0.5 rounded bg-emerald-800/60 text-emerald-200 align-middle",children:"preset"})]}),r.jsx("div",{className:"text-[11px] text-slate-400",children:new Date(k.savedAt).toLocaleString()})]}),r.jsx("button",{onClick:w=>{w.stopPropagation(),Go(k.name)},className:"p-1 rounded-lg text-slate-300 hover:text-rose-300 hover:bg-slate-700",title:"Eliminar guardado",children:r.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[r.jsx("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),r.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",stroke:"currentColor",strokeWidth:"1.5"}),r.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6",stroke:"currentColor",strokeWidth:"1.5"}),r.jsx("path",{d:"M10 11v7M14 11v7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})]},P))]})})]})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mt-6",children:[r.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-2xl p-4 h-fit",children:r.jsxs("div",{children:[r.jsx("label",{htmlFor:"metros",className:"block text-sm font-semibold text-slate-200",children:"Metros Cuadrados de la Casa"}),r.jsx("input",{id:"metros",type:"number",min:40,max:200,step:5,value:_,onChange:k=>b(Number(k.target.value||0)),className:"mt-1 w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-slate-100 focus:outline-none focus:border-slate-500"}),r.jsxs("div",{className:"text-indigo-400 font-semibold text-center mt-1",children:[_," m²"]}),r.jsx("input",{type:"range",min:40,max:200,step:5,value:_,onChange:k=>b(Number(k.target.value)),className:"mt-3 w-full accent-indigo-500"})]})}),r.jsxs("div",{className:"rounded-2xl border border-slate-700 bg-slate-900 p-4 flex flex-col justify-center",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"text-xs uppercase text-slate-300",children:"Costo por m²"}),r.jsxs("label",{className:"flex items-center gap-2 text-[11px] text-slate-300",children:[r.jsx("input",{type:"checkbox",className:"accent-indigo-500",checked:Da,onChange:k=>Dn(k.target.checked)}),r.jsx("span",{children:Da?"con IVA":"sin IVA"})]})]}),r.jsx("div",{className:"text-xl font-bold text-indigo-300 mt-1",children:Wn(ls)})]}),r.jsxs("div",{className:"rounded-2xl border border-purple-800 bg-purple-900/20 p-4",children:[r.jsx("div",{className:"text-xs uppercase text-slate-300",children:"Gastos Generales (%)"}),r.jsx("input",{type:"number",min:0,max:100,step:.5,value:Math.round((e||0)*1e3)/10,onChange:k=>u&&u(Math.max(0,Math.min(100,Number(k.target.value||0)))/100),className:"mt-2 w-full rounded-xl bg-slate-900 border border-purple-800/60 px-3 py-2 text-slate-100 focus:outline-none focus:border-purple-500"})]}),r.jsxs("div",{className:"rounded-2xl border border-emerald-800 bg-emerald-900/20 p-4",children:[r.jsx("div",{className:"text-xs uppercase text-slate-300",children:"Utilidad (%)"}),r.jsx("input",{type:"number",min:0,max:100,step:.5,value:Math.round((t||0)*1e3)/10,onChange:k=>p&&p(Math.max(0,Math.min(100,Number(k.target.value||0)))/100),className:"mt-2 w-full rounded-xl bg-slate-900 border border-emerald-800/60 px-3 py-2 text-slate-100 focus:outline-none focus:border-emerald-500"})]}),r.jsxs("div",{className:"rounded-2xl border border-rose-800 bg-rose-900/20 p-4",children:[r.jsx("div",{className:"text-xs uppercase text-slate-300",children:"IVA (%)"}),r.jsx("input",{type:"number",min:0,max:100,step:.5,value:Math.round((a||0)*1e3)/10,onChange:k=>v&&v(Math.max(0,Math.min(100,Number(k.target.value||0)))/100),className:"mt-2 w-full rounded-xl bg-slate-900 border border-rose-800/60 px-3 py-2 text-slate-100 focus:outline-none focus:border-rose-500"})]})]}),r.jsx("div",{className:"grid grid-cols-1 gap-4 mt-6",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-2xl p-4 text-center",children:[r.jsx("h2",{className:"text-lg font-semibold text-slate-100",children:"Presupuesto Total Estimado"}),r.jsx("div",{className:"text-3xl md:text-4xl font-extrabold text-emerald-400 my-2",children:Wn(qn)}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mt-3",children:[r.jsxs("div",{className:"rounded-xl p-3 bg-blue-900/20 border border-blue-800",children:[r.jsx("div",{className:"text-xs uppercase text-slate-300",children:"Materiales"}),r.jsx("div",{className:"text-lg font-bold",children:Wn(Ba)})]}),r.jsxs("div",{className:"rounded-xl p-3 bg-purple-900/20 border border-purple-800",children:[r.jsxs("div",{className:"text-xs uppercase text-slate-300",children:["Gastos Generales (",Math.round((e||0)*100),"%)"]}),r.jsx("div",{className:"text-lg font-bold",children:Wn(mn)})]}),r.jsxs("div",{className:"rounded-xl p-3 bg-emerald-900/20 border border-emerald-800",children:[r.jsxs("div",{className:"text-xs uppercase text-slate-300",children:["Utilidad (",Math.round((t||0)*100),"%)"]}),r.jsx("div",{className:"text-lg font-bold",children:Wn(_r)})]}),r.jsxs("div",{className:"rounded-xl p-3 bg-rose-900/20 border border-rose-800",children:[r.jsxs("div",{className:"text-xs uppercase text-slate-300",children:["IVA (",Math.round((a||0)*100),"%)"]}),r.jsx("div",{className:"text-lg font-bold",children:Wn(fn)})]})]})]}),hr.length>0&&r.jsxs("div",{className:"bg-amber-900/20 border border-amber-700 rounded-2xl p-4",children:[r.jsx("div",{className:"text-amber-300 text-sm font-semibold mb-2",children:"Partidas vacías"}),r.jsx("div",{className:"space-y-2",children:hr.map(k=>r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 bg-amber-900/10 rounded-xl p-2",children:[r.jsxs("div",{className:"text-amber-200 text-sm",children:['La partida "',k.name,'" está vacía.'," ",k.suggestedApuId?"Se encontró un APU sugerido.":"No se encontró APU automático."]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{type:"button",disabled:!k.suggestedApuId,onClick:()=>Ho(k.rowId),className:`px-3 py-1.5 rounded-lg text-sm font-semibold shadow ${k.suggestedApuId?"bg-amber-600 hover:bg-amber-500 text-white":"bg-amber-800/40 text-amber-300 cursor-not-allowed"}`,children:"Agregar sugerido"}),r.jsx("button",{type:"button",onClick:()=>Wo(k.rowId),className:"px-3 py-1.5 rounded-lg text-sm font-semibold shadow bg-slate-700 hover:bg-slate-600 text-white",children:"Elegir APU…"})]})]},k.rowId))})]}),M&&C.length>0&&r.jsxs("div",{ref:X,className:"bg-sky-900/20 border border-sky-700 rounded-2xl p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"text-sky-300 text-sm font-semibold",children:"Subpartidas vacías detectadas al guardar"}),r.jsx("button",{type:"button",onClick:()=>K(!1),className:"px-2 py-1 rounded-lg text-xs font-semibold bg-slate-700 hover:bg-slate-600 text-white",children:"Ocultar"})]}),r.jsx("div",{className:"space-y-2",children:C.map(k=>r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 bg-sky-900/10 rounded-xl p-2",children:[r.jsxs("div",{className:"text-sky-200 text-sm",children:['"',k.descripcion,'" — UN: ',k.unit,k.metrados?` · CANT: ${k.metrados}`:""," ",k.suggestedApuId?"Sugerencia disponible.":"Sin sugerencia automática."]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{type:"button",disabled:!k.suggestedApuId,onClick:()=>Qo(k.parentId,k.subId),className:`px-3 py-1.5 rounded-lg text-sm font-semibold shadow ${k.suggestedApuId?"bg-sky-600 hover:bg-sky-500 text-white":"bg-sky-800/40 text-sky-300 cursor-not-allowed"}`,children:"Agregar sugerido"}),r.jsx("button",{type:"button",onClick:()=>ss(k.parentId,k.subId),className:"px-3 py-1.5 rounded-lg text-sm font-semibold shadow bg-slate-700 hover:bg-slate-600 text-white",children:"Elegir APU…"})]})]},k.subId))})]}),r.jsxs("div",{className:"bg-slate-800 border border-slate-700 rounded-2xl p-4",children:[r.jsx("h3",{className:"text-base font-semibold text-slate-100 mb-3",children:"Vista Presupuesto"}),r.jsx(c0,{chapters:mr,rows:It,getApuById:$a,unitCost:gr,resources:i,fmt:Wn,onAddSubRow:k=>{const P=(prompt("Nombre de la subpartida:","")||"").trim();if(!P)return;const w=`user_${k}_${Date.now()}`;lt(I=>{const $=[...I[k]||[]];return $.push({id:w,descripcion:P,unidadSalida:"u",metrados:1,apuIds:[]}),{...I,[k]:$}})},onUpdateSubRow:(k,P,w)=>{String(P).startsWith("user_")?lt(I=>{const $=[...I[k]||[]],W=$.findIndex(ce=>ce.id===P);return W>=0&&($[W]={...$[W],...w}),{...I,[k]:$}}):_t(I=>({...I,[P]:{...I[P]||{},...w}}))},onRemoveSubRow:(k,P)=>{String(P).startsWith("user_")?lt(w=>{const I=(w[k]||[]).filter($=>$.id!==P);return{...w,[k]:I}}):jt(w=>({...w,[P]:!0}))},onPickApu:k=>{Se({open:!0,subId:k})},onMoveChapter:()=>{},onDelete:()=>{},onShowApuDetail:s,onUpdateRow:(k,P)=>{P&&typeof P.descripcion=="string"&&Fe(w=>({...w,[k]:P.descripcion}))}}),r.jsx(s0,{open:ca.open,onClose:()=>Se({open:!1,subId:null}),onPick:k=>{const P=ca.subId;if(!P)return;const w=It.find(ce=>(ce.subRows||[]).some(je=>je.id===P));if(!w){Se({open:!1,subId:null});return}const I=(w.subRows||[]).find(ce=>ce.id===P),$=Array.isArray(I==null?void 0:I.apuIds)?I.apuIds:[],W=$.includes(k)?$:[...$,k];String(P).startsWith("user_")?lt(ce=>{const je=[...ce[w.id]||[]],le=je.findIndex(Qe=>Qe.id===P);return le>=0&&(je[le]={...je[le],apuIds:W,overrideTotal:void 0}),{...ce,[w.id]:je}}):_t(ce=>({...ce,[P]:{...ce[P]||{},apuIds:W,overrideTotal:void 0}})),Se({open:!1,subId:null})},apus:Array.isArray(n)?n:[],onCreateNew:()=>{try{const k=ca.subId;if(!k){Se({open:!1,subId:null});return}const P=It.find(W=>(W.subRows||[]).some(ce=>ce.id===k)),w=P?(P.subRows||[]).find(W=>W.id===k):null,I=String((w==null?void 0:w.descripcion)||"APU sin título"),$=String((w==null?void 0:w.unidadSalida)||"");if(o){const W=o(I,$),ce=le=>!!le&&typeof le.then=="function",je=le=>{if(!le)return;const Qe=Array.isArray(w==null?void 0:w.apuIds)?w.apuIds:[],ye=Qe.includes(le)?Qe:[...Qe,le];String(k).startsWith("user_")?lt(Oe=>{const Pe=[...Oe[P.id]||[]],Me=Pe.findIndex(tt=>tt.id===k);return Me>=0&&(Pe[Me]={...Pe[Me],apuIds:ye,overrideTotal:void 0}),{...Oe,[P.id]:Pe}}):_t(Oe=>({...Oe,[k]:{...Oe[k]||{},apuIds:ye,overrideTotal:void 0}})),Se({open:!1,subId:null})};ce(W)?W.then(le=>je(le)).catch(()=>Se({open:!1,subId:null})):typeof W=="string"&&je(W)}else Se({open:!1,subId:null})}catch{Se({open:!1,subId:null})}}})]})]})})]})},m_={BASE_URL:"/pres/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Up=4e3,Dp=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`ntf-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,f_=(e,t="success")=>typeof e=="string"?{id:Dp(),message:e,type:t,ttl:Up,createdAt:Date.now(),persistent:!1}:{id:e.id??Dp(),message:e.message,type:e.type??t,ttl:typeof e.ttl=="number"?e.ttl:Up,createdAt:Date.now(),persistent:!!e.persistent};function h_(){if((()=>{try{const p=m_?"".toLowerCase():"";if(p==="true"||p==="1")return!0}catch{}try{const p=String(localStorage.getItem("apu-toasts-disabled")||"").toLowerCase();if(p==="true"||p==="1")return!0}catch{}return!1})()){const p="";return{notifications:[],showNotification:(v,_)=>p,dismissNotification:v=>{},clearNotifications:()=>{}}}const[t,a]=q.useState([]),n=q.useRef(new Map),i=q.useCallback(p=>{const v=n.current,_=v.get(p);_!==void 0&&(window.clearTimeout(_),v.delete(p))},[]),s=q.useCallback(p=>{a(v=>v.filter(_=>_.id!==p)),i(p)},[i]),o=q.useCallback(()=>{n.current.forEach(p=>window.clearTimeout(p)),n.current.clear(),a([])},[]),u=q.useCallback((p,v)=>{const _=f_(p,v);if(i(_.id),a(b=>{const j=b.findIndex(E=>E.id===_.id);if(j>=0){const E=[...b];return E[j]=_,E}return[...b,_]}),!_.persistent&&typeof _.ttl=="number"&&_.ttl>0){const b=window.setTimeout(()=>s(_.id),_.ttl);n.current.set(_.id,b)}return _.id},[s,i]);return q.useEffect(()=>()=>{n.current.forEach(p=>window.clearTimeout(p)),n.current.clear()},[]),{notifications:t,showNotification:u,dismissNotification:s,clearNotifications:o}}const $p="inline-flex items-center rounded-full bg-amber-100 text-amber-800 px-2 py-0.5 text-xs font-semibold";function g_({open:e,apus:t,resources:a,usageCounts:n,onShowUsages:i,onClose:s,onMerge:o,onEdit:u,onDelete:p}){const[v,_]=V.useState(!0),b=V.useMemo(()=>t.filter(M=>rr(M)),[t]),j=V.useMemo(()=>to(t,{threshold:.44,sameUnit:!0}),[t]),[E,F]=V.useState({}),[D,me]=V.useState({}),[N,y]=V.useState(new Set),O=V.useCallback(M=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(M||0),[]),L=V.useMemo(()=>{const M=j||[],K=M.length,C=M.reduce((U,R)=>{var H;return U+Math.max(0,(((H=R.ids)==null?void 0:H.length)||0)-1)},0);return{totalGroups:K,totalDuplicates:C}},[j]),ie=V.useCallback(()=>{const M=j||[];if(!M.length)return;const K=`Se aplicarán fusiones en ${M.length} grupo(s), eliminando hasta ${L.totalDuplicates} duplicado(s) (según selección). ¿Continuar?`;if(window.confirm(K)){for(const C of M){if(D[C.key])continue;const U=(C.ids||[]).map(X=>t.find(ne=>ne.id===X)).filter(Boolean);if(U.length<2)continue;const R=E[C.key]||U[0].id,H=U.map(X=>X.id).filter(X=>X!==R);H.length&&o(R,H,v)}s()}},[j,E,v,o,s,t,L.totalDuplicates,D]),Y=V.useCallback(M=>{y(K=>{const C=new Set(K);return C.has(M)?C.delete(M):C.add(M),C})},[]),Z=V.useCallback(()=>{const M=Array.from(N);if(!M.length){s();return}const K=M.filter(H=>n&&(n[H]||0)>0),C=M.filter(H=>!K.includes(H));if(C.length===0){alert("No hay APU(s) eliminables: todos están en uso.");return}const U=`Se eliminarán ${C.length} APU(s).${K.length?`
(${K.length} no se eliminarán por estar en uso)`:""}
¿Confirmar?`;if(!window.confirm(U))return;C.forEach(H=>{try{p&&p(H)}catch{}});const R=`Eliminados ${C.length} APU(s).${K.length?`
${K.length} no se eliminaron por estar en uso.`:""}`;alert(R),s()},[N,p,s,n]);return e?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:r.jsxs("div",{className:"w-full max-w-5xl rounded-2xl bg-white text-slate-800 shadow-2xl",children:[r.jsxs("header",{className:"flex items-center justify-between border-b border-slate-200 px-6 py-4",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"Limpieza de Biblioteca APU"}),r.jsx("button",{onClick:s,className:"text-slate-400 hover:text-slate-600","aria-label":"Cerrar",children:"×"})]}),r.jsxs("div",{className:"max-h-[75vh] overflow-y-auto px-6 py-5 space-y-8",children:[r.jsx("section",{className:"rounded-lg bg-slate-50 border border-slate-200 p-3 text-sm text-slate-700",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsxs("div",{children:[r.jsx("span",{className:"font-semibold",children:"Grupos similares:"})," ",L.totalGroups]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-semibold",children:"Posibles duplicados:"})," ",L.totalDuplicates]}),r.jsxs("div",{children:[r.jsx("span",{className:"font-semibold",children:"Marcados para borrar:"})," ",N.size]}),r.jsxs("label",{className:"inline-flex items-center gap-2 ml-auto",children:[r.jsx("input",{type:"checkbox",checked:v,onChange:M=>_(M.currentTarget.checked)}),r.jsx("span",{children:"Eliminar duplicados al fusionar"})]}),r.jsx("button",{onClick:ie,className:"ml-auto rounded bg-emerald-600 px-3 py-1 text-white hover:bg-emerald-700",children:"Aplicar todo"})]})}),r.jsxs("section",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"font-semibold",children:"APUs incompletos"}),r.jsx("span",{className:$p,children:b.length})]}),b.length===0?r.jsx("p",{className:"text-sm text-slate-500",children:"No se detectaron APUs incompletos."}):r.jsx("ul",{className:"space-y-2",children:b.map(M=>r.jsxs("li",{className:"flex items-center justify-between gap-3 rounded-lg border border-slate-200 px-3 py-2",children:[r.jsxs("div",{className:"min-w-0",children:[r.jsx("div",{className:"truncate font-medium",children:M.descripcion}),r.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 flex-wrap",children:[r.jsxs("span",{children:["ID: ",M.id]}),r.jsxs("span",{children:["· Unidad: ",(M.unidadSalida||"").toUpperCase()]}),r.jsxs("span",{children:["· P. Unit.: ",O(yt(M,a).unit||0)]}),n&&(n[M.id]||0)>0&&r.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-sky-100 text-sky-800 text-[10px]",children:["en uso · ",n[M.id]]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[i&&r.jsx("button",{onClick:()=>i(M.id),className:"rounded border border-slate-300 px-3 py-1 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Ver usos"}),r.jsx("button",{onClick:()=>u(M.id),className:"rounded border border-slate-300 px-3 py-1 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Completar ahora"})]})]},M.id))})]}),r.jsxs("section",{children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"font-semibold",children:"Posibles duplicados (por trigramas y misma unidad)"}),r.jsx("span",{className:$p,children:j.length})]}),j.length===0?r.jsx("p",{className:"text-sm text-slate-500",children:"No se encontraron grupos de posibles duplicados."}):r.jsx("div",{className:"space-y-4",children:j.map(M=>{var U;const K=M.ids.map(R=>t.find(H=>H.id===R)).filter(Boolean),C=E[M.key]||((U=K[0])==null?void 0:U.id)||M.key;return r.jsxs("div",{className:"rounded-xl border border-slate-200 p-3",children:[r.jsxs("div",{className:"mb-2 text-xs text-slate-500 flex items-center gap-2",children:[r.jsxs("span",{children:["Unidad: ",(M.unit||"").toUpperCase()]}),r.jsx("button",{onClick:()=>me(R=>({...R,[M.key]:!R[M.key]})),className:`ml-auto rounded px-2 py-0.5 text-xs border ${D[M.key]?"border-slate-400 text-slate-500 bg-slate-100":"border-slate-300 text-slate-700 hover:bg-slate-50"}`,title:D[M.key]?"Este grupo no se fusionará en Aplicar todo":"Omitir este grupo en Aplicar todo",children:D[M.key]?"No fusionar (omitido)":"No fusionar"})]}),r.jsx("ul",{className:"space-y-1",children:K.map(R=>{const H=yt(R,a).unit||0,X=rr(R),ne=n&&n[R.id]||0;return r.jsxs("li",{className:"flex items-center justify-between gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[r.jsx("input",{type:"radio",name:`target_${M.key}`,className:"h-4 w-4",checked:C===R.id,onChange:()=>F(T=>({...T,[M.key]:R.id}))}),r.jsxs("div",{className:"truncate",children:[r.jsx("span",{className:"font-medium",children:R.descripcion}),r.jsxs("span",{className:"ml-2 text-xs text-slate-500",children:["ID: ",R.id]}),X&&r.jsx("span",{className:"ml-2 inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-amber-100 text-amber-800 text-[10px]",children:"incompleto"}),ne>0&&r.jsxs("span",{className:"ml-2 inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-sky-100 text-sky-800 text-[10px]",children:["en uso · ",ne]})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>Y(R.id),className:`rounded border px-2 py-0.5 text-xs ${N.has(R.id)?"border-red-500 text-red-600 bg-red-50":ne>0?"border-slate-200 text-slate-400 cursor-not-allowed":"border-slate-300 text-slate-700 hover:bg-slate-50"}`,title:ne>0?"No se puede borrar: APU en uso":N.has(R.id)?"Quitar de borrado":"Marcar para borrar",disabled:ne>0,children:N.has(R.id)?"Borrar (marcado)":"Borrar"}),i&&r.jsx("button",{onClick:()=>i(R.id),className:"rounded border border-slate-300 px-2 py-0.5 text-xs text-slate-700 hover:bg-slate-50",children:"Ver usos"}),r.jsxs("div",{className:"text-xs text-slate-600 whitespace-nowrap",children:[(R.unidadSalida||"").toUpperCase()," · ",O(H)]})]})]},R.id)})}),r.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[r.jsxs("div",{className:"text-xs text-slate-500",children:["Duplicados en este grupo: ",Math.max(0,K.length-1)]}),r.jsx("button",{onClick:()=>o(C,K.map(R=>R.id).filter(R=>R!==C),v),className:"rounded border border-slate-300 px-3 py-1 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Fusionar"})]})]},M.key)})})]})]}),r.jsxs("footer",{className:"flex items-center justify-end gap-2 border-t border-slate-200 px-6 py-3",children:[r.jsx("button",{onClick:Z,className:"rounded bg-indigo-600 px-4 py-2 text-sm font-semibold text-white hover:bg-indigo-700",children:"Guardar cambios"}),r.jsx("button",{onClick:s,className:"rounded border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50",children:"Cerrar"})]})]})}):null}const d0="apu-resources",Bp=(e,t,a)=>{const n=a??Ao[e]??{id:e,tipo:"material",nombre:e,unidad:"",precio:0},i=Number((t??{}).precio);return{id:typeof(t==null?void 0:t.id)=="string"&&t.id.trim().length>0?t.id:n.id,tipo:typeof(t==null?void 0:t.tipo)=="string"?t.tipo:n.tipo,nombre:typeof(t==null?void 0:t.nombre)=="string"&&t.nombre.trim().length>0?t.nombre:n.nombre,unidad:typeof(t==null?void 0:t.unidad)=="string"?t.unidad:n.unidad,precio:Number.isFinite(i)?Math.max(0,i):n.precio}},tr=e=>{const t={};for(const[a,n]of Object.entries(Ao))t[a]=Bp(a,n,n);if(e&&typeof e=="object"){const a=Object.entries(e);for(const[n,i]of a)t[n]=Bp(n,i,t[n])}return t},qp=()=>{if(typeof window>"u")return tr({});try{const e=window.localStorage.getItem(d0);return tr(e?JSON.parse(e):{})}catch(e){return console.warn("No se pudo leer los recursos almacenados:",e),tr({})}},Vp=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(d0,JSON.stringify(e))}catch(t){console.warn("No se pudieron guardar los recursos:",t)}};function x_(){const[e,t]=q.useState(()=>qp());q.useEffect(()=>{Vp(e)},[e]);const a=q.useCallback(()=>qp(),[]),n=q.useCallback(u=>{t(p=>{const v=typeof u=="function"?u(p):u;return tr(v)})},[]),i=q.useCallback((u,p)=>{t(v=>{const _=v[u]??Ao[u];if(!_)return v;const b=Number.isFinite(p)?Math.max(0,Number(p)):0;return{...v,[u]:{..._,precio:b}}})},[]),s=q.useCallback(u=>{const p=tr(u);Vp(p)},[]),o=q.useCallback(()=>{t(tr(Ao))},[]);return{resources:e,setResources:n,updateResourcePrice:i,loadResources:a,saveResources:s,resetResources:o}}function wa(e,t){const[a,n]=q.useState(()=>{try{const i=localStorage.getItem(e);return i!=null?JSON.parse(i):t}catch{return t}});return q.useEffect(()=>{try{localStorage.setItem(e,JSON.stringify(a))}catch{}},[e,a]),[a,n]}const Qn="text-xs font-semibold uppercase tracking-wide text-slate-400 flex flex-col gap-1",Gn="w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm text-slate-100 placeholder-slate-500 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500",__=({open:e,onClose:t,onSubmit:a,initial:n})=>{if(!e)return null;const[i,s]=V.useState((n==null?void 0:n.nombre)||""),[o,u]=V.useState("update"),p=((n==null?void 0:n.nombre)||"").trim().toLowerCase(),v=(i||"").trim().toLowerCase(),_=!!p&&p!==v;return r.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/60 px-4",children:r.jsxs("div",{className:"w-full max-w-3xl overflow-hidden rounded-2xl bg-slate-900 text-slate-100 shadow-2xl border border-slate-700",children:[r.jsxs("header",{className:"flex items-center justify-between border-b border-slate-800 px-6 py-4",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"Proyecto"}),r.jsx("button",{type:"button",onClick:t,className:"text-slate-400 transition hover:text-slate-200","aria-label":"Cerrar",children:"×"})]}),r.jsxs("form",{onSubmit:a,className:"px-6 py-4 grid gap-3",children:[r.jsxs("label",{className:Qn,children:["Nombre del Proyecto ",r.jsx("span",{className:"text-red-500",children:"*"}),r.jsx("input",{type:"text",className:Gn,name:"nombre",value:i,onChange:b=>s(b.target.value)})]}),r.jsxs("label",{className:Qn,children:["Propietario ",r.jsx("span",{className:"text-red-500",children:"*"}),r.jsx("input",{type:"text",className:Gn,name:"propietario",defaultValue:(n==null?void 0:n.propietario)||""})]}),r.jsxs("label",{className:Qn,children:["Dirección",r.jsx("input",{type:"text",className:Gn,name:"direccion",defaultValue:(n==null?void 0:n.direccion)||""})]}),r.jsxs("label",{className:Qn,children:["Ciudad",r.jsx("input",{type:"text",className:Gn,name:"ciudad",defaultValue:(n==null?void 0:n.ciudad)||""})]}),r.jsxs("label",{className:Qn,children:["Comuna",r.jsx("input",{type:"text",className:Gn,name:"comuna",defaultValue:(n==null?void 0:n.comuna)||""})]}),r.jsxs("label",{className:Qn,children:["Fecha entrega/apertura",r.jsx("input",{type:"date",className:Gn,name:"fecha",defaultValue:(n==null?void 0:n.fecha)||""})]}),r.jsxs("label",{className:Qn,children:["Plazo de Ejecución (días)",r.jsx("input",{type:"number",className:Gn,name:"plazoDias",defaultValue:(n==null?void 0:n.plazoDias)??""})]}),_&&r.jsxs("div",{className:"rounded-xl border border-slate-700 bg-slate-800 px-4 py-3 text-slate-200",children:[r.jsx("div",{className:"text-sm font-semibold mb-2",children:"Nombre cambiado. ¿Actualizar existente? (Aceptar) / ¿Crear nuevo? (Cancelar)"}),r.jsxs("div",{className:"flex flex-col gap-2 text-sm",children:[r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:"nameChangeAction",value:"update",className:"accent-slate-200",checked:o==="update",onChange:()=>u("update")}),"Actualizar existente"]}),r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:"nameChangeAction",value:"create",className:"accent-slate-200",checked:o==="create",onChange:()=>u("create")}),"Crear nuevo"]})]})]}),r.jsxs("footer",{className:"flex items-center justify-end gap-3 pt-2",children:[r.jsx("button",{type:"button",onClick:t,className:"rounded-xl border border-slate-600 px-4 py-2 text-sm font-medium text-slate-200 transition hover:bg-slate-700/30",children:"Cerrar"}),r.jsx("button",{type:"submit",className:"rounded-xl border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:bg-slate-700/30",children:"Guardar"})]})]})]})})},v_={success:"bg-green-600",error:"bg-red-600",info:"bg-blue-600",warning:"bg-amber-500"},u0=V.memo(({notifications:e,onDismiss:t})=>e.length===0?null:r.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-3",children:e.map(a=>r.jsx("div",{className:`max-w-sm px-4 py-3 rounded-xl shadow-lg text-white transition-all duration-300 ${v_[a.type]}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-1",children:r.jsx("p",{className:"text-sm font-medium leading-snug",children:a.message})}),r.jsx("button",{onClick:()=>t(a.id),className:"text-white/80 hover:text-white transition-colors","aria-label":"Cerrar notificacion",children:"x"})]})},a.id))}));u0.displayName="NotificationToast";const b_=({open:e,initial:t,onClose:a,onSave:n,projects:i=[]})=>{const[s,o]=V.useState({nombre:"",email:"",telefono:"",profesion:"",tipo:"admin",assignedProjectId:""});if(V.useEffect(()=>{o({nombre:(t==null?void 0:t.nombre)||"",email:(t==null?void 0:t.email)||"",telefono:(t==null?void 0:t.telefono)||"",profesion:(t==null?void 0:t.profesion)||"",tipo:(t==null?void 0:t.tipo)||"admin",assignedProjectId:(t==null?void 0:t.assignedProjectId)||""})},[t,e]),!e)return null;const u=p=>v=>{o(_=>({..._,[p]:v.target.value}))};return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 px-4",children:r.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-slate-900 text-slate-100 shadow-2xl border border-slate-700",children:[r.jsxs("header",{className:"flex items-center justify-between border-b border-slate-800 px-5 py-3",children:[r.jsx("h2",{className:"text-base font-semibold",children:"Usuario"}),r.jsx("button",{onClick:a,"aria-label":"Cerrar",className:"text-slate-400 hover:text-slate-200",children:"×"})]}),r.jsxs("div",{className:"p-5 grid gap-3",children:[r.jsxs("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 grid gap-1",children:["Nombre",r.jsx("input",{className:"w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm text-slate-100 placeholder-slate-500 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500",value:s.nombre||"",onChange:u("nombre")})]}),r.jsxs("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 grid gap-1",children:["Email",r.jsx("input",{type:"email",className:"w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm text-slate-100 placeholder-slate-500 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500",value:s.email||"",onChange:u("email")})]}),r.jsxs("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 grid gap-1",children:["Teléfono",r.jsx("input",{className:"w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm text-slate-100 placeholder-slate-500 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500",value:s.telefono||"",onChange:u("telefono")})]}),r.jsxs("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 grid gap-1",children:["Profesión",r.jsx("input",{className:"w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm text-slate-100 placeholder-slate-500",value:s.profesion||"",onChange:u("profesion")})]}),r.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:"tipoUserQuick",checked:(s.tipo||"admin")==="admin",onChange:()=>o(p=>({...p,tipo:"admin"})),className:"accent-slate-500"}),"Admin"]}),r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"radio",name:"tipoUserQuick",checked:(s.tipo||"admin")==="normal",onChange:()=>o(p=>({...p,tipo:"normal"})),className:"accent-slate-500"}),"Normal"]})]}),r.jsxs("label",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400 grid gap-1",children:["Proyecto asignado",r.jsxs("select",{className:"w-full rounded-xl bg-slate-900 border border-slate-700 px-3 py-2 text-sm text-slate-100 focus:border-slate-500 focus:outline-none focus:ring-1 focus:ring-slate-500",value:s.assignedProjectId||"",onChange:p=>o(v=>({...v,assignedProjectId:p.target.value})),children:[r.jsx("option",{value:"",children:"(Ninguno)"}),i.map(p=>r.jsx("option",{value:p.id,children:[p.name,p.client,p.location].filter(Boolean).join(" — ")},p.id))]})]})]}),r.jsxs("footer",{className:"flex items-center justify-end gap-2 px-5 py-3 border-t border-slate-800",children:[r.jsx("button",{type:"button",onClick:a,className:"rounded-xl border border-slate-600 px-4 py-2 text-sm font-medium text-slate-200 hover:bg-slate-700/30",children:"Cerrar"}),r.jsx("button",{type:"button",onClick:()=>n(s),className:"rounded-xl border border-slate-600 px-4 py-2 text-sm font-semibold text-slate-200 hover:bg-slate-700/30",children:"Guardar"})]})]})})},y_=()=>{const{notifications:e,showNotification:t,dismissNotification:a}=h_(),[n,i]=q.useState("presupuesto"),s=l=>String(l||"").trim().toLowerCase().replace(new RegExp("\\b\\p{L}+","gu"),c=>c.charAt(0).toUpperCase()+c.slice(1)),{resources:o,setResources:u}=x_(),[p,v]=wa("apu-gg",.18),[_,b]=wa("apu-util",.2),[j,E]=wa("apu-iva",.19),[F,D]=wa("apu-budget-notes",""),[me,N]=q.useState(!1),[y,O]=q.useState(""),L=q.useRef(null);q.useEffect(()=>{var l;try{if(me&&L.current){const d=L.current.contentDocument||((l=L.current.contentWindow)==null?void 0:l.document);d&&(d.open(),d.write(y||""),d.close())}}catch{}},[me,y]);const ie=V.useCallback(()=>{try{const l="fosa",d=`calculator-save:${encodeURIComponent(l)}`,c=Date.now(),f="calc_manual",g=60,m=1,x=.7,S=1,h=!0,A=Math.max(3,Math.round((g||0)*.06)),z=[{id:`user_${f}_${c}_1`,descripcion:"Excavación para fosa séptica",unidadSalida:"m3",metrados:A,apuIds:["apu_exc_zanja_manual"]},{id:`user_${f}_${c}_2`,descripcion:"Fosa séptica prefabricada 3.000 L",unidadSalida:"u",metrados:1,apuIds:["apu_fosa_septica_3000l_u"]},{id:`user_${f}_${c}_3`,descripcion:"Relleno y compactación alrededor de fosa",unidadSalida:"m3",metrados:A,apuIds:["apu_relleno_compact_manual"]},{id:`user_${f}_${c}_4`,descripcion:"Cámara de inspección",unidadSalida:"u",metrados:1,apuIds:["apu_camara_inspeccion_elevador_u"]},{id:`user_${f}_${c}_5`,descripcion:"Losa de hormigón para tapa de fosa",unidadSalida:"m2",metrados:3,apuIds:["apu_radier_h25_10cm_malla_polietileno"]},{id:`user_${f}_${c}_6`,descripcion:"Conexiones y tuberías sanitarias hacia fosa",unidadSalida:"gl",metrados:1,apuIds:["apu_inst_sanit_gas_lote"]}],Q=localStorage.getItem(d);if(Q){try{const J=JSON.parse(Q||"null"),Ce=J&&J.userSubRows&&Array.isArray(J.userSubRows[f])?J.userSubRows[f]:[];if(!Ce||Ce.length===0){const ve={...J,userSubRows:{...J.userSubRows||{},[f]:z},rowDescOverrides:{...J.rowDescOverrides||{},[f]:"Fosa séptica"},savedAt:c};localStorage.setItem(d,JSON.stringify(ve));const ue="calculator-saves-index-v1",Ge=(()=>{try{return JSON.parse(localStorage.getItem(ue)||"[]")||[]}catch{return[]}})(),Ue=Array.isArray(Ge)?Ge.filter(ae=>ae&&ae.name!==l):[];Ue.unshift({name:l,savedAt:c}),localStorage.setItem(ue,JSON.stringify(Ue.slice(0,30)))}}catch{}return}const B={v:1,name:l,savedAt:c,metros:g,calidad:m,techo:x,piso:S,includeIvaInM2:h,rowDescOverrides:{calc_manual:"Fosa séptica"},subOverrides:{},userSubRows:{[f]:z},hiddenSubIds:{},gg:p,util:_,iva:j};localStorage.setItem(d,JSON.stringify(B));try{const J="calculator-saves-index-v1",Ce=(()=>{try{return JSON.parse(localStorage.getItem(J)||"[]")||[]}catch{return[]}})(),ve=Array.isArray(Ce)?Ce.filter(ue=>ue&&ue.name!==l):[];ve.unshift({name:l,savedAt:c}),localStorage.setItem(J,JSON.stringify(ve.slice(0,30)))}catch{}}catch{}},[p,_,j]);q.useEffect(()=>{try{const l="calc-switch-to-calculadora-once";localStorage.getItem(l)||(ie(),i("calculadora"),localStorage.setItem(l,"done"))}catch{}},[ie]);const[Y,Z]=wa("apu-library",[]),M=q.useMemo(()=>Array.isArray(Y)?Y:[],[Y]),K=V.useCallback(l=>{const c=(Array.isArray(l)?l:[]).map((f,g)=>{const m=(f==null?void 0:f.codigo)||`01-${String(g+1).padStart(3,"0")}`;return{...f,codigo:m}});Z(c);try{localStorage.setItem("apu-library",JSON.stringify(c))}catch{}},[Z]),C=V.useCallback(l=>{const d=yn(),c=String(l||""),f=d[c]||c,g=(M||[]).find(x=>String((x==null?void 0:x.id)||"")===f);if(g)return g;const m=($s||[]).find(x=>String((x==null?void 0:x.id)||"")===f);if(m)return m;throw new Error("APU no encontrado")},[M]);V.useCallback(()=>{try{const l=Array.isArray(M)?M:[],d=l.filter(f=>String((f==null?void 0:f.descripcion)||"").toLowerCase().includes("subpartida"));if(d.length===0){t('No hay APUs con "subpartida"',"info");return}if(!confirm(`¿Eliminar ${d.length} APU(s) cuya descripción contiene "subpartida"? Esta acción no se puede deshacer.`))return;const c=l.filter(f=>!String((f==null?void 0:f.descripcion)||"").toLowerCase().includes("subpartida"));K(c),t(`Eliminados ${d.length} APUs con "subpartida"`,"success")}catch{t("Error al eliminar APUs","error")}},[M,K,t]),V.useCallback(()=>{try{const l=Array.isArray(M)?M:[],d=to(l,{threshold:.44,sameUnit:!0});if(!d.length){t("No se detectaron grupos de duplicados","info");return}const c=d.reduce((x,S)=>x+Math.max(0,S.ids.length-1),0);if(!confirm(`Se encontraron ${d.length} grupo(s) con ${c} duplicado(s) potencial(es). ¿Eliminar duplicados manteniendo 1 por grupo?`))return;const f=yn(),g=new Set;for(const x of d){const S=x.ids[0];for(let h=1;h<x.ids.length;h++){const A=x.ids[h];g.add(A),f[A]=S}}Ds(f);const m=l.filter(x=>!g.has(x.id));K(m),t(`Eliminados ${g.size} APUs duplicados (se actualizaron alias)`,"success")}catch{t("Error al eliminar duplicados","error")}},[M,K,t]);const[U,R]=wa("apu-projects",[]),H=V.useCallback(l=>Array.isArray(l)?l:l&&Array.isArray(l.items)?l.items:[],[]),X=V.useCallback(l=>{const d=Array.isArray(l)?l:[];R(d);try{localStorage.setItem("apu-projects",JSON.stringify(d))}catch{}},[R]);q.useEffect(()=>{const l=d=>{d.key==="calculator-inject"&&d.newValue&&i("calculadora")};return window.addEventListener("storage",l),()=>window.removeEventListener("storage",l)},[]),q.useEffect(()=>{var l;try{const d="apu-dup-cleanup-run";if(localStorage.getItem(d)==="done")return;const c=Array.isArray(M)?M:[];if(!c.length){localStorage.setItem(d,"done");return}const f=to(c,{threshold:.44,sameUnit:!0})||[];if(!f.length){localStorage.setItem(d,"done");return}const g=yn(),m=new Set;for(const S of f){if(!((l=S==null?void 0:S.ids)!=null&&l.length))continue;const h=S.ids[0];for(let A=1;A<S.ids.length;A++){const G=S.ids[A];m.add(G),g[G]=h}}Ds(g);const x=c.filter(S=>!m.has(S.id));x.length!==c.length&&(K(x),t(`Fusión completa: ${c.length-x.length} duplicado(s) removido(s)`,"success")),localStorage.setItem(d,"done")}catch{}},[]);const ne=()=>{try{return JSON.parse(localStorage.getItem("apu-project")||"{}")}catch{return{}}},[T,de]=q.useState(ne);q.useEffect(()=>{try{localStorage.setItem("apu-project",JSON.stringify(T||{}))}catch{}},[T]);const[ee,ge]=wa("apu-projects-list",[]),[fe,Fe]=wa("apu-active-project-id",null),te=q.useMemo(()=>(ee||[]).find(l=>String((l==null?void 0:l.id)||"")===String(fe||""))||null,[ee,fe]),_t=q.useMemo(()=>Array.isArray(ee)?ee:[],[ee]),wt=()=>{try{return JSON.parse(localStorage.getItem("apu-users")||"[]")||[]}catch{return[]}},[lt,gt]=q.useState(wt);q.useEffect(()=>{try{localStorage.setItem("apu-users",JSON.stringify(lt||[]))}catch{}},[lt]);const[jt,ca]=wa("apu-active-user-email",null),Se=q.useMemo(()=>(lt||[]).find(l=>String((l==null?void 0:l.email)||"")===String(jt||""))||null,[lt,jt]),we=l=>{try{const d=String((l==null?void 0:l.email)||"").trim();if(!d){t("Email es obligatorio","error");return}gt((c=[])=>{const f=c.findIndex(m=>String((m==null?void 0:m.email)||"")===d),g={nombre:"",telefono:"",password:"",ciudad:"",tipo:"admin",profesion:"",...l};if(f>=0){const m=[...c];return m[f]={...c[f],...g},m}return[...c,g]}),ca(d),t("Usuario guardado","success")}catch{t("Error al guardar el usuario","error")}},[Un,va]=q.useState(!1),[Da,Dn]=q.useState(null),[mr,da]=q.useState(!1),pn=V.useCallback(()=>{try{const l=fe;if(!l||l==="inline"||!confirm("¿Eliminar el proyecto seleccionado del listado?"))return;ge((d=[])=>d.filter(c=>String((c==null?void 0:c.id)||"")!==String(l))),fe===l&&Fe(null),t("Proyecto eliminado del listado","info")}catch{}},[fe,Fe,ge,t]),is=V.useCallback(()=>{try{const l=jt;if(!l||!confirm("¿Eliminar el usuario seleccionado?"))return;gt((d=[])=>d.filter(c=>String((c==null?void 0:c.email)||"")!==String(l))),ca(null),t("Usuario eliminado","info")}catch{}},[jt,gt,ca,t]),[ua,It]=q.useState(!1),[fr,$n]=q.useState(null),hr=()=>{$n(null),It(!0)},Ho=()=>{if(!Se){t("Selecciona un usuario para editar","info");return}$n(Se),It(!0)},Wo=()=>({id:"apu_tablero_electrico_monofasico_u",descripcion:"Tablero eléctrico monofásico 12 polos",unidadSalida:"u",categoria:"Eléctrica",codigoExterno:"",secciones:{materiales:[{descripcion:"Tablero 12/24 polos",unidad:"u",cantidad:1,pu:45e3},{descripcion:"Protecciones y riel",unidad:"u",cantidad:1,pu:35e3},{descripcion:"Caja y accesorios",unidad:"u",cantidad:1,pu:15e3}],manoObra:[{descripcion:"Montaje y conexionado",unidad:"u",cantidad:1,pu:3e4}],equipos:[],varios:[]}}),Qo=()=>({id:"apu_toma_interruptor_u",descripcion:"Toma o interruptor (unidad)",unidadSalida:"u",categoria:"Eléctrica",codigoExterno:"",secciones:{materiales:[{descripcion:"Placa + mecanismo",unidad:"u",cantidad:1,pu:5500}],manoObra:[{descripcion:"Instalación punto",unidad:"u",cantidad:1,pu:3500}],equipos:[],varios:[]}}),ss=()=>({id:"apu_mov_tierras_excavacion_lote",descripcion:"Movimiento de Tierras y Excavación (preparación de terreno)",unidadSalida:"lote",categoria:"Movimiento de tierras",codigoExterno:"",secciones:{materiales:[{descripcion:"Movimiento de tierra (nivelación y excavación para fundaciones)",unidad:"lote",cantidad:1,pu:15e4},{descripcion:"Material de relleno y compactación (arena, grava)",unidad:"m3",cantidad:5,pu:25e3}],manoObra:[],equipos:[],varios:[]}}),ri=()=>({id:"apu_h25_obra",descripcion:"Hormigón H-25 hecho en obra",unidadSalida:"m3",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Materiales (cemento, áridos, aditivo)",unidad:"m3",cantidad:1,pu:109462}],manoObra:[{descripcion:"Mano de obra",unidad:"m3",cantidad:1,pu:15456}],equipos:[{descripcion:"Betonera",unidad:"m3",cantidad:1,pu:5e3}],varios:[]}}),$a=()=>({id:"apu_moldaje_terciado_m2",descripcion:"Moldaje con terciado 18 mm (doble cara)",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Encofrado terciado 18 mm amort. (5 usos)",unidad:"m2",cantidad:1,pu:2956},{descripcion:"Listones/amarres/clavos",unidad:"m2",cantidad:1,pu:2439},{descripcion:"Desmoldante",unidad:"m2",cantidad:1,pu:280}],manoObra:[{descripcion:"Mano de obra",unidad:"m2",cantidad:1,pu:4802}],equipos:[],varios:[]}}),gr=()=>({id:"apu_h20_obra_vibrado_m3",descripcion:"Hormigón H-20 hecho en obra + vibrado",unidadSalida:"m3",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Materiales (c/5% mermas)",unidad:"m3",cantidad:1,pu:101e3}],manoObra:[{descripcion:"Mano de obra",unidad:"m3",cantidad:1,pu:15e3}],equipos:[{descripcion:"Betonera + vibrador",unidad:"m3",cantidad:1,pu:6e3}],varios:[]}}),xr=()=>({id:"apu_material_ladrillo_fiscal_u",descripcion:"Ladrillo fiscal 29×14×8 (unidad)",unidadSalida:"u",categoria:"Materiales",codigoExterno:"",secciones:{materiales:[{descripcion:"Ladrillo fiscal",unidad:"u",cantidad:1,pu:390}],manoObra:[],equipos:[],varios:[]}}),os=()=>({id:"apu_cubierta_teja_fibrocemento_m2",descripcion:"Cubierta teja de fibrocemento sobre OSB + fieltro",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Revestimiento teja fibrocemento",unidad:"m2",cantidad:1,pu:9800},{descripcion:"Fieltro asfáltico",unidad:"m2",cantidad:1,pu:1200},{descripcion:"Tablero OSB 11 mm (prorrateo)",unidad:"m2",cantidad:1,pu:3500},{descripcion:"Clavos/fijaciones",unidad:"m2",cantidad:1,pu:600}],manoObra:[{descripcion:"Instalación cubierta",unidad:"m2",cantidad:1,pu:3500}],equipos:[],varios:[]}}),Ba=()=>({id:"apu_ventana_pvc_100x100_instalada",descripcion:"Ventana PVC 100×100 mm instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Ventana PVC 100×100 termopanel",unidad:"u",cantidad:1,pu:15e4},{descripcion:"Sellos y fijaciones",unidad:"u",cantidad:1,pu:5e3}],manoObra:[{descripcion:"Instalación ventana",unidad:"u",cantidad:1,pu:18e3}],equipos:[],varios:[]}}),ii=()=>({id:"apu_kit_bano_economico_set",descripcion:"Kit baño económico (WC + lavamanos + grifería)",unidadSalida:"set",categoria:"Sanitarios",codigoExterno:"",secciones:{materiales:[{descripcion:"WC completo",unidad:"set",cantidad:1,pu:85e3},{descripcion:"Lavamanos + pedestal",unidad:"set",cantidad:1,pu:6e4},{descripcion:"Grifería básica",unidad:"set",cantidad:1,pu:35e3}],manoObra:[{descripcion:"Instalación artefactos",unidad:"set",cantidad:1,pu:45e3}],equipos:[],varios:[]}}),mn=()=>({id:"apu_kit_cocina_economico_set",descripcion:"Kit cocina económico (lavaplatos + grifería + accesorios)",unidadSalida:"set",categoria:"Sanitarios",codigoExterno:"",secciones:{materiales:[{descripcion:"Lavaplatos simple",unidad:"set",cantidad:1,pu:45e3},{descripcion:"Grifería cocina",unidad:"set",cantidad:1,pu:3e4},{descripcion:"Accesorios e insumos",unidad:"set",cantidad:1,pu:15e3}],manoObra:[{descripcion:"Instalación kit cocina",unidad:"set",cantidad:1,pu:35e3}],equipos:[],varios:[]}}),_r=()=>({id:"apu_fundaciones_estructura_m2",descripcion:"Fundaciones y estructura (hormigón + acero + encofrado)",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Hormigón H-20 (prorrateo)",unidad:"m2",cantidad:1,pu:32e3},{descripcion:"Acero de refuerzo (prorrateo)",unidad:"m2",cantidad:1,pu:18e3},{descripcion:"Madera encofrado + misceláneos",unidad:"m2",cantidad:1,pu:8e3}],manoObra:[{descripcion:"Cuadrilla hormigonado",unidad:"m2",cantidad:1,pu:5150}],equipos:[],varios:[]}}),Bn=()=>({id:"apu_albanileria_muro_m2",descripcion:"Albañilería de muros (ladrillo fiscal + mortero)",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Ladrillo fiscal + mortero (prorr.)",unidad:"m2",cantidad:1,pu:9e3}],manoObra:[{descripcion:"Colocación ladrillo",unidad:"m2",cantidad:1,pu:6783}],equipos:[],varios:[{descripcion:"Misceláneos y herramientas",unidad:"m2",cantidad:1,pu:0}]}}),fn=()=>({id:"apu_techumbre_teja_fibro_m2",descripcion:"Techumbre madera + fieltro + OSB + teja fibrocemento",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Estructura cerchas y listones (prorr.)",unidad:"m2",cantidad:1,pu:15e3},{descripcion:"Fieltro asfáltico",unidad:"m2",cantidad:1,pu:1200},{descripcion:"OSB 11 mm (prorr.)",unidad:"m2",cantidad:1,pu:3500},{descripcion:"Teja de fibrocemento + fijaciones",unidad:"m2",cantidad:1,pu:12500}],manoObra:[{descripcion:"Instalación techumbre",unidad:"m2",cantidad:1,pu:885}],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"m2",cantidad:1,pu:1980}]}}),qn=()=>({id:"apu_terminaciones_interiores_m2",descripcion:"Terminaciones interiores base (pinturas, pisos, cielos)",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Pinturas + insumos (prorr.)",unidad:"m2",cantidad:1,pu:6e3},{descripcion:"Pisos y adhesivos (prorr.)",unidad:"m2",cantidad:1,pu:12e3},{descripcion:"Cielos y perfilería (prorr.)",unidad:"m2",cantidad:1,pu:3600}],manoObra:[{descripcion:"Instalación/terminaciones",unidad:"m2",cantidad:1,pu:2386}],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"m2",cantidad:1,pu:0}]}}),ls=()=>({id:"apu_carpinteria_ventanas_lote",descripcion:"Carpintería y ventanas (puertas, ventanas, herrajes)",unidadSalida:"lote",categoria:"Carpintería",codigoExterno:"",secciones:{materiales:[{descripcion:"Puerta principal madera maciza",unidad:"u",cantidad:1,pu:149990},{descripcion:"Puertas interiores honeycomb",unidad:"u",cantidad:3,pu:44990},{descripcion:"Ventanas PVC línea económica",unidad:"u",cantidad:6,pu:8e4},{descripcion:"Herrajes y accesorios",unidad:"lote",cantidad:1,pu:15e4}],manoObra:[],equipos:[],varios:[{descripcion:"Ajustes y sellos",unidad:"lote",cantidad:1,pu:6e4}]}}),Rt=()=>({id:"apu_inst_sanit_gas_lote",descripcion:"Instalaciones sanitarias y gas (tuberías + kits)",unidadSalida:"lote",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"PVC desagüe (lote)",unidad:"lote",cantidad:1,pu:18e4},{descripcion:"PPR agua caliente/fría (lote)",unidad:"lote",cantidad:1,pu:22e4},{descripcion:"Kit baño económico",unidad:"set",cantidad:1,pu:299990},{descripcion:"Kit cocina económico",unidad:"set",cantidad:1,pu:149990},{descripcion:"Cañería gas y regulador",unidad:"lote",cantidad:1,pu:12e4}],manoObra:[],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"lote",cantidad:1,pu:0}]}}),Gt=()=>({id:"apu_inst_electricas_lote",descripcion:"Instalaciones eléctricas (cableado, tablero, puntos)",unidadSalida:"lote",categoria:"Instalaciones eléctricas",codigoExterno:"",secciones:{materiales:[{descripcion:"Cableado (THWN/LSZH)",unidad:"lote",cantidad:1,pu:25e4},{descripcion:"Tablero y protecciones",unidad:"u",cantidad:1,pu:8e4},{descripcion:"Cajas/tomas/interruptores",unidad:"u",cantidad:20,pu:2990},{descripcion:"Tubos y canaletas",unidad:"lote",cantidad:1,pu:7e4}],manoObra:[],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"lote",cantidad:1,pu:0}]}}),Ya=()=>({id:"apu_mov_tierra_lote",descripcion:"Movimiento de tierra (lote)",unidadSalida:"lote",categoria:"Movimiento de tierras",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Lote estimado movimiento/ajustes",unidad:"lote",cantidad:1,pu:15e4}]}}),vr=()=>({id:"apu_clavos_alambre_lote",descripcion:"Clavos y alambre (lote)",unidadSalida:"lote",categoria:"Materiales",codigoExterno:"",secciones:{materiales:[{descripcion:"Clavos + alambre (paquete)",unidad:"lote",cantidad:1,pu:45e3}],manoObra:[],equipos:[],varios:[]}}),Vn=()=>({id:"apu_mortero_pega_lote",descripcion:"Mortero de pega (lote)",unidadSalida:"lote",categoria:"Materiales",codigoExterno:"",secciones:{materiales:[{descripcion:"Sacos mortero de pega",unidad:"lote",cantidad:1,pu:12e4}],manoObra:[],equipos:[],varios:[]}}),si=()=>({id:"apu_fijaciones_techo_lote",descripcion:"Clavos y fijaciones para techumbre (lote)",unidadSalida:"lote",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Fijaciones techo (tornillos, clavos, sellos)",unidad:"lote",cantidad:1,pu:8e4}],manoObra:[],equipos:[],varios:[]}}),hn=()=>({id:"apu_herrajes_carpinteria_lote",descripcion:"Herrajes de carpintería (lote)",unidadSalida:"lote",categoria:"Carpintería",codigoExterno:"",secciones:{materiales:[{descripcion:"Herrajes (bisagras, chapas, tiradores)",unidad:"lote",cantidad:1,pu:15e4}],manoObra:[],equipos:[],varios:[]}}),Go=()=>({id:"apu_herrajes_bisagras_picaportes_cerraduras_lote",descripcion:"Herrajes (bisagras, picaportes, cerraduras) — lote (1 ext + 3 int)",unidadSalida:"lote",categoria:"Carpintería",codigoExterno:"",secciones:{materiales:[{descripcion:"Bisagras reforzadas",unidad:"u",cantidad:12,pu:2990},{descripcion:"Picaportes interiores",unidad:"u",cantidad:3,pu:9990},{descripcion:"Cerradura exterior",unidad:"u",cantidad:1,pu:24990},{descripcion:"Cilindros/contrachapas y topes (lote)",unidad:"lote",cantidad:1,pu:19990},{descripcion:"Tornillería y placas (lote)",unidad:"lote",cantidad:1,pu:9990}],manoObra:[],equipos:[],varios:[{descripcion:"Ajustes y misceláneos",unidad:"lote",cantidad:1,pu:15e3}]}}),k=()=>({id:"apu_tuberias_pvc_desague_lote",descripcion:"Tuberías PVC desagüe (lote)",unidadSalida:"lote",categoria:"Sanitarios",codigoExterno:"",secciones:{materiales:[{descripcion:"Tuberías y fittings PVC sanitaria",unidad:"lote",cantidad:1,pu:18e4}],manoObra:[],equipos:[],varios:[]}}),P=()=>({id:"apu_tuberias_ppr_agua_lote",descripcion:"Tuberías PPR agua (lote)",unidadSalida:"lote",categoria:"Sanitarios",codigoExterno:"",secciones:{materiales:[{descripcion:"Tuberías y fittings PPR",unidad:"lote",cantidad:1,pu:22e4}],manoObra:[],equipos:[],varios:[]}}),w=()=>({id:"apu_caneria_gas_lote",descripcion:"Cañería de gas (lote)",unidadSalida:"lote",categoria:"Gas",codigoExterno:"",secciones:{materiales:[{descripcion:"Tuberías, fittings y kit gas",unidad:"lote",cantidad:1,pu:12e4}],manoObra:[],equipos:[],varios:[]}}),I=()=>({id:"apu_cables_electricos_lote",descripcion:"Cables eléctricos (lote)",unidadSalida:"lote",categoria:"Eléctrica",codigoExterno:"",secciones:{materiales:[{descripcion:"Rollos de cable THHN/LSZH",unidad:"lote",cantidad:1,pu:25e4}],manoObra:[],equipos:[],varios:[]}}),$=()=>({id:"apu_tubos_canaletas_lote",descripcion:"Tubos/canaletas (lote)",unidadSalida:"lote",categoria:"Eléctrica",codigoExterno:"",secciones:{materiales:[{descripcion:"Tubería PVC conduit y canaletas",unidad:"lote",cantidad:1,pu:7e4}],manoObra:[],equipos:[],varios:[]}}),W=()=>({id:"apu_mo_30_materiales_nota",descripcion:"Mano de obra 30% del valor materiales (nota)",unidadSalida:"lote",categoria:"Notas",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Ajustar manualmente 30% de materiales",unidad:"lote",cantidad:1,pu:0}]}}),ce=()=>({id:"apu_gg_imprev_10_nota",descripcion:"Gastos generales e imprevistos 10% (nota)",unidadSalida:"lote",categoria:"Notas",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Se aplica con parámetros financieros",unidad:"lote",cantidad:1,pu:0}]}});q.useEffect(()=>{try{if(Array.isArray(M)&&M.length===0){const l=[];try{l.push(ri())}catch{}try{l.push($a())}catch{}try{l.push(ss())}catch{}try{l.push(_r())}catch{}try{l.push(Bn())}catch{}try{l.push(fn())}catch{}try{l.push(qn())}catch{}try{l.push(ls())}catch{}try{l.push(Rt())}catch{}try{l.push(Gt())}catch{}try{l.push(ye())}catch{}try{l.push(Oe())}catch{}try{l.push(Pe())}catch{}try{l.push(Me())}catch{}try{l.push(tt())}catch{}try{l.push(Lt())}catch{}l.length>0&&K(l)}}catch{}},[M,K]),q.useEffect(()=>{try{const l=[{id:"apu_mov_tierras_excavacion_lote",build:ss},{id:"apu_fundaciones_estructura_m2",build:_r},{id:"apu_albanileria_muro_m2",build:Bn},{id:"apu_techumbre_teja_fibro_m2",build:fn},{id:"apu_terminaciones_interiores_m2",build:qn},{id:"apu_carpinteria_ventanas_lote",build:ls},{id:"apu_inst_sanit_gas_lote",build:Rt},{id:"apu_inst_electricas_lote",build:Gt},{id:"apu_dren_infiltracion_m",build:ye},{id:"apu_tuberia_pvc_110_m",build:Oe},{id:"apu_fosa_septica_3000l_u",build:Pe},{id:"apu_camara_inspeccion_elevador_u",build:Me},{id:"apu_camara_desgrasadora_100l_u",build:tt},{id:"apu_camara_distribuidora_100l_u",build:Lt},{id:"apu_clavos_alambre_lote",build:vr},{id:"apu_mortero_pega_lote",build:Vn},{id:"apu_fijaciones_techo_lote",build:si},{id:"apu_material_ladrillo_fiscal_u",build:xr},{id:"apu_acond_termico_cielo_lana100",build:Xo},{id:"apu_acond_termico_muros_lana100_bv",build:Dd},{id:"apu_ventana_pvc_100x100_instalada",build:Ba},{id:"apu_puerta_exterior_acero_90x200_instalada",build:Zo},{id:"apu_puerta_exterior_madera_90x200_instalada",build:h0},{id:"apu_herrajes_bisagras_picaportes_cerraduras_lote",build:Go},{id:"apu_kit_bano_economico_set",build:ii},{id:"apu_kit_cocina_economico_set",build:mn}],d=new Set((M||[]).map(f=>String((f==null?void 0:f.id)||""))),c=l.filter(f=>!d.has(f.id)).map(f=>f.build());c.length>0&&K([...M||[],...c])}catch{}},[M,K]),q.useEffect(()=>{try{const l={apu_mov_tierra_lote:Ya,apu_clavos_alambre_lote:vr,apu_mortero_pega_lote:Vn,apu_fijaciones_techo_lote:si,apu_herrajes_carpinteria_lote:hn,apu_tuberias_pvc_desague_lote:k,apu_tuberias_ppr_agua_lote:P,apu_caneria_gas_lote:w,apu_cables_electricos_lote:I,apu_tubos_canaletas_lote:$},d=g=>Array.isArray(g)?g:[];let c=!1;const f=(M||[]).map(g=>{const m=l[g==null?void 0:g.id];if(!m)return g;const x=(g==null?void 0:g.secciones)||{};if(![...d(x.materiales),...d(x.manoObra),...d(x.equipos),...d(x.varios)].some(A=>Number((A==null?void 0:A.pu)||0)>0)){const A=m();return c=!0,{...g,secciones:JSON.parse(JSON.stringify(A.secciones||{}))}}return g});c&&K(f)}catch{}},[M,K]);const je=()=>{const l=Number(2.020689655172414.toFixed(3)),d=18e3,c=9e3,f=d-c,g=Math.round(d*.05);return{id:"apu_muro_ladrillo_m2",descripcion:"Muro de ladrillo fiscal 29×14×8",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Ladrillo fiscal 29×14×8",unidad:"u",cantidad:36.75,pu:390},{descripcion:"Mortero de pega 25 kg (14,5 L/saco)",unidad:"saco",cantidad:l,pu:2650}],manoObra:[{descripcion:"Maestro (1+1; rend. 5 m²/jrn)",unidad:"m2",cantidad:1,pu:c},{descripcion:"Ayudante (1+1; rend. 5 m²/jrn)",unidad:"m2",cantidad:1,pu:f}],equipos:[],varios:[{descripcion:"Herramientas menores (5% de MO)",unidad:"m2",cantidad:1,pu:g}]}}},le=()=>({id:"apu_tabique_metalcon_90_doble_placa",descripcion:"Tabique Metalcon 90 mm, doble placa 12,5 mm + lana 50 mm",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Montante C90 (2,7 m/m²)",unidad:"m2",cantidad:1,pu:4585},{descripcion:"Solera U92 (0,8 m/m²)",unidad:"m2",cantidad:1,pu:1165},{descripcion:"Yeso-cartón 12,5 mm (doble cara)",unidad:"m2",cantidad:1,pu:7738},{descripcion:"Lana 50 mm",unidad:"m2",cantidad:1,pu:1874},{descripcion:"Tornillos yeso-cartón (18 u/m²)",unidad:"m2",cantidad:1,pu:212},{descripcion:"Cinta juntas (1,5 m/m²)",unidad:"m2",cantidad:1,pu:153},{descripcion:"Masilla juntas 5 kg (0,6 kg/m²)",unidad:"m2",cantidad:1,pu:899}],manoObra:[{descripcion:"Maestro (10 m²/jornal)",unidad:"m2",cantidad:1,pu:4500},{descripcion:"Ayudante (10 m²/jornal)",unidad:"m2",cantidad:1,pu:4500}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:450}]}}),Qe=()=>({id:"apu_cielo_yeso_carton_12_5_sobre_perf",descripcion:"Cielo raso yeso-cartón 12,5 mm sobre perfilería existente",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Yeso-cartón 12,5 mm",unidad:"m2",cantidad:1,pu:3867},{descripcion:"Tornillos drywall (18 u/m²)",unidad:"m2",cantidad:1,pu:212},{descripcion:"Cinta juntas",unidad:"m2",cantidad:1,pu:153},{descripcion:"Masilla juntas 5 kg (0,6 kg/m²)",unidad:"m2",cantidad:1,pu:899}],manoObra:[{descripcion:"Maestro (12 m²/jornal)",unidad:"m2",cantidad:1,pu:3750},{descripcion:"Ayudante (12 m²/jornal)",unidad:"m2",cantidad:1,pu:3750}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:375}]}}),ye=()=>{const l=Math.round(2331.7),d=1560,c=4275,f=l+d+c,g=Math.round(f*.03),m=Math.round(2421.9);return{id:"apu_dren_infiltracion_m",descripcion:"Dren de infiltración 0,50×0,80 m",unidadSalida:"m",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Tubo dren Ø110 (6 m = 13.990 ⇒ 2.332 CLP/m)",unidad:"m",cantidad:1,pu:l},{descripcion:"Geotextil (1,3 m²/m × 1.200)",unidad:"m",cantidad:1,pu:d},{descripcion:"Gravilla ¾” (0,15 m³/m × 28.500)",unidad:"m",cantidad:1,pu:c}],manoObra:[{descripcion:"Cuadrilla (2 maestros + 1 ayudante; 64 m/jornada)",unidad:"m",cantidad:1,pu:m}],equipos:[{descripcion:"Miniexcavadora (0,06 h/m × 20.000 CLP/h)",unidad:"m",cantidad:1,pu:1200}],varios:[{descripcion:"Misceláneos (3% materiales)",unidad:"m",cantidad:1,pu:g}],__meta:{obs:"Alcance: Excavación mecánica, cama y recubrimiento con gravilla, tubo dren Ø110 corrugado, envolvente geotextil, relleno y compactación. Ref: GLOBALPLAST CHILE"}}}},Oe=()=>{const l=Math.round(2331.7),d=600,c=100,f=945,g=l+d+c+f,m=Math.round(g*.03),x=Math.round(2421.9);return{id:"apu_tuberia_pvc_110_m",descripcion:"Tubería PVC Ø110 sanitaria enterrada",unidadSalida:"m",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Tubo PVC Ø110 (6 m = 13.990 ⇒ 2.332 CLP/m)",unidad:"m",cantidad:1,pu:l},{descripcion:"Fittings prorrateo (codos/tees)",unidad:"m",cantidad:1,pu:d},{descripcion:"Adhesivo PVC 240 cc (prorrateo)",unidad:"m",cantidad:1,pu:c},{descripcion:"Cama de arena (0,03 m³/m × 31.500)",unidad:"m",cantidad:1,pu:f}],manoObra:[{descripcion:"Cuadrilla (2 maestros + 1 ayudante; 64 m/jornada)",unidad:"m",cantidad:1,pu:x}],equipos:[{descripcion:"Miniexcavadora (0,03 h/m × 20.000 CLP/h)",unidad:"m",cantidad:1,pu:600}],varios:[{descripcion:"Misceláneos (3% materiales)",unidad:"m",cantidad:1,pu:m}],__meta:{obs:"Alcance: Zanja, cama de arena, tendido PVC Ø110, uniones, relleno y compactación."}}}},Pe=()=>({id:"apu_fosa_septica_3000l_u",descripcion:"Fosa séptica 3.000 L instalada",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Fosa 3.000 L Bioplastic",unidad:"u",cantidad:1,pu:489990},{descripcion:"Arena de asiento (2,0 m³ × 31.500)",unidad:"u",cantidad:1,pu:63e3},{descripcion:"Kit 4 sellos Ø110",unidad:"u",cantidad:1,pu:18990}],manoObra:[{descripcion:"Cuadrilla (0,5 jornada)",unidad:"u",cantidad:1,pu:77500}],equipos:[{descripcion:"Equipo (2 h × 20.000 CLP/h)",unidad:"u",cantidad:1,pu:4e4}],varios:[{descripcion:"Misceláneos (3% materiales)",unidad:"u",cantidad:1,pu:17159}],__meta:{obs:"Alcance: Excavación mecánica, cama de arena, colocación, conexiones Ø110, relleno, prueba hidráulica."}}}),Me=()=>({id:"apu_camara_inspeccion_elevador_u",descripcion:"Cámara de inspección + elevador",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Cámara",unidad:"u",cantidad:1,pu:70990},{descripcion:"Elevador",unidad:"u",cantidad:1,pu:39990},{descripcion:"Adhesivos",unidad:"u",cantidad:1,pu:1e3}],manoObra:[{descripcion:"Cuadrilla (0,25 jornada)",unidad:"u",cantidad:1,pu:38750}],equipos:[{descripcion:"Equipo (0,25 h × 20.000)",unidad:"u",cantidad:1,pu:5e3}],varios:[{descripcion:"Misceláneos (3% materiales)",unidad:"u",cantidad:1,pu:3359}]}}),tt=()=>({id:"apu_camara_desgrasadora_100l_u",descripcion:"Cámara desgrasadora 100 L",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Cámara 100 L",unidad:"u",cantidad:1,pu:46390},{descripcion:"Adhesivos",unidad:"u",cantidad:1,pu:500}],manoObra:[{descripcion:"Cuadrilla (0,25 jornada)",unidad:"u",cantidad:1,pu:38750}],equipos:[{descripcion:"Equipo (0,25 h × 20.000)",unidad:"u",cantidad:1,pu:5e3}],varios:[{descripcion:"Misceláneos (3% materiales)",unidad:"u",cantidad:1,pu:1407}]}}),Lt=()=>({id:"apu_camara_distribuidora_100l_u",descripcion:"Cámara distribuidora 100 L",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Cámara 100 L",unidad:"u",cantidad:1,pu:41290},{descripcion:"Adhesivos",unidad:"u",cantidad:1,pu:500}],manoObra:[{descripcion:"Cuadrilla (0,25 jornada)",unidad:"u",cantidad:1,pu:38750}],equipos:[{descripcion:"Equipo (0,25 h × 20.000)",unidad:"u",cantidad:1,pu:5e3}],varios:[{descripcion:"Misceláneos (3% materiales)",unidad:"u",cantidad:1,pu:1254}]}}),qa=()=>({id:"apu_exc_zanja_manual",descripcion:"Excavación de zanja manual",unidadSalida:"m3",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[],manoObra:[{descripcion:"Maestro (5 m³/jornal)",unidad:"m3",cantidad:1,pu:9e3},{descripcion:"Ayudante (5 m³/jornal)",unidad:"m3",cantidad:1,pu:9e3}],equipos:[],varios:[{descripcion:"Herramientas menores (5% de MO)",unidad:"m3",cantidad:1,pu:900}]}}),oe=()=>({id:"apu_relleno_compact_manual",descripcion:"Relleno y compactación manual",unidadSalida:"m3",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Agua",unidad:"m3",cantidad:1,pu:200}],manoObra:[{descripcion:"Maestro (8 m³/jornal)",unidad:"m3",cantidad:1,pu:5625},{descripcion:"Ayudante (8 m³/jornal)",unidad:"m3",cantidad:1,pu:5625}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m3",cantidad:1,pu:560}]}}),Ve=()=>({id:"apu_hormigon_zapata_corrida_ml",descripcion:"Hormigón en zapata corrida 0,40×0,20 (en zanja)",unidadSalida:"ml",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Hormigón preparado 25 kg (7 sacos/ml)",unidad:"ml",cantidad:1,pu:22680},{descripcion:"Acero A630 Ø10 (4 m/ml)",unidad:"ml",cantidad:1,pu:4590},{descripcion:"Estribos Ø6 c/20 cm (estim.)",unidad:"ml",cantidad:1,pu:2500},{descripcion:"Alambre recocido 0,05 kg/ml",unidad:"ml",cantidad:1,pu:185}],manoObra:[{descripcion:"Maestro (8 ml/jornal)",unidad:"ml",cantidad:1,pu:5625},{descripcion:"Ayudante (8 ml/jornal)",unidad:"ml",cantidad:1,pu:5625}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"ml",cantidad:1,pu:560}]}}),Xe=()=>({id:"apu_radier_h25_10cm_malla_polietileno",descripcion:"Radier H-25 10 cm con malla y polietileno",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Cemento 25 kg (1,4 sacos/m²)",unidad:"m2",cantidad:1,pu:6706},{descripcion:"Arena 25 kg (2 sacos/m²)",unidad:"m2",cantidad:1,pu:1880},{descripcion:"Gravilla 25 kg (3 sacos/m²)",unidad:"m2",cantidad:1,pu:2670},{descripcion:"Malla ACMA C-92",unidad:"m2",cantidad:1,pu:1769},{descripcion:"Polietileno 4×10 m",unidad:"m2",cantidad:1,pu:375},{descripcion:"Alambre recocido",unidad:"m2",cantidad:1,pu:185}],manoObra:[{descripcion:"Maestro (12 m²/jornal)",unidad:"m2",cantidad:1,pu:3575},{descripcion:"Ayudante (12 m²/jornal)",unidad:"m2",cantidad:1,pu:3575}],equipos:[],varios:[{descripcion:"Herramientas menores y misceláneos",unidad:"m2",cantidad:1,pu:315}]}}),Et=()=>({id:"apu_albanileria_ladrillo_fiscal_m2",descripcion:"Albañilería ladrillo fiscal (aparejo común)",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Ladrillo fiscal (25 u/m²)",unidad:"m2",cantidad:1,pu:7750},{descripcion:"Mortero: cemento + arena",unidad:"m2",cantidad:1,pu:7610}],manoObra:[{descripcion:"Maestro (5 m²/jornal)",unidad:"m2",cantidad:1,pu:9e3},{descripcion:"Ayudante (5 m²/jornal)",unidad:"m2",cantidad:1,pu:9e3}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:900}]}}),Je=()=>({id:"apu_estructura_techumbre_madera",descripcion:"Estructura de techumbre en madera (cerchas pino 2×6 @60 cm)",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Madera + fijaciones (estimado)",unidad:"m2",cantidad:1,pu:12200}],manoObra:[{descripcion:"Maestro (8 m²/jornal)",unidad:"m2",cantidad:1,pu:5625},{descripcion:"Ayudante (8 m²/jornal)",unidad:"m2",cantidad:1,pu:5625}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:563}]}}),zt=()=>({id:"apu_cubierta_zinc_0_35_fieltro",descripcion:"Cubierta zinc acanalado 0,35 mm + fieltro",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Plancha zinc 0,35",unidad:"m2",cantidad:1,pu:6506},{descripcion:"Fieltro asfáltico 15 lb",unidad:"m2",cantidad:1,pu:2589},{descripcion:"Tornillos techo (6 u/m²)",unidad:"m2",cantidad:1,pu:317}],manoObra:[{descripcion:"Maestro (12 m²/jornal)",unidad:"m2",cantidad:1,pu:3750},{descripcion:"Ayudante (12 m²/jornal)",unidad:"m2",cantidad:1,pu:3750}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:375}]}}),Va=()=>({id:"apu_techumbre_teja_asfaltica_m2",descripcion:"Techumbre OSB 11 + fieltro + teja asfáltica",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"OSB 11 mm (0,336 pl/m²)",unidad:"m2",cantidad:1,pu:6600},{descripcion:"Fieltro asfáltico 15 lb",unidad:"m2",cantidad:1,pu:225},{descripcion:"Teja asfáltica (económica)",unidad:"m2",cantidad:1,pu:9990},{descripcion:"Clavos/asfaltos",unidad:"m2",cantidad:1,pu:800},{descripcion:"Estructura de techumbre en madera (proporción)",unidad:"m2",cantidad:1,pu:13e3}],manoObra:[{descripcion:"Maestro techumbre",unidad:"m2",cantidad:1,pu:5e3},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:5e3}],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"m2",cantidad:1,pu:485}]}}),gn=()=>({id:"apu_cielo_yeso_eps100",descripcion:"Cielo raso yeso-cartón + aislación EPS 100 mm",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Yeso-cartón 10 mm",unidad:"m2",cantidad:1,pu:2290},{descripcion:"Listonería y fijaciones",unidad:"m2",cantidad:1,pu:2500},{descripcion:"EPS 100 mm",unidad:"m2",cantidad:1,pu:3e3},{descripcion:"Cinta, pasta, tornillos",unidad:"m2",cantidad:1,pu:1400}],manoObra:[{descripcion:"Maestro",unidad:"m2",cantidad:1,pu:3500},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:3500}],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"m2",cantidad:1,pu:1620}]}}),vt=()=>({id:"apu_piso_porcelanato_60x60",descripcion:"Porcelanato 60×60 + adhesivo + fragüe",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Porcelanato 60×60",unidad:"m2",cantidad:1,pu:7990},{descripcion:"Adhesivo porcelanato",unidad:"m2",cantidad:1,pu:1800},{descripcion:"Fragüe",unidad:"m2",cantidad:1,pu:685}],manoObra:[{descripcion:"Maestro",unidad:"m2",cantidad:1,pu:4250},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:4250}],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"m2",cantidad:1,pu:110}]}}),Ha=()=>({id:"apu_piso_ceramica_base",descripcion:"Cerámica piso + adhesivo + fragüe",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Cerámica piso",unidad:"m2",cantidad:1,pu:4690},{descripcion:"Adhesivo",unidad:"m2",cantidad:1,pu:1800},{descripcion:"Fragüe",unidad:"m2",cantidad:1,pu:685}],manoObra:[{descripcion:"Maestro",unidad:"m2",cantidad:1,pu:4e3},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:4e3}],equipos:[],varios:[{descripcion:"Misceláneos",unidad:"m2",cantidad:1,pu:110}]}}),xn=()=>({id:"apu_piso_flotante_7mm",descripcion:"Piso flotante 7 mm + bajo mantención + guardapolvo",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Lámina piso flotante 7 mm",unidad:"m2",cantidad:1,pu:6990},{descripcion:"Bajo-mantención",unidad:"m2",cantidad:1,pu:500},{descripcion:"Guardapolvo",unidad:"m2",cantidad:1,pu:1e3}],manoObra:[{descripcion:"Maestro",unidad:"m2",cantidad:1,pu:3e3},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:3e3}],equipos:[],varios:[]}}),oi=()=>({id:"apu_ceramica_muro_bano",descripcion:"Cerámica muros baño + adhesivo + fragüe",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Cerámica muro",unidad:"m2",cantidad:1,pu:4690},{descripcion:"Adhesivo",unidad:"m2",cantidad:1,pu:1800},{descripcion:"Fragüe",unidad:"m2",cantidad:1,pu:695}],manoObra:[{descripcion:"Maestro",unidad:"m2",cantidad:1,pu:5e3},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:5e3}],equipos:[],varios:[]}}),br=()=>({id:"apu_pintura_exterior_fibro",descripcion:"Pintura exterior en fibrocemento (esmalte al agua)",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Pintura + insumos",unidad:"m2",cantidad:1,pu:1500}],manoObra:[{descripcion:"Maestro",unidad:"m2",cantidad:1,pu:1500},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:1500}],equipos:[],varios:[]}}),cs=()=>({id:"apu_electrica_completa_gl",descripcion:"Instalación eléctrica completa vivienda 100 m²",unidadSalida:"u",categoria:"Instalaciones eléctricas",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Sistema completo",unidad:"u",cantidad:1,pu:148e4}]}}),Pt=()=>({id:"apu_sanitaria_completa_gl",descripcion:"Instalación sanitaria completa 2 baños + cocina + lavadero + calefón",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Sistema completo",unidad:"u",cantidad:1,pu:252e4}]}}),ct=()=>({id:"apu_terminaciones_menores_ml",descripcion:"Guardapolvos, zócalos, cornisas (todo costo)",unidadSalida:"ml",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"ml",cantidad:1,pu:3e3}]}}),We=()=>({id:"apu_tramite_dom_permiso",descripcion:"Permiso de edificación y derechos DOM",unidadSalida:"u",categoria:"Servicios",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Permiso DOM",unidad:"u",cantidad:1,pu:7e5}]}}),bt=()=>({id:"apu_tramite_calculo_estructural",descripcion:"Cálculo estructural vivienda liviana",unidadSalida:"u",categoria:"Servicios",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Cálculo estructural",unidad:"u",cantidad:1,pu:6e5}]}}),Kt=()=>({id:"apu_tramite_recepcion_final",descripcion:"Recepción final, certificados y copias",unidadSalida:"u",categoria:"Servicios",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Recepción final y certificados",unidad:"u",cantidad:1,pu:3e5}]}}),Ea=()=>({id:"apu_tramite_te1_sec",descripcion:"SEC/TE1 eléctrica",unidadSalida:"u",categoria:"Servicios",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"SEC/TE1",unidad:"u",cantidad:1,pu:12e4}]}}),qt=()=>({id:"apu_canaleta_pvc_4_instalada",descripcion:'Canaleta PVC 4" instalada',unidadSalida:"ml",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Canaleta + uniones/soportes",unidad:"ml",cantidad:1,pu:1923}],manoObra:[{descripcion:"Maestro (20 ml/jornal)",unidad:"ml",cantidad:1,pu:2250},{descripcion:"Ayudante (20 ml/jornal)",unidad:"ml",cantidad:1,pu:2250}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"ml",cantidad:1,pu:225}]}}),Pa=()=>({id:"apu_bajada_lluvias_pvc_75_instalada",descripcion:"Bajada de aguas lluvias PVC Ø75 mm instalada",unidadSalida:"ml",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Tubo + codos/anclajes",unidad:"ml",cantidad:1,pu:3197}],manoObra:[{descripcion:"Maestro (20 ml/jornal)",unidad:"ml",cantidad:1,pu:2250},{descripcion:"Ayudante (20 ml/jornal)",unidad:"ml",cantidad:1,pu:2250}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"ml",cantidad:1,pu:225}]}}),Hn=()=>({id:"apu_revestimiento_exterior_fibro_6mm_sobre_liston",descripcion:"Revestimiento exterior fibrocemento 6 mm sobre listón",unidadSalida:"m2",categoria:"Fachada",codigoExterno:"",secciones:{materiales:[{descripcion:"Placa fibrocemento 6 mm",unidad:"m2",cantidad:1,pu:5318},{descripcion:"Tornillo lenteja (12 u/m²)",unidad:"m2",cantidad:1,pu:271},{descripcion:"Listón pino (1,2 m/m²)",unidad:"m2",cantidad:1,pu:656},{descripcion:"Masilla juntas fibrocemento",unidad:"m2",cantidad:1,pu:800}],manoObra:[{descripcion:"Maestro (8 m²/jornal)",unidad:"m2",cantidad:1,pu:5625},{descripcion:"Ayudante (8 m²/jornal)",unidad:"m2",cantidad:1,pu:5625}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:563}]}}),ba=()=>({id:"apu_muro_ext_2x4_osb11_lana80_fc6_pint",descripcion:"Muro exterior 2×4 @40 + OSB 11 mm + lana 80 mm + fibrocemento 6 mm pintado",unidadSalida:"m2",categoria:"Fachada",codigoExterno:"",secciones:{materiales:[{descripcion:"Madera pino 2×4 3,2 m (2,5 pzs/m²)",unidad:"m2",cantidad:1,pu:12975},{descripcion:"OSB 11 mm (0,336 pl/m²)",unidad:"m2",cantidad:1,pu:6600},{descripcion:"Lana mineral 80 mm",unidad:"m2",cantidad:1,pu:7500},{descripcion:"Fibrocemento 6 mm (0,347 pl/m²)",unidad:"m2",cantidad:1,pu:4700},{descripcion:"Tornillos, clavos, cintas y sellos",unidad:"m2",cantidad:1,pu:877},{descripcion:"Pintura exterior (materiales)",unidad:"m2",cantidad:1,pu:4200}],manoObra:[{descripcion:"Maestro carpintero",unidad:"m2",cantidad:1,pu:6e3},{descripcion:"Ayudante carpintería",unidad:"m2",cantidad:1,pu:6e3}],equipos:[],varios:[{descripcion:"Merma y misceláneos (10% materiales)",unidad:"m2",cantidad:1,pu:3548}]}}),yr=()=>({id:"apu_tabique_2x4_volcanita_simple",descripcion:"Tabique interior 2×4 + volcanita 10 mm simple (ambas caras)",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Madera pino 2×4 (2,19 pzs/m²)",unidad:"m2",cantidad:1,pu:11366},{descripcion:"Volcanita 10 mm (0,694 pl/m²)",unidad:"m2",cantidad:1,pu:4580},{descripcion:"Tornillos yeso, cinta y pasta",unidad:"m2",cantidad:1,pu:2100}],manoObra:[{descripcion:"Yesero/maestro",unidad:"m2",cantidad:1,pu:4e3},{descripcion:"Ayudante",unidad:"m2",cantidad:1,pu:4e3}],equipos:[],varios:[{descripcion:"Merma y misceláneos (ajuste)",unidad:"m2",cantidad:1,pu:2584}]}}),Ko=()=>({id:"apu_piso_ceramica_60x60",descripcion:"Piso cerámica 60×60 sobre radier afinado",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Cerámica 60×60 (estimado)",unidad:"m2",cantidad:1,pu:8e3},{descripcion:"Adhesivo cerámico",unidad:"m2",cantidad:1,pu:700},{descripcion:"Fragüe",unidad:"m2",cantidad:1,pu:327}],manoObra:[{descripcion:"Maestro (8 m²/jornal)",unidad:"m2",cantidad:1,pu:5625},{descripcion:"Ayudante (8 m²/jornal)",unidad:"m2",cantidad:1,pu:5625}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:563}]}}),Jo=()=>({id:"apu_pintura_interior_latex_muros",descripcion:"Pintura interior muros, látex mate, 2 manos sobre yeso",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Tineta látex + insumos",unidad:"m2",cantidad:1,pu:898}],manoObra:[{descripcion:"Maestro (35 m²/jornal, 2 manos)",unidad:"m2",cantidad:1,pu:1286},{descripcion:"Ayudante (35 m²/jornal, 2 manos)",unidad:"m2",cantidad:1,pu:1285}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"m2",cantidad:1,pu:129}]}}),m0=()=>({id:"apu_ventana_aluminio_120x100_instalada",descripcion:"Ventana aluminio corredera 120×100 instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Ventana + sellos",unidad:"u",cantidad:1,pu:77613}],manoObra:[{descripcion:"Maestro (0,25 jornal/u)",unidad:"u",cantidad:1,pu:11250},{descripcion:"Ayudante (0,25 jornal/u)",unidad:"u",cantidad:1,pu:11250}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"u",cantidad:1,pu:1125}]}}),f0=()=>({id:"apu_ventana_aluminio_100x100_instalada",descripcion:"Ventana aluminio corredera 100×100 instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Ventana + sellos",unidad:"u",cantidad:1,pu:215e3}],manoObra:[{descripcion:"Maestro (0,30 jornal/u)",unidad:"u",cantidad:1,pu:15e3},{descripcion:"Ayudante (0,30 jornal/u)",unidad:"u",cantidad:1,pu:15e3}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"u",cantidad:1,pu:990}]}}),Yo=()=>({id:"apu_puerta_interior_mdf_70x200_instalada",descripcion:"Puerta interior MDF 70×200 instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Hoja + cerradura + bisagras + contramarco",unidad:"u",cantidad:1,pu:86650}],manoObra:[{descripcion:"Maestro (0,30 jornal/u)",unidad:"u",cantidad:1,pu:13500},{descripcion:"Ayudante (0,30 jornal/u)",unidad:"u",cantidad:1,pu:13500}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"u",cantidad:1,pu:1350}]}}),Zo=()=>({id:"apu_puerta_exterior_acero_90x200_instalada",descripcion:"Puerta exterior acero 90×200 instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Hoja acero + cerradura exterior + bisagras + marco",unidad:"u",cantidad:1,pu:292990}],manoObra:[{descripcion:"Maestro (0,40 jornal/u)",unidad:"u",cantidad:1,pu:18e3},{descripcion:"Ayudante (0,40 jornal/u)",unidad:"u",cantidad:1,pu:18e3}],equipos:[],varios:[{descripcion:"Espumas/sellos y herramientas",unidad:"u",cantidad:1,pu:2e3}]}}),h0=()=>({id:"apu_puerta_exterior_madera_90x200_instalada",descripcion:"Puerta exterior madera maciza 90×200 instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Hoja de puerta madera maciza 90×200",unidad:"u",cantidad:1,pu:249990},{descripcion:"Marco de madera para puerta 90×200",unidad:"u",cantidad:1,pu:39990},{descripcion:"Cerradura exterior (seguridad)",unidad:"u",cantidad:1,pu:24990},{descripcion:"Bisagras reforzadas",unidad:"u",cantidad:3,pu:2990},{descripcion:"Sellos y espuma PU",unidad:"u",cantidad:1,pu:2500}],manoObra:[{descripcion:"Maestro (0,40 jornal/u)",unidad:"u",cantidad:1,pu:18e3},{descripcion:"Ayudante (0,40 jornal/u)",unidad:"u",cantidad:1,pu:18e3}],equipos:[],varios:[{descripcion:"Herramientas y ajustes",unidad:"u",cantidad:1,pu:3e3}]}}),g0=()=>({id:"apu_mortero_estuco_cementicio_m2",descripcion:"Mortero (Arena–Cemento) estuco 2 cm",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Cemento 25 kg (0,28 saco/m²)",unidad:"saco",cantidad:.28,pu:4790},{descripcion:"Arena gruesa 25 kg (1,02 saco/m²)",unidad:"saco",cantidad:1.02,pu:940},{descripcion:"Agua y misceláneos",unidad:"m2",cantidad:1,pu:150},{descripcion:"Merma materiales 3%",unidad:"m2",cantidad:1,pu:74}],manoObra:[{descripcion:"Maestro (1/18 jornal/m²)",unidad:"jornal",cantidad:1/18,pu:6e4},{descripcion:"Ayudante (1/18 jornal/m²)",unidad:"jornal",cantidad:1/18,pu:45e3}],equipos:[{descripcion:"Herramienta menor",unidad:"m2",cantidad:1,pu:300}],varios:[]}}),x0=()=>({id:"apu_cerchas_pino_techo_m2",descripcion:"Cerchas de pino para techo (2 aguas)",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Madera pino 2×4 (9,0 m/ml por m²)",unidad:"m",cantidad:9,pu:1621.9},{descripcion:"Pernos coche 3/8″×6″ (2 u/m²)",unidad:"u",cantidad:2,pu:1929},{descripcion:"Tirafondos 1/4″×4″ (20 u/m²)",unidad:"u",cantidad:20,pu:95.9},{descripcion:"Merma materiales 3%",unidad:"m2",cantidad:1,pu:611}],manoObra:[{descripcion:"Carpintero (1/20 jornal/m²)",unidad:"jornal",cantidad:1/20,pu:6e4},{descripcion:"Carpintero (1/20 jornal/m²)",unidad:"jornal",cantidad:1/20,pu:6e4},{descripcion:"Ayudante (1/20 jornal/m²)",unidad:"jornal",cantidad:1/20,pu:45e3}],equipos:[{descripcion:"Herramienta menor",unidad:"m2",cantidad:1,pu:500}],varios:[]}}),_0=()=>({id:"apu_puerta_madera_maciza_90x200_u",descripcion:"Puerta principal madera maciza 90×200 instalada",unidadSalida:"u",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Puerta exterior pino oregón 90×200",unidad:"u",cantidad:1,pu:482990},{descripcion:"Marco pino finger 40×90 mm (juego 5,4 m)",unidad:"u",cantidad:1,pu:15590},{descripcion:"Bisagras 4″×4″ (pack 3)",unidad:"u",cantidad:1,pu:8490},{descripcion:"Cerradura de acceso (ODIS embutir o similar)",unidad:"u",cantidad:1,pu:44990},{descripcion:"Tornillos 1½″ (caja 100 u — uso 50 u)",unidad:"caja",cantidad:.5,pu:4790},{descripcion:"Barniz marino exterior, 1 gal (uso ¼ gal, 2 manos)",unidad:"gal",cantidad:.25,pu:18990},{descripcion:"Merma materiales 2%",unidad:"u",cantidad:1,pu:11184}],manoObra:[{descripcion:"Carpintero (½ jornal/u)",unidad:"jornal",cantidad:.5,pu:6e4},{descripcion:"Ayudante (½ jornal/u)",unidad:"jornal",cantidad:.5,pu:45e3}],equipos:[{descripcion:"Herramienta menor",unidad:"u",cantidad:1,pu:1e3}],varios:[]}}),v0=()=>({id:"apu_ventana_aluminio_60x40_instalada",descripcion:"Ventana aluminio corredera 60×40 instalada",unidadSalida:"u",categoria:"Aberturas",codigoExterno:"",secciones:{materiales:[{descripcion:"Ventana + sellos",unidad:"u",cantidad:1,pu:81100}],manoObra:[{descripcion:"Maestro (0,20 jornal/u)",unidad:"u",cantidad:1,pu:9e3},{descripcion:"Ayudante (0,20 jornal/u)",unidad:"u",cantidad:1,pu:9e3}],equipos:[],varios:[{descripcion:"Herramientas menores",unidad:"u",cantidad:1,pu:900}]}}),b0=()=>({id:"apu_subbase_estab_15cm_m2",descripcion:"Subbase estabilizada 15 cm compactada",unidadSalida:"m2",categoria:"Movimiento de tierras",codigoExterno:"",secciones:{__meta:{rendimiento:5},materiales:[{descripcion:"Base chancada (15 cm) + 5% merma",unidad:"m3",cantidad:.1575,pu:2e4},{descripcion:"Geotextil 200 g/m²",unidad:"m2",cantidad:1,pu:1199},{descripcion:"Agua riego",unidad:"m2",cantidad:1,pu:100}],manoObra:[{descripcion:"Cuadrilla (0,20 h/m²)",unidad:"m2",cantidad:1,pu:2250}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:300},{descripcion:"Obs: placa vibratoria/rodillo; humedad óptima. Rendimiento: 5,0 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),y0=()=>({id:"apu_muro_ext_23_osb_house_lana_yeso_m2",descripcion:"Muro exterior 2×3 + OSB11 + housewrap + lana 100 + yeso int.",unidadSalida:"m2",categoria:"Fachada",codigoExterno:"",secciones:{__meta:{rendimiento:.7},materiales:[{descripcion:'Madera 2×3" estructura + 5% merma',unidad:"ml",cantidad:3.36,pu:1200},{descripcion:'Madera 2×3" soleras + 3% merma',unidad:"ml",cantidad:.824,pu:1200},{descripcion:"OSB 11 mm + 5% merma",unidad:"m2",cantidad:1.05,pu:7e3},{descripcion:"Membrana hidrófuga + 5% merma",unidad:"m2",cantidad:1.05,pu:1800},{descripcion:"Lana de vidrio 100 mm",unidad:"m2",cantidad:1,pu:4753},{descripcion:"Yeso-cartón 12,5 mm",unidad:"m2",cantidad:1,pu:5309},{descripcion:"Tornillos, clavos, cintas",unidad:"m2",cantidad:1,pu:1200}],manoObra:[{descripcion:"Cuadrilla (1,42 h/m²)",unidad:"m2",cantidad:1,pu:16e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:600},{descripcion:"Obs: topes sísmicos y barrera de vapor. Rendimiento: 0,70 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),S0=()=>({id:"apu_eifs_40mm_m2",descripcion:"EIFS 40 mm (EPS + basecoat+malla + terminación)",unidadSalida:"m2",categoria:"Fachada",codigoExterno:"",secciones:{__meta:{rendimiento:.94},materiales:[{descripcion:"EPS 40 mm + 3% merma",unidad:"m2",cantidad:1.03,pu:3500},{descripcion:"Basecoat + 5% merma",unidad:"kg",cantidad:5.25,pu:560},{descripcion:"Malla 160 g + 5% merma",unidad:"m2",cantidad:1.05,pu:1500},{descripcion:"Terminación acrílica + 5% merma",unidad:"kg",cantidad:2.625,pu:1120},{descripcion:"Perfiles PVC",unidad:"m2",cantidad:1,pu:600},{descripcion:"Anclajes",unidad:"m2",cantidad:1,pu:300}],manoObra:[{descripcion:"Cuadrilla (1,07 h/m²)",unidad:"m2",cantidad:1,pu:12e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:500},{descripcion:"Obs: juntas dentadas y curado entre capas. Rendimiento: 0,94 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),w0=()=>({id:"apu_siding_vinilico_m2",descripcion:"Siding vinílico sobre listones y membrana",unidadSalida:"m2",categoria:"Fachada",codigoExterno:"",secciones:{__meta:{rendimiento:1.25},materiales:[{descripcion:"Siding vinílico + 5% merma",unidad:"m2",cantidad:1.05,pu:9500},{descripcion:"Membrana hidrófuga + 5% merma",unidad:"m2",cantidad:1.05,pu:1800},{descripcion:"Listón 2×2 + 5% merma",unidad:"ml",cantidad:1.26,pu:547},{descripcion:"Perfiles de terminación",unidad:"m2",cantidad:1,pu:1e3},{descripcion:"Tornillos/Clavos",unidad:"m2",cantidad:1,pu:500}],manoObra:[{descripcion:"Cuadrilla (0,80 h/m²)",unidad:"m2",cantidad:1,pu:9e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:400},{descripcion:"Obs: holguras de dilatación; clavo sin apretar. Rendimiento: 1,25 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),j0=()=>({id:"apu_cubierta_teja_asfaltica_osb_fieltro_m2",descripcion:"Cubierta teja asfáltica sobre OSB + fieltro",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{__meta:{rendimiento:1.25},materiales:[{descripcion:"Shingle + 5% merma",unidad:"m2",cantidad:1.05,pu:9990},{descripcion:"Fieltro 15 lb",unidad:"m2",cantidad:1,pu:647},{descripcion:"OSB 11 mm + 5% merma",unidad:"m2",cantidad:1.05,pu:7e3},{descripcion:"Clavos y tapajuntas",unidad:"m2",cantidad:1,pu:600}],manoObra:[{descripcion:"Cuadrilla (0,80 h/m²)",unidad:"m2",cantidad:1,pu:9e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:400},{descripcion:"Obs: pendientes ≥ 20% y líneas guía. Rendimiento: 1,25 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),Fd=()=>({id:"apu_revest_ceramico_muro_30x60_m2",descripcion:"Revestimiento cerámico en muros 30×60",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{__meta:{rendimiento:1.02},materiales:[{descripcion:"Cerámica 30×60 + 3% merma",unidad:"m2",cantidad:1.03,pu:9e3},{descripcion:"Adhesivo 25 kg prorr.",unidad:"m2",cantidad:1,pu:622},{descripcion:"Fragüe",unidad:"m2",cantidad:1,pu:327},{descripcion:"Crucetas",unidad:"m2",cantidad:1,pu:200}],manoObra:[{descripcion:"Cuadrilla (0,98 h/m²)",unidad:"m2",cantidad:1,pu:11e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:500},{descripcion:"Obs: doble encolado en formatos grandes. Rendimiento: 1,02 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),N0=()=>({id:"apu_cielo_pvc_tablilla_20cm_m2",descripcion:"Cielo falso PVC tablilla 20 cm",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{__meta:{rendimiento:1.73},materiales:[{descripcion:"Panel PVC 20 cm + 3% merma",unidad:"m2",cantidad:1.03,pu:6990},{descripcion:"Perímetro y colgadores",unidad:"m2",cantidad:1,pu:1200},{descripcion:"Tornillos",unidad:"m2",cantidad:1,pu:200}],manoObra:[{descripcion:"Cuadrilla (0,58 h/m²)",unidad:"m2",cantidad:1,pu:6500}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:300},{descripcion:"Obs: respetar ventilación y registros. Rendimiento: 1,73 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),C0=()=>({id:"apu_carpeta_autonivelante_5mm_m2",descripcion:"Carpeta autonivelante cementicia 5 mm",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{__meta:{rendimiento:2.78},materiales:[{descripcion:"Mortero autonivelante 25 kg + 5% merma",unidad:"saco",cantidad:.3,pu:9990},{descripcion:"Imprimación",unidad:"m2",cantidad:1,pu:400}],manoObra:[{descripcion:"Cuadrilla (0,36 h/m²)",unidad:"m2",cantidad:1,pu:4e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:300},{descripcion:"Obs: controlar corrientes de aire; tiempos tránsito. Rendimiento: 2,78 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),Ud=()=>({id:"apu_pav_ext_h25_8cm_malla_m2",descripcion:"Pavimento exterior H-25 8 cm con malla",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{__meta:{rendimiento:1.41},materiales:[{descripcion:"Hormigón H-25",unidad:"m3",cantidad:.08,pu:202500},{descripcion:"Malla C-92",unidad:"m2",cantidad:.077,pu:22990},{descripcion:"Curado/agua",unidad:"m2",cantidad:1,pu:200},{descripcion:"Juntas asfálticas prorr.",unidad:"m2",cantidad:1,pu:400}],manoObra:[{descripcion:"Cuadrilla (0,71 h/m²)",unidad:"m2",cantidad:1,pu:8e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"m2",cantidad:1,pu:400},{descripcion:"Obs: curado 3–7 días; juntas 2–3 m. Rendimiento: 1,41 m²/h",unidad:"m2",cantidad:1,pu:0}]}}),A0=()=>({id:"apu_camara_inspeccion_pvc_50x50x60_u",descripcion:"Cámara de inspección PVC 50×50×60",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{rendimiento:.63},materiales:[{descripcion:"Cámara PVC prefabricada 50×50×60",unidad:"u",cantidad:1,pu:45e3},{descripcion:"Tapa y marco reforzado",unidad:"u",cantidad:1,pu:15e3},{descripcion:"Mortero asiento (10 kg)",unidad:"kg",cantidad:10,pu:300},{descripcion:"Tuberías y uniones prorr.",unidad:"u",cantidad:1,pu:5e3}],manoObra:[{descripcion:"Cuadrilla (1,60 h/u)",unidad:"u",cantidad:1,pu:18e3}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"u",cantidad:1,pu:500},{descripcion:"Obs: pendiente 1–2% y cama de asiento. Rendimiento: 0,63 u/h",unidad:"u",cantidad:1,pu:0}]}}),k0=()=>({id:"apu_trampa_grasas_50l_u",descripcion:"Trampa de grasas prefabricada 50 L",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{rendimiento:.5},materiales:[{descripcion:"Trampa de grasas 50 L",unidad:"u",cantidad:1,pu:69990},{descripcion:"PVC y accesorios",unidad:"u",cantidad:1,pu:5e3},{descripcion:"Mortero (8 kg)",unidad:"kg",cantidad:8,pu:300}],manoObra:[{descripcion:"Cuadrilla (2,00 h/u)",unidad:"u",cantidad:1,pu:22500}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"u",cantidad:1,pu:600},{descripcion:"Obs: accesible para mantención; ventilación. Rendimiento: 0,50 u/h",unidad:"u",cantidad:1,pu:0}]}}),I0=()=>({id:"apu_cierre_perimetral_malla_2m_postes_ml",descripcion:"Cierre perimetral malla 2,0 m + postes imp. @2,5 m",unidadSalida:"ml",categoria:"Obras exteriores",codigoExterno:"",secciones:{__meta:{rendimiento:1.5},materiales:[{descripcion:"Malla galvanizada 2,0 m + 5% merma",unidad:"ml",cantidad:1.05,pu:7e3},{descripcion:'Poste 4×4" @2,5 m + 5% merma',unidad:"u",cantidad:.42,pu:7500},{descripcion:"Tensor y grampas",unidad:"ml",cantidad:1,pu:600},{descripcion:"Hormigón seco (12 kg)",unidad:"kg",cantidad:12,pu:400}],manoObra:[{descripcion:"Cuadrilla (0,67 h/ml)",unidad:"ml",cantidad:1,pu:7500}],equipos:[],varios:[{descripcion:"Herramientas y misceláneos",unidad:"ml",cantidad:1,pu:400},{descripcion:"Obs: curado bases; tensores a 3 niveles. Rendimiento: 1,50 ml/h",unidad:"ml",cantidad:1,pu:0}]}}),E0=()=>({id:"apu_losa_12cm_malla_c92",descripcion:"Losa/entrepiso HºA 12 cm con malla C-92",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Hormigón preparado en saco (0,12 m³)",unidad:"m2",cantidad:1,pu:24300},{descripcion:"Malla electrosoldada C-92 (1/13 paño)",unidad:"m2",cantidad:1,pu:1769},{descripcion:"Acero adicional Ø10 (1 kg)",unidad:"kg",cantidad:1,pu:1863},{descripcion:"Encofrado terciado 18 mm amort. (5 usos)",unidad:"m2",cantidad:1,pu:2956},{descripcion:"Puntales y misceláneos",unidad:"m2",cantidad:1,pu:999}],manoObra:[{descripcion:"Maestro (1,0 h)",unidad:"m2",cantidad:1,pu:5e3},{descripcion:"Ayudante (1,0 h)",unidad:"m2",cantidad:1,pu:5e3}],equipos:[],varios:[]}}),P0=()=>({id:"apu_entramado_2x8_osb18",descripcion:"Entramado horizontal madera 2×8 @40 cm + OSB 18 mm",unidadSalida:"m2",categoria:"Estructura madera",codigoExterno:"",secciones:{materiales:[{descripcion:"Pino 2×8 (2,5 ml)",unidad:"m",cantidad:1,pu:12728},{descripcion:"OSB 18 mm",unidad:"m2",cantidad:1,pu:9e3},{descripcion:"Tornillos y fijaciones",unidad:"m2",cantidad:1,pu:500}],manoObra:[{descripcion:"Maestro (1,2 h)",unidad:"m2",cantidad:1,pu:6e3},{descripcion:"Ayudante (1,2 h)",unidad:"m2",cantidad:1,pu:6e3}],equipos:[],varios:[]}}),M0=()=>({id:"apu_sobrecimiento_20x20_h20",descripcion:"Sobrecimiento 20×20 cm H-20 con protección superficial",unidadSalida:"m",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Hormigón (0,04 m³)",unidad:"m",cantidad:1,pu:8100},{descripcion:"Acero longitudinal + estribos (3 kg)",unidad:"kg",cantidad:1,pu:5588},{descripcion:"Encofrado amort. (5 usos) 0,4 m²",unidad:"m",cantidad:1,pu:1182},{descripcion:"Impermeabilizante asfáltico (2 manos)",unidad:"m",cantidad:1,pu:1134}],manoObra:[{descripcion:"Maestro (0,5 h)",unidad:"m",cantidad:1,pu:2500},{descripcion:"Ayudante (0,5 h)",unidad:"m",cantidad:1,pu:2500}],equipos:[],varios:[]}}),T0=()=>({id:"apu_barrera_humedad_vent_entretechos",descripcion:"Barrera de humedad bajo techumbre + ventilación de entretechos",unidadSalida:"m2",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Fieltro asfáltico 15 lb",unidad:"m2",cantidad:1,pu:647},{descripcion:"Accesorios ventilación (prorrateo)",unidad:"m2",cantidad:1,pu:500}],manoObra:[{descripcion:"Maestro (0,2 h)",unidad:"m2",cantidad:1,pu:1e3},{descripcion:"Ayudante (0,2 h)",unidad:"m2",cantidad:1,pu:1e3}],equipos:[],varios:[]}}),O0=()=>({id:"apu_cumbreras_metalicas",descripcion:"Aleros y cumbreras metálicas",unidadSalida:"m",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Caballete zinc 3 m (prorrateo)",unidad:"m",cantidad:1,pu:4997},{descripcion:"Tornillos autoperforantes con neopreno",unidad:"m",cantidad:1,pu:600},{descripcion:"Cinta tapajuntas/flashband (prorrateo)",unidad:"m",cantidad:1,pu:300}],manoObra:[{descripcion:"Maestro (0,25 h)",unidad:"m",cantidad:1,pu:1250},{descripcion:"Ayudante (0,25 h)",unidad:"m",cantidad:1,pu:1250}],equipos:[],varios:[]}}),R0=()=>({id:"apu_imper_membrana_3mm_losa",descripcion:"Impermeabilización de losa/terraza con membrana asfáltica 3 mm",unidadSalida:"m2",categoria:"Impermeabilización",codigoExterno:"",secciones:{materiales:[{descripcion:"Membrana 1×10 m JD2 Plus",unidad:"m2",cantidad:1,pu:7899},{descripcion:"Imprimante asfáltico 5 L",unidad:"m2",cantidad:1,pu:480},{descripcion:"Gas y misceláneos",unidad:"m2",cantidad:1,pu:300}],manoObra:[{descripcion:"Maestro (0,25 h)",unidad:"m2",cantidad:1,pu:1250},{descripcion:"Ayudante (0,25 h)",unidad:"m2",cantidad:1,pu:1250}],equipos:[],varios:[]}}),L0=()=>({id:"apu_saneamiento_basico_biodigestor",descripcion:"Saneamiento individual básico (biodigestor + drenes)",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{materiales:[{descripcion:"Biodigestor 600 L",unidad:"u",cantidad:1,pu:119990},{descripcion:"Tuberías y fittings PVC 110 mm",unidad:"u",cantidad:1,pu:36e3},{descripcion:"Cámara de inspección prefabricada",unidad:"u",cantidad:1,pu:5e4},{descripcion:"Geotextil 1×10 m",unidad:"u",cantidad:1,pu:11990}],manoObra:[{descripcion:"Maestro (1,5 días)",unidad:"u",cantidad:1,pu:6e4},{descripcion:"Ayudante (1,5 días)",unidad:"u",cantidad:1,pu:6e4}],equipos:[],varios:[]}}),z0=()=>({id:"apu_vent_mecanica_local_100mm",descripcion:"Ventilación mecánica local (extractor baño 100 mm)",unidadSalida:"u",categoria:"Instalaciones eléctricas",codigoExterno:"",secciones:{materiales:[{descripcion:"Extractor 4″ Klimber",unidad:"u",cantidad:1,pu:21990},{descripcion:"Ducto 100 mm + rejilla",unidad:"u",cantidad:1,pu:3e3},{descripcion:"Cableado y anclajes",unidad:"u",cantidad:1,pu:2e3}],manoObra:[{descripcion:"Maestro (2,0 h)",unidad:"u",cantidad:1,pu:1e4},{descripcion:"Ayudante (1,0 h)",unidad:"u",cantidad:1,pu:5625}],equipos:[],varios:[]}}),F0=()=>({id:"apu_sellos_hermeticidad_vanos",descripcion:"Sellos de hermeticidad en vanos (silicona + espuma PU)",unidadSalida:"m",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Silicona neutra (prorrateo)",unidad:"m",cantidad:1,pu:549},{descripcion:"Espuma PU (prorrateo)",unidad:"m",cantidad:1,pu:400}],manoObra:[{descripcion:"Maestro (0,1 h)",unidad:"m",cantidad:1,pu:500},{descripcion:"Ayudante (0,1 h)",unidad:"m",cantidad:1,pu:500}],equipos:[],varios:[]}}),U0=()=>({id:"apu_sellos_cortafuego_pasamuros",descripcion:"Sellos cortafuego en pasamuros (intumescente)",unidadSalida:"u",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Masilla intumescente CP-25WB+ (prorrateo)",unidad:"u",cantidad:1,pu:12500},{descripcion:"Rotulación/accesorios",unidad:"u",cantidad:1,pu:1e3}],manoObra:[{descripcion:"Maestro (0,5 h)",unidad:"u",cantidad:1,pu:1953},{descripcion:"Ayudante (0,25 h)",unidad:"u",cantidad:1,pu:1953}],equipos:[],varios:[]}}),D0=()=>({id:"apu_muro_contencion_hoa_20cm_dren",descripcion:"Muro de contención HºA 20 cm con dren y geotextil (h≈1,5 m)",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Hormigón (0,20 m³)",unidad:"m2",cantidad:1,pu:40500},{descripcion:"Acero (≈16 kg/m²)",unidad:"m2",cantidad:1,pu:29803},{descripcion:"Tubo corrugado dren 110 mm (prorrateo)",unidad:"m2",cantidad:1,pu:2100},{descripcion:"Geotextil 1×10 m",unidad:"m2",cantidad:1,pu:1199},{descripcion:"Encofrado ambos lados amort.",unidad:"m2",cantidad:1,pu:5911}],manoObra:[{descripcion:"Maestro (1,5 h)",unidad:"m2",cantidad:1,pu:7500},{descripcion:"Ayudante (1,5 h)",unidad:"m2",cantidad:1,pu:7500}],equipos:[],varios:[]}}),Dd=()=>({id:"apu_acond_termico_muros_lana100_bv",descripcion:"Acondicionamiento térmico de muros (lana de vidrio 100 mm + BV)",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Lana de vidrio 100 mm",unidad:"m2",cantidad:1,pu:4753},{descripcion:"Barrera de vapor PE 200 µm",unidad:"m2",cantidad:1,pu:375},{descripcion:"Cinta/adhesivos",unidad:"m2",cantidad:1,pu:100}],manoObra:[{descripcion:"Maestro (0,25 h)",unidad:"m2",cantidad:1,pu:1250},{descripcion:"Ayudante (0,25 h)",unidad:"m2",cantidad:1,pu:1250}],equipos:[],varios:[]}}),Xo=()=>({id:"apu_acond_termico_cielo_lana100",descripcion:"Acondicionamiento térmico de cielo entretechos (lana de vidrio 100 mm)",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Lana de vidrio 100 mm",unidad:"m2",cantidad:1,pu:4753}],manoObra:[{descripcion:"Maestro (0,2 h)",unidad:"m2",cantidad:1,pu:1e3},{descripcion:"Ayudante (0,2 h)",unidad:"m2",cantidad:1,pu:1e3}],equipos:[],varios:[]}}),$0=()=>({id:"apu_imper_muros_bano_2k",descripcion:"Impermeabilización muros de baño con membrana cementicia 2K (2 manos)",unidadSalida:"m2",categoria:"Impermeabilización",codigoExterno:"",secciones:{materiales:[{descripcion:"Membrana 2K (prorrateo)",unidad:"m2",cantidad:1,pu:10196},{descripcion:"Insumos",unidad:"m2",cantidad:1,pu:500}],manoObra:[{descripcion:"Maestro (0,3 h)",unidad:"m2",cantidad:1,pu:1688},{descripcion:"Ayudante (0,3 h)",unidad:"m2",cantidad:1,pu:1687}],equipos:[],varios:[]}}),B0=()=>({id:"apu_imper_muros_ext_asfaltica",descripcion:"Impermeabilización muros exteriores con pintura asfáltica (2 manos)",unidadSalida:"m2",categoria:"Impermeabilización",codigoExterno:"",secciones:{materiales:[{descripcion:"Igol denso (prorrateo)",unidad:"m2",cantidad:1,pu:3778},{descripcion:"Insumos",unidad:"m2",cantidad:1,pu:300}],manoObra:[{descripcion:"Maestro (0,25 h)",unidad:"m2",cantidad:1,pu:1407},{descripcion:"Ayudante (0,25 h)",unidad:"m2",cantidad:1,pu:1406}],equipos:[],varios:[]}}),el=()=>({id:"apu_excavacion_retiro_m3",descripcion:"Excavación y retiro",unidadSalida:"m3",categoria:"Movimiento de tierras",codigoExterno:"",secciones:{__meta:{obs:"Rendimiento base: 100–150 m³/día según suelo. Incluye carga, acopio y retiro."},materiales:[],manoObra:[{descripcion:"2 ayudantes",unidad:"m3",cantidad:1,pu:1186}],equipos:[{descripcion:"Retroexcavadora c/operador",unidad:"m3",cantidad:1,pu:5435},{descripcion:"Transporte y disposición",unidad:"m3",cantidad:1,pu:12451}],varios:[{descripcion:"Ajuste redondeo",unidad:"m3",cantidad:1,pu:-1}]}}),$d=()=>({id:"apu_base_estabilizada_10cm_m2",descripcion:"Base estabilizada 10 cm compactada",unidadSalida:"m2",categoria:"Movimiento de tierras",codigoExterno:"",secciones:{__meta:{obs:"Rendimiento 35–50 m²/jornada. Incluye humectación y nivelación. (EST.)"},materiales:[{descripcion:"Gravilla 0,10 m³/m² @ $30.000/m³",unidad:"m2",cantidad:1,pu:3e3}],manoObra:[{descripcion:"Mano de obra",unidad:"m2",cantidad:1,pu:1696}],equipos:[],varios:[]}}),Bd=()=>({id:"apu_encofrado_doble_cara_m2",descripcion:"Encofrado muros/cantos, doble cara",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{__meta:{obs:"Rendimiento: 12–18 m²/cuadrilla-día. Incluye armado y desencofrado."},materiales:[{descripcion:"Terciado estructural 18 mm prorrateo",unidad:"m2",cantidad:1,pu:8129},{descripcion:"Listones/amarres/clavos",unidad:"m2",cantidad:1,pu:2439},{descripcion:"Desmoldante",unidad:"m2",cantidad:1,pu:280}],manoObra:[{descripcion:"Mano de obra",unidad:"m2",cantidad:1,pu:4802}],equipos:[],varios:[]}}),ds=()=>({id:"apu_enfierradura_kg",descripcion:"Enfierradura colocada",unidadSalida:"kg",categoria:"Obra gruesa",codigoExterno:"",secciones:{__meta:{obs:"Rendimiento: 120–160 kg/jornada-cuadrilla."},materiales:[{descripcion:"Acero A63/420",unidad:"kg",cantidad:1,pu:1166},{descripcion:"Accesorios (alambre/separadores) 5%",unidad:"kg",cantidad:1,pu:58}],manoObra:[{descripcion:"Mano de obra",unidad:"kg",cantidad:1,pu:198}],equipos:[],varios:[]}}),tl=()=>({id:"apu_h25_obra_vibrado_m3",descripcion:"Hormigón H-25 hecho en obra + vibrado",unidadSalida:"m3",categoria:"Obra gruesa",codigoExterno:"",secciones:{__meta:{obs:"Incluye cemento, arena, grava, aditivo y 5% mermas. Vibrado incluido."},materiales:[{descripcion:"Materiales (c/5% mermas)",unidad:"m3",cantidad:1,pu:109462}],manoObra:[{descripcion:"Mano de obra",unidad:"m3",cantidad:1,pu:15456}],equipos:[{descripcion:"Betonera + vibrador",unidad:"m3",cantidad:1,pu:6295}],varios:[{descripcion:"Ajuste redondeo",unidad:"m3",cantidad:1,pu:26}]}}),al=()=>({id:"apu_curado_humedo_m2",descripcion:"Curado húmedo",unidadSalida:"m2",categoria:"Obra gruesa",codigoExterno:"",secciones:{__meta:{obs:"Procedimiento: riegos diarios 3–7 días."},materiales:[],manoObra:[{descripcion:"Mano de obra",unidad:"m2",cantidad:1,pu:183}],equipos:[],varios:[]}}),nl=()=>({id:"apu_imper_cementicia_2capas_m2",descripcion:"Impermeabilización cementicia 2 capas",unidadSalida:"m2",categoria:"Impermeabilización",codigoExterno:"",secciones:{__meta:{obs:"Rendimiento: 12–18 m²/jornada."},materiales:[{descripcion:"Mortero bicomponente",unidad:"m2",cantidad:1,pu:4436}],manoObra:[{descripcion:"Mano de obra",unidad:"m2",cantidad:1,pu:2747}],equipos:[],varios:[]}}),rl=()=>({id:"apu_pintura_piscina_2manos_m2",descripcion:"Pintura para piscina 2 manos",unidadSalida:"m2",categoria:"Terminaciones",codigoExterno:"",secciones:{__meta:{obs:"Rendimiento: 25–35 m²/jornada."},materiales:[{descripcion:"Pintura base solvente/tineta",unidad:"m2",cantidad:1,pu:3708}],manoObra:[{descripcion:"Mano de obra",unidad:"m2",cantidad:1,pu:1829}],equipos:[],varios:[]}}),qd=()=>({id:"apu_red_hid_pvc50_tuberia_ml",descripcion:"Tubería PVC Ø50 mm instalada",unidadSalida:"ml",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"ml",cantidad:1,pu:4056}]}}),q0=()=>({id:"apu_red_hid_codo_50_u",descripcion:"Codo Ø50 instalado",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"u",cantidad:1,pu:1500}]}}),V0=()=>({id:"apu_red_hid_tee_50_u",descripcion:"Tee Ø50 instalada",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"u",cantidad:1,pu:2790}]}}),Vd=()=>({id:"apu_red_hid_valvula_bola_50_u",descripcion:"Válvula bola Ø50 instalada",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"u",cantidad:1,pu:10090}]}}),H0=()=>({id:"apu_red_hid_skimmer_u",descripcion:"Skimmer instalado",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"u",cantidad:1,pu:67890}]}}),W0=()=>({id:"apu_red_hid_retorno_u",descripcion:"Retorno instalado",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"u",cantidad:1,pu:2e4}]}}),Q0=()=>({id:"apu_red_hid_desague_fondo_u",descripcion:"Desagüe de fondo instalado",unidadSalida:"u",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"u",cantidad:1,pu:41990}]}}),G0=()=>({id:"apu_red_hid_kit_filtro_bomba_set",descripcion:"Filtro + bomba 11 m³/h instalado y PM",unidadSalida:"set",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro e instalación",unidad:"set",cantidad:1,pu:274990}]}}),K0=()=>({id:"apu_red_hid_arena_filtro_saco",descripcion:"Arena de filtro 25 kg cargada",unidadSalida:"saco",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Suministro y carga",unidad:"saco",cantidad:1,pu:14990}]}}),J0=()=>({id:"apu_red_hid_pruebas_ls",descripcion:"Pruebas hidráulicas y cloración inicial",unidadSalida:"LS",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Valores hidráulicos coherentes con combo y fittings típicos; algunos EST."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Servicio LS",unidad:"LS",cantidad:1,pu:42e3}]}}),Hd=()=>({id:"apu_red_hid_conjunto_set",descripcion:"Red hidráulica y equipos (conjunto)",unidadSalida:"set",categoria:"Instalaciones sanitarias",codigoExterno:"",secciones:{__meta:{obs:"Conjunto base con 1 de cada ítem. Ajusta cantidades (ml/u) según diseño y largo de tendidos."},materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Tubería PVC Ø50 mm instalada",unidad:"ml",cantidad:30,pu:4056},{descripcion:"Codo Ø50 instalado",unidad:"u",cantidad:10,pu:1500},{descripcion:"Tee Ø50 instalada",unidad:"u",cantidad:2,pu:2790},{descripcion:"Válvula bola Ø50 instalada",unidad:"u",cantidad:2,pu:10090},{descripcion:"Skimmer instalado",unidad:"u",cantidad:2,pu:67890},{descripcion:"Retorno instalado",unidad:"u",cantidad:3,pu:2e4},{descripcion:"Desagüe de fondo instalado",unidad:"u",cantidad:1,pu:41990},{descripcion:"Filtro + bomba 11 m³/h instalado y PM",unidad:"set",cantidad:1,pu:274990},{descripcion:"Arena de filtro 25 kg cargada",unidad:"saco",cantidad:4,pu:14990},{descripcion:"Pruebas hidráulicas y cloración inicial",unidad:"LS",cantidad:1,pu:42e3},{descripcion:"Ajuste redondeo",unidad:"LS",cantidad:1,pu:-160}]}}),Y0=()=>({id:"apu_antepecho_12x20_hoa",descripcion:"Antepecho HºA 12×20 cm armado",unidadSalida:"m",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Hormigón en saco (0,024 m³/ml)",unidad:"m",cantidad:1,pu:4860},{descripcion:"Acero Ø10 (≈3,4 kg/ml)",unidad:"m",cantidad:1,pu:3960},{descripcion:"Encofrado amort. (5 usos)",unidad:"m",cantidad:1,pu:832}],manoObra:[{descripcion:"Maestro (0,5 h)",unidad:"m",cantidad:1,pu:2813},{descripcion:"Ayudante (0,5 h)",unidad:"m",cantidad:1,pu:2812}],equipos:[],varios:[]}}),Z0=()=>({id:"apu_limahoya_metal_flashband",descripcion:"Limahoya metálica + tapajuntas autoadhesivo",unidadSalida:"m",categoria:"Techumbre",codigoExterno:"",secciones:{materiales:[{descripcion:"Limahoya metálica (prorrateo)",unidad:"m",cantidad:1,pu:3663},{descripcion:"Cinta Flashband (prorrateo)",unidad:"m",cantidad:1,pu:1800},{descripcion:"Tornillos techo",unidad:"m",cantidad:1,pu:690}],manoObra:[{descripcion:"Maestro (0,2 h)",unidad:"m",cantidad:1,pu:1125},{descripcion:"Ayudante (0,2 h)",unidad:"m",cantidad:1,pu:1125}],equipos:[],varios:[]}}),X0=()=>({id:"apu_dintel_12x20_hoa",descripcion:"Dintel HºA 12×20 cm sobre vano",unidadSalida:"m",categoria:"Obra gruesa",codigoExterno:"",secciones:{materiales:[{descripcion:"Antepecho base (hormigón + acero + encofrado)",unidad:"m",cantidad:1,pu:9652},{descripcion:"Pernos/amarres",unidad:"m",cantidad:1,pu:500}],manoObra:[{descripcion:"Maestro (0,5 h)",unidad:"m",cantidad:1,pu:2813},{descripcion:"Ayudante (0,5 h)",unidad:"m",cantidad:1,pu:2812}],equipos:[],varios:[]}}),eh=()=>({id:"apu_pasamanos_madera_interior",descripcion:"Baranda y pasamanos interior madera",unidadSalida:"m",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Pasamanos pino",unidad:"m",cantidad:1,pu:7663},{descripcion:"Soportes pared (1,25 u/m)",unidad:"m",cantidad:1,pu:14375},{descripcion:"Tornillería",unidad:"m",cantidad:1,pu:375}],manoObra:[{descripcion:"Maestro (0,3 h)",unidad:"m",cantidad:1,pu:1688},{descripcion:"Ayudante (0,3 h)",unidad:"m",cantidad:1,pu:1687}],equipos:[],varios:[]}}),th=()=>({id:"apu_baranda_metal_simple",descripcion:"Pasamanos/Baranda metálica simple 20×20×2 mm",unidadSalida:"m",categoria:"Terminaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Tubo cuadrado 20×20×2 mm",unidad:"m",cantidad:1,pu:1198},{descripcion:"Pintura",unidad:"m",cantidad:1,pu:700},{descripcion:"Fijaciones",unidad:"m",cantidad:1,pu:300}],manoObra:[{descripcion:"Maestro (0,5 h)",unidad:"m",cantidad:1,pu:2813},{descripcion:"Ayudante (0,5 h)",unidad:"m",cantidad:1,pu:2812}],equipos:[],varios:[]}}),ah=()=>({id:"apu_conector_viga_apoyo",descripcion:"Conector estructural viga a apoyo",unidadSalida:"u",categoria:"Estructura madera",codigoExterno:"",secciones:{materiales:[{descripcion:"Soporte Simpson Strong-Tie",unidad:"u",cantidad:1,pu:2490},{descripcion:"Tornillos (prorrateo)",unidad:"u",cantidad:1,pu:203}],manoObra:[{descripcion:"Maestro (0,1 h)",unidad:"u",cantidad:1,pu:563},{descripcion:"Ayudante (0,1 h)",unidad:"u",cantidad:1,pu:562}],equipos:[],varios:[]}}),nh=()=>({id:"apu_estabil_talud_geotextil",descripcion:"Estabilización de talud con geotextil y estacas",unidadSalida:"m2",categoria:"Movimiento de tierras",codigoExterno:"",secciones:{materiales:[{descripcion:"Geotextil 1×10 m (prorrateo)",unidad:"m2",cantidad:1,pu:1200},{descripcion:"Estacas pino (0,5 u/m²)",unidad:"m2",cantidad:1,pu:875}],manoObra:[{descripcion:"Maestro (0,25 h)",unidad:"m2",cantidad:1,pu:1407},{descripcion:"Ayudante (0,25 h)",unidad:"m2",cantidad:1,pu:1406}],equipos:[],varios:[]}}),rh=()=>({id:"apu_serv_topografia_lote_urbano",descripcion:"Levantamiento topográfico lote urbano <1.000 m²",unidadSalida:"u",categoria:"Servicios",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Servicio topográfico",unidad:"u",cantidad:1,pu:18e4}]}}),ih=()=>({id:"apu_serv_proctor_dr",descripcion:"Ensayo Proctor/DR en obra chica",unidadSalida:"u",categoria:"Servicios",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Ensayo Proctor/DR",unidad:"u",cantidad:1,pu:85e3}]}}),sh=()=>({id:"apu_serv_mecanica_suelos_calicata",descripcion:"Informe mecánica de suelos (1 calicata + recomendación)",unidadSalida:"u",categoria:"Servicios",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Mecánica de suelos",unidad:"u",cantidad:1,pu:42e4}]}}),oh=()=>({id:"apu_serv_te1_empalme_40a",descripcion:"Trámite TE1 + empalme 40 A + puesta a tierra básica",unidadSalida:"u",categoria:"Servicios",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Servicio eléctrico",unidad:"u",cantidad:1,pu:18e4}]}}),lh=()=>({id:"apu_serv_empalme_sanitario",descripcion:"Empalme sanitario domiciliario",unidadSalida:"u",categoria:"Servicios",codigoExterno:"",secciones:{materiales:[],manoObra:[],equipos:[],varios:[{descripcion:"Servicio sanitario (estimado)",unidad:"u",cantidad:1,pu:5e5}]}}),ch=()=>({id:"apu_vent_higroregulada_bano_cocina",descripcion:"Ventilación higroregulada en baños/cocina (rejilla + mano de obra)",unidadSalida:"u",categoria:"Instalaciones",codigoExterno:"",secciones:{materiales:[{descripcion:"Rejilla admisión",unidad:"u",cantidad:1,pu:6e3}],manoObra:[{descripcion:"Maestro (instalación)",unidad:"u",cantidad:1,pu:1688},{descripcion:"Ayudante (instalación)",unidad:"u",cantidad:1,pu:1687}],equipos:[],varios:[]}}),Wd=V.useRef(!1);q.useEffect(()=>{var Ze,Te,Be;if(Wd.current)return;Wd.current=!0;try{const he=localStorage.getItem("apu-library"),pe=he?JSON.parse(he):[];if(Array.isArray(pe)&&pe.length){let Ae=!1;const ke=pe.map(ze=>{const be=ze&&ze.secciones?ze.secciones:null,se=be&&Array.isArray(be.manoObra)?be.manoObra:null;if(!se||se.length!==1)return ze;const Ne=se[0]||{},xe=String(Ne.descripcion||"").trim();if(/^maestro|^ayudante/i.test(xe)||!xe&&!Number(Ne.pu))return ze;const $e=Number(Ne.cantidad)||0,qe=Number(Ne.pu)||0;if(qe<=0||$e<0)return ze;const ut=Math.floor(qe/2),st=qe-ut,Ke=String(Ne.unidad||""),Ut={descripcion:`Maestro — ${xe||"MO"}`,unidad:Ke,cantidad:$e,pu:ut},Xa={descripcion:`Ayudante — ${xe||"MO"}`,unidad:Ke,cantidad:$e,pu:st};return Ae=!0,{...ze,secciones:{...be,manoObra:[Ut,Xa]}}});Ae&&K(ke)}}catch{}try{const he=localStorage.getItem("apu-library"),pe=he?JSON.parse(he):[];if(Array.isArray(pe)&&pe.length){let Ae=!1;const ke=be=>{const se=(be||"").toLowerCase();return/excavación|relleno|talud|zanja/.test(se)?"Movimiento de tierras":/losa|radier|h-?25|h-?20|hormigón|hº|zapata|sobrecimiento|muro|dintel|antepecho|albañilería|ladrillo|contención/.test(se)?"Obra gruesa":/techumbre|cubierta|canaleta|cumbrera|limahoya|fieltro|barrera.*humedad/.test(se)?"Techumbre":/revestimiento.*exterior|fachada/.test(se)?"Fachada":/pintura|piso|cerámica|tabique|yeso|cielo|sello|pasamanos|baranda|acondicionamiento térmico|lana/.test(se)?"Terminaciones":/sanitaria|biodigestor|empalme sanitario/.test(se)?"Instalaciones sanitarias":/eléctric|te1|ventilación mecánica|extractor/.test(se)?"Instalaciones eléctricas":/impermeabiliz|membrana|asfáltica|igol/.test(se)?"Impermeabilización":/estructura.*madera|entramado|conector viga/.test(se)?"Estructura madera":/ventana|puerta|abertura/.test(se)?"Aberturas":/topograf|proctor|mecánica de suelos|servicio/.test(se)?"Servicios":/ventilación.*higro/.test(se)?"Instalaciones":"Otros"},ze=pe.map(be=>{if(String(be&&be.categoria||"").trim())return be;const Ne=ke(String((be==null?void 0:be.descripcion)||""));return Ae=!0,{...be,categoria:Ne}});Ae&&K(ze)}}catch{}const l="apu_h25_obra",d=M.find(he=>he.id===l);if(d){try{const pe=((Ze=d==null?void 0:d.secciones)==null?void 0:Ze.manoObra)||[];if(Array.isArray(pe)&&pe.length===1&&/maestro|cuadrilla|ayudante/i.test(String(((Te=pe[0])==null?void 0:Te.descripcion)||""))){const Ne=Math.round(12535.257575757576),xe=Math.round(480457/22/3),qe=[{...d,secciones:{...d.secciones||{},manoObra:[{descripcion:"Maestro (rend. 3 m³/jornada)",unidad:"m3",cantidad:1,pu:Ne},{descripcion:"Ayudante (rend. 3 m³/jornada)",unidad:"m3",cantidad:1,pu:xe}]}},...Y.filter(ut=>ut.id!==l)];K(qe)}}catch{}if(((Be=Y[0])==null?void 0:Be.id)!==l){const pe=Y.map(ke=>ke.id===l?d:ke),Ae=[d,...pe.filter(ke=>ke.id!==l)];K(Ae)}}else{const he=[ri(),...Y];K(he)}const c=()=>{try{return JSON.parse(localStorage.getItem("apu-library")||"[]")}catch{return Y}},f="apu_moldaje_terciado_m2",g="apu_muro_ladrillo_m2",m=c(),x=Array.isArray(m)&&m.some(he=>he.id===f),S=Array.isArray(m)&&m.some(he=>he.id===g);let h=m;x||(h=[...h,$a()]),S||(h=[...h,je()]);const A=h.find(he=>he.id===l),G=h.find(he=>he.id===f),z=h.find(he=>he.id===g);if(A||G||z){const he=h.filter(Ae=>Ae.id!==l&&Ae.id!==f&&Ae.id!==g),pe=[A,G,z,...he].filter(Boolean);K(pe)}let B=(()=>{try{return JSON.parse(localStorage.getItem("apu-library")||"[]")}catch{return Y}})();const J=[["apu_mortero_estuco_cementicio_m2",g0],["apu_cerchas_pino_techo_m2",x0],["apu_puerta_madera_maciza_90x200_u",_0],["apu_exc_zanja_manual",qa],["apu_relleno_compact_manual",oe],["apu_hormigon_zapata_corrida_ml",Ve],["apu_radier_h25_10cm_malla_polietileno",Xe],["apu_albanileria_ladrillo_fiscal_m2",Et],["apu_tabique_metalcon_90_doble_placa",le],["apu_cielo_yeso_carton_12_5_sobre_perf",Qe],["apu_estructura_techumbre_madera",Je],["apu_cubierta_zinc_0_35_fieltro",zt],["apu_techumbre_teja_asfaltica_m2",Va],["apu_canaleta_pvc_4_instalada",qt],["apu_bajada_lluvias_pvc_75_instalada",Pa],["apu_revestimiento_exterior_fibro_6mm_sobre_liston",Hn],["apu_muro_ext_2x4_osb11_lana80_fc6_pint",ba],["apu_piso_ceramica_60x60",Ko],["apu_piso_porcelanato_60x60",vt],["apu_piso_ceramica_base",Ha],["apu_piso_flotante_7mm",xn],["apu_ceramica_muro_bano",oi],["apu_pintura_interior_latex_muros",Jo],["apu_pintura_exterior_fibro",br],["apu_tabique_2x4_volcanita_simple",yr],["apu_ventana_aluminio_120x100_instalada",m0],["apu_puerta_interior_mdf_70x200_instalada",Yo],["apu_losa_12cm_malla_c92",E0],["apu_entramado_2x8_osb18",P0],["apu_sobrecimiento_20x20_h20",M0],["apu_barrera_humedad_vent_entretechos",T0],["apu_cumbreras_metalicas",O0],["apu_imper_membrana_3mm_losa",R0],["apu_saneamiento_basico_biodigestor",L0],["apu_vent_mecanica_local_100mm",z0],["apu_sellos_hermeticidad_vanos",F0],["apu_sellos_cortafuego_pasamuros",U0],["apu_muro_contencion_hoa_20cm_dren",D0],["apu_acond_termico_muros_lana100_bv",Dd],["apu_acond_termico_cielo_lana100",Xo],["apu_imper_muros_bano_2k",$0],["apu_imper_muros_ext_asfaltica",B0],["apu_antepecho_12x20_hoa",Y0],["apu_limahoya_metal_flashband",Z0],["apu_dintel_12x20_hoa",X0],["apu_pasamanos_madera_interior",eh],["apu_baranda_metal_simple",th],["apu_conector_viga_apoyo",ah],["apu_estabil_talud_geotextil",nh],["apu_serv_topografia_lote_urbano",rh],["apu_serv_proctor_dr",ih],["apu_serv_mecanica_suelos_calicata",sh],["apu_serv_te1_empalme_40a",oh],["apu_serv_empalme_sanitario",lh],["apu_vent_higroregulada_bano_cocina",ch],["apu_electrica_completa_gl",cs],["apu_sanitaria_completa_gl",Pt],["apu_terminaciones_menores_ml",ct],["apu_tramite_dom_permiso",We],["apu_tramite_calculo_estructural",bt],["apu_tramite_recepcion_final",Kt],["apu_tramite_te1_sec",Ea],["apu_excavacion_retiro_m3",el],["apu_base_estabilizada_10cm_m2",$d],["apu_encofrado_doble_cara_m2",Bd],["apu_enfierradura_kg",ds],["apu_h25_obra_vibrado_m3",tl],["apu_curado_humedo_m2",al],["apu_imper_cementicia_2capas_m2",nl],["apu_pintura_piscina_2manos_m2",rl],["apu_red_hid_pvc50_tuberia_ml",qd],["apu_red_hid_codo_50_u",q0],["apu_red_hid_tee_50_u",V0],["apu_red_hid_valvula_bola_50_u",Vd],["apu_red_hid_skimmer_u",H0],["apu_red_hid_retorno_u",W0],["apu_red_hid_desague_fondo_u",Q0],["apu_red_hid_kit_filtro_bomba_set",G0],["apu_red_hid_arena_filtro_saco",K0],["apu_red_hid_pruebas_ls",J0],["apu_red_hid_conjunto_set",Hd],["apu_subbase_estab_15cm_m2",b0],["apu_muro_ext_23_osb_house_lana_yeso_m2",y0],["apu_eifs_40mm_m2",S0],["apu_siding_vinilico_m2",w0],["apu_cubierta_teja_asfaltica_osb_fieltro_m2",j0],["apu_revest_ceramico_muro_30x60_m2",Fd],["apu_cielo_pvc_tablilla_20cm_m2",N0],["apu_carpeta_autonivelante_5mm_m2",C0],["apu_pav_ext_h25_8cm_malla_m2",Ud],["apu_camara_inspeccion_pvc_50x50x60_u",A0],["apu_trampa_grasas_50l_u",k0],["apu_cierre_perimetral_malla_2m_postes_ml",I0]],Ce=new Set((B||[]).map(he=>he.id));J.forEach(([he,pe])=>{Ce.has(he)||(B=[...B,pe()],Ce.add(he))});const ve=new Map(J);B=(B||[]).map(he=>{if(!ve.has(he.id))return he;try{const pe=ve.get(he.id)(),Ae=he.secciones||{},ke=Array.isArray(Ae.materiales)&&Ae.materiales.length>0,ze=Array.isArray(Ae.manoObra)&&Ae.manoObra.length>0,be=Array.isArray(Ae.varios)&&Ae.varios.length>0;if(!Ae||!ke||!ze||!be)return{...he,secciones:pe.secciones,unidadSalida:he.unidadSalida||pe.unidadSalida,categoria:he.categoria||pe.categoria}}catch{}return he});const ue=[l,f,g,"apu_mortero_estuco_cementicio_m2","apu_cerchas_pino_techo_m2","apu_puerta_madera_maciza_90x200_u","apu_excavacion_retiro_m3","apu_base_estabilizada_10cm_m2","apu_encofrado_doble_cara_m2","apu_enfierradura_kg","apu_h25_obra_vibrado_m3","apu_curado_humedo_m2","apu_imper_cementicia_2capas_m2","apu_pintura_piscina_2manos_m2","apu_red_hid_pvc50_tuberia_ml","apu_red_hid_codo_50_u","apu_red_hid_tee_50_u","apu_red_hid_valvula_bola_50_u","apu_red_hid_skimmer_u","apu_red_hid_retorno_u","apu_red_hid_desague_fondo_u","apu_red_hid_kit_filtro_bomba_set","apu_red_hid_arena_filtro_saco","apu_red_hid_pruebas_ls","apu_red_hid_conjunto_set","apu_exc_zanja_manual","apu_relleno_compact_manual","apu_hormigon_zapata_corrida_ml","apu_radier_h25_10cm_malla_polietileno","apu_albanileria_ladrillo_fiscal_m2","apu_tabique_metalcon_90_doble_placa","apu_cielo_yeso_carton_12_5_sobre_perf","apu_estructura_techumbre_madera","apu_cubierta_zinc_0_35_fieltro","apu_techumbre_teja_asfaltica_m2","apu_canaleta_pvc_4_instalada","apu_bajada_lluvias_pvc_75_instalada","apu_revestimiento_exterior_fibro_6mm_sobre_liston","apu_muro_ext_2x4_osb11_lana80_fc6_pint","apu_piso_ceramica_60x60","apu_piso_porcelanato_60x60","apu_piso_ceramica_base","apu_piso_flotante_7mm","apu_ceramica_muro_bano","apu_pintura_interior_latex_muros","apu_pintura_exterior_fibro","apu_tabique_2x4_volcanita_simple","apu_ventana_aluminio_120x100_instalada","apu_puerta_interior_mdf_70x200_instalada","apu_losa_12cm_malla_c92","apu_entramado_2x8_osb18","apu_sobrecimiento_20x20_h20","apu_barrera_humedad_vent_entretechos","apu_cumbreras_metalicas","apu_imper_membrana_3mm_losa","apu_saneamiento_basico_biodigestor","apu_vent_mecanica_local_100mm","apu_sellos_hermeticidad_vanos","apu_sellos_cortafuego_pasamuros","apu_muro_contencion_hoa_20cm_dren","apu_acond_termico_muros_lana100_bv","apu_acond_termico_cielo_lana100","apu_imper_muros_bano_2k","apu_imper_muros_ext_asfaltica","apu_antepecho_12x20_hoa","apu_limahoya_metal_flashband","apu_dintel_12x20_hoa","apu_pasamanos_madera_interior","apu_baranda_metal_simple","apu_conector_viga_apoyo","apu_estabil_talud_geotextil","apu_serv_topografia_lote_urbano","apu_serv_proctor_dr","apu_serv_mecanica_suelos_calicata","apu_serv_te1_empalme_40a","apu_serv_empalme_sanitario","apu_vent_higroregulada_bano_cocina","apu_electrica_completa_gl","apu_sanitaria_completa_gl","apu_terminaciones_menores_ml","apu_tramite_dom_permiso","apu_tramite_calculo_estructural","apu_tramite_recepcion_final","apu_tramite_te1_sec","apu_subbase_estab_15cm_m2","apu_muro_ext_23_osb_house_lana_yeso_m2","apu_eifs_40mm_m2","apu_siding_vinilico_m2","apu_cubierta_teja_asfaltica_osb_fieltro_m2","apu_revest_ceramico_muro_30x60_m2","apu_cielo_pvc_tablilla_20cm_m2","apu_carpeta_autonivelante_5mm_m2","apu_pav_ext_h25_8cm_malla_m2","apu_camara_inspeccion_pvc_50x50x60_u","apu_trampa_grasas_50l_u","apu_cierre_perimetral_malla_2m_postes_ml"],Ge=new Map((B||[]).map(he=>[he.id,he])),Ue=ue.map(he=>Ge.get(he)).filter(Boolean),ae=new Set(Ue.map(he=>he.id)),Le=(B||[]).filter(he=>!ae.has(he.id));K([...Ue,...Le])},[M,Y,K]);const[Qd]=q.useState("all"),[il,dh]=q.useState(""),[sl,uh]=q.useState("all"),[Gd,ph]=wa("lib-hide-incomplete",!1),[mh,us]=q.useState(!1),[fh,ol]=q.useState(!1),[hh,ll]=q.useState(!1),[li,cl]=q.useState(null),[Mt,ci]=q.useState(null),[Ct,dt]=q.useState(null),Sr=l=>String(l||"").startsWith("custom_"),ps=V.useCallback(l=>{const d=(M||[]).find(f=>String((f==null?void 0:f.id)||"")===String(l||""));if(d)return d;const c=($s||[]).find(f=>String((f==null?void 0:f.id)||"")===String(l||""));if(c)return c;throw new Error("APU no encontrado")},[M]),Kd=l=>{if(Mt===l){ci(null),dt(null);return}const d=ps(l),c=()=>{const m={materiales:[],equipos:[],manoObra:[],varios:[],extras:[],__meta:{}},x=Array.isArray(d.items)?d.items:[];for(const h of x){if((h==null?void 0:h.tipo)==="coef"||(h==null?void 0:h.tipo)==="rendimiento"){const A=o[h.resourceId];if(!A)continue;const z=h.tipo==="coef"?Number(h.coef||0)*(1+Number(h.merma||0)):1/Math.max(1,Number(h.rendimiento||1)),Q=Number(A.precio||0),B={descripcion:A.nombre,unidad:A.unidad,cantidad:z,pu:Q};switch(A.tipo){case"material":m.materiales.push(B);break;case"equipo":m.equipos.push(B);break;case"mano_obra":m.manoObra.push(B);break;default:m.varios.push(B);break}continue}if((h==null?void 0:h.tipo)==="subapu"){try{const A=String(h.apuRefId||""),G=C(A),z=yt(G,o).unit||0,Q=h.coef??(h.rendimiento?1/(Number(h.rendimiento)||1):1),B={descripcion:`SubAPU ${A}`,unidad:"u",cantidad:Q,pu:z};m.varios.push(B)}catch{}continue}}const S=h=>h&&h.length>0?h:[{descripcion:"",unidad:"",cantidad:0,pu:0}];return{materiales:S(m.materiales),equipos:S(m.equipos),manoObra:S(m.manoObra),varios:S(m.varios),extras:Array.isArray(m.extras)?m.extras:[],__meta:m.__meta}},f=d.secciones||c(),g={descripcion:d.descripcion||"",unidadSalida:d.unidadSalida||"",categoria:d.categoria||"",secciones:f};ci(l),dt(g)},ms=(l,d,c)=>{dt(f=>{var m;const g=[...((m=f.secciones)==null?void 0:m[l])||[]];return g[d]={...g[d],...c},{...f,secciones:{...f.secciones,[l]:g}}})},gh=l=>{dt(d=>{var f;const c=[...((f=d.secciones)==null?void 0:f[l])||[]];return c.push({descripcion:"",unidad:"",cantidad:0,pu:0}),{...d,secciones:{...d.secciones,[l]:c}}})},xh=(l,d)=>{dt(c=>{var g;const f=[...((g=c.secciones)==null?void 0:g[l])||[]];return f.splice(d,1),{...c,secciones:{...c.secciones,[l]:f}}})},_h=l=>{dt(d=>({...d,secciones:{...d.secciones||{},__meta:{...(d.secciones||{}).__meta||{},...l}}}))},vh=()=>{dt(l=>{const d={...(l==null?void 0:l.secciones)||{}},c=["materiales","manoObra","equipos","varios"];let f=null;for(const m of c)if(Array.isArray(d[m])){f=m;break}f||(f="materiales",d[f]=[]);const g=Array.isArray(d[f])?[...d[f]]:[];return g.push({descripcion:"",unidad:"",cantidad:0,pu:0}),{...l,secciones:{...d,[f]:g}}})},bh=()=>{const l=(prompt("Nombre de la nueva sección:")||"").trim();l&&dt(d=>{var f;const c=Array.isArray((f=d.secciones)==null?void 0:f.extras)?[...d.secciones.extras]:[];return c.push({title:l,rows:[{descripcion:"",unidad:"",cantidad:0,pu:0}]}),{...d,secciones:{...d.secciones,extras:c}}})},fs=(l,d,c)=>{dt(f=>{var S;const g=Array.isArray((S=f.secciones)==null?void 0:S.extras)?[...f.secciones.extras]:[];if(!g[l])return f;const m={...g[l]},x=Array.isArray(m.rows)?[...m.rows]:[];return x[d]={...x[d],...c},g[l]={...m,rows:x},{...f,secciones:{...f.secciones,extras:g}}})},yh=l=>{dt(d=>{var m;const c=Array.isArray((m=d.secciones)==null?void 0:m.extras)?[...d.secciones.extras]:[];if(!c[l])return d;const f={...c[l]},g=Array.isArray(f.rows)?[...f.rows]:[];return g.push({descripcion:"",unidad:"",cantidad:0,pu:0}),c[l]={...f,rows:g},{...d,secciones:{...d.secciones,extras:c}}})},Sh=(l,d)=>{dt(c=>{var x;const f=Array.isArray((x=c.secciones)==null?void 0:x.extras)?[...c.secciones.extras]:[];if(!f[l])return c;const g={...f[l]},m=Array.isArray(g.rows)?[...g.rows]:[];return m.splice(d,1),f[l]={...g,rows:m},{...c,secciones:{...c.secciones,extras:f}}})},wh=()=>{if(!Mt||!Ct)return;if(M.find(d=>d.id===Mt)){const d=M.map(c=>c.id===Mt?{...c,descripcion:Ct.descripcion,unidadSalida:Ct.unidadSalida,categoria:Ct.categoria||"",secciones:Ct.secciones,items:void 0}:c);K(d),t("APU actualizado","success")}else t("APU no encontrado","error");ci(null),dt(null)},Jd=l=>{if(!(l!=null&&l.descripcion)||!l.descripcion.trim()||!(l!=null&&l.unidadSalida)||!l.unidadSalida.trim()){us(!0),t("Completa descripción y unidad","error");return}const d={...l,id:"custom_"+Ie(),categoria:l.categoria||"",items:l.items||[]},c=[...Y,d];if(K(c),us(!1),gu){const f=Ee.map(g=>{if(g.id!==gu)return g;const m=g.apuIds&&g.apuIds.length?g.apuIds:g.apuId?[g.apuId]:[],x=m.includes(d.id)?m:[...m,d.id];return{...g,apuIds:x,apuId:x[0]||null}});it(f),at(f),Yh(null),i("presupuesto"),t("APU creado y asignado","success"),setTimeout(()=>Nr({open:!0,id:d.id}),0)}else t("APU creado","success"),setTimeout(()=>Nr({open:!0,id:d.id}),0)},Yd=V.useCallback(l=>{const d=Y.find(c=>c.id===l);d&&(cl(d),ll(!0))},[Y]),jh=l=>{if(!li)return;const d=Y.map(c=>c.id===li.id?{...li,...l,categoria:l.categoria??li.categoria??""}:c);K(d),ll(!1),cl(null),t("APU modificado","success")};q.useEffect(()=>{const l=d=>{var f;const c=(f=d==null?void 0:d.detail)==null?void 0:f.id;c&&(i("biblioteca"),Yd(c))};return window.addEventListener("apu-edit-request",l),()=>window.removeEventListener("apu-edit-request",l)},[Y,Yd]);const Zd=l=>{const d=[];try{for(const c of Ee){if((c!=null&&c.apuIds&&c.apuIds.length?c.apuIds:c!=null&&c.apuId?[String(c.apuId)]:[]).includes(l)){const m=`${c!=null&&c.codigo?c.codigo+" · ":""}${(c==null?void 0:c.descripcion)||"Partida"}`.trim();d.push({rowId:c.id,label:m})}const g=Array.isArray(c==null?void 0:c.subRows)?c.subRows:[];for(const m of g)if((Array.isArray(m==null?void 0:m.apuIds)?m.apuIds:[]).includes(l)){const S=`${c!=null&&c.codigo?c.codigo+" · ":""}${(c==null?void 0:c.descripcion)||"Partida"} › ${(m==null?void 0:m.descripcion)||"Subpartida"}`.trim();d.push({rowId:c.id,subId:m.id,label:S})}}}catch{}return d},dl=(l,d)=>{const c=Zd(l);if(c.length>0){const g=c.slice(0,6).map(x=>`• ${x.label}`),m=c.length>6?`
… y ${c.length-6} referencia(s) más`:"";alert(["No se puede eliminar este APU porque está en uso en el presupuesto activo.","",...g,m,"","Primero elimínalo de esas partidas/subpartidas y vuelve a intentarlo."].filter(Boolean).join(`
`));return}if(!(d!=null&&d.skipConfirm)&&!confirm("¿Eliminar este APU de la biblioteca?"))return;const f=(M||[]).filter(g=>g.id!==l);K(f),d!=null&&d.silent||t("APU eliminado","info")},ul=V.useCallback(()=>{try{return JSON.parse(localStorage.getItem("apu-chapters")||"[]")}catch{return[]}},[]),na=V.useCallback(l=>{try{localStorage.setItem("apu-chapters",JSON.stringify(l))}catch{}},[]),Xd=V.useCallback(()=>{try{return localStorage.getItem("apu-current-chapter")||""}catch{return""}},[]),Ma=V.useCallback(l=>{try{localStorage.setItem("apu-current-chapter",l)}catch{}},[]),[Re,Jt]=q.useState(()=>ul()),[Yt,ya]=q.useState(()=>{var c;const l=Xd();if(l)return l;const d=ul();return((c=d[d.length-1])==null?void 0:c.id)||""}),eu=()=>{const l=(prompt("Letra del capítulo (ej: A):")||"").trim(),d=(prompt("Título del capítulo:")||"").trim();if(!l&&!d)return;const c={id:Ie(),letter:l||"-",title:d||"TÍTULO"},f=[...Re,c];Jt(f),na(f),ya(c.id),Ma(c.id)},Nh=l=>{if(!Re.find(m=>m.id===l))return;const c=(prompt("Título del subcapítulo:")||"").trim();if(!c)return;const f={id:Ie(),title:c},g=Re.map(m=>m.id===l?{...m,subChapters:[...m.subChapters||[],f]}:m);Jt(g),na(g),t("Subcapítulo agregado","success")},Ch=(l,d)=>{const c=Re.find(x=>x.id===l);if(!c)return;const f=(c.subChapters||[]).find(x=>x.id===d);if(!f)return;const g=(prompt("Nuevo título del subcapítulo:",f.title)||"").trim();if(!g)return;const m=Re.map(x=>x.id===l?{...x,subChapters:(x.subChapters||[]).map(S=>S.id===d?{...S,title:g}:S)}:x);Jt(m),na(m),t("Subcapítulo renombrado","success")},Ah=(l,d)=>{if(!Re.find(g=>g.id===l)||!confirm("¿Eliminar este subcapítulo?"))return;const f=Re.map(g=>g.id===l?{...g,subChapters:(g.subChapters||[]).filter(m=>m.id!==d)}:g);Jt(f),na(f),t("Subcapítulo eliminado","info")},kh=l=>{const d=Re.find(m=>m.id===l);if(!d)return;const c=(prompt("Nueva letra del capítulo:",d.letter)||"").trim(),f=(prompt("Nuevo título del capítulo:",d.title)||"").trim();if(!c&&!f)return;const g=Re.map(m=>m.id===l?{...m,letter:c||m.letter,title:f||m.title}:m);Jt(g),na(g)},Ih=l=>{var x,S;const d=Re.find(h=>h.id===l);if(!d)return;const c=Ee.filter(h=>h.chapterId===l),f=Re.filter(h=>h.id!==l);if(c.length>0&&f.length===0){alert("No puedes eliminar el capítulo porque tiene partidas y no hay otro capítulo para moverlas. Crea otro capítulo primero.");return}if(!confirm(`¿Eliminar capítulo ${d.letter} — ${d.title}?${c.length>0?`
Las partidas se moverán al capítulo activo.`:""}`))return;let g=Yt&&Yt!==l?Yt:((x=f[0])==null?void 0:x.id)||"";if(c.length>0&&g){const h=Ee.map(A=>A.chapterId===l?{...A,chapterId:g}:A);it(h),at(h)}const m=Re.filter(h=>h.id!==l);if(Jt(m),na(m),Yt===l){const h=((S=m[m.length-1])==null?void 0:S.id)||"";ya(h),Ma(h)}},Eh=(l,d)=>{const c=Ee.map(f=>f.id===l?{...f,chapterId:d}:f);it(c),at(c)},tu=V.useCallback(()=>{try{return JSON.parse(localStorage.getItem("apu-budget")||"[]")}catch{return[]}},[]),at=V.useCallback(l=>{try{localStorage.setItem("apu-budget",JSON.stringify(l))}catch{}},[]),[Ee,it]=q.useState(()=>{const l=tu()||[];return l.length?l:[]}),au=q.useRef(!1);q.useEffect(()=>{if(!au.current){au.current=!0;try{let l=!1,d=0;const c=Ee.map(f=>{var x;const g=Array.isArray(f==null?void 0:f.apuIds)&&f.apuIds.length?f.apuIds:f!=null&&f.apuId?[String(f.apuId)]:[],m=Array.isArray(f==null?void 0:f.subRows)?f.subRows:[];if(g.length>0&&m.length===0){let S="";try{S=((x=C(g[0]))==null?void 0:x.unidadSalida)||""}catch{}const h={id:Ie(),descripcion:f.descripcion||"Subpartida",unidadSalida:f.unidadSalida||S||"",metrados:Number(f.metrados||0)||1,apuIds:Array.from(new Set(g)),overrideUnitPrice:typeof(f==null?void 0:f.overrideUnitPrice)=="number"&&Number.isFinite(f==null?void 0:f.overrideUnitPrice)?f==null?void 0:f.overrideUnitPrice:void 0,overrideTotal:typeof(f==null?void 0:f.overrideTotal)=="number"&&Number.isFinite(f==null?void 0:f.overrideTotal)?f==null?void 0:f.overrideTotal:void 0,_migrated:!0};return l=!0,d++,{...f,apuIds:[],apuId:null,subRows:[h]}}return f});if(l){it(c),at(c);try{t(`${d} partida(s) convertidas a subpartidas`,"info")}catch{}}}catch{}}},[Ee,at,C,t]);const[Zt,pl]=q.useState({open:!1,apuId:null,usages:[],targetId:""}),nu=l=>{try{const d=Zd(l);pl({open:!0,apuId:l,usages:d,targetId:""})}catch{}},ru=()=>pl({open:!1,apuId:null,usages:[],targetId:""}),Ph=(l,d)=>{try{const c=String(l||""),f=String(d||"");if(!c||!f){t("Selecciona un APU de reemplazo","info");return}if(c===f){t("El APU de reemplazo debe ser distinto","info");return}let g=0,m=!1;const x=Ee.map(S=>{let h=!1,G=S!=null&&S.apuIds&&S.apuIds.length?[...S.apuIds]:S!=null&&S.apuId?[String(S.apuId)]:[];G.includes(c)&&(g+=G.filter(J=>J===c).length,G=Array.from(new Set(G.map(J=>J===c?f:J))),h=!0);let z=!1;const B=(Array.isArray(S==null?void 0:S.subRows)?S.subRows:[]).map(J=>{let Ce=!1,ve=Array.isArray(J==null?void 0:J.apuIds)?[...J.apuIds]:[];return ve.includes(c)&&(g+=ve.filter(ue=>ue===c).length,ve=Array.from(new Set(ve.map(ue=>ue===c?f:ue))),Ce=!0,z=!0),Ce?{...J,apuIds:ve}:J});return h||z?(m=!0,{...S,apuIds:G,apuId:null,subRows:B}):S});m?(it(x),at(x),t(`Reemplazo aplicado en ${g} uso(s)`,"success")):t("No se encontraron usos para reemplazar","info"),ru()}catch{t("No se pudo aplicar el reemplazo","error")}},Mh=q.useMemo(()=>{const l=new Map;try{for(const d of Ee){(d!=null&&d.apuIds&&d.apuIds.length?d.apuIds:d!=null&&d.apuId?[String(d.apuId)]:[]).forEach(g=>l.set(g,(l.get(g)||0)+1));const f=Array.isArray(d==null?void 0:d.subRows)?d.subRows:[];for(const g of f)(Array.isArray(g==null?void 0:g.apuIds)?g.apuIds:[]).forEach(x=>l.set(x,(l.get(x)||0)+1))}}catch{}return Object.fromEntries(l.entries())},[Ee]),Th=()=>{var g;if(Re.length||eu(),!Re.length)return;if(!Yt){const m=(g=Re[Re.length-1])==null?void 0:g.id;m&&(ya(m),Ma(m))}const l=prompt("Código de la partida (opcional):")??"",d=prompt("Nombre/Descripción de la partida:")??"";if(l===""&&d.trim()==="")return;const c={id:Ie(),chapterId:Yt||Re[Re.length-1].id,apuId:null,apuIds:[],metrados:0,codigo:l.trim(),descripcion:d.trim(),unidadSalida:"",_noAutoApu:!0},f=[...Ee,c];it(f),at(f),t("Partida agregada","success")},Oh=(l,d)=>{const c=Ee.map(f=>f.id===l?{...f,...d}:f);it(c),at(c)},iu=l=>{const d=Ee.filter(c=>c.id!==l);it(d),at(d),t("Partida eliminada","info")},Rh=l=>{const d=Ee.findIndex(h=>h.id===l);if(d<0)return;const c=Ee[d],f=prompt("Nombre para la partida duplicada:",(c.descripcion||"").trim());if(f===null)return;const g=(f||"").trim()||((c.descripcion||"").trim()?`${(c.descripcion||"").trim()} (copia)`:"Sin nombre");let m=c.chapterId;try{if(Array.isArray(Re)&&Re.length>0){const h=Re.map((z,Q)=>`${Q+1}. ${z.letter} — ${z.title}`).join(`
`),A=Re.findIndex(z=>z.id===c.chapterId)+1,G=prompt(`¿A qué capítulo enviar la copia?
${h}
Escribe el número (1-${Re.length}) o deja vacío para mantener (${A>0?A:1}).`,"");if(G!==null){const z=parseInt(String(G).trim(),10);Number.isFinite(z)&&z>=1&&z<=Re.length&&(m=Re[z-1].id)}}}catch{}const x={...c,id:Ie(),chapterId:m,descripcion:g,order:typeof c.order=="number"?c.order+1:void 0};let S=[];if(m===c.chapterId)S=[...Ee.slice(0,d+1),x,...Ee.slice(d+1)];else{const h=(()=>{let A=-1;for(let G=0;G<Ee.length;G++)Ee[G].chapterId===m&&(A=G);return A})();h>=0?S=[...Ee.slice(0,h+1),x,...Ee.slice(h+1)]:S=[...Ee,x]}it(S),at(S),t("Partida duplicada","success")},[wr,Za]=wa("apu-budgets",{}),[Ft,di]=wa("apu-active-budget-id",null),su=V.useRef(!1);q.useEffect(()=>{if(!su.current){if(!Ft){const l=`b_${Date.now()}`,d={id:l,name:"Borrador",rows:[],chapters:[],currentChapterId:"",createdAt:Date.now(),updatedAt:Date.now()},c={...wr||{},[l]:d};Za(c),di(l)}su.current=!0}},[Ft,wr,tu,ul,Xd,di,Za,Yt]),q.useEffect(()=>{Ft&&Za(l=>{const c={...(l||{})[Ft]||{id:Ft,name:"Borrador",createdAt:Date.now(),updatedAt:Date.now(),rows:[],chapters:[],currentChapterId:""},rows:Ee,chapters:Re,currentChapterId:Yt,updatedAt:Date.now()};return{...l||{},[Ft]:c}})},[Ee,Re,Yt,Ft,Za]);const hs=V.useCallback((l,d)=>{if(!l){Fe(null);return}if(l==="inline"){Fe("inline");return}Fe(l);try{const c=B=>(B||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),f=(ee||[]).find(B=>String((B==null?void 0:B.id)||"")===String(l));if(!f)return;const g=String(f.name||""),x=H(U).filter(B=>c((B==null?void 0:B.projectName)||(B==null?void 0:B.name)||"")===c(g)).sort((B,J)=>((J==null?void 0:J.createdAt)||0)-((B==null?void 0:B.createdAt)||0))[0];if(!x)return;if(x.resourcesSnapshot)try{u(x.resourcesSnapshot)}catch{}typeof x.gg=="number"&&v(x.gg),typeof x.util=="number"&&b(x.util),typeof x.iva=="number"&&E(x.iva),x.savedByEmail&&!d&&ca(String(x.savedByEmail));const S=Array.isArray(x.rows)?x.rows:[],h=Array.isArray(x.chapters)?x.chapters:[],A=String(x.currentChapterId||""),G=x.projectName||f.name||"",z=x.budgetId?String(x.budgetId):`b_${Date.now()}`,Q=G?`Presupuesto · ${G}`:"Presupuesto";Za(B=>{const J=B||{},ue={...!!J[z]?J[z]:{id:z,createdAt:Date.now()},id:z,name:Q,rows:S,chapters:h,currentChapterId:A,updatedAt:Date.now()};return{...J,[z]:ue}}),di(z),Jt(h),na(h),it(S),at(S),ya(A),Ma(A),i("presupuesto")}catch{}},[ee,U,u,v,b,E,ca,Za,di,Jt,na,it,at,ya,Ma,i,H,Fe]);q.useEffect(()=>{try{const l=(Se==null?void 0:Se.assignedProjectId)||"";if(!l||String(fe||"")===String(l)||!(_t||[]).some(c=>String((c==null?void 0:c.id)||"")===String(l)))return;hs(String(l),!0)}catch{}},[jt,fe,_t,hs,Se]);const Lh=l=>{const d=(l==null?void 0:l.replace)!==!1;v(.12),localStorage.setItem("apu-gg",String(.12)),b(.03),localStorage.setItem("apu-util",String(.03)),E(0),localStorage.setItem("apu-iva",String(0));const c=Ie(),f={id:c,letter:"A",title:"CASA 10×10 — 1 PISO",subChapters:[]},g=d?[f]:[...Re,f];Jt(g),na(g),ya(c),Ma(c);const m=(z,Q)=>{let B=[...Y];if(!B.find(J=>J.id===z)){const J=Q();B=[...B,J],K(B)}return z},x=(z,Q,B,J)=>({id:Ie(),chapterId:c,codigo:B,descripcion:z,unidadSalida:Q,metrados:0,apuId:null,apuIds:[],subRows:J}),S=(z,Q,B,J=[],Ce,ve)=>({id:Ie(),descripcion:z,unidadSalida:Q,metrados:B,apuIds:J,overrideUnitPrice:Ce,overrideTotal:ve}),h={radier:m("apu_radier_h25_10cm_malla_polietileno",Xe),cielo:m("apu_cielo_yeso_eps100",gn),canaleta:m("apu_canaleta_pvc_4_instalada",qt),pinturaInt:m("apu_pintura_interior_latex_muros",Jo),puertaInt:m("apu_puerta_interior_mdf_70x200_instalada",Yo),puertaExt:m("apu_puerta_exterior_acero_90x200_instalada",Zo),ventana100x100:m("apu_ventana_aluminio_100x100_instalada",f0),ventana60x40:m("apu_ventana_aluminio_60x40_instalada",v0),pisoCeramica:m("apu_piso_ceramica_60x60",Ko),muroExt:m("apu_muro_ext_2x4_osb11_lana80_fc6_pint",ba),tabique:m("apu_tabique_2x4_volcanita_simple",yr),techTeja:m("apu_techumbre_teja_asfaltica_m2",Va),porcelanato:m("apu_piso_porcelanato_60x60",vt),ceramicaBase:m("apu_piso_ceramica_base",Ha),pisoFlot:m("apu_piso_flotante_7mm",xn),ceramMuro:m("apu_ceramica_muro_bano",oi),pintExt:m("apu_pintura_exterior_fibro",br),electricaGl:m("apu_electrica_completa_gl",cs),sanitariaGl:m("apu_sanitaria_completa_gl",Pt),termMen:m("apu_terminaciones_menores_ml",ct),tramDom:m("apu_tramite_dom_permiso",We),tramCalc:m("apu_tramite_calculo_estructural",bt),tramRecep:m("apu_tramite_recepcion_final",Kt),tramTE1:m("apu_tramite_te1_sec",Ea)},A=[];f.subChapters.push({id:Ie(),title:"A.1 · Movimiento de tierras y radier H-20 10 cm"}),A.push(x("Movimiento de tierras y radier H-20 10 cm","m2","A.1",[S("Radier H-20 10 cm terminado","m2",100,[h.radier])])),f.subChapters.push({id:Ie(),title:"A.2 · Muros exteriores 2×4 @40 + OSB 11 mm + aislación + fibrocemento pintado"}),A.push(x("Muros exteriores 2×4 @40 + OSB 11 mm + aislación + fibrocemento pintado","m2","A.2",[S("Muro exterior completo","m2",96,[h.muroExt],52400)])),f.subChapters.push({id:Ie(),title:"A.3 · Tabiques interiores 2×4 + volcanita simple"}),A.push(x("Tabiques interiores 2×4 + volcanita simple","m2","A.3",[S("Tabique interior","m2",168,[h.tabique],28630)])),f.subChapters.push({id:Ie(),title:"A.4 · Techumbre 25% + alero 40 cm + OSB 11 mm + fieltro + teja asfáltica"}),A.push(x("Techumbre 25% + alero 40 cm + OSB 11 mm + fieltro + teja asfáltica","m2","A.4",[S("Cubierta completa","m2",120,[h.techTeja])])),f.subChapters.push({id:Ie(),title:"A.5 · Cielos rasos + aislación EPS 100 mm"}),A.push(x("Cielos rasos + aislación EPS 100 mm","m2","A.5",[S("Cielo raso yeso-cartón + EPS 100 mm","m2",100,[h.cielo])])),f.subChapters.push({id:Ie(),title:"A.6 · Aberturas"}),A.push(x("Aberturas","u","A.6",[S("Puerta exterior acero 90×200","u",1,[h.puertaExt]),S("Puertas interiores MDF 70×200","u",6,[h.puertaInt]),S("Ventanas termopanel 100×100","u",8,[h.ventana100x100]),S("Ventanas termopanel 60×40","u",2,[h.ventana60x40])])),f.subChapters.push({id:Ie(),title:"A.7 · Revestimientos de pisos y muros húmedos"}),A.push(x("Revestimientos de pisos y muros húmedos","m2","A.7",[S("Porcelanato estar-comedor","m2",36,[h.porcelanato]),S("Cerámica cocina","m2",10,[h.ceramicaBase]),S("Cerámica pasillos","m2",10,[h.ceramicaBase]),S("Cerámica piso baños","m2",8,[h.ceramicaBase]),S("Piso flotante dormitorios","m2",36,[h.pisoFlot]),S("Cerámica muros baños (hasta 2,10 m)","m2",33.6,[h.ceramMuro])])),f.subChapters.push({id:Ie(),title:"A.8 · Pinturas"}),A.push(x("Pinturas","m2","A.8",[S("Interior (muros y cielos)","m2",364,[h.pinturaInt]),S("Exterior (fibrocemento)","m2",96,[h.pintExt])])),f.subChapters.push({id:Ie(),title:"A.9 · Instalación eléctrica completa"}),A.push(x("Instalación eléctrica completa","u","A.9",[S("Sistema completo (materiales + MO)","u",1,[h.electricaGl])])),f.subChapters.push({id:Ie(),title:"A.10 · Instalación sanitaria agua y desagüe + artefactos + calefón"}),A.push(x("Instalación sanitaria agua y desagüe + artefactos + calefón","u","A.10",[S("Sistema completo (materiales + MO)","u",1,[h.sanitariaGl])])),f.subChapters.push({id:Ie(),title:"A.11 · Canaletas y bajadas"}),A.push(x("Canaletas y bajadas","ml","A.11",[S("Canaleta PVC instalada","ml",40,[h.canaleta])])),f.subChapters.push({id:Ie(),title:"A.12 · Terminaciones menores"}),A.push(x("Terminaciones menores (guardapolvos, zócalos, cornisas)","ml","A.12",[S("Suministro e instalación","ml",150,[h.termMen])])),f.subChapters.push({id:Ie(),title:"A.13 · Trámites y profesionales"}),A.push(x("Trámites y profesionales","u","A.13",[S("Permiso de edificación y derechos DOM","u",1,[h.tramDom]),S("Cálculo estructural vivienda liviana","u",1,[h.tramCalc]),S("Recepción final, certificados, copias planas","u",1,[h.tramRecep]),S("SEC/TE1 eléctrica","u",1,[h.tramTE1])]));const G=d?A:[...Ee,...A];it(G),at(G),t("Preset “Casa 10×10” cargado en Presupuesto","success")},zh=l=>{const d=(l==null?void 0:l.replace)!==!1;v(.1);try{localStorage.setItem("apu-gg",String(.1))}catch{}const c=Ie(),f={id:c,letter:"C",title:"Casa 60 m² — 1 piso",subChapters:[]},g=d?[f]:[...Re,f];Jt(g),na(g),ya(c),Ma(c);const m=(z,Q)=>{let B=[...Y];if(!B.find(J=>J.id===z)){const J=Q();B=[...B,J],K(B)}return z},x={movTierra:m("apu_mov_tierra_lote",Ya),relleno:m("apu_relleno_compact_manual",oe),h20:m("apu_h20_obra_vibrado_m3",gr),enfiKg:m("apu_enfierradura_kg",ds),encofrado:m("apu_moldaje_terciado_m2",$a),clavosAlambre:m("apu_clavos_alambre_lote",vr),ladrilloU:m("apu_material_ladrillo_fiscal_u",xr),morteroPega:m("apu_mortero_pega_lote",Vn),techEstruct:m("apu_estructura_techumbre_madera",Je),tejaFibro:m("apu_cubierta_teja_fibrocemento_m2",os),fijacionesTecho:m("apu_fijaciones_techo_lote",si),aislCielo:m("apu_acond_termico_cielo_lana100",Xo),pintInt:m("apu_pintura_interior_latex_muros",Jo),pintExt:m("apu_pintura_exterior_fibro",br),pisoCer:m("apu_piso_ceramica_60x60",Ko),ceramMuro:m("apu_revest_ceramico_muro_30x60_m2",Fd),cieloYeso:m("apu_cielo_yeso_carton_12_5_sobre_perf",Qe),ptaExt:m("apu_puerta_exterior_acero_90x200_instalada",Zo),ptaInt:m("apu_puerta_interior_mdf_70x200_instalada",Yo),ventanaPVC:m("apu_ventana_pvc_100x100_instalada",Ba),herrajes:m("apu_herrajes_carpinteria_lote",hn),kitBano:m("apu_kit_bano_economico_set",ii),kitCocina:m("apu_kit_cocina_economico_set",mn),pvcDesague:m("apu_tuberias_pvc_desague_lote",k),pprAgua:m("apu_tuberias_ppr_agua_lote",P),gas:m("apu_caneria_gas_lote",w),tablero:m("apu_tablero_electrico_monofasico_u",Wo),cables:m("apu_cables_electricos_lote",I),tubos:m("apu_tubos_canaletas_lote",$),tomaInt:m("apu_toma_interruptor_u",Qo),mo30:m("apu_mo_30_materiales_nota",W),gg10:m("apu_gg_imprev_10_nota",ce)},S=(z,Q,B,J)=>({id:Ie(),chapterId:c,codigo:B,descripcion:z,unidadSalida:Q,metrados:0,apuId:null,apuIds:[],subRows:J}),h=(z,Q,B,J=[],Ce,ve)=>({id:Ie(),descripcion:z,unidadSalida:Q,metrados:B,apuIds:J,overrideUnitPrice:Ce,overrideTotal:ve}),A=[];f.subChapters.push({id:Ie(),title:"1 · Movimiento de Tierras"}),A.push(S("Movimiento de Tierras","lote","1",[h("Movimiento de tierra (lote)","lote",1,[x.movTierra]),h("Material de relleno","m3",5,[x.relleno])])),f.subChapters.push({id:Ie(),title:"2 · Fundaciones y Estructura"}),A.push(S("Fundaciones y Estructura","m3","2",[h("Hormigón H20","m3",15,[x.h20]),h("Acero de refuerzo","kg",600,[x.enfiKg]),h("Madera para encofrado","m2",200,[x.encofrado]),h("Clavos y alambre (lote)","lote",1,[x.clavosAlambre])])),f.subChapters.push({id:Ie(),title:"3 · Albañilería"}),A.push(S("Albañilería","m2","3",[h("Ladrillo fiscal (material)","u",3e3,[x.ladrilloU]),h("Mortero (lote)","lote",1,[x.morteroPega])])),f.subChapters.push({id:Ie(),title:"4 · Techumbre"}),A.push(S("Techumbre","m2","4",[h("Cerchas de pino","m2",70,[x.techEstruct]),h("Tejas de fibrocemento","m2",70,[x.tejaFibro]),h("Clavos y fijaciones (lote)","lote",1,[x.fijacionesTecho]),h("Aislante térmico","m2",60,[x.aislCielo])])),f.subChapters.push({id:Ie(),title:"5 · Terminaciones Interiores"}),A.push(S("Terminaciones Interiores","m2","5",[h("Pintura látex interior","m2",180,[x.pintInt]),h("Pintura fachada","m2",80,[x.pintExt]),h("Cerámica para piso","m2",60,[x.pisoCer]),h("Cerámica baño/cocina","m2",25,[x.ceramMuro]),h("Mortero de pega (lote)","lote",1,[x.morteroPega]),h("Yeso-cartón para cielos","m2",60,[x.cieloYeso])])),f.subChapters.push({id:Ie(),title:"6 · Carpintería y Ventanas"}),A.push(S("Carpintería y Ventanas","u","6",[h("Puerta principal","u",1,[x.ptaExt]),h("Puertas interiores","u",3,[x.ptaInt]),h("Ventanas PVC 100×100","u",6,[x.ventanaPVC]),h("Herrajes (lote)","lote",1,[x.herrajes])])),f.subChapters.push({id:Ie(),title:"7 · Instalaciones Sanitarias y Gas"}),A.push(S("Instalaciones Sanitarias y Gas","set","7",[h("Tuberías PVC desagüe (lote)","lote",1,[x.pvcDesague]),h("Tuberías PPR agua (lote)","lote",1,[x.pprAgua]),h("Kit baño económico","set",1,[x.kitBano]),h("Kit cocina económico","set",1,[x.kitCocina]),h("Cañería gas (lote)","lote",1,[x.gas])])),f.subChapters.push({id:Ie(),title:"8 · Instalaciones Eléctricas"}),A.push(S("Instalaciones Eléctricas","u","8",[h("Cables eléctricos (lote)","lote",1,[x.cables]),h("Tablero eléctrico","u",1,[x.tablero]),h("Tomas e interruptores","u",20,[x.tomaInt]),h("Tubos/canaletas (lote)","lote",1,[x.tubos])])),f.subChapters.push({id:Ie(),title:"9 · Costos Indirectos"}),A.push(S("Costos Indirectos","lote","9",[h("Mano de obra 30% sobre materiales (ajustar manualmente si aplica)","lote",1,[x.mo30]),h("Gastos generales e imprevistos 10% (se aplica en parámetros financieros)","lote",1,[x.gg10])]));const G=d?A:[...Ee,...A];it(G),at(G),t("Preset “Casa 60 m²” cargado en Presupuesto","success")},Fh=l=>{const d=(l==null?void 0:l.replace)!==!1,c=Ie(),f={id:c,letter:"P",title:"pisicna",subChapters:[]},g=d?[f]:[...Re,f];Jt(g),na(g),ya(c),Ma(c);const m=(z,Q)=>{let B=[...Y];if(!B.find(J=>J.id===z)){const J=Q();B=[...B,J],K(B)}return z},x=(z,Q,B,J)=>({id:Ie(),chapterId:c,codigo:B,descripcion:z,unidadSalida:Q,metrados:0,apuId:null,apuIds:[],subRows:J}),S=(z,Q,B,J=[],Ce,ve)=>({id:Ie(),descripcion:z,unidadSalida:Q,metrados:B,apuIds:J,overrideUnitPrice:Ce,overrideTotal:ve}),h={exc:m("apu_excavacion_retiro_m3",el),base10:m("apu_base_estabilizada_10cm_m2",$d),encof:m("apu_encofrado_doble_cara_m2",Bd),enfi:m("apu_enfierradura_kg",ds),h25v:m("apu_h25_obra_vibrado_m3",tl),curado:m("apu_curado_humedo_m2",al),imper:m("apu_imper_cementicia_2capas_m2",nl),pinturaPiscina:m("apu_pintura_piscina_2manos_m2",rl),hidConjunto:m("apu_red_hid_conjunto_set",Hd)},A=[];f.subChapters.push({id:Ie(),title:"P.1 · Obra piscina"}),A.push(x("Excavación y retiro","m3","P.1",[S("Excavación y retiro","m3",101.2,[h.exc])])),A.push(x("Base estabilizada 10 cm","m2","P.2",[S("Base estabilizada 10 cm","m2",35.36,[h.base10])])),A.push(x("Encofrado muros/cantos doble cara","m2","P.3",[S("Encofrado doble cara","m2",109.2,[h.encof])])),A.push(x("Enfierradura colocada","kg","P.4",[S("Enfierradura","kg",2271,[h.enfi])])),A.push(x("Hormigón H-25 hecho en obra + vibrado","m3","P.5",[S("Hormigón H-25 + vibrado","m3",17.472,[h.h25v])])),A.push(x("Curado húmedo","m2","P.6",[S("Curado húmedo","m2",82,[h.curado])])),A.push(x("Impermeabilización cementicia 2 capas","m2","P.7",[S("Impermeabilización cementicia 2 capas","m2",82,[h.imper])])),A.push(x("Pintura para piscina 2 manos","m2","P.8",[S("Pintura para piscina 2 manos","m2",82,[h.pinturaPiscina])])),f.subChapters.push({id:Ie(),title:"P.9 · Hidráulica"}),A.push(x("Hidráulica","set","P.9",[S("Red hidráulica y equipos (conjunto)","set",1,[h.hidConjunto])]));const G=d?A:[...Ee,...A];it(G),at(G),t("Preset “pisicna” cargado en Presupuesto","success")},Uh=l=>{const d=(l==null?void 0:l.replace)!==!1,c=Ie(),f={id:c,letter:"S",title:"Fosa séptica y drenaje",subChapters:[]},g=d?[f]:[...Re,f];Jt(g),na(g),ya(c),Ma(c);const m=(z,Q)=>{let B=[...Y];if(!B.find(J=>J.id===z)){const J=Q();B=[...B,J],K(B)}return z},x=(z,Q,B,J)=>({id:Ie(),chapterId:c,codigo:B,descripcion:z,unidadSalida:Q,metrados:0,apuId:null,apuIds:[],subRows:J}),S=(z,Q,B,J=[],Ce,ve)=>({id:Ie(),descripcion:z,unidadSalida:Q,metrados:B,apuIds:J,overrideUnitPrice:Ce,overrideTotal:ve}),h={dren:m("apu_dren_infiltracion_m",ye),pvc110:m("apu_tuberia_pvc_110_m",Oe),fosa:m("apu_fosa_septica_3000l_u",Pe),camIns:m("apu_camara_inspeccion_elevador_u",Me),camDesg:m("apu_camara_desgrasadora_100l_u",tt),camDist:m("apu_camara_distribuidora_100l_u",Lt)},A=[];f.subChapters.push({id:Ie(),title:"S.1 · Fosa séptica 3.000 L"}),A.push(x("Fosa séptica 3.000 L instalada","u","S.1",[S("Fosa séptica 3.000 L instalada","u",1,[h.fosa])])),f.subChapters.push({id:Ie(),title:"S.2 · Cámaras sanitarias"}),A.push(x("Cámaras sanitarias","u","S.2",[S("Cámaras de inspección con elevador","u",2,[h.camIns]),S("Cámara distribuidora 100 L","u",1,[h.camDist]),S("Cámara desgrasadora 100 L","u",1,[h.camDesg])])),f.subChapters.push({id:Ie(),title:"S.3 · Redes y drenaje"}),A.push(x("Redes y drenaje sanitario","m","S.3",[S("Tubería PVC Ø110 sanitaria enterrada","m",15,[h.pvc110]),S("Dren de infiltración 0,50×0,80 m","m",20,[h.dren])]));const G=d?A:[...Ee,...A];it(G),at(G),t("Preset “Fosa Séptica” cargado en Presupuesto","success")},Dh=l=>{var x;if(Array.isArray(l.subRows)&&l.subRows.length>0)return(l.subRows||[]).reduce((S,h)=>{const A=Number(h.metrados||0),G=(h.apuIds||[]).reduce((B,J)=>{try{return B+yt(C(J),o).unit}catch{return B}},0),z=typeof h.overrideUnitPrice=="number"&&Number.isFinite(h.overrideUnitPrice)?h.overrideUnitPrice:G,Q=typeof h.overrideTotal=="number"&&Number.isFinite(h.overrideTotal)?h.overrideTotal:z*A;return S+(Number.isFinite(Q)?Q:0)},0);const d=Number(l.metrados||0),f=((x=l.apuIds)!=null&&x.length?l.apuIds:l.apuId?[l.apuId]:[]).reduce((S,h)=>{try{return S+yt(C(h),o).unit}catch{return S}},0),g=typeof l.overrideUnitPrice=="number"&&Number.isFinite(l.overrideUnitPrice)?l.overrideUnitPrice:f,m=typeof l.overrideTotal=="number"&&Number.isFinite(l.overrideTotal)?l.overrideTotal:g*d;return Number.isFinite(m)?m:0},jr=Ee.reduce((l,d)=>l+Dh(d),0),ou=jr*p,ml=jr+ou,lu=ml*_,cu=ml+lu,du=cu*j,$h=cu+du,[ui,Nr]=q.useState({open:!1,id:null}),Cr=l=>Nr({open:!0,id:l}),Bh=()=>Nr({open:!1,id:null}),qh=(l,d)=>{const{secciones:c,descripcion:f,unidadSalida:g,categoria:m}=d||{};if(!!Y.find(S=>String((S==null?void 0:S.id)||"")===String(l))){const S=Y.map(h=>h.id!==l?h:{...h,descripcion:f??h.descripcion,unidadSalida:g??h.unidadSalida,categoria:m??(h.categoria||""),secciones:c??h.secciones,items:void 0});K(S),t("APU actualizado","success"),Nr({open:!1,id:null});return}try{const S=C(l);if(!S)throw new Error("notfound");const h={id:S.id,descripcion:f??S.descripcion,unidadSalida:g??S.unidadSalida,categoria:m??(S.categoria||""),secciones:c,items:void 0},A=[...Y||[],h];K(A),t("APU copiado del catálogo y guardado","success"),Nr({open:!1,id:null})}catch{t("APU no encontrado","error")}},[Vh,gs]=q.useState(!1),[Hh,uu]=q.useState(()=>{try{return!!localStorage.getItem("apu-library-backup")}catch{return!1}}),xs=V.useCallback(()=>{try{if(localStorage.getItem("apu-library-backup")||localStorage.setItem("apu-library-backup",JSON.stringify({at:Date.now(),apus:M||[]})),!localStorage.getItem("apu-alias-backup")){const l=yn();localStorage.setItem("apu-alias-backup",JSON.stringify({at:Date.now(),aliases:l}))}uu(!0)}catch{}},[M]),Wh=V.useCallback(()=>{try{const l=localStorage.getItem("apu-library-backup"),d=localStorage.getItem("apu-alias-backup");if(!l&&!d){t("No hay copia para deshacer","info");return}if(l){try{const f=(JSON.parse(l||"null")||{}).apus;Array.isArray(f)&&K(f)}catch{}try{localStorage.removeItem("apu-library-backup")}catch{}}if(d){try{const f=(JSON.parse(d||"null")||{}).aliases;f&&typeof f=="object"&&Ds(f)}catch{}try{localStorage.removeItem("apu-alias-backup")}catch{}}uu(!1),t("Se restauró la biblioteca y alias previos","success")}catch{t("No se pudo restaurar el respaldo","error")}},[K,t]),fl=V.useCallback((l,d,c)=>{try{xs();const g={...yn()||{}};for(const m of d)g[m]=l;if(Ds(g),c){const m=new Set([l]),x=(M||[]).filter(S=>m.has(S.id)||!d.includes(S.id));K(x)}t("Fusión de APUs completada","success")}catch{t("No se pudo completar la fusión","error")}},[M,K,t,xs]),Qh=V.useCallback(()=>{try{const l=Array.isArray(Y)?Y:[];if(l.length<2){t("No hay suficientes APUs para analizar","info");return}const d=new Map,c=x=>{x&&d.set(x,(d.get(x)||0)+1)};Ee.forEach(x=>{(Array.isArray(x==null?void 0:x.apuIds)&&x.apuIds.length?x.apuIds:x!=null&&x.apuId?[x.apuId]:[]).forEach(c),(x.subRows||[]).forEach(h=>(Array.isArray(h==null?void 0:h.apuIds)?h.apuIds:[]).forEach(c))});const f=to(l,{threshold:.46,sameUnit:!0});if(!f.length){t("No se detectaron duplicados","info");return}let g=0,m=0;f.forEach(x=>{const S=x.ids.map(Q=>l.find(B=>B.id===Q)).filter(Boolean);if(S.length<2)return;const h=Q=>{const B=d.get(Q.id)||0,J=rr(Q)?0:1,Ce=(()=>{try{const ve=Q.secciones||{};return["materiales","equipos","manoObra","varios"].reduce((ue,Ge)=>ue+(Array.isArray(ve[Ge])?ve[Ge].length:0),0)}catch{return 0}})();return B*3+J*2+Ce*.1};let A=S[0],G=h(A);for(const Q of S.slice(1)){const B=h(Q);B>G&&(G=B,A=Q)}const z=x.ids.filter(Q=>Q!==A.id);z.length&&(g++,m+=z.length,fl(A.id,z,!0))}),t(`Depuración completada: ${g} grupos fusionados, ${m} duplicados eliminados`,"success")}catch{t("Error en la depuración automática","error")}},[Y,Ee,fl,t]),Gh=V.useCallback(()=>{try{const l=Array.isArray(M)?M:[];if(!l.length){t("Biblioteca vacía","info");return}xs();const d=h=>Array.isArray(h)?h.length:0,c=h=>{try{const A=["materiales","equipos","manoObra","varios"];if(A.some(G=>d(h==null?void 0:h[G])>0)||Array.isArray(h==null?void 0:h.extras)&&h.extras.some(G=>d(G==null?void 0:G.rows)>0))return!0;for(const G of Object.keys(h||{})){if(A.includes(G)||G==="extras"||G==="__meta"||G==="__titles")continue;const z=h[G];if(Array.isArray(z)&&z.length>0||z&&Array.isArray(z.rows)&&z.rows.length>0)return!0}return!1}catch{return!1}},f=h=>{const A={materiales:[],equipos:[],manoObra:[],varios:[],extras:[],__meta:{}},G=Array.isArray(h==null?void 0:h.items)?h.items:[];for(const z of G){if((z==null?void 0:z.tipo)==="coef"||(z==null?void 0:z.tipo)==="rendimiento"){const Q=o[z.resourceId];if(!Q)continue;const J=z.tipo==="coef"?Number(z.coef||0)*(1+Number(z.merma||0)):1/Math.max(1,Number(z.rendimiento||1)),Ce=Number(Q.precio||0),ve={descripcion:Q.nombre,unidad:Q.unidad,cantidad:J,pu:Ce};switch(Q.tipo){case"material":A.materiales.push(ve);break;case"equipo":A.equipos.push(ve);break;case"mano_obra":A.manoObra.push(ve);break;default:A.varios.push(ve);break}continue}if((z==null?void 0:z.tipo)==="subapu"){try{const Q=String(z.apuRefId||""),B=ps?ps(Q):C(Q),J=yt(B,o).unit||0,Ce=z.coef??(z.rendimiento?1/(Number(z.rendimiento)||1):1),ve={descripcion:`SubAPU ${Q}`,unidad:"u",cantidad:Ce,pu:J};A.varios.push(ve)}catch{}continue}}return A};let g=0,m=0,x=0;const S=l.map(h=>{const A=(h==null?void 0:h.secciones)||{},G=c(A),z=Array.isArray(h==null?void 0:h.items)&&h.items.length>0;if(G&&z)return g++,x++,{...h,items:void 0};if(!G&&z){const Q=f(h);return g++,m++,{...h,secciones:Q,items:void 0}}return h});g>0?(K(S),t(`Migración realizada: ${g} APU(s) actualizados (${m} derivados desde items, ${x} limpiados)`,"success")):t("No había APUs para migrar","info")}catch{t("Error al migrar APUs","error")}},[M,o,xs,K,t,ps,C]),pi=V.useCallback(l=>(l||"").normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").toLowerCase().trim(),[]),hl=V.useCallback(l=>pi(l).split(/[^a-z0-9áéíóúüñ]+/i).filter(Boolean),[pi]),pu=V.useCallback((l,d)=>{const c=hl(l),f=hl(d);if(!c.length||!f.length)return 0;const g=new Set(c),m=new Set(f);let x=0;for(const Q of g)m.has(Q)&&x++;const S=x/(g.size+m.size-x||1),h=pi(l),A=pi(d),G=A.includes(h)||h.includes(A)?.2:0,z=h&&A.startsWith(h)||A&&h.startsWith(A)?.1:0;return S+G+z},[hl,pi]),gl=V.useCallback(l=>{const d=[...Y||[],...$s||[]];let c=null,f=0;for(const g of d){const m=pu(l,String((g==null?void 0:g.descripcion)||""));m>f&&(f=m,c=g)}return f>=.25?c:null},[Y,pu]),mu=l=>l==null?l:JSON.parse(JSON.stringify(l)),Kh=l=>{for(const d of Ee){if(d.id===l)return{row:d,sub:null};if(Array.isArray(d.subRows)){const c=d.subRows.find(f=>f.id===l);if(c)return{row:d,sub:c}}}return{row:null,sub:null}},Jh=l=>{const{row:d,sub:c}=Kh(l),f=String((c==null?void 0:c.descripcion)||(d==null?void 0:d.descripcion)||"APU sin título").trim(),g=String((c==null?void 0:c.unidadSalida)||(d==null?void 0:d.unidadSalida)||"").trim()||void 0,m=gl(f),S={id:`apu_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,descripcion:f||(m==null?void 0:m.descripcion)||"APU sin título",unidadSalida:g||(m==null?void 0:m.unidadSalida)||"m2",categoria:(m==null?void 0:m.categoria)||"",secciones:mu(m==null?void 0:m.secciones),items:m!=null&&m.secciones?void 0:mu((m==null?void 0:m.items)||[])},h=[...Y||[],S];K(h),setTimeout(()=>{_u(S.id),Cr(S.id)},0)},_s=V.useCallback((l,d)=>{const c=gl(l),g={id:`apu_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,6)}`,descripcion:l&&l.trim()?l.trim():(c==null?void 0:c.descripcion)||"APU sin título",unidadSalida:d&&d.trim()||(c==null?void 0:c.unidadSalida)||"m2",categoria:(c==null?void 0:c.categoria)||"",secciones:c!=null&&c.secciones?JSON.parse(JSON.stringify(c.secciones)):void 0,items:c!=null&&c.secciones?void 0:JSON.parse(JSON.stringify((c==null?void 0:c.items)||[]))},m=[...Y||[],g];return K(m),g.id},[Y,K,gl]),fu=q.useRef(new Set),hu=q.useRef(new Set),vs=V.useCallback(()=>{try{let l=!1;const d=Ee.map(c=>{let f=!1,g=c;if(Array.isArray(c.subRows)&&c.subRows.length>0){const m=c.subRows.map(x=>{const S=Array.isArray(x.apuIds)&&x.apuIds.length>0,h=typeof x.overrideTotal=="number"&&Number.isFinite(x.overrideTotal),A=fu.current.has(x.id);if(S||h||A||x._noAutoApu)return x;const G=String(x.descripcion||"").trim()||"APU sin título",z=String(x.unidadSalida||"").trim()||void 0,Q=_s(G,z);return fu.current.add(x.id),f=!0,l=!0,{...x,apuIds:[Q],overrideTotal:void 0}});f&&(g={...c,subRows:m})}else{const x=(Array.isArray(c.apuIds)&&c.apuIds.length?c.apuIds:c.apuId?[c.apuId]:[]).length>0,S=typeof c.overrideTotal=="number"&&Number.isFinite(c.overrideTotal),h=hu.current.has(c.id);if(!x&&!S&&!h&&!c._noAutoApu){const A=String(c.descripcion||"").trim()||"APU sin título",G=String(c.unidadSalida||"").trim()||void 0,z=_s(A,G);hu.current.add(c.id),f=!0,l=!0,g={...c,apuIds:[z],apuId:null,overrideTotal:void 0}}}return g});return l?(it(d),at(d),!0):!1}catch{}return!1},[Ee,_s,at]);q.useEffect(()=>{vs()},[Ee,vs]),q.useEffect(()=>{if(n==="presupuesto"){const l=setTimeout(()=>{vs()},0);return()=>clearTimeout(l)}},[n,vs]);const[xl,Ar]=q.useState({open:!1,rowId:null}),[gu,Yh]=q.useState(null),[Zh,_l]=q.useState(""),[Xh,bs]=q.useState(!1),[xu,vl]=q.useState(""),[bl,yl]=q.useState("replace"),eg=l=>{if(!l){_l("");return}vl(l),yl("replace"),bs(!0)},tg=()=>{const l=xu;if(!l){bs(!1);return}const d=bl!=="append";l==="Casa 10×10"?Lh({replace:d}):l==="Casa 60 m²"?zh({replace:d}):l==="Piscina"?Fh({replace:d}):l==="Fosa Séptica"&&Uh({replace:d}),_l(""),vl(""),bs(!1),t(`Planilla "${l}" cargada (${d?"reemplazar":"agregar"})`,"success")},ag=()=>{bs(!1),vl(""),_l("")},_u=l=>{const d=xl.rowId;if(!d)return;if(d==="__new__"){const g={id:Ie(),apuId:l,apuIds:[l],metrados:1},m=[...Ee,g];it(m),at(m),Ar({open:!1,rowId:null}),t("Partida agregada","success");return}let c=!1;const f=Ee.map(g=>{if(g.id===d){const m=g.apuIds&&g.apuIds.length?g.apuIds:g.apuId?[g.apuId]:[];return c=!0,m.includes(l)?{...g,apuIds:m}:{...g,apuIds:[...m,l]}}if(Array.isArray(g.subRows)){const m=g.subRows.findIndex(x=>x.id===d);if(m>=0){c=!0;const x=g.subRows[m],S=x.apuIds&&x.apuIds.length?x.apuIds:[],h=S.includes(l)?S:[...S,l],A=[...g.subRows];return A[m]={...x,apuIds:h},{...g,subRows:A}}}return g});if(!c)try{console.warn("No se encontró fila o subfila para asignar APU")}catch{}it(f),at(f),Ar({open:!1,rowId:null}),t("APU asignado a la partida","success")},[ng,rg]=q.useState(!1),[vu,ig]=q.useState(""),[ys,sg]=q.useState(!1),[bu,og]=q.useState(!0),[yu,Su]=q.useState([]),mi=l=>(l||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),lg=l=>{const d=mi(er(l));if(!d)return null;const c=M.find(m=>mi(m.id)===d);if(c)return c;const f=M.find(m=>mi(er(m.descripcion)).startsWith(d));if(f)return f;const g=M.find(m=>mi(er(m.descripcion)).includes(d));if(g)return g;try{const m=[...M||[],...$s||[]];let x=null,S=0;for(const h of m){const A=zd(String(l||""),String((h==null?void 0:h.descripcion)||""));A>S&&(S=A,x=h)}if(S>=.35)return x}catch{}return null},cg=l=>{const d=(l||"").split(/\r?\n/).map(g=>g.trim()).filter(Boolean),c=g=>(g.includes("	")?g.split("	"):g.includes(";")?g.split(";"):g.split(",")).map(x=>x.trim()),f=[];for(const g of d){const m=c(g);if(m.length<6)continue;const x=mi(m[0]);if(x.startsWith("capitulo")||x.startsWith("capítulo"))continue;const S=(m[0]||"").trim(),h=(m[1]||"").trim(),A=(m[2]||"").trim(),G=(m[3]||"").trim(),z=(m[4]||"").trim(),Q=Number(String(m[5]||"").replace(/\./g,"").replace(",","."))||0,B=(m[6]||"").trim(),J=B?B.split("|").map(Ce=>Ce.trim()).filter(Boolean):[];f.push({cap:S,sub:h,codigo:A,partida:G,unidad:z,cant:Q,apus:J})}return f},dg=()=>{const l=cg(vu);if(!l.length){Su(["No se detectaron filas válidas."]);return}let d=[...Re];const c=(h,A)=>{const G=(h||"").trim()||"-";let z=d.find(Q=>(Q.letter||"-")===G);return z||(z={id:Ie(),letter:G,title:A||"CAPÍTULO"},d=[...d,z]),z.id},f=new Map;l.forEach(h=>{const A=[h.cap||"-",h.codigo||"",h.partida||"",h.unidad||""].join("||"),G=f.get(A)||[];G.push(h),f.set(A,G)});const g=[],m=[];for(const[h,A]of f){const G=A[0],z=c(G.cap,"CAPÍTULO "+(G.cap||"")),Q=A.map(J=>{const Ce=[];for(const ve of J.apus){const ue=lg(ve);ue?Ce.push(ue.id):m.push(`APU no encontrado: "${ve}" en partida "${J.partida}"`)}return{id:Ie(),descripcion:J.partida,unidadSalida:J.unidad,metrados:J.cant,apuIds:Ce,overrideUnitPrice:void 0,overrideTotal:void 0}}),B={id:Ie(),chapterId:z,codigo:G.codigo||"",descripcion:G.partida||"PARTIDA",unidadSalida:G.unidad||"",metrados:0,apuId:null,apuIds:[],subRows:Q};g.push(B)}const x=ys?g:[...Ee,...g];Jt(d),na(d),it(x),at(x);try{if(!(ys&&bu&&(!!fe||!!jt))){let A=fe||null,G="";const z=`Proyecto importado ${new Date().toLocaleDateString("es-CL")} ${new Date().toLocaleTimeString("es-CL",{hour:"2-digit",minute:"2-digit"})}`;if(A){const Q=(ee||[]).find(B=>String((B==null?void 0:B.id)||"")===String(A));G=(Q==null?void 0:Q.name)||(T==null?void 0:T.nombreProyecto)||z,ge((B=[])=>B.map(J=>String((J==null?void 0:J.id)||"")===String(A)?{...J,updatedAt:Date.now()}:J))}else{G=(T==null?void 0:T.nombreProyecto)||z;const Q=`p_${Date.now()}`,B={id:Q,name:G,client:(T==null?void 0:T.propietario)||"",location:[T==null?void 0:T.direccion,T==null?void 0:T.comuna,T==null?void 0:T.ciudad].filter(Boolean).join(", "),fecha:(T==null?void 0:T.fecha)||"",plazoDias:(T==null?void 0:T.plazoDias)||void 0,createdAt:Date.now(),updatedAt:Date.now(),_source:"from-import"};ge((J=[])=>[...J,B]),Fe(Q),A=Q}Ft&&G&&Za(Q=>{const B=(Q||{})[Ft];return B?{...Q||{},[Ft]:{...B,name:`Presupuesto · ${G}`,updatedAt:Date.now()}}:Q}),jt&&A&&gt((Q=[])=>Q.map(B=>String((B==null?void 0:B.email)||"")===String(jt)?{...B,assignedProjectId:A}:B))}}catch{}const S=[`Importadas ${g.length} partidas (${l.length} filas).`,...m.length?m.slice(0,50):[]];Su(S),t(`Importadas ${g.length} partidas`,m.length?"info":"success")};return r.jsxs("div",{className:"min-h-screen bg-slate-900 text-slate-100 p-6",children:[r.jsx(u0,{notifications:e,onDismiss:a}),r.jsx(__,{open:Un,onClose:()=>va(!1),initial:Da??{nombre:(te==null?void 0:te.name)||(T==null?void 0:T.nombreProyecto)||"",propietario:(te==null?void 0:te.client)||(T==null?void 0:T.propietario)||"",direccion:(T==null?void 0:T.direccion)||"",ciudad:(T==null?void 0:T.ciudad)||"",comuna:(T==null?void 0:T.comuna)||"",fecha:(te==null?void 0:te.fecha)||(T==null?void 0:T.fecha)||"",plazoDias:(te==null?void 0:te.plazoDias)??(T==null?void 0:T.plazoDias)??""},onSubmit:l=>{l.preventDefault();try{const d=l.currentTarget,c=new FormData(d),f=String(c.get("nombre")||"").trim()||"Proyecto sin título",g=mr?"create":String(c.get("nameChangeAction")||"update"),m=String(c.get("propietario")||"").trim(),x=String(c.get("direccion")||"").trim(),S=String(c.get("ciudad")||"").trim(),h=String(c.get("comuna")||"").trim(),A=String(c.get("fecha")||"").trim(),G=Number(c.get("plazoDias")||""),z=[x,h,S].filter(Boolean).join(", ");de(pe=>({...pe,nombreProyecto:f,propietario:m,direccion:x,ciudad:S,comuna:h,fecha:A,plazoDias:Number.isFinite(G)?G:pe==null?void 0:pe.plazoDias}));const Q=te||null,B=(Q==null?void 0:Q.id)||null,J=Ft&&(wr!=null&&wr[Ft])&&wr[Ft].name||"",Ce=f?`Presupuesto · ${f}`:J||"Presupuesto sin título",ve=Se?{nombre:(Se==null?void 0:Se.nombre)||"",email:(Se==null?void 0:Se.email)||"",telefono:(Se==null?void 0:Se.telefono)||"",profesion:(Se==null?void 0:Se.profesion)||""}:null;let ue=Ft||null,Ge=Ee,Ue=Re,ae=Yt;if(g==="create"){const pe=`b_${Date.now()}`,Ae=mr?[]:[...Ee],ke=mr?[]:[...Re],ze=mr?"":Yt,be={id:pe,name:Ce,rows:Ae,chapters:ke,currentChapterId:ze,createdAt:Date.now(),updatedAt:Date.now()};Za(se=>({...se||{},[pe]:be})),Jt(ke),na(ke),it(Ae),at(Ae),ya(ze),Ma(ze),di(pe),ue=pe,Ge=Ae,Ue=ke,ae=ze}else Ft&&Za(pe=>{const Ae=(pe||{})[Ft];return Ae?{...pe||{},[Ft]:{...Ae,name:Ce,updatedAt:Date.now()}}:pe});const Le={id:Ie(),name:Ce,createdAt:Date.now(),gg:p,util:_,iva:j,projectId:B,projectInfo:T,projectName:f,client:m,location:z,fecha:A||"",plazoDias:Number.isFinite(G)?G:void 0,savedBy:ve,savedByEmail:(Se==null?void 0:Se.email)||null,budgetId:ue,budgetName:Ce,currentChapterId:ae,apuLibrary:[...M],resourcesSnapshot:{...o},sumDirecto:jr,chapters:Ue,rows:Ge},Ze=H(U),Te=[Le,...Ze];X(Te);let Be=fe||null;const he=g==="create"?`p_${Date.now()}`:null;ge((pe=[])=>{const Ae=xe=>(xe||"").trim().toLowerCase().replace(/\s+/g," "),ke=f,ze={name:ke,client:m,location:z,fecha:A||"",plazoDias:Number.isFinite(G)?G:void 0,updatedAt:Date.now(),_source:"from-budget-save"};if(g==="create"&&he){const xe={id:he,...ze,createdAt:Date.now()};return[...pe,xe]}if(B&&B!=="inline"){const xe=pe.findIndex($e=>String(($e==null?void 0:$e.id)||"")===String(B));if(xe>=0){const $e=pe[xe]||{},qe={...$e,...ze,id:$e.id,createdAt:$e.createdAt||Date.now()},ut=[...pe];return ut[xe]=qe,Be=qe.id,ut}}const be=pe.findIndex(xe=>Ae((xe==null?void 0:xe.name)||"")===Ae(ke));if(be>=0){const xe=pe[be]||{},$e={...xe,...ze,id:xe.id||xe._tempId||`p_${Date.now()}`,createdAt:xe.createdAt||Date.now()},qe=[...pe];return qe[be]=$e,Be=$e.id,qe}const se=B&&B!=="inline"?String(B):`p_${Date.now()}`,Ne={id:se,...ze,createdAt:Date.now()};return Be=se,[...pe,Ne]}),Fe(he||Be),he&&setTimeout(()=>{try{hs(he)}catch{}},0),t("Proyecto creado/actualizado y presupuesto guardado","success"),va(!1),da(!1),Dn(null),i("presupuesto")}catch{va(!1),da(!1),Dn(null)}}}),me&&r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>N(!1)}),r.jsxs("div",{className:"relative bg-slate-900 border border-slate-700 rounded-2xl w-[min(1000px,95vw)] h-[min(90vh,900px)] grid grid-rows-[auto,1fr]",children:[r.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-slate-800",children:[r.jsx("div",{className:"text-sm font-semibold text-slate-100",children:"Vista previa de impresión"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>{var l;try{const d=(l=L.current)==null?void 0:l.contentWindow;d==null||d.focus(),d==null||d.print()}catch{}},className:"px-3 py-1 rounded-xl bg-indigo-700 hover:bg-indigo-600 text-white text-xs",children:"Imprimir"}),r.jsx("button",{onClick:()=>N(!1),className:"px-3 py-1 rounded-xl border border-slate-600 text-xs",children:"Cerrar"})]})]}),r.jsx("div",{className:"overflow-hidden",children:r.jsx("iframe",{ref:L,className:"w-full h-full bg-white",onLoad:()=>{var l,d,c;try{const f=((l=L.current)==null?void 0:l.contentDocument)||((c=(d=L.current)==null?void 0:d.contentWindow)==null?void 0:c.document);f&&(f.open(),f.write(y||""),f.close())}catch{}}})})]})]}),r.jsxs("div",{className:"max-w-6xl mx-auto grid gap-6",children:[r.jsx(b_,{open:ua,initial:fr,onClose:()=>It(!1),onSave:l=>{we(l),It(!1)},projects:_t}),r.jsxs("header",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[r.jsx("div",{className:"flex-1",children:r.jsx("h1",{className:"text-4xl font-extrabold tracking-tight text-slate-100",children:"PRESUPUESTO"})}),r.jsx("div",{className:"flex flex-wrap items-center gap-2",children:n==="presupuesto"&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:async()=>{var l;try{const d=ue=>{const Ue=(Array.isArray(ue==null?void 0:ue.apuIds)?ue.apuIds:[]).reduce((Le,Ze)=>{try{return Le+yt(C(Ze),o).unit}catch{return Le}},0);return((typeof(ue==null?void 0:ue.overrideUnitPrice)=="number"&&Number.isFinite(ue.overrideUnitPrice)?ue.overrideUnitPrice:void 0)??Ue)||0},c=ue=>{const Ue=(Array.isArray(ue==null?void 0:ue.apuIds)&&ue.apuIds.length?ue.apuIds:ue!=null&&ue.apuId?[ue.apuId]:[]).reduce((Le,Ze)=>{try{return Le+yt(C(Ze),o).unit}catch{return Le}},0);return((typeof(ue==null?void 0:ue.overrideUnitPrice)=="number"&&Number.isFinite(ue.overrideUnitPrice)?ue.overrideUnitPrice:void 0)??Ue)||0},f={};Re.forEach(ue=>f[ue.id]=[]),Ee.forEach(ue=>{var Ue;const Ge=ue.chapterId||((Ue=Re[0])==null?void 0:Ue.id)||"";f[Ge]||(f[Ge]=[]),f[Ge].push(ue)});const g=(te==null?void 0:te.name)||(T==null?void 0:T.nombreProyecto)||"Proyecto sin título",m=(te==null?void 0:te.client)||(T==null?void 0:T.propietario)||"",x=(te==null?void 0:te.location)||[T==null?void 0:T.direccion,T==null?void 0:T.comuna,T==null?void 0:T.ciudad].filter(Boolean).join(", "),S=(te==null?void 0:te.contract)||(T==null?void 0:T.contrato)||"",h=[];h.push([`Presupuesto — ${g}`]),h.push(["Obra:",g||"","","Cliente:",m||""]),h.push(["Dirección:",x||"","","Contrato:",S||""]),h.push([]),h.push(["Código","Descripción","Unidad","Cantidad","P.Unitario","P.Total"]);const A={};Re.forEach((ue,Ge)=>{const Ue=f[ue.id]||[];Ue.length&&(h.push([String(Ge+1),ue.title,"",null,null,null]),Ue.forEach((ae,Le)=>{var ze;const Ze=`${Ge+1}.${Le+1}`,Te=Array.isArray(ae.subRows)?ae.subRows:[];let Be=0,he=0,pe=0,Ae=0,ke=0;if(Te.length)h.push([Ze,String(ae.descripcion||"Partida").toUpperCase(),"",null,null,null]),Te.forEach((be,se)=>{var Ke;const Ne=`${Ge+1}.${Le+1}.${se+1}`,xe=be.unidadSalida||Array.isArray(be.apuIds)&&be.apuIds[0]&&((Ke=C(be.apuIds[0]))==null?void 0:Ke.unidadSalida)||""||"",$e=Number((be==null?void 0:be.metrados)||0),qe=d(be),ut=typeof(be==null?void 0:be.overrideTotal)=="number"&&Number.isFinite(be.overrideTotal)?be.overrideTotal:qe*$e;h.push([Ne,be.descripcion||"Subpartida",xe,Number.isFinite($e)&&$e!==0?$e:null,Number.isFinite(qe)&&qe!==0?qe:null,Number.isFinite(ut)&&ut!==0?ut:null]),Be+=Number(ut||0),(Array.isArray(be==null?void 0:be.apuIds)?be.apuIds:[]).forEach(Ut=>{try{const Xa=C(Ut);if(!Xa)return;A[Ut]||(A[Ut]={apu:Xa,items:new Set}),A[Ut].items.add(Ne);const Sa=Bs(Xa,o);he+=Sa.manoObra*$e,pe+=Sa.materiales*$e,Ae+=Sa.equipos*$e,ke+=Sa.varios*$e}catch{}})}),Be=he+pe+Ae+ke;else{h.push([Ze,String(ae.descripcion||"Partida").toUpperCase(),"",null,null,null]);const be=`${Ge+1}.${Le+1}.1`,se=ae.unidadSalida||Array.isArray(ae.apuIds)&&ae.apuIds[0]&&((ze=C(ae.apuIds[0]))==null?void 0:ze.unidadSalida)||""||"",Ne=Number(ae.metrados||0),xe=c(ae),$e=typeof(ae==null?void 0:ae.overrideTotal)=="number"&&Number.isFinite(ae.overrideTotal)?ae.overrideTotal:xe*Ne;h.push([be,"Subpartida",se,Number.isFinite(Ne)&&Ne!==0?Ne:null,Number.isFinite(xe)&&xe!==0?xe:null,Number.isFinite($e)&&$e!==0?$e:null]);const qe=Array.isArray(ae==null?void 0:ae.apuIds)&&ae.apuIds.length?ae.apuIds:ae!=null&&ae.apuId?[ae.apuId]:[];for(const st of qe)try{const Ke=C(st);if(!Ke)continue;const Ut=Bs(Ke,o);he+=Ut.manoObra*Ne,pe+=Ut.materiales*Ne,Ae+=Ut.equipos*Ne,ke+=Ut.varios*Ne}catch{}Be=he+pe+Ae+ke,(Array.isArray(ae==null?void 0:ae.apuIds)&&ae.apuIds.length?ae.apuIds:ae!=null&&ae.apuId?[ae.apuId]:[]).forEach(st=>{try{const Ke=C(st);if(!Ke)return;A[st]||(A[st]={apu:Ke,items:new Set}),A[st].items.add(be)}catch{}})}he&&h.push(["","Subtotal Mano de Obra","",null,null,he]),pe&&h.push(["","Subtotal Materiales","",null,null,pe]),Ae&&h.push(["","Subtotal Equipos","",null,null,Ae]),ke&&h.push(["","Subtotal Varios","",null,null,ke]),h.push(["",`COSTO DIRECTO partida ${String(ae.descripcion||"").toLowerCase()}`,"",null,null,Be||null])}))});const G=Number(p)||0,z=Number(_)||0,Q=Number(jr)||0,B=Q*G,J=(Q+B)*z;h.push([]),h.push(["","COSTO DIRECTO","","","",Q]),h.push(["",`utilidad (${(z*100).toFixed(0)}%)`,"","","",J]),h.push(["",`gastos generales (${(G*100).toFixed(0)}%)`,"","","",B]),h.push(["","total neto","","","",Q+J+B]),h.push([]),h.push(["Notas"]),h.push([String(F||"")]);const Ce=(ue,Ge)=>{try{const Ue=yn(),ae=Ue&&Ue[ue]?Ue[ue]:ue,Le=localStorage.getItem("apu-library");if(Le){const Ze=JSON.parse(Le||"null");if(Array.isArray(Ze)){const Te=Ze.findIndex(Be=>String((Be==null?void 0:Be.id)||"")===String(ae));if(Te>=0){const Be=Te+1;return String(Be)}}}}catch{}return""};let ve=!1;try{const ue=await Gl(()=>import("./exceljs.min-Cy5lojwr.js").then(se=>se.e),[]),{saveAs:Ge}=await Gl(async()=>{const{saveAs:se}=await import("./FileSaver.min-Cnotsbnx.js").then(Ne=>Ne.F);return{saveAs:se}},[]),Ue=new ue.Workbook,ae=Ue.addWorksheet("Presupuesto");ae.columns=[{header:"Código",key:"codigo",width:6},{header:"Descripción",key:"desc",width:60},{header:"Unidad",key:"un",width:10},{header:"Cantidad",key:"qty",width:12},{header:"P.Unitario",key:"pu",width:16},{header:"P.Total",key:"pt",width:16}];const Le=se=>ae.addRow(se),Ze=se=>`A${se}`,Te=(se,Ne)=>`${se}:${Ne}`;Le([`Presupuesto — ${g}`]),ae.mergeCells(Te(Ze(1),"F1")),Le(["Obra:",g||"","","Cliente:",m||""]),ae.mergeCells("B2:C2"),ae.mergeCells("E2:F2"),Le(["Dirección:",x||"","","Contrato:",S||""]),ae.mergeCells("B3:C3"),ae.mergeCells("E3:F3"),Le([]);const Be=Le(["Código","Descripción","Unidad","Cantidad","P.Unitario","P.Total"]);Be.eachCell(se=>{se.font={bold:!0},se.alignment={vertical:"middle",horizontal:"center"},se.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFE5E7EB"}},se.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});const he=Be.number;for(const se of h.slice(6)){const Ne=Le(se),xe=String((se==null?void 0:se[1])||""),$e=(se==null?void 0:se[0])&&!(se!=null&&se[2])&&!(se!=null&&se[3])&&!(se!=null&&se[4])&&!(se!=null&&se[5]),qe=xe.toLowerCase(),ut=qe.startsWith("subtotal "),st=qe.startsWith("costo directo partida");$e&&(Ne.font={bold:!0},Ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFF3F4F6"}}),ut&&(Ne.getCell(2).font={bold:!0},Ne.getCell(6).font={bold:!0},Ne.getCell(6).numFmt="#,##0"),st&&(Ne.font={bold:!0},Ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFF6FF"}},Ne.getCell(6).numFmt="#,##0"),Ne.eachCell(Ke=>{Ke.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Ke.col===4&&(Ke.numFmt="#,##0.00"),(Ke.col===5||Ke.col===6)&&(Ke.numFmt="#,##0"),(Ke.col===4||Ke.col===5||Ke.col===6)&&(Ke.alignment={horizontal:"right"})})}const pe=((l=ae.lastRow)==null?void 0:l.number)||ae.rowCount;for(let se=pe-3;se<=pe;se++){const Ne=ae.getRow(se);Ne.eachCell(xe=>{xe.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),Ne.getCell(1).value="",Ne.getCell(2).alignment={horizontal:"right"},se===pe&&(Ne.eachCell(xe=>{xe.font={bold:!0}}),Ne.getCell(2).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFF6FF"}},Ne.getCell(6).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FFEFF6FF"}})}ae.views=[{state:"frozen",ySplit:he}],ae.autoFilter={from:{row:he,column:1},to:{row:he,column:6}};const Ae=Ue.addWorksheet("APUs");Ae.columns=[{header:"APU",width:20},{header:"Descripción",width:50},{header:"Unidad",width:10},{header:"P. UNIT.",width:16},{header:"Usado en",width:20}];const ke=Ae.addRow(["APU","Descripción","Unidad","P. UNIT.","Usado en"]);ke.font={bold:!0},Object.entries(A).forEach(([se,Ne])=>{try{const xe=Ne.apu,$e=(xe==null?void 0:xe.unidadSalida)||"",qe=yt(xe,o).unit||0,ut=Array.from(Ne.items||[]).sort().join(", "),st=Ce(se,xe)||se,Ke=Ae.addRow([st,(xe==null?void 0:xe.descripcion)||"",$e,Number.isFinite(qe)&&qe!==0?qe:null,ut]);Ke.getCell(4).numFmt="#,##0"}catch{}});const ze=await Ue.xlsx.writeBuffer(),be=String(g).toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-_]+/g,"");Ge(new Blob([ze],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),`presupuesto-${be||"export"}.xlsx`),ve=!0}catch{}if(!ve){const ue=await Gl(()=>import("./xlsx-D_0l8YDs.js"),[]),Ge=ue.utils.book_new(),Ue=ue.utils.aoa_to_sheet(h);Ue["!merges"]=(Ue["!merges"]||[]).concat([{s:{r:0,c:0},e:{r:0,c:5}},{s:{r:1,c:1},e:{r:1,c:2}},{s:{r:1,c:4},e:{r:1,c:5}},{s:{r:2,c:1},e:{r:2,c:2}},{s:{r:2,c:4},e:{r:2,c:5}}]);const ae=h.length-1;Ue["!merges"].push({s:{r:ae,c:0},e:{r:ae,c:5}}),Ue["!cols"]=[{wch:6},{wch:60},{wch:10},{wch:12},{wch:16},{wch:16}];const Le=h.findIndex(pe=>pe&&pe[0]==="Código"&&pe[1]==="Descripción"),Ze=Le>=0?Le+1:0;for(let pe=Ze;pe<h.length;pe++){const Ae=ue.utils.encode_cell({r:pe,c:3}),ke=ue.utils.encode_cell({r:pe,c:4}),ze=ue.utils.encode_cell({r:pe,c:5}),be=Ue[Ae];be&&typeof be.v=="number"&&(be.t="n",be.z="#,##0.00");const se=Ue[ke];se&&typeof se.v=="number"&&(se.t="n",se.z="#,##0");const Ne=Ue[ze];Ne&&typeof Ne.v=="number"&&(Ne.t="n",Ne.z="#,##0")}ue.utils.book_append_sheet(Ge,Ue,"Presupuesto");const Te=[["APU","Descripción","Unidad","P. UNIT.","Usado en"]];Object.entries(A).forEach(([pe,Ae])=>{try{const ke=Ae.apu,ze=(ke==null?void 0:ke.unidadSalida)||"",be=yt(ke,o).unit||0,se=Array.from(Ae.items||[]).sort().join(", "),Ne=Ce(pe,ke);Te.push([Ne||pe,(ke==null?void 0:ke.descripcion)||"",ze,Number.isFinite(be)&&be!==0?be:null,se])}catch{}});const Be=ue.utils.aoa_to_sheet(Te);Be["!cols"]=[{wch:20},{wch:50},{wch:10},{wch:16},{wch:20}];for(let pe=1;pe<Te.length;pe++){const Ae=ue.utils.encode_cell({r:pe,c:3}),ke=Be[Ae];ke&&typeof ke.v=="number"&&(ke.t="n",ke.z="#,##0")}ue.utils.book_append_sheet(Ge,Be,"APUs");const he=String(g).toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-_]+/g,"");ue.writeFile(Ge,`presupuesto-${he||"export"}.xlsx`)}}catch{}},className:"px-3 py-1 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40 text-xs",children:"📥 Exportar Excel"}),r.jsxs("button",{onClick:()=>{try{const l=ae=>new Intl.NumberFormat("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}).format(ae||0),d=ae=>new Intl.NumberFormat("es-CL",{maximumFractionDigits:2}).format(Number.isFinite(ae)?ae:0),c=ae=>String(ae??"").replace(/[&<>"']/g,Le=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[Le]),f=ae=>{const Ze=(Array.isArray(ae==null?void 0:ae.apuIds)?ae.apuIds:[]).reduce((Be,he)=>{try{return Be+yt(C(he),o).unit}catch{return Be}},0);return((typeof(ae==null?void 0:ae.overrideUnitPrice)=="number"&&Number.isFinite(ae.overrideUnitPrice)?ae.overrideUnitPrice:void 0)??Ze)||0},g=ae=>{const Ze=(Array.isArray(ae==null?void 0:ae.apuIds)&&ae.apuIds.length?ae.apuIds:ae!=null&&ae.apuId?[ae.apuId]:[]).reduce((Be,he)=>{try{return Be+yt(C(he),o).unit}catch{return Be}},0);return((typeof(ae==null?void 0:ae.overrideUnitPrice)=="number"&&Number.isFinite(ae.overrideUnitPrice)?ae.overrideUnitPrice:void 0)??Ze)||0},m={};Re.forEach(ae=>m[ae.id]=[]),Ee.forEach(ae=>{var Ze;const Le=ae.chapterId||((Ze=Re[0])==null?void 0:Ze.id)||"";m[Le]||(m[Le]=[]),m[Le].push(ae)});let S=`<!doctype html><html><head><meta charset='utf-8'/><title>Vista previa</title><style>
                    *{ box-sizing: border-box; }
                    @page{ size:A4; margin:10mm 10mm 12mm 10mm; }
                    body{ font-family: Arial, Helvetica, sans-serif; color:#111; }
                    h1{ text-align:center; margin: 0 0 12px; font-size:18px; }
                    .meta{ display:flex; justify-content:space-between; align-items:flex-start; margin: 0 0 10px; font-size:12px; }
                    .meta div{ line-height:1.2; }
                    table{ border-collapse: collapse; width:100%; }
                    .outer{ border:2px solid #111; }
                    th, td{ border:1px solid #333; padding:6px 8px; font-size:12px; }
                    thead th{ background:#e5e7eb; font-weight:700; text-align:center; }
                    tfoot td{ background:#eef2ff; font-weight:700; }
                    .col-item{ width:60px; text-align:center; }
                    .col-un{ width:80px; text-align:center; }
                    .col-cant{ width:90px; text-align:right; }
                    .col-pu{ width:120px; text-align:right; }
                    .col-total{ width:120px; text-align:right; }
                    .section{ font-weight:700; background:#f3f4f6; }
                    .right{ text-align:right; }
                    .center{ text-align:center; }
                    .notes{ border:1px solid #333; padding:8px; margin-top:12px; min-height:90px; }
                    .notes-title{ font-weight:700; margin-bottom:6px; }
                    .summary{ margin-top:12px; width:100%; display:flex; justify-content:flex-end; }
                    .summary table{ border-collapse:collapse; min-width:360px; }
                    .summary td{ border:1px solid #333; padding:6px 8px; font-size:12px; }
                    .summary .label{ background:#f8fafc; }
                    .summary .total{ background:#eef2ff; font-weight:700; }
                  </style></head><body>`;const h=(te==null?void 0:te.name)||(T==null?void 0:T.nombreProyecto)||"Proyecto sin título",A=(te==null?void 0:te.client)||(T==null?void 0:T.propietario)||"",G=(te==null?void 0:te.location)||[T==null?void 0:T.direccion,T==null?void 0:T.comuna,T==null?void 0:T.ciudad].filter(Boolean).join(", "),z=(te==null?void 0:te.contract)||(T==null?void 0:T.contrato)||"";S+=`<h1>Presupuesto — ${c(h)}</h1>`,S+=`<div class='meta'><div>${h?`<div><strong>Obra:</strong> ${c(h)}</div>`:""}${G?`<div><strong>Dirección:</strong> ${c(G)}</div>`:""}</div><div style='text-align:right'><div><strong>Cliente:</strong> ${c(A)}</div>${z?`<div><strong>Contrato:</strong> ${c(z)}</div>`:""}</div></div>`,S+="<table class='outer'><thead><tr><th class='col-item'>Código</th><th>Descripción</th><th class='col-un'>Unidad</th><th class='col-cant'>Cantidad</th><th class='col-pu'>P.Unitario</th><th class='col-total'>P.Total</th></tr></thead><tbody>",Re.forEach((ae,Le)=>{const Ze=m[ae.id]||[];Ze.length&&(S+=`<tr class='section'><td class='center'>${Le+1}</td><td>${ae.title}</td><td></td><td></td><td></td><td></td></tr>`,Ze.forEach((Te,Be)=>{var Ne;const he=`${Le+1}.${Be+1}`,pe=Array.isArray(Te.subRows)?Te.subRows:[];let Ae=0,ke=0,ze=0,be=0,se=0;if(pe.length)S+=`<tr class='section'><td class='center'>${he}</td><td>${(Te.descripcion||"Partida").toString().toUpperCase()}</td><td></td><td></td><td></td><td></td></tr>`,pe.forEach((xe,$e)=>{var Sa;const qe=`${Le+1}.${Be+1}.${$e+1}`,ut=xe.unidadSalida||Array.isArray(xe.apuIds)&&xe.apuIds[0]&&((Sa=C(xe.apuIds[0]))==null?void 0:Sa.unidadSalida)||""||"",st=Number((xe==null?void 0:xe.metrados)||0),Ke=f(xe),Ut=typeof(xe==null?void 0:xe.overrideTotal)=="number"&&Number.isFinite(xe.overrideTotal)?xe.overrideTotal:Ke*st;S+=`<tr><td class='center'>${qe}</td><td>${xe.descripcion||"Subpartida"}</td><td class='center'>${ut}</td><td class='right'>${st?d(st):""}</td><td class='right'>${Ke?l(Ke):""}</td><td class='right'>${Ut?l(Ut):""}</td></tr>`,Ae+=Number(Ut||0),(Array.isArray(xe==null?void 0:xe.apuIds)?xe.apuIds:[]).forEach(ug=>{try{const wu=C(ug);if(!wu)return;const Ss=Bs(wu,o);ke+=Ss.manoObra*st,ze+=Ss.materiales*st,be+=Ss.equipos*st,se+=Ss.varios*st}catch{}})}),Ae=ke+ze+be+se;else{S+=`<tr class='section'><td class='center'>${he}</td><td>${(Te.descripcion||"Partida").toString().toUpperCase()}</td><td></td><td></td><td></td><td></td></tr>`;const xe=`${Le+1}.${Be+1}.1`,$e=Te.unidadSalida||Array.isArray(Te.apuIds)&&Te.apuIds[0]&&((Ne=C(Te.apuIds[0]))==null?void 0:Ne.unidadSalida)||""||"",qe=Number(Te.metrados||0),ut=g(Te),st=typeof(Te==null?void 0:Te.overrideTotal)=="number"&&Number.isFinite(Te.overrideTotal)?Te.overrideTotal:ut*qe;S+=`<tr><td class='center'>${xe}</td><td>Subpartida</td><td class='center'>${$e}</td><td class='right'>${qe?d(qe):""}</td><td class='right'>${ut?l(ut):""}</td><td class='right'>${st?l(st):""}</td></tr>`;const Ke=Array.isArray(Te==null?void 0:Te.apuIds)&&Te.apuIds.length?Te.apuIds:Te!=null&&Te.apuId?[Te.apuId]:[];for(const Ut of Ke)try{const Xa=C(Ut);if(!Xa)continue;const Sa=Bs(Xa,o);ke+=Sa.manoObra*qe,ze+=Sa.materiales*qe,be+=Sa.equipos*qe,se+=Sa.varios*qe}catch{}Ae=ke+ze+be+se}ke&&(S+=`<tr><td></td><td>Subtotal Mano de Obra</td><td></td><td></td><td></td><td class='right'>${l(ke)}</td></tr>`),ze&&(S+=`<tr><td></td><td>Subtotal Materiales</td><td></td><td></td><td></td><td class='right'>${l(ze)}</td></tr>`),be&&(S+=`<tr><td></td><td>Subtotal Equipos</td><td></td><td></td><td></td><td class='right'>${l(be)}</td></tr>`),se&&(S+=`<tr><td></td><td>Subtotal Varios</td><td></td><td></td><td></td><td class='right'>${l(se)}</td></tr>`),S+=`<tr class='section'><td></td><td colspan='4'>COSTO DIRECTO partida ${(Te.descripcion||"").toString().toLowerCase()}</td><td class='right'>${Ae?l(Ae):""}</td></tr>`}))}),S+="</tbody></table>";const Q=Number(p)||0,B=Number(_)||0,J=Number(jr)||0,Ce=J*Q,ue=(J+Ce)*B,Ge=J+Ce+ue;S+=`<div class='summary'><table><tbody>
                    <tr><td class='label right'>COSTO DIRECTO</td><td class='right'>${l(J)}</td></tr>
                    <tr><td class='label right'>utilidad (${(B*100).toFixed(0)}%)</td><td class='right'>${l(ue)}</td></tr>
                    <tr><td class='label right'>gastos generales (${(Q*100).toFixed(0)}%)</td><td class='right'>${l(Ce)}</td></tr>
                    <tr><td class='label right total'>total neto</td><td class='right total'>${l(Ge)}</td></tr>
                  </tbody></table></div>`;const Ue=F&&String(F).trim()?`<div class='notes'><div class='notes-title'>Notas</div><div>${c(F).replace(/\n/g,"<br/>")}</div></div>`:"<div class='notes'><div class='notes-title'>Notas</div><div style='min-height:72px'></div></div>";S+=Ue,S+="</body></html>",O(S),N(!0)}catch{}},className:"px-3 py-1 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40 text-xs inline-flex items-center gap-1",children:[r.jsx(s_,{className:"h-4 w-4"})," Imprimir"]}),r.jsxs("button",{onClick:()=>{Dn({nombre:"",propietario:"",direccion:"",ciudad:"",comuna:"",fecha:"",plazoDias:""}),da(!0),va(!0)},className:"px-3 py-1 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40 text-xs inline-flex items-center gap-1",children:[r.jsx(Lp,{className:"h-4 w-4"})," Nuevo proyecto"]}),r.jsx("button",{onClick:()=>{va(!0)},className:"px-3 py-1 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40 text-xs",children:"💾 Guardar"}),r.jsx("button",{onClick:()=>{if(confirm("¿Borrar TODO el presupuesto (capítulos y partidas)? Esta acción no se puede deshacer.")){try{localStorage.removeItem("apu-budget")}catch{}try{localStorage.removeItem("apu-chapters")}catch{}try{localStorage.removeItem("apu-current-chapter")}catch{}it([]),Jt([]),ya("");try{fe&&fe!=="inline"?(ge((l=[])=>l.filter(d=>String((d==null?void 0:d.id)||"")!==String(fe))),Fe(null),t("Presupuesto y proyecto del stick borrados","info")):t("Presupuesto borrado","info")}catch{t("Presupuesto borrado","info")}}},className:"px-3 py-1 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40 text-xs",children:"🗑️ Borrar presupuesto"})]})})]}),r.jsxs("div",{className:"flex gap-2 bg-slate-800 p-1 rounded-2xl w-fit",children:[r.jsx("button",{onClick:()=>i("biblioteca"),className:`px-3 py-1 rounded-xl ${n==="biblioteca"?"bg-slate-900":"hover:bg-slate-700"}`,children:"Biblioteca de APU"}),r.jsx("button",{onClick:()=>i("presupuesto"),className:`px-3 py-1 rounded-xl ${n==="presupuesto"?"bg-slate-900":"hover:bg-slate-700"}`,children:"Presupuesto"}),r.jsx("button",{onClick:()=>i("calculadora"),className:`px-3 py-1 rounded-xl ${n==="calculadora"?"bg-slate-900":"hover:bg-slate-700"}`,children:"Calculadora"})]}),n==="biblioteca"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[r.jsx("h2",{className:"text-lg font-semibold",children:"Biblioteca de APUs"}),r.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-slate-400",children:"Buscar:"}),r.jsx("input",{value:il,onChange:l=>dh(l.target.value),className:"bg-slate-900 border border-slate-700 rounded-xl px-3 py-1.5 text-sm"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-slate-400",children:"Categoría:"}),(()=>{const l=Qd==="mine"?Y:M,d=Array.from(new Set((l||[]).map(c=>(c.categoria||"").trim()).filter(Boolean))).sort();return r.jsxs("select",{className:"bg-slate-900 border border-slate-700 rounded-xl px-3 py-1.5 text-sm",value:sl,onChange:c=>uh(c.target.value),children:[r.jsx("option",{value:"all",children:"Todas"}),d.map(c=>r.jsx("option",{value:c,children:c},c))]})})()]}),r.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-slate-300",children:[r.jsx("input",{type:"checkbox",checked:Gd,onChange:l=>ph(l.currentTarget.checked)}),"Ocultar incompletos"]}),r.jsx("button",{onClick:()=>us(!0),className:"ml-auto px-3 py-1.5 rounded-xl bg-slate-600 hover:bg-slate-500 text-sm",children:"+ Crear nuevo APU"}),r.jsx("button",{onClick:()=>ol(!0),className:"px-3 py-1.5 rounded-xl bg-indigo-700 hover:bg-indigo-600 text-sm text-white",children:"Asistente · APU desde texto"}),r.jsx("button",{onClick:()=>gs(!0),className:"px-3 py-1.5 rounded-xl bg-slate-700 hover:bg-slate-600 text-sm text-white",children:"👀 Revisar duplicados"}),r.jsx("button",{onClick:Qh,className:"px-3 py-1.5 rounded-xl bg-emerald-700 hover:bg-emerald-600 text-sm text-white",children:"🧹 Depurar duplicados"}),r.jsx("button",{onClick:()=>{confirm("Esto migrará APUs a secciones (limpiará items cuando existan secciones y derivará secciones desde items cuando falten). ¿Continuar?")&&Gh()},className:"px-3 py-1.5 rounded-xl bg-cyan-700 hover:bg-cyan-600 text-sm text-white",children:"🧽 Migrar a secciones"}),Hh&&r.jsx("button",{onClick:Wh,className:"px-3 py-1.5 rounded-xl border border-amber-400 text-amber-200 hover:bg-amber-500/10 text-sm",children:"↩️ Deshacer último"})]})]}),r.jsx("div",{className:"mt-3 bg-slate-800 rounded-2xl p-0 overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-sm",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-slate-300",children:[r.jsx("th",{className:"py-2 px-3 w-16",children:"N°"}),r.jsx("th",{className:"py-2 px-3",children:"Descripción"}),r.jsx("th",{className:"py-2 px-3 w-32",children:"Categoría"}),r.jsx("th",{className:"py-2 px-3 w-24",children:"Unidad"}),r.jsx("th",{className:"py-2 px-3 w-28",children:"P. Unitario"}),r.jsx("th",{className:"py-2 px-3 w-12"})]})}),r.jsx("tbody",{children:(()=>{const l=(Qd==="mine"?Y:M).filter(d=>!il||(d.descripcion||"").toLowerCase().includes(il.toLowerCase())).filter(d=>sl==="all"||String(d.categoria||"").trim()===sl).filter(d=>{if(!Gd)return!0;try{return!(rr(d)||!String((d==null?void 0:d.unidadSalida)||"").trim()||yt(d,o).unit===0)}catch{return!0}});return l.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"py-6 px-3 text-center text-slate-300",children:"No hay APUs para mostrar con los filtros actuales. Crea uno con “+ Crear nuevo APU” o usa el “Asistente · APU desde texto”."})}):l.map((d,c)=>{var f;return r.jsxs(V.Fragment,{children:[r.jsxs("tr",{className:"border-t border-slate-700",children:[r.jsx("td",{className:"py-2 px-3",children:c+1}),r.jsx("td",{className:"py-2 px-3",children:r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsx("button",{onClick:()=>Kd(d.id),className:"text-left hover:underline",children:d.descripcion}),(()=>{try{return rr(d)||!String((d==null?void 0:d.unidadSalida)||"").trim()||yt(d,o).unit===0?r.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg bg-amber-900/30 border border-amber-700/50 text-amber-300 text-[10px]",title:"Este APU no tiene costo calculable o le falta unidad/secciones","aria-label":"APU incompleto",children:"incompleto"}):null}catch{return null}})()]})}),r.jsx("td",{className:"py-2 px-3",children:d.categoria||""}),r.jsx("td",{className:"py-2 px-3",children:d.unidadSalida}),r.jsx("td",{className:"py-2 px-3 text-right",children:(()=>{const g=Mt===d.id&&Ct?{...Ct,id:d.id}:d;return pt(yt(g,o).unit)})()}),r.jsx("td",{className:"py-2 px-3 text-right",children:r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:()=>Kd(d.id),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Ver/Editar APU","aria-label":"Ver/Editar APU",children:r.jsx(Ri,{className:"h-4 w-4"})}),r.jsx("button",{onClick:()=>nu(d.id),className:"p-1 rounded-md border border-slate-600 text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Ver usos","aria-label":"Ver usos",children:"👁"}),r.jsx("button",{onClick:()=>dl(d.id),className:"p-1 rounded-md border border-slate-600 text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Eliminar APU","aria-label":"Eliminar APU",children:r.jsx(ma,{className:"h-4 w-4"})}),ng&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:r.jsxs("div",{className:"w-[min(920px,95vw)] max-h-[90vh] overflow-auto bg-slate-800 rounded-2xl border border-slate-700 p-4 grid gap-3",children:[r.jsx("div",{className:"text-lg font-semibold",children:"Importar partidas al presupuesto"}),r.jsx("div",{className:"text-sm text-slate-300",children:"Formato por línea: Capítulo; Subcapítulo; Código; Descripción Partida; Unidad; Cantidad; APU (id o nombre). Acepta separador ; , o tab. Para múltiples APUs por línea, separa con |"}),r.jsx("textarea",{className:"min-h-[220px] bg-slate-900 border border-slate-700 rounded-xl p-2 font-mono text-xs",value:vu,onChange:g=>ig(g.target.value),placeholder:`A; Movimiento de Tierras; 01-001; Excavación de zanjas; m3; 12; apu_exc_zanja_manual
A; Movimiento de Tierras; 01-002; Relleno y compactación; m3; 8; Relleno y compactación manual`}),r.jsxs("div",{className:"grid gap-2 text-sm",children:[r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:ys,onChange:g=>sg(g.target.checked)}),"Reemplazar presupuesto actual"]}),ys&&r.jsxs("label",{className:"inline-flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",checked:bu,onChange:g=>og(g.target.checked)}),"No cambiar el nombre del proyecto ni el usuario"]})]}),!!yu.length&&r.jsx("div",{className:"bg-slate-900 border border-slate-700 rounded-xl p-3 text-xs text-slate-300",children:yu.map((g,m)=>r.jsxs("div",{children:["• ",g]},m))}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:()=>rg(!1),className:"px-3 py-2 rounded-xl border border-slate-600",children:"Cerrar"}),r.jsx("button",{onClick:dg,className:"px-3 py-2 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40",children:"Procesar"})]})]})})]})})]}),Mt===d.id&&Ct&&r.jsx("tr",{className:"border-t border-slate-800 bg-slate-900/60",children:r.jsx("td",{colSpan:6,className:"p-3",children:r.jsxs("div",{className:"grid gap-3",children:[r.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Descripción"}),r.jsx("input",{className:"bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:Ct.descripcion,onChange:g=>dt(m=>({...m,descripcion:g.target.value}))})]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Unidad"}),(()=>{const g=Array.from(new Set((M||[]).map(x=>String((x==null?void 0:x.unidadSalida)||"").trim()).filter(Boolean))).sort(),m=`apu-units-${Mt}`;return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:m,className:"bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:Ct.unidadSalida,onChange:x=>dt(S=>({...S,unidadSalida:x.target.value}))}),r.jsx("datalist",{id:m,children:g.map(x=>r.jsx("option",{value:x},x))})]})})()]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Categoría"}),(()=>{const g=Array.from(new Set((M||[]).map(x=>String((x==null?void 0:x.categoria)||"").trim()).filter(Boolean))).sort(),m=`apu-cats-${Mt}`;return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:m,className:"bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:Ct.categoria||"",onChange:x=>dt(S=>({...S,categoria:x.target.value}))}),r.jsx("datalist",{id:m,children:g.map(x=>r.jsx("option",{value:x},x))})]})})()]})]}),r.jsx("div",{className:"flex items-center justify-end",children:r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[r.jsx("button",{onClick:()=>{const g=String((Ct==null?void 0:Ct.descripcion)||""),m=(prompt("Nuevo nombre del APU:",g)||"").trim();m&&dt(x=>({...x,descripcion:m}))},className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"Renombrar"}),r.jsx("button",{onClick:()=>{Mt&&(dl(Mt),ci(null),dt(null))},className:"px-2 py-1 rounded-lg border border-slate-600 hover:bg-slate-700/30 text-xs",children:"Eliminar"}),Sr(Mt||"")&&r.jsx("button",{onClick:vh,className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"+ Fila"}),Sr(Mt||"")&&r.jsx("button",{onClick:()=>{if(!confirm("¿Borrar TODAS las secciones y dejar solo una vacía?"))return;const g=(prompt("Nombre de la única sección que quedará:","SECCIÓN")||"").trim()||"SECCIÓN";dt(m=>({...m,secciones:{materiales:[],equipos:[],manoObra:[],varios:[],extras:[{title:g,rows:[{descripcion:"",unidad:"",cantidad:0,pu:0}]}],__titles:{}}}))},className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Borrar todas las secciones","aria-label":"Borrar todas las secciones",children:r.jsx(ma,{className:"h-4 w-4"})}),Sr(Mt||"")&&r.jsx("button",{onClick:bh,className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"+ Agregar sección"})]})}),r.jsxs("div",{className:"grid gap-4",children:[[{key:"materiales",title:"A.- MATERIALES"},{key:"equipos",title:"B.- EQUIPOS, MAQUINARIAS Y TRANSPORTES"},{key:"manoObra",title:"C.- MANO DE OBRA"},{key:"varios",title:"D.- VARIOS"}].map(g=>{var h,A,G;const m=((h=Ct.secciones)==null?void 0:h[g.key])||[];if(!m.length)return null;const x=m.reduce((z,Q)=>z+(Number(Q.cantidad)||0)*(Number(Q.pu)||0),0),S=((G=(A=Ct.secciones)==null?void 0:A.__titles)==null?void 0:G[g.key])||g.title;return r.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-slate-800",children:[r.jsx("div",{className:"font-medium text-slate-200 text-sm",children:S}),r.jsxs("div",{className:"flex items-center gap-2",children:[Sr(Mt||"")&&r.jsx("button",{onClick:()=>{const z=(prompt("Nuevo nombre de la sección:",S)||"").trim();z&&dt(Q=>{const B={...(Q.secciones||{}).__titles||{}};return B[g.key]=z,{...Q,secciones:{...Q.secciones||{},__titles:B}}})},className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"Renombrar"}),Sr(Mt||"")&&r.jsx("button",{onClick:()=>{dt(z=>({...z,secciones:{...z.secciones||{},[g.key]:[]}}))},className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Eliminar sección","aria-label":"Eliminar sección",children:r.jsx(ma,{className:"h-4 w-4"})}),Sr(Mt||"")&&r.jsx("button",{onClick:()=>gh(g.key),className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"+ Fila"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-slate-300",children:[r.jsx("th",{className:"py-2 px-3",children:"Descripción"}),r.jsx("th",{className:"py-2 px-3 w-24",children:"Unidad"}),r.jsx("th",{className:"py-2 px-3 w-24",children:"Cantidad"}),r.jsx("th",{className:"py-2 px-3 w-28",children:"P. Unitario"}),r.jsx("th",{className:"py-2 px-3 w-28",children:"Total"}),r.jsx("th",{className:"py-2 px-3 w-12"})]})}),r.jsxs("tbody",{children:[(m.length?m:[{descripcion:"",unidad:"",cantidad:0,pu:0}]).map((z,Q)=>{const B=(Number(z.cantidad)||0)*(Number(z.pu)||0);return r.jsxs("tr",{className:"border-t border-slate-800",children:[r.jsx("td",{className:"py-2 px-3",children:r.jsx("input",{className:"w-full bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-lg px-2 py-1",value:z.descripcion,onChange:J=>ms(g.key,Q,{descripcion:J.target.value})})}),r.jsx("td",{className:"py-2 px-3",children:(()=>{const J=Array.from(new Set((M||[]).map(ve=>String((ve==null?void 0:ve.unidadSalida)||"").trim()).filter(Boolean))).sort(),Ce=`apu-row-units-${Mt}-${g.key}`;return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:Ce,className:"w-full bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-lg px-2 py-1",value:z.unidad,onChange:ve=>ms(g.key,Q,{unidad:ve.target.value})}),r.jsx("datalist",{id:Ce,children:J.map(ve=>r.jsx("option",{value:ve},ve))})]})})()}),r.jsx("td",{className:"py-2 px-3",children:r.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-right",value:z.cantidad,onChange:J=>ms(g.key,Q,{cantidad:Number(J.target.value)||0})})}),r.jsx("td",{className:"py-2 px-3",children:r.jsx(ei,{value:Number.isFinite(Number(z.pu))?Number(z.pu):void 0,onChange:J=>ms(g.key,Q,{pu:Number(J||0)})})}),r.jsx("td",{className:"py-2 px-3 text-right",children:pt(B)}),r.jsx("td",{className:"py-2 px-3 text-right",children:r.jsx("button",{onClick:()=>xh(g.key,Q),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Eliminar fila","aria-label":"Eliminar fila",children:r.jsx(ma,{className:"h-4 w-4"})})})]},Q)}),r.jsxs("tr",{className:"border-t border-slate-800",children:[r.jsx("td",{colSpan:4,className:"py-2 px-3 text-right font-medium",children:"TOTAL"}),r.jsx("td",{className:"py-2 px-3 text-right font-semibold",children:pt(x)}),r.jsx("td",{className:"py-2 px-3"})]})]})]})})]},g.key)}),(((f=Ct.secciones)==null?void 0:f.extras)||[]).map((g,m)=>{const x=Array.isArray(g.rows)&&g.rows.length?g.rows:[{descripcion:"",unidad:"",cantidad:0,pu:0}],S=x.reduce((h,A)=>h+(Number(A.cantidad)||0)*(Number(A.pu)||0),0);return r.jsxs("div",{className:"bg-slate-900 rounded-xl border border-slate-700",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-slate-800",children:[r.jsx("div",{className:"font-medium text-slate-200 text-sm",children:g.title||"SECCIÓN"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>{const h=(prompt("Nuevo nombre de la sección:",g.title||"SECCIÓN")||"").trim();h&&dt(A=>{var z;const G=Array.isArray((z=A.secciones)==null?void 0:z.extras)?[...A.secciones.extras]:[];return G[m]?(G[m]={...G[m],title:h},{...A,secciones:{...A.secciones,extras:G}}):A})},className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"Renombrar"}),r.jsx("button",{onClick:()=>{confirm("¿Eliminar esta sección completa?")&&dt(h=>{var G;const A=Array.isArray((G=h.secciones)==null?void 0:G.extras)?[...h.secciones.extras]:[];return A.splice(m,1),{...h,secciones:{...h.secciones,extras:A}}})},className:"px-2 py-1 rounded-lg border border-slate-600 hover:bg-slate-700/30 text-xs",children:"Eliminar"}),r.jsx("button",{onClick:()=>yh(m),className:"px-2 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-xs",children:"+ Fila"})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-slate-300",children:[r.jsx("th",{className:"py-2 px-3",children:"Descripción"}),r.jsx("th",{className:"py-2 px-3 w-24",children:"Unidad"}),r.jsx("th",{className:"py-2 px-3 w-24",children:"Cantidad"}),r.jsx("th",{className:"py-2 px-3 w-28",children:"P. Unitario"}),r.jsx("th",{className:"py-2 px-3 w-28",children:"Total"}),r.jsx("th",{className:"py-2 px-3 w-12"})]})}),r.jsxs("tbody",{children:[x.map((h,A)=>{const G=(Number(h.cantidad)||0)*(Number(h.pu)||0);return r.jsxs("tr",{className:"border-t border-slate-800",children:[r.jsx("td",{className:"py-2 px-3",children:r.jsx("input",{className:"w-full bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-lg px-2 py-1",value:h.descripcion||"",onChange:z=>fs(m,A,{descripcion:z.target.value})})}),r.jsx("td",{className:"py-2 px-3",children:(()=>{const z=Array.from(new Set((M||[]).map(B=>String((B==null?void 0:B.unidadSalida)||"").trim()).filter(Boolean))).sort(),Q=`apu-extra-units-${Mt}-${m}`;return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:Q,className:"w-full bg-slate-900 border border-transparent focus:border-transparent focus:ring-0 rounded-lg px-2 py-1",value:h.unidad||"",onChange:B=>fs(m,A,{unidad:B.target.value})}),r.jsx("datalist",{id:Q,children:z.map(B=>r.jsx("option",{value:B},B))})]})})()}),r.jsx("td",{className:"py-2 px-3",children:r.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded-lg px-2 py-1 text-right",value:Number(h.cantidad||0),onChange:z=>fs(m,A,{cantidad:Number(z.target.value)||0})})}),r.jsx("td",{className:"py-2 px-3",children:r.jsx(ei,{value:Number.isFinite(Number(h.pu))?Number(h.pu):void 0,onChange:z=>fs(m,A,{pu:Number(z||0)})})}),r.jsx("td",{className:"py-2 px-3 text-right",children:pt(G)}),r.jsx("td",{className:"py-2 px-3 text-right",children:r.jsx("button",{onClick:()=>Sh(m,A),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Eliminar fila","aria-label":"Eliminar fila",children:r.jsx(ma,{className:"h-4 w-4"})})})]},A)}),r.jsxs("tr",{className:"border-t border-slate-800",children:[r.jsx("td",{colSpan:4,className:"py-2 px-3 text-right font-medium",children:"TOTAL"}),r.jsx("td",{className:"py-2 px-3 text-right font-semibold",children:pt(S)}),r.jsx("td",{className:"py-2 px-3"})]})]})]})})]},`extra2_${m}`)}),(()=>{try{const g=Ct.secciones||{},m=J=>(Array.isArray(J)?J:[]).reduce((Ce,ve)=>Ce+(Number(ve==null?void 0:ve.cantidad)||0)*(Number(ve==null?void 0:ve.pu)||0),0),x=m(g.materiales),S=m(g.equipos),h=m(g.manoObra),A=m(g.varios),G=(Array.isArray(g.extras)?g.extras:[]).reduce((J,Ce)=>J+m((Ce==null?void 0:Ce.rows)||[]),0),z=["materiales","equipos","manoObra","varios","extras","__meta","__titles"],Q=Object.keys(g||{}).reduce((J,Ce)=>{if(z.includes(Ce))return J;const ve=g[Ce];return Array.isArray(ve)?J+m(ve):ve&&Array.isArray(ve.rows)?J+m(ve.rows):J},0),B=x+S+h+A+G+Q;return r.jsxs("div",{className:"mt-2 grid gap-2",children:[r.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-slate-300",children:[r.jsxs("span",{children:["Materiales: ",r.jsx("b",{className:"tabular-nums",children:pt(x)})]}),r.jsxs("span",{children:["Equipos: ",r.jsx("b",{className:"tabular-nums",children:pt(S)})]}),r.jsxs("span",{children:["Mano de obra: ",r.jsx("b",{className:"tabular-nums",children:pt(h)})]}),r.jsxs("span",{children:["Varios: ",r.jsx("b",{className:"tabular-nums",children:pt(A)})]}),r.jsxs("span",{children:["Extras: ",r.jsx("b",{className:"tabular-nums",children:pt(G)})]}),Q>0&&r.jsxs("span",{children:["Otras secciones: ",r.jsx("b",{className:"tabular-nums",children:pt(Q)})]})]}),r.jsx("div",{className:"flex items-center justify-end",children:r.jsxs("div",{className:"px-3 py-2 rounded-xl bg-slate-900 border border-slate-700 text-sm font-semibold text-slate-200",children:["TOTAL APU: ",r.jsx("span",{className:"tabular-nums",children:pt(B)})]})})]})}catch{return null}})()]}),(()=>{var m,x;const g=String(((x=(m=Ct.secciones)==null?void 0:m.__meta)==null?void 0:x.obs)||"");return r.jsx("div",{className:"grid gap-3 items-end",children:r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Observaciones"}),r.jsx("textarea",{rows:2,value:g,onChange:S=>_h({obs:S.target.value}),className:"bg-slate-900 border border-slate-700 rounded-xl p-2",placeholder:"Notas/observaciones del APU"})]})})})(),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:()=>{ci(null),dt(null)},className:"px-3 py-2 rounded-xl border border-slate-600",children:"Cerrar"}),r.jsx("button",{onClick:wh,className:"px-3 py-2 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40",children:"Guardar"})]})]})})})]},d.id)})})()})]})}),r.jsx(Hp,{open:mh,onClose:()=>us(!1),onSave:Jd}),r.jsx(w_,{open:fh,onClose:()=>ol(!1),onGenerate:l=>{Jd(l),ol(!1)},builders:{buildApuRadierH25ConMalla:Xe,buildApuPavimentoExteriorH25_8cmMalla:Ud,buildApuH25ObraVibradoM3:tl,buildApuExcavacionRetiroM3:el,buildApuExcavacionZanjaManual:qa,buildApuRellenoCompactManual:oe,buildApuZapataCorridaEnZanja:Ve,buildApuEnfierraduraKg:ds,buildApuCuradoHumedoM2:al,buildApuImperCementicia2capasM2:nl,buildApuPinturaPiscina2manosM2:rl,buildApuTabiqueMetalconDoblePlaca:le,buildApuCieloRasoYesoCarton:Qe,buildApuAlbanileriaLadrilloComun:Et,buildApuMuroLadrillo:je,buildApuEstructuraTechumbreMadera:Je,buildApuCubiertaZincFieltro:zt,buildApuRedHid_ValvulaBola50_u:Vd,buildApuRedHid_PVC50_Tuberia_ml:qd}}),r.jsx(Hp,{open:hh,onClose:()=>{ll(!1),cl(null)},onSave:jh,initial:li}),r.jsx(g_,{open:Vh,apus:M,resources:o,usageCounts:Mh,onShowUsages:l=>{gs(!1),nu(l)},onClose:()=>gs(!1),onMerge:(l,d,c)=>fl(l,d,c),onEdit:l=>{gs(!1),Cr(l)},onDelete:l=>dl(l,{skipConfirm:!0,silent:!0})}),Zt.open&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:r.jsxs("div",{className:"w-[min(720px,95vw)] max-h-[85vh] overflow-auto bg-slate-900 rounded-2xl border border-slate-700 p-4 grid gap-3 text-slate-100",children:[(()=>{let l=Zt.apuId||"";try{if(Zt.apuId){const d=C(Zt.apuId);d&&(l=`${d.descripcion} (${d.id})`)}}catch{}return r.jsxs("div",{className:"text-lg font-semibold",children:["Usos del APU · ",l]})})(),r.jsxs("div",{className:"text-sm text-slate-300",children:["Total de referencias: ",Zt.usages.length]}),Zt.usages.length===0?r.jsx("div",{className:"text-sm text-slate-400",children:"Este APU no está en uso en el presupuesto activo."}):r.jsx("div",{className:"bg-slate-800 border border-slate-700 rounded-xl p-2 max-h-[45vh] overflow-auto",children:r.jsx("ul",{className:"text-sm space-y-1",children:Zt.usages.map((l,d)=>r.jsxs("li",{children:["• ",l.label]},d))})}),r.jsxs("div",{className:"grid gap-2",children:[r.jsx("label",{className:"text-sm text-slate-300",children:"Reemplazar en todas estas referencias por:"}),(()=>{const l="apu-replace-list",d=(M||[]).map(c=>({id:c.id,label:`${c.descripcion} (${c.id})`}));return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:l,className:"bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm",placeholder:"Escribe o selecciona un APU",value:Zt.targetId,onChange:c=>pl(f=>({...f,targetId:c.target.value}))}),r.jsx("datalist",{id:l,children:d.map(c=>r.jsx("option",{value:c.id,children:c.label},c.id))})]})})()]}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:ru,className:"px-3 py-2 rounded-xl border border-slate-600",children:"Cerrar"}),r.jsx("button",{onClick:()=>Zt.apuId&&Ph(Zt.apuId,Zt.targetId),disabled:!Zt.apuId||!Zt.targetId||Zt.apuId===Zt.targetId,className:"px-3 py-2 rounded-xl bg-indigo-700 hover:bg-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Reemplazar"})]})]})})]}),n==="calculadora"&&r.jsx(p_,{gg:p,util:_,iva:j,onChangeGG:l=>v(l),onChangeUtil:l=>b(l),onChangeIVA:l=>E(l),apus:M,resources:o,onShowApuDetail:l=>Cr(l),onCreateApuByName:(l,d)=>_s(l,d)}),n==="presupuesto"&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:backdrop-blur bg-slate-900/80 border-b border-slate-800/80 mb-4",children:r.jsxs("div",{className:"w-full max-w-6xl mx-auto bg-slate-800/60 border border-slate-700 rounded-2xl p-4 m-2 shadow-md grid gap-3",children:[Xh&&r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:r.jsxs("div",{className:"w-[min(520px,95vw)] bg-slate-900 rounded-2xl border border-slate-700 p-4 grid gap-3",children:[r.jsx("div",{className:"text-lg font-semibold text-slate-100",children:"Cargar planilla"}),r.jsxs("div",{className:"text-sm text-slate-300",children:["Vas a cargar la planilla ",r.jsx("span",{className:"font-medium",children:xu}),". ¿Cómo quieres aplicarla?"]}),r.jsxs("div",{className:"grid gap-2",children:[r.jsxs("label",{className:"inline-flex items-center gap-2 text-slate-200 text-sm",children:[r.jsx("input",{type:"radio",name:"pl-mode",checked:bl==="replace",onChange:()=>yl("replace")}),"Reemplazar presupuesto actual"]}),r.jsxs("label",{className:"inline-flex items-center gap-2 text-slate-200 text-sm",children:[r.jsx("input",{type:"radio",name:"pl-mode",checked:bl==="append",onChange:()=>yl("append")}),"Agregar al final del presupuesto"]})]}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{onClick:ag,className:"px-3 py-2 rounded-xl border border-slate-600 text-slate-200",children:"Cancelar"}),r.jsx("button",{onClick:tg,className:"px-3 py-2 rounded-xl bg-indigo-700 hover:bg-indigo-600 text-white",children:"Confirmar"})]})]})}),r.jsxs("div",{className:"grid md:grid-cols-3 gap-3 items-start md:items-start",children:[r.jsxs("div",{className:"grid gap-2 min-w-0 text-center",children:[r.jsxs("div",{className:"flex items-center justify-between w-full",children:[r.jsx("h3",{className:"text-sm font-semibold text-slate-200",children:"Proyecto"}),(()=>{const l=te&&te.plazoDias||(T==null?void 0:T.plazoDias),d=Number.isFinite(Number(l))&&Number(l)>0?String(l):"—";return r.jsxs("span",{className:"text-xs text-slate-400",children:["Plazo: ",d," días"]})})()]}),r.jsxs("div",{className:"grid gap-2 max-w-full overflow-hidden",children:[r.jsxs("select",{className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm truncate outline-none focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0 focus:border-slate-600",value:fe||"",title:`${s((te==null?void 0:te.name)||"")}${te!=null&&te.client?" — "+s((te==null?void 0:te.client)||""):""}${te!=null&&te.location?" — "+s((te==null?void 0:te.location)||""):""}`,onChange:l=>hs(l.target.value||null),children:[r.jsx("option",{value:"",children:"Seleccionar…"}),_t.map(l=>r.jsxs("option",{value:l.id,children:[s(l.name),l.client?` — ${s(l.client)}`:"",l.location?` — ${s(l.location)}`:""]},l.id)),fe==="inline"&&T&&(T.nombreProyecto||T.propietario||T.direccion||T.ciudad||T.comuna)&&r.jsxs("option",{value:"inline",children:[s((T==null?void 0:T.nombreProyecto)||"Proyecto"),T!=null&&T.propietario?` — ${s(T==null?void 0:T.propietario)}`:""]})]}),r.jsxs("div",{className:"flex justify-end gap-2",children:[r.jsx("button",{type:"button",className:"p-1.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200",title:"Agregar proyecto","aria-label":"Agregar proyecto",onClick:()=>{Dn({nombre:"",propietario:"",direccion:"",ciudad:"",comuna:"",fecha:"",plazoDias:""}),da(!0),va(!0)},children:r.jsx(Lp,{className:"h-4 w-4"})}),r.jsx("button",{type:"button",className:"p-1.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200",title:"Modificar datos del proyecto","aria-label":"Modificar datos del proyecto",onClick:()=>va(!0),disabled:!fe,children:r.jsx(Ri,{className:"h-4 w-4"})}),r.jsx("button",{type:"button",className:"p-1.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200",title:"Eliminar proyecto","aria-label":"Eliminar proyecto",onClick:pn,disabled:!fe,children:r.jsx(ma,{className:"h-4 w-4"})})]}),te&&r.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 text-xs text-slate-300 max-w-full text-center",children:[r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Nombre:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:s(te.name),children:s(te.name)||"—"})]}),r.jsx("span",{className:"mx-1 text-slate-500",children:"·"}),r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Cliente:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:s(te.client),children:s(te.client)||"—"})]}),r.jsx("span",{className:"mx-1 text-slate-500",children:"·"}),r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Ubicación:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:s(te.location),children:s(te.location)||"—"})]}),r.jsx("span",{className:"mx-1 text-slate-500",children:"·"}),r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Fecha:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:te.fecha||"",children:te.fecha||"—"})]})]})]})]}),r.jsxs("div",{className:"grid gap-2 min-w-0 max-w-full text-center",children:[r.jsxs("div",{className:"flex items-center justify-between w-full",children:[r.jsx("h3",{className:"text-sm font-semibold text-slate-200",children:"Usuario"}),r.jsxs("span",{className:"text-xs text-slate-400 truncate max-w-[50%]",title:s((Se==null?void 0:Se.profesion)||""),children:["Profesión: ",s((Se==null?void 0:Se.profesion)||"—")]})]}),r.jsxs("div",{className:"grid gap-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("select",{className:"flex-1 min-w-0 bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm truncate outline-none focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0 focus:border-slate-600",value:jt||"",title:Se?`${s((Se==null?void 0:Se.nombre)||"")}${Se!=null&&Se.email?" — "+Se.email:""}`:"",onChange:l=>ca(l.target.value||null),children:[r.jsx("option",{value:"",children:"Seleccionar…"}),lt.map((l,d)=>r.jsx("option",{value:l.email||"",children:s(l.nombre)||l.email||`Usuario ${d+1}`},l.email||d))]}),r.jsxs("div",{className:"flex items-center justify-end gap-1",children:[r.jsx("button",{type:"button",onClick:hr,className:"p-1.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200",title:"Crear usuario","aria-label":"Crear usuario",children:r.jsx(c_,{className:"h-4 w-4"})}),r.jsx("button",{type:"button",onClick:Ho,className:"p-1.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200",title:"Editar usuario seleccionado","aria-label":"Editar usuario seleccionado",children:r.jsx(Ri,{className:"h-4 w-4"})}),r.jsx("button",{type:"button",onClick:is,className:"p-1.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-200",title:"Eliminar usuario seleccionado","aria-label":"Eliminar usuario seleccionado",children:r.jsx(ma,{className:"h-4 w-4"})})]})]}),Se&&r.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 text-xs text-slate-300 max-w-full text-center",children:[r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Nombre:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:s(Se.nombre),children:s(Se.nombre)||"—"})]}),r.jsx("span",{className:"mx-1 text-slate-500",children:"·"}),r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Email:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:Se.email||"",children:Se.email||"—"})]}),r.jsx("span",{className:"mx-1 text-slate-500",children:"·"}),r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Teléfono:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:Se.telefono||"",children:Se.telefono||"—"})]}),r.jsx("span",{className:"mx-1 text-slate-500",children:"·"}),r.jsxs("div",{className:"flex items-baseline whitespace-normal break-words",children:[r.jsx("span",{className:"text-slate-400 font-normal mr-1",children:"Profesión:"}),r.jsx("span",{className:"inline-block align-bottom break-words",title:s(Se.profesion)||"",children:s(Se.profesion)||"—"})]})]})]})]}),r.jsxs("div",{className:"grid gap-2 min-w-0 text-center",children:[r.jsxs("div",{className:"flex items-center justify-between w-full",children:[r.jsx("h3",{className:"text-sm font-semibold text-slate-200",children:"Planillas"}),r.jsx("span",{className:"text-xs text-slate-400",children:"Cargar preset"})]}),r.jsx("div",{className:"grid gap-2 max-w-full overflow-hidden",children:r.jsxs("select",{className:"w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-2 text-sm truncate outline-none focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0 focus:border-slate-600",value:Zh,onChange:l=>eg(l.target.value),children:[r.jsx("option",{value:"",children:"Seleccionar…"}),r.jsx("option",{value:"Casa 10×10",children:"Casa 10×10"}),r.jsx("option",{value:"Casa 60 m²",children:"Casa 60 m²"}),r.jsx("option",{value:"Piscina",children:"Piscina"}),r.jsx("option",{value:"Fosa Séptica",children:"Fosa Séptica"})]})})]})]})]})}),r.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:r.jsxs("div",{className:"flex-1 grid gap-4",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[r.jsx("h2",{className:"text-lg font-semibold",children:te!=null&&te.name||T!=null&&T.nombreProyecto?`Presupuesto · ${s((te==null?void 0:te.name)||(T==null?void 0:T.nombreProyecto)||"")}`:"Presupuesto"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("select",{className:"bg-slate-700 border border-slate-600 rounded-xl px-3 py-2 text-sm",value:Yt,onChange:l=>{ya(l.target.value),Ma(l.target.value)},children:[r.jsx("option",{value:"",children:"Capítulos…"}),Re.map(l=>r.jsxs("option",{value:l.id,children:[l.letter," — ",l.title]},l.id))]}),r.jsx("button",{onClick:eu,className:"px-3 py-2 rounded-xl border border-slate-600 hover:bg-slate-700/40 text-sm",children:"+ Capítulo"}),Yt&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>kh(Yt),className:"px-3 py-2 rounded-xl border border-slate-600 hover:bg-slate-700/40 text-sm",children:"Renombrar"}),r.jsx("button",{onClick:()=>Ih(Yt),className:"px-3 py-2 rounded-xl border border-slate-600 hover:bg-slate-700/40 text-sm",children:"Eliminar"})]}),r.jsx("button",{onClick:Th,className:"px-3 py-2 rounded-xl border border-slate-600 hover:bg-slate-700/40",children:"+ Partida"})]})})]}),r.jsxs("div",{className:"bg-slate-800 rounded-2xl p-4 shadow",children:[r.jsx("div",{className:"block lg:hidden space-y-6",children:Re.map(l=>{const d=Ee.filter(c=>c.chapterId===l.id);return r.jsx("div",{className:"space-y-3",children:d.map((c,f)=>{const g=c.apuIds&&c.apuIds.length?c.apuIds:c.apuId?[c.apuId]:[],m=g.length>0;return r.jsxs("div",{className:"bg-slate-900 rounded-xl p-4 border border-slate-700",children:[r.jsx("div",{className:"text-xs text-slate-400 mb-1",children:f+1}),r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("div",{className:"grid gap-2 w-full",children:[r.jsx("label",{className:"text-xs text-slate-400",children:"Nombre de la partida"}),r.jsx("button",{className:"w-full text-left rounded-lg p-2 text-sm border bg-slate-800 border-slate-600 hover:bg-slate-700/40 cursor-pointer",onClick:()=>{Ar({open:!0,rowId:c.id})},children:c.descripcion&&c.descripcion.trim()||"Sin nombre"}),m&&r.jsx("div",{className:"mt-2 overflow-x-auto",children:r.jsxs("table",{className:"min-w-full text-xs",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-slate-300",children:[r.jsx("th",{className:"px-2 py-1 text-left w-8",children:"#"}),r.jsx("th",{className:"px-2 py-1 text-left",children:"PARTIDA"}),r.jsx("th",{className:"px-2 py-1 text-center w-12",children:"UN"}),r.jsx("th",{className:"px-2 py-1 text-center w-16",children:"CANT."}),r.jsx("th",{className:"px-2 py-1 text-right w-24",children:"P. UNIT."}),r.jsx("th",{className:"px-2 py-1 text-right w-24",children:"TOTAL"})]})}),r.jsx("tbody",{children:g.map((x,S)=>{try{const h=C(x),A=h.unidadSalida||"GL",G=c.metrados||0,z=yt(h,o).unit,Q=z*G;return r.jsxs("tr",{className:"border-t border-slate-700",children:[r.jsx("td",{className:"px-2 py-1",children:S+1}),r.jsx("td",{className:"px-2 py-1",children:r.jsx("button",{onClick:()=>Cr(x),className:"text-slate-200 hover:underline text-left",title:h.descripcion,children:h.descripcion})}),r.jsx("td",{className:"px-2 py-1 text-center",children:A}),r.jsx("td",{className:"px-2 py-1 text-center",children:G.toFixed(1)}),r.jsx("td",{className:"px-2 py-1 text-right",children:pt(z)}),r.jsx("td",{className:"px-2 py-1 text-right",children:pt(Q)})]},x)}catch{return null}})})]})}),Array.isArray(c.subRows)&&c.subRows.length>0&&r.jsxs("div",{className:"mt-3",children:[r.jsx("div",{className:"text-[11px] text-slate-300 mb-1",children:"Subpartidas:"}),r.jsx("div",{className:"grid gap-2",children:c.subRows.map((x,S)=>{const h=Array.isArray(x.apuIds)?x.apuIds:[],A=Number(x.metrados||0);return r.jsxs("div",{className:"rounded-lg border border-slate-700 p-2 bg-slate-900/60",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("div",{className:"text-sm text-slate-200 truncate",title:x.descripcion||"Subpartida",children:x.descripcion&&x.descripcion.trim()||"Subpartida"}),r.jsxs("div",{className:"text-[11px] text-slate-400 whitespace-nowrap",children:[A," ",x.unidadSalida||""]})]}),h.length>0&&r.jsx("div",{className:"mt-1 pl-2",children:h.map(G=>{try{const z=C(G),Q=(z==null?void 0:z.unidadSalida)||"GL",B=(()=>{try{return yt(z,o).unit}catch{return 0}})();return r.jsxs("div",{className:"flex items-center gap-2 text-[11px]",children:[r.jsx("span",{className:"text-slate-500",children:"•"}),r.jsx("button",{onClick:()=>Cr(G),className:"text-slate-200 hover:underline text-left",title:z.descripcion,children:z.descripcion}),r.jsxs("span",{className:"text-slate-400",children:["— ",Q," · ",pt(B)]})]},G)}catch{return null}})})]},x.id||S)})})]})]}),r.jsx("button",{onClick:()=>{confirm("¿Eliminar esta partida completa?")&&iu(c.id)},className:"ml-3 p-1 h-8 w-8 flex items-center justify-center rounded text-slate-300 hover:text-white hover:bg-slate-700/40",title:"Eliminar partida","aria-label":"Eliminar partida",children:r.jsx(ma,{className:"h-4 w-4"})})]})]},c.id)})},l.id)})}),r.jsx("div",{className:"hidden lg:block",children:r.jsx(c0,{chapters:Re,rows:Ee,getApuById:C,unitCost:yt,resources:o,fmt:pt,onPickApu:l=>Ar({open:!0,rowId:l}),onAddSubRow:l=>{const d=(prompt("Nombre de la subpartida:")||"").trim();if(!d)return;const c={id:Ie(),descripcion:d,apuIds:[],metrados:1,unidadSalida:"",overrideUnitPrice:void 0,overrideTotal:void 0,_noAutoApu:!0},f=Ee.map(g=>g.id===l?{...g,subRows:[...g.subRows||[],c]}:g);it(f),at(f),t("Subpartida agregada","success")},onUpdateSubRow:(l,d,c)=>{const f=Ee.map(g=>{if(g.id!==l)return g;const m=(g.subRows||[]).map(x=>x.id===d?{...x,...c}:x);return{...g,subRows:m}});it(f),at(f)},onRemoveSubRow:(l,d)=>{const c=Ee.map(f=>f.id===l?{...f,subRows:(f.subRows||[]).filter(g=>g.id!==d)}:f);it(c),at(c),t("Subpartida eliminada","info")},onMoveChapter:Eh,onDelete:iu,onUpdateRow:Oh,onDuplicate:Rh,onShowApuDetail:l=>Cr(l),onAddSubChapter:Nh,onRenameSubChapter:Ch,onDeleteSubChapter:Ah})})]}),r.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"bg-slate-800 rounded-2xl p-4 shadow grid grid-cols-1 sm:grid-cols-3 gap-3 md:col-span-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-sm text-slate-300",children:"Gastos generales (%)"}),r.jsxs("div",{className:"mt-1 relative",children:[r.jsx("input",{type:"number",step:.1,min:0,max:100,value:Number.isFinite(p)?Math.round(p*1e3)/10:0,onChange:l=>{const d=parseFloat(l.target.value),c=Number.isFinite(d)?Math.min(100,Math.max(0,d)):0;v(c/100)},className:"w-full bg-slate-900 border border-slate-700 rounded-xl p-2 pr-10"}),r.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:"%"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm text-slate-300",children:"Utilidad (%)"}),r.jsxs("div",{className:"mt-1 relative",children:[r.jsx("input",{type:"number",step:.1,min:0,max:100,value:Number.isFinite(_)?Math.round(_*1e3)/10:0,onChange:l=>{const d=parseFloat(l.target.value),c=Number.isFinite(d)?Math.min(100,Math.max(0,d)):0;b(c/100)},className:"w-full bg-slate-900 border border-slate-700 rounded-xl p-2 pr-10"}),r.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:"%"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-sm text-slate-300",children:"IVA (%)"}),r.jsxs("div",{className:"mt-1 relative",children:[r.jsx("input",{type:"number",step:.1,min:0,max:100,value:Number.isFinite(j)?Math.round(j*1e3)/10:0,onChange:l=>{const d=parseFloat(l.target.value),c=Number.isFinite(d)?Math.min(100,Math.max(0,d)):0;E(c/100)},className:"w-full bg-slate-900 border border-slate-700 rounded-xl p-2 pr-10"}),r.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400",children:"%"})]})]}),r.jsx("div",{className:"col-span-1 sm:col-span-3",children:r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Notas"}),r.jsx("textarea",{rows:3,value:F,onChange:l=>D(l.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-xl p-2",placeholder:"Notas u observaciones del presupuesto"})]})})]}),r.jsxs("div",{className:"bg-slate-800 rounded-2xl p-4 shadow grid gap-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-slate-300",children:"Directo"}),r.jsx("b",{children:pt(jr)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-slate-300",children:["Gastos generales (",(p*100).toFixed(1),"%)"]}),r.jsx("b",{children:pt(ou)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-slate-300",children:"Sub-Total"}),r.jsx("b",{children:pt(ml)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-slate-300",children:["Utilidad (",(_*100).toFixed(1),"%)"]}),r.jsx("b",{children:pt(lu)})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-slate-300",children:["IVA (",(j*100).toFixed(1),"%)"]}),r.jsx("b",{children:pt(du)})]}),r.jsxs("div",{className:"mt-2 p-3 rounded-xl bg-slate-900 flex items-center justify-between",children:[r.jsx("span",{children:"Total"}),r.jsx("span",{className:"text-xl font-extrabold",children:pt($h)})]})]})]})]})})]}),r.jsx("footer",{className:"text-xs text-slate-500 text-center pt-6",children:"MVP de vista y cálculo. Próximos pasos: catálogo persistente, listas de precios, UF, plantillas de capítulos y exportación PDF/XLSX."}),r.jsx(s0,{open:xl.open,onClose:()=>Ar({open:!1,rowId:null}),onPick:l=>{_u(l)},apus:Y,onCreateNew:()=>{const l=xl.rowId;l&&(Ar({open:!1,rowId:null}),Jh(l))}}),r.jsx(S_,{open:ui.open,onClose:Bh,apu:ui.id?C(ui.id):null,fmt:pt,resources:o,onSave:l=>{ui.id&&qh(ui.id,l)}})]})]})};function S_({open:e,onClose:t,apu:a,fmt:n,resources:i,onSave:s}){var K;if(!e||!a)return null;const o=V.useMemo(()=>{const C=a.secciones;if(C)return C;const U={materiales:[],equipos:[],manoObra:[],varios:[]};return(a.items||[]).forEach(R=>{const H=i[R.resourceId];if(!H)return;const ne=R.tipo==="coef"?Number(R.coef||0)*(1+Number(R.merma||0)):1/Math.max(1,Number(R.rendimiento||1)),T=Number(H.precio||0),de=ne*T,ee={descripcion:H.nombre,unidad:H.unidad,cantidad:ne,pu:T,total:de};switch(H.tipo){case"material":U.materiales.push(ee);break;case"equipo":U.equipos.push(ee);break;case"mano_obra":U.manoObra.push(ee);break;default:U.varios.push(ee);break}}),U},[a,i]),u=(o==null?void 0:o.__meta)||{},[p,v]=V.useState({descripcion:String(a.descripcion||""),unidadSalida:String(a.unidadSalida||""),categoria:String(a.categoria||"")}),_=[{key:"materiales",title:"A.- MATERIALES"},{key:"equipos",title:"B.- EQUIPOS, MAQUINARIAS Y TRANSPORTES"},{key:"manoObra",title:"C.- MANO DE OBRA"},{key:"varios",title:"D.- VARIOS"}],[b,j]=V.useState({materiales:[],equipos:[],manoObra:[],varios:[],extras:[],__meta:{...u||{}}}),[E,F]=V.useState({});V.useEffect(()=>{v({descripcion:String(a.descripcion||""),unidadSalida:String(a.unidadSalida||""),categoria:String(a.categoria||"")});const C=["materiales","equipos","manoObra","varios"],U=o||{},R={materiales:Array.isArray(U.materiales)?[...U.materiales]:[],equipos:Array.isArray(U.equipos)?[...U.equipos]:[],manoObra:Array.isArray(U.manoObra)?[...U.manoObra]:[],varios:Array.isArray(U.varios)?[...U.varios]:[],__meta:{...U.__meta||{}},extras:[]};Array.isArray(U.extras)?R.extras=U.extras.map(ne=>({title:(ne==null?void 0:ne.title)||"SECCIÓN",rows:Array.isArray(ne==null?void 0:ne.rows)?[...ne.rows]:[]})):Object.keys(U).filter(ne=>!C.includes(ne)&&ne!=="__meta"&&ne!=="__titles"&&ne!=="extras").forEach(ne=>{const T=U[ne],de=Array.isArray(T)?[...T]:T&&Array.isArray(T.rows)?[...T.rows]:[];R.extras.push({title:String(ne).toUpperCase(),rows:de})});const H=ne=>ne&&ne.length>0?ne:[{descripcion:"",unidad:"",cantidad:0,pu:0}];j({materiales:H(R.materiales),equipos:H(R.equipos),manoObra:H(R.manoObra),varios:H(R.varios),__meta:{...R.__meta||{}},extras:(R.extras||[]).map(ne=>({title:ne.title||"SECCIÓN",rows:H(Array.isArray(ne.rows)?ne.rows:[])}))});const X=(o==null?void 0:o.__titles)||{};F(X&&typeof X=="object"?X:{})},[e,a,o]);const D=(C,U,R)=>{j(H=>{const X=[...H[C]||[]];return X[U]={...X[U],...R},{...H,[C]:X}})},me=C=>j(U=>({...U,[C]:[...U[C]||[],{descripcion:"",unidad:"",cantidad:0,pu:0}]})),N=(C,U)=>j(R=>({...R,[C]:(R[C]||[]).filter((H,X)=>X!==U)})),y=C=>j(U=>({...U,__meta:{...U.__meta||{},...C}})),O=()=>{var U;const C=(U=prompt("Nombre de la nueva sección:"))==null?void 0:U.trim();C&&j(R=>({...R,extras:[...R.extras||[],{title:C,rows:[{descripcion:"",unidad:"",cantidad:0,pu:0}]}]}))},L=(C,U,R)=>{j(H=>{const X=[...H.extras||[]],ne={...X[C]},T=[...ne.rows||[]];return T[U]={...T[U],...R},X[C]={...ne,rows:T},{...H,extras:X}})},ie=C=>j(U=>{const R=[...U.extras||[]],H={...R[C]},X=[...H.rows||[]];return X.push({descripcion:"",unidad:"",cantidad:0,pu:0}),R[C]={...H,rows:X},{...U,extras:R}}),Y=(C,U)=>j(R=>{const H=[...R.extras||[]],X={...H[C]},ne=[...X.rows||[]];return ne.splice(U,1),H[C]={...X,rows:ne},{...R,extras:H}}),Z=C=>{j(U=>{var ne;const R=[...U.extras||[]],H=R[C];if(!H)return U;const X=(ne=prompt("Nuevo nombre de la sección:",H.title||"SECCIÓN"))==null?void 0:ne.trim();return X?(R[C]={...H,title:X},{...U,extras:R}):U})},M=C=>{confirm("¿Eliminar esta sección completa?")&&j(U=>{const R=[...U.extras||[]];return R.splice(C,1),{...U,extras:R}})};return r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:t}),r.jsxs("div",{className:"relative bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-4xl mx-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[r.jsx("div",{className:"flex-1 grid gap-2",children:r.jsxs("div",{className:"grid md:grid-cols-3 gap-2",children:[r.jsxs("label",{className:"text-xs text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Descripción"}),r.jsx("input",{className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded px-2 py-1 text-sm",value:p.descripcion,onChange:C=>v(U=>({...U,descripcion:C.target.value}))})]}),r.jsxs("label",{className:"text-xs text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Unidad salida"}),(()=>{const C=["m","m2","m3","kg","u","jornal","hora","día","ml","cm","mm"],U=Array.from(new Set([p.unidadSalida,...C].map(H=>String(H||"").trim()).filter(Boolean))).sort(),R=`apu-detail-units-${(a==null?void 0:a.id)||""}`;return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:R,className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded px-2 py-1 text-sm",value:p.unidadSalida,onChange:H=>v(X=>({...X,unidadSalida:H.target.value}))}),r.jsx("datalist",{id:R,children:U.map(H=>r.jsx("option",{value:H},H))})]})})()]}),r.jsxs("label",{className:"text-xs text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Categoría"}),(()=>{const C=["Obra gruesa","Terminaciones","Techumbre","Instalaciones sanitarias","Instalaciones eléctricas","Fachada","Servicios"],U=Array.from(new Set([p.categoria,...C].map(H=>String(H||"").trim()).filter(Boolean))).sort(),R=`apu-detail-cats-${(a==null?void 0:a.id)||""}`;return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:R,className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded px-2 py-1 text-sm",value:p.categoria,onChange:H=>v(X=>({...X,categoria:H.target.value}))}),r.jsx("datalist",{id:R,children:U.map(H=>r.jsx("option",{value:H},H))})]})})()]})]})}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>{try{const C={apuId:String((a==null?void 0:a.id)||""),descripcion:p.descripcion,unidadSalida:p.unidadSalida,metrados:1};localStorage.setItem("calculator-inject",JSON.stringify(C))}catch{}t()},className:"px-2 py-1 rounded bg-indigo-700 hover:bg-indigo-600 text-white text-xs",title:"Agregar este APU a la Calculadora",children:"Agregar a Calculadora"}),r.jsx("button",{onClick:()=>{if(!confirm("¿Borrar TODAS las secciones y dejar solo una vacía?"))return;const C=(prompt("Nombre de la única sección que quedará:","SECCIÓN")||"").trim()||"SECCIÓN";j({materiales:[],equipos:[],manoObra:[],varios:[],extras:[{title:C,rows:[{descripcion:"",unidad:"",cantidad:0,pu:0}]}]}),F({})},className:"px-2 py-1 rounded border border-slate-600 hover:bg-slate-700/30 text-xs",children:"Borrar todas las secciones"}),r.jsx("button",{onClick:O,className:"px-2 py-1 rounded border border-slate-600 hover:bg-slate-700/40 text-xs",children:"+ Agregar sección"}),r.jsx("button",{onClick:t,className:"text-slate-300 hover:text-white",children:"×"})]})]}),r.jsxs("div",{className:"p-4 grid gap-3 max-h-[75vh] overflow-y-auto",children:[_.map(C=>{const U=(b==null?void 0:b[C.key])||[],R=U.reduce((X,ne)=>X+(Number(ne.cantidad)||0)*(Number(ne.pu)||0),0),H=E[C.key]||C.title;return U.length?r.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 overflow-x-auto",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 text-[11px] text-slate-300 font-medium border-b border-slate-800",children:[r.jsx("div",{children:H}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>{var ne;const X=(ne=prompt("Nuevo nombre de la sección:",H))==null?void 0:ne.trim();X&&F(T=>({...T,[C.key]:X}))},className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 text-[11px]",children:"Renombrar"}),r.jsx("button",{onClick:()=>j(X=>({...X,[C.key]:[]})),className:"px-2 py-1 rounded border border-slate-600 hover:bg-slate-700/30 text-[11px]",children:"Eliminar"}),r.jsx("button",{onClick:()=>me(C.key),className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 text-[11px]",children:"+ Fila"})]})]}),r.jsxs("table",{className:"min-w-full text-[12px]",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-slate-300",children:[r.jsx("th",{className:"py-1.5 px-3",children:"Descripción"}),r.jsx("th",{className:"py-1.5 px-3 w-20",children:"Unidad"}),r.jsx("th",{className:"py-1.5 px-3 w-24 text-right tabular-nums",children:"Cantidad"}),r.jsx("th",{className:"py-1.5 px-3 w-28 text-right tabular-nums",children:"P. Unit."}),r.jsx("th",{className:"py-1.5 px-3 w-28 text-right tabular-nums",children:"Total"}),r.jsx("th",{className:"py-1.5 px-3 w-12"})]})}),r.jsxs("tbody",{className:"divide-y divide-slate-800",children:[U.map((X,ne)=>r.jsxs("tr",{children:[r.jsx("td",{className:"py-1.5 px-3",children:r.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded px-2 py-1",value:X.descripcion||"",onChange:T=>D(C.key,ne,{descripcion:T.target.value})})}),r.jsx("td",{className:"py-1.5 px-3",children:r.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded px-2 py-1",value:X.unidad||"",onChange:T=>D(C.key,ne,{unidad:T.target.value})})}),r.jsx("td",{className:"py-1.5 px-3 text-right tabular-nums",children:r.jsx("input",{type:"number",className:"w-full text-right bg-slate-900 border border-slate-700 rounded px-2 py-1",value:Number(X.cantidad||0),onChange:T=>D(C.key,ne,{cantidad:Number(T.target.value)||0})})}),r.jsx("td",{className:"py-1.5 px-3 text-right tabular-nums",children:r.jsx(ei,{value:Number.isFinite(Number(X.pu))?Number(X.pu):void 0,onChange:T=>D(C.key,ne,{pu:Number(T||0)})})}),r.jsx("td",{className:"py-1.5 px-3 text-right tabular-nums",children:n(Number(X.cantidad||0)*Number(X.pu||0))}),r.jsx("td",{className:"py-1.5 px-3 text-right",children:r.jsx("button",{onClick:()=>N(C.key,ne),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Eliminar fila","aria-label":"Eliminar fila",children:r.jsx(ma,{className:"h-4 w-4"})})})]},ne)),r.jsxs("tr",{className:"bg-slate-900/50",children:[r.jsx("td",{colSpan:5,className:"py-2 px-3 text-right font-medium",children:"TOTAL"}),r.jsx("td",{className:"py-2 px-3 text-right font-semibold tabular-nums",children:n(R)})]})]})]})]},C.key):null}),(b.extras||[]).map((C,U)=>{const R=C.rows||[],H=R.reduce((X,ne)=>X+(Number(ne.cantidad)||0)*(Number(ne.pu)||0),0);return r.jsxs("div",{className:"bg-slate-900 rounded-lg border border-slate-800 overflow-x-auto",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 text-[11px] text-slate-300 font-medium border-b border-slate-800",children:[r.jsx("div",{children:C.title||"SECCIÓN"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>Z(U),className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 text-[11px]",children:"Renombrar"}),r.jsx("button",{onClick:()=>M(U),className:"px-2 py-1 rounded border border-slate-600 hover:bg-slate-700/30 text-[11px]",children:"Eliminar"}),r.jsx("button",{onClick:()=>ie(U),className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 text-[11px]",children:"+ Fila"})]})]}),r.jsxs("table",{className:"min-w-full text-[12px]",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"text-left text-slate-300",children:[r.jsx("th",{className:"py-1.5 px-3",children:"Descripción"}),r.jsx("th",{className:"py-1.5 px-3 w-20",children:"Unidad"}),r.jsx("th",{className:"py-1.5 px-3 w-24 text-right tabular-nums",children:"Cantidad"}),r.jsx("th",{className:"py-1.5 px-3 w-28 text-right tabular-nums",children:"P. Unit."}),r.jsx("th",{className:"py-1.5 px-3 w-28 text-right tabular-nums",children:"Total"}),r.jsx("th",{className:"py-1.5 px-3 w-12"})]})}),r.jsxs("tbody",{className:"divide-y divide-slate-800",children:[R.map((X,ne)=>r.jsxs("tr",{children:[r.jsx("td",{className:"py-1.5 px-3",children:r.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded px-2 py-1",value:X.descripcion||"",onChange:T=>L(U,ne,{descripcion:T.target.value})})}),r.jsx("td",{className:"py-1.5 px-3",children:r.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded px-2 py-1",value:X.unidad||"",onChange:T=>L(U,ne,{unidad:T.target.value})})}),r.jsx("td",{className:"py-1.5 px-3 text-right tabular-nums",children:r.jsx("input",{type:"number",className:"w-full text-right bg-slate-900 border border-slate-700 rounded px-2 py-1",value:Number(X.cantidad||0),onChange:T=>L(U,ne,{cantidad:Number(T.target.value)||0})})}),r.jsx("td",{className:"py-1.5 px-3 text-right tabular-nums",children:r.jsx(ei,{value:Number.isFinite(Number(X.pu))?Number(X.pu):void 0,onChange:T=>L(U,ne,{pu:Number(T||0)})})}),r.jsx("td",{className:"py-1.5 px-3 text-right tabular-nums",children:n(Number(X.cantidad||0)*Number(X.pu||0))}),r.jsx("td",{className:"py-1.5 px-3 text-right",children:r.jsx("button",{onClick:()=>Y(U,ne),className:"p-1 rounded-md text-slate-300 hover:text-white hover:bg-slate-700/60",title:"Eliminar fila","aria-label":"Eliminar fila",children:r.jsx(ma,{className:"h-4 w-4"})})})]},ne)),r.jsxs("tr",{className:"bg-slate-900/50",children:[r.jsx("td",{colSpan:5,className:"py-2 px-3 text-right font-medium",children:"TOTAL"}),r.jsx("td",{className:"py-2 px-3 text-right font-semibold tabular-nums",children:n(H)})]})]})]})]},`extra_${U}`)}),(()=>{const C=((b==null?void 0:b.materiales)||[]).reduce((T,de)=>T+(Number(de.cantidad)||0)*(Number(de.pu)||0),0),U=((b==null?void 0:b.equipos)||[]).reduce((T,de)=>T+(Number(de.cantidad)||0)*(Number(de.pu)||0),0),R=((b==null?void 0:b.manoObra)||[]).reduce((T,de)=>T+(Number(de.cantidad)||0)*(Number(de.pu)||0),0),H=((b==null?void 0:b.varios)||[]).reduce((T,de)=>T+(Number(de.cantidad)||0)*(Number(de.pu)||0),0),X=((b==null?void 0:b.extras)||[]).reduce((T,de)=>T+(de.rows||[]).reduce((ee,ge)=>ee+(Number(ge.cantidad)||0)*(Number(ge.pu)||0),0),0),ne=C+U+R+H+X;return r.jsx("div",{className:"mt-1 flex items-center justify-end",children:r.jsxs("div",{className:"text-sm",children:["Costo directo unitario: ",r.jsx("b",{children:n(ne)})]})})})()]}),r.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center justify-between gap-3 p-4 border-t border-slate-800",children:[r.jsx("div",{className:"grid gap-3 w-full md:w-auto",children:r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Observaciones"}),r.jsx("textarea",{rows:2,value:((K=b.__meta)==null?void 0:K.obs)||"",onChange:C=>y({obs:C.target.value}),className:"bg-slate-800 border border-slate-700 rounded-xl p-2",placeholder:"Notas/observaciones del APU"})]})}),r.jsxs("div",{className:"flex justify-end gap-2 w-full md:w-auto",children:[r.jsx("button",{onClick:t,className:"px-3 py-2 rounded-xl border border-slate-600",children:"Cerrar"}),r.jsx("button",{onClick:()=>s({secciones:{...b,__titles:E},descripcion:p.descripcion,unidadSalida:p.unidadSalida,categoria:p.categoria}),className:"px-3 py-2 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40",children:"Guardar"})]})]})]})]})}function p0({open:e,title:t,children:a,onClose:n}){return e?r.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:n}),r.jsxs("div",{className:"relative bg-slate-900 border border-slate-700 rounded-2xl w-full max-w-2xl mx-4",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800",children:[r.jsx("h3",{className:"text-lg font-semibold",children:t}),r.jsx("button",{onClick:n,className:"text-slate-300 hover:text-white",children:"×"})]}),r.jsx("div",{className:"p-4",children:a})]})]}):null}function Hp({open:e,onClose:t,onSave:a,initial:n}){const[i,s]=q.useState({descripcion:"",unidadSalida:"m2",categoria:""});return q.useEffect(()=>{s(n?{descripcion:n.descripcion||"",unidadSalida:n.unidadSalida||"m2",categoria:n.categoria||""}:{descripcion:"",unidadSalida:"m2",categoria:""})},[n]),r.jsx(p0,{open:e,title:n?"Modificación APU":"Creación APU",onClose:t,children:r.jsxs("div",{className:"grid gap-3",children:[r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Descripción"}),r.jsx("input",{className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:i.descripcion,onChange:o=>s({...i,descripcion:o.target.value})})]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Unidad"}),(()=>{const o=["m","m2","m3","kg","u","jornal","hora","día","ml","cm","mm"],u=Array.from(new Set([i.unidadSalida,...o].map(v=>String(v||"").trim()).filter(Boolean))).sort(),p="create-apu-units";return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:p,className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:i.unidadSalida,onChange:v=>s({...i,unidadSalida:v.target.value})}),r.jsx("datalist",{id:p,children:u.map(v=>r.jsx("option",{value:v},v))})]})})()]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Categoría"}),(()=>{const o=["Obra gruesa","Terminaciones","Techumbre","Instalaciones sanitarias","Instalaciones eléctricas","Fachada","Servicios"],u=Array.from(new Set([i.categoria||"",...o].map(v=>String(v||"").trim()).filter(Boolean))).sort(),p="create-apu-cats";return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:p,className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:i.categoria||"",onChange:v=>s({...i,categoria:v.target.value})}),r.jsx("datalist",{id:p,children:u.map(v=>r.jsx("option",{value:v},v))})]})})()]}),r.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[r.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/40",children:"Cerrar"}),r.jsx("button",{onClick:()=>a({descripcion:i.descripcion,unidadSalida:i.unidadSalida,categoria:i.categoria||"",items:[],secciones:void 0}),className:"px-4 py-2 rounded-xl border border-slate-600 text-slate-200 hover:bg-slate-700/30",children:"Guardar"})]})]})})}function w_({open:e,onClose:t,onGenerate:a,builders:n}){const[i,s]=q.useState(""),[o,u]=q.useState(""),[p,v]=q.useState(""),[_,b]=q.useState(""),j=()=>{var K;const E=i.split(/\r?\n/).map(C=>C.trim()).filter(Boolean),F={descripcion:_||"APU sin título",unidadSalida:o||"m2",categoria:p||"",secciones:{materiales:[],equipos:[],manoObra:[],varios:[],extras:[]}},D=C=>/[|;\t]|@|\$\s*\d/.test(C),me=E[0]||"",N=(_+" "+me).toLowerCase().trim(),y=C=>{const U=C.match(/(\d+(?:[\.,]\d+)?)\s*([a-zA-Záéíóúüñ°²³\/]+)\b/);return U?{qty:Number(String(U[1]).replace(",",".")),unit:(U[2]||"").toLowerCase()}:{qty:1,unit:""}},L=(C=>{var H,X,ne,T,de,ee,ge,fe,Fe,te,_t,wt,lt,gt,jt,ca,Se,we,Un;if(!C||D(i))return null;const U=C.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),""),R=(...va)=>va.some(Da=>U.includes(Da));return R("radier","contrapiso","platea","losa radier")?((H=n==null?void 0:n.buildApuRadierH25ConMalla)==null?void 0:H.call(n))||null:R("pavimento","vereda","calzada","acera","pavi")&&(R("h25","h-25","h 25")||R("8cm","8 cm"))?((X=n==null?void 0:n.buildApuPavimentoExteriorH25_8cmMalla)==null?void 0:X.call(n))||null:R("hormigon","concreto","h-25","h25","h 25")?((ne=n==null?void 0:n.buildApuH25ObraVibradoM3)==null?void 0:ne.call(n))||null:R("excavacion","excavar","excavaciones","zanjeo","zanja","zanjas")&&R("retiro","botadero","dispos","disposicion","camion","tolva","traslado","vertedero","acopio")?((T=n==null?void 0:n.buildApuExcavacionRetiroM3)==null?void 0:T.call(n))||null:R("excavacion","excavar","excavaciones","zanjeo","zanja","zanjas")?((de=n==null?void 0:n.buildApuExcavacionZanjaManual)==null?void 0:de.call(n))||null:R("relleno","rellenos")||R("compact","compactacion","compactar","vibroplaca","apisonadora","pison","placa")?((ee=n==null?void 0:n.buildApuRellenoCompactManual)==null?void 0:ee.call(n))||null:R("zapata","cimiento corrido","fundacion corrida")?((ge=n==null?void 0:n.buildApuZapataCorridaEnZanja)==null?void 0:ge.call(n))||null:R("enfierradura","armado","acero","fierro","barras","corrugado","armadura")?((fe=n==null?void 0:n.buildApuEnfierraduraKg)==null?void 0:fe.call(n))||null:R("curado","curado humedo","cura")?((Fe=n==null?void 0:n.buildApuCuradoHumedoM2)==null?void 0:Fe.call(n))||null:R("impermeabilizacion","hidrofugo","membrana cementicia","impermeabilizacion cementicia","sikatop")?((te=n==null?void 0:n.buildApuImperCementicia2capasM2)==null?void 0:te.call(n))||null:R("piscina")&&R("pintura","revestimiento","epoxica","clorada")?((_t=n==null?void 0:n.buildApuPinturaPiscina2manosM2)==null?void 0:_t.call(n))||null:R("tabique","tabiqueria","metalcon","drywall","yeso carton","durlock")?((wt=n==null?void 0:n.buildApuTabiqueMetalconDoblePlaca)==null?void 0:wt.call(n))||null:R("cielo raso","cielo","plafon","cielo americano")&&R("yeso","carton","yeso carton")?((lt=n==null?void 0:n.buildApuCieloRasoYesoCarton)==null?void 0:lt.call(n))||null:R("muro","albanileria","ladrillo","aparejo")?((gt=n==null?void 0:n.buildApuAlbanileriaLadrilloComun)==null?void 0:gt.call(n))||((jt=n==null?void 0:n.buildApuMuroLadrillo)==null?void 0:jt.call(n))||null:R("techumbre","cercha","cerchas","estructura techo")?((ca=n==null?void 0:n.buildApuEstructuraTechumbreMadera)==null?void 0:ca.call(n))||null:R("cubierta","chapa","zinc","aluzinc","colorbond","plancha")&&R("zinc","chapa","aluzinc","plancha")?((Se=n==null?void 0:n.buildApuCubiertaZincFieltro)==null?void 0:Se.call(n))||null:R("valvula")&&R("bola","esfera")?((we=n==null?void 0:n.buildApuRedHid_ValvulaBola50_u)==null?void 0:we.call(n))||null:R("tuberia","caneria","cañeria","pvc","caner")&&R("ø50","50mm","50 mm","dn50"," 50"," 050","50")&&((Un=n==null?void 0:n.buildApuRedHid_PVC50_Tuberia_ml)==null?void 0:Un.call(n))||null})(N);if(L){const{unit:C}=y(me),U=(o||C||L.unidadSalida||"").trim(),R=(_||L.descripcion||"APU generado").trim(),H=(p||L.categoria||"").trim();return{...L,descripcion:R,unidadSalida:U||L.unidadSalida,categoria:H}}const ie=(C,U)=>{const R=(C||"").toLowerCase(),H=(U||"").toLowerCase();return["maestro","ayudante","carpintero","yesero","pintor","albañil","topógrafo","topografo","operador","jornal","mano de obra","peón","peon"].some(T=>R.includes(T))||["jornal","hh","hora-hombre","h-h","h/h"].some(T=>H.includes(T))?"manoObra":R.includes("herramientas menores")||R.includes("misceláneos")||R.includes("miscelaneos")||R.includes("imprevisto")||R.includes("gastos varios")||R.includes("miscel")?"varios":["retroexcavadora","bomba","betonera","vibrador","compactadora","andamio","grúa","grua","camión","camion","mixer","generador","equipo","pluma","martillo","cortadora","sierra"].some(T=>R.includes(T))||["hora","día","dia"].some(T=>H.includes(T))&&(R.includes("equipo")||R.includes("maquinaria"))?"equipos":"materiales"},Y=C=>Number(String(C||"").replace(/[^0-9,.-]/g,"").replace(/\.(?=.*\.)/g,"").replace(",","."))||0,Z=C=>{const U=(C||"").toLowerCase(),R=[["Obra gruesa",["excav","hormig","encofr","acero","radier","zapata","losa","moldaj","albañil","albanil","relleno","compactación","compactacion"]],["Terminaciones",["pintura","cerám","ceram","porcelanato","tabique","yeso","cielo","piso","guardapolvo","fragüe","fragüe","masilla"]],["Techumbre",["techumbre","cubierta","teja","zinc","fieltro","cumbrera","canaleta","bajada","entretechos"]],["Instalaciones sanitarias",["sanitaria","red hídr","red hid","pvc","desag","biodigestor","alcant"]],["Instalaciones eléctricas",["eléctrica","electrica","enchufe","cable","tablero","breaker","te1","sec"]],["Fachada",["fachada","revestimiento exterior","fibrocemento","siding"]],["Servicios",["trámite","tramite","permiso","dom","cálculo","calculo","recepción","recepcion"]]];for(const[H,X]of R)if(X.some(ne=>U.includes(ne)))return H;return""},M=C=>{let U=C.match(/^(\d+(?:[\.,]\d+)?)\s*([a-zA-Záéíóúüñ°²³\/%]+)\s+(.+?)\s*@\s*\$?\s*([\d\.,]+)/i);if(U){const R=Y(U[1]),H=(U[2]||"").trim(),X=(U[3]||"").trim(),ne=Y(U[4]);return{descripcion:X,unidad:H,cantidad:R,pu:ne}}if(U=C.match(/^(.+?)\s+(\d+(?:[\.,]\d+)?)\s*([a-zA-Záéíóúüñ°²³\/%]+)\s*\$?\s*([\d\.,]+)$/i),U){const R=(U[1]||"").trim(),H=Y(U[2]),X=(U[3]||"").trim(),ne=Y(U[4]);return{descripcion:R,unidad:X,cantidad:H,pu:ne}}if(U=C.match(/^(.+?)\s+(\d+(?:[\.,]\d+)?)\s*([a-zA-Záéíóúüñ°²³\/%]+)s?\b\s+([\d\.,]+)$/i),U){const R=(U[1]||"").trim(),H=Y(U[2]),X=(U[3]||"").trim(),ne=Y(U[4]);return{descripcion:R,unidad:X,cantidad:H,pu:ne}}return C.length>0?{descripcion:C,unidad:"",cantidad:1,pu:0}:null};for(const C of E){const U=C.toLowerCase().match(/^(material(es)?|equipo(s)?|mano\s*obra|varios)\s*[:：-]/i);if(U){const X=U[1].toLowerCase();X.startsWith("mater")||X.startsWith("equipo")||X.startsWith("mano");continue}const R=C.split(/\s*\|\s*|\t|;|,/);if(R.length>=3&&R[0]&&R[1]){const[X,ne,T,de]=R,ee={descripcion:(X||"").trim(),unidad:(ne||"").trim()||"",cantidad:Y(String(T||0)),pu:Y(String(de||0))};if(ee.descripcion){const ge=ie(ee.descripcion,ee.unidad);F.secciones[ge].push(ee)}continue}const H=M(C);if(H&&H.descripcion){const X=ie(H.descripcion,H.unidad);F.secciones[X].push(H)}}if(!String(p||"").trim()){const C=[_,...E].filter(Boolean).join(` 
 `),U=Z(C);U&&(F.categoria=U)}if(!String(o||"").trim()){const C=[...F.secciones.materiales||[],...F.secciones.equipos||[],...F.secciones.manoObra||[],...F.secciones.varios||[],...(F.secciones.extras||[]).flatMap(H=>(H==null?void 0:H.rows)||[])],U={};for(const H of C){const X=((H==null?void 0:H.unidad)||"").trim();if(!X)continue;const ne=Vo(X);U[ne]||(U[ne]={n:0,repr:X}),U[ne].n++}const R=(K=Object.values(U).sort((H,X)=>X.n-H.n)[0])==null?void 0:K.repr;R&&(F.unidadSalida=R)}return F};return r.jsx(p0,{open:e,title:"Asistente: Generar APU desde texto",onClose:t,children:r.jsxs("div",{className:"grid gap-3",children:[r.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Descripción APU"}),r.jsx("input",{className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:_,onChange:E=>b(E.target.value)})]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Unidad salida"}),(()=>{const E=["m","m2","m3","kg","u","jornal","hora","día","ml","cm","mm"],F=Array.from(new Set([o,...E].map(me=>String(me||"").trim()).filter(Boolean))).sort(),D="assist-apu-units";return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:D,className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:o,onChange:me=>u(me.target.value)}),r.jsx("datalist",{id:D,children:F.map(me=>r.jsx("option",{value:me},me))})]})})()]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:"Categoría"}),(()=>{const E=["Obra gruesa","Terminaciones","Techumbre","Instalaciones sanitarias","Instalaciones eléctricas","Fachada","Servicios"],F=Array.from(new Set([p,...E].map(me=>String(me||"").trim()).filter(Boolean))).sort(),D="assist-apu-cats";return r.jsxs(r.Fragment,{children:[r.jsx("input",{list:D,className:"bg-slate-800 border border-transparent focus:border-transparent focus:ring-0 rounded-xl p-2",value:p,onChange:me=>v(me.target.value)}),r.jsx("datalist",{id:D,children:F.map(me=>r.jsx("option",{value:me},me))})]})})()]})]}),r.jsxs("label",{className:"text-sm text-slate-300 grid gap-1",children:[r.jsx("span",{children:'Pega tu texto (una fila por línea) o escribe un prompt corto. Ejemplos rápidos: "1 m3 hormigón", "radier 10 cm", "excavación", "enfierradura". También soporta formatos: "descripcion | unidad | cantidad | pu" o libre tipo "1 m3 Hormigón H-25 @ $188.836". Auto-clasifica filas y sugiere Categoría por palabras clave; puedes forzar secciones con "Materiales:", "Equipos:", "Mano Obra:", "Varios:".'}),r.jsx("textarea",{className:"min-h-[220px] bg-slate-900 border border-slate-700 rounded-xl p-2 font-mono text-xs",value:i,onChange:E=>s(E.target.value),placeholder:`Materiales:
Cemento 25 kg | saco | 14 | 4790
Arena a granel | m3 | 0.563 | 32900

Mano Obra:
Maestro | m3 | 1 | 12500
Ayudante | m3 | 1 | 7300`})]}),r.jsxs("div",{className:"flex justify-end gap-2 pt-1",children:[r.jsx("button",{onClick:t,className:"px-3 py-2 rounded-xl border border-slate-600",children:"Cerrar"}),r.jsx("button",{onClick:()=>{const E=j();a(E)},className:"px-3 py-2 rounded-xl bg-indigo-700 hover:bg-indigo-600 text-white",children:"Generar APU"})]})]})})}Kl.createRoot(document.getElementById("root")).render(r.jsx(V.StrictMode,{children:r.jsx(y_,{})}));export{j_ as c,pg as g};
